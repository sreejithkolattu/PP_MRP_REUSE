/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("i2d.pp.mrpcockpit.reuse.controls.SolutionCard");sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.SolutionCardContainer",{metadata:{properties:{scrollStep:"int",animationSpeed:"int",cardWidth:"int",registrationID:"string",materialShortageHasNoSolution:"boolean"},defaultAggregation:"cards",aggregations:{"cards":{type:"i2d.pp.mrpcockpit.reuse.controls.SolutionCard",multiple:true,singularName:"card"},"ctrlScrollLeft":{type:"sap.ui.core.Icon",multiple:false},"ctrlScrollRight":{type:"sap.ui.core.Icon",multiple:false}},associations:{"activeCard":{type:"i2d.pp.mrpcockpit.reuse.controls.SolutionCard",multiple:false}}},init:function(){this.setAnimationSpeed(750);this.setCardWidth(148);this.setScrollStep(0);this.setMaterialShortageHasNoSolution(false);this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var c=new sap.ui.core.Icon({id:"mrpScrollLeft",src:"sap-icon://navigation-left-arrow"});this.setCtrlScrollLeft(c);var C=new sap.ui.core.Icon({id:"mrpScrollRight",src:"sap-icon://navigation-right-arrow"});this.setCtrlScrollRight(C);var b=sap.ui.getCore().getEventBus();b.subscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_DIALOG_START,this.onODataSent,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_DIALOG_CANCEL,this.unlockAllCards,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,this.onODataError,this)},exit:function(){sap.ui.core.ResizeHandler.deregister(this.getRegistrationID);var b=sap.ui.getCore().getEventBus();b.unsubscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_DIALOG_START,this.onODataSent,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_DIALOG_CANCEL,this.onODataSent,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,this.onODataError,this)},onODataError:function(){this.enableAllCards()},onODataSent:function(){this.lockAllCards()},enableAllCards:function(){var c=this.getCards();var i;for(i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_ENABLED)}},enableCard:function(c){var C=this.getCards();var i;for(i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ENABLED)}}},lockCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_LOCKED)}}},lockAllCards:function(){var c=this.getCards();for(var i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_LOCKED)}},unlockCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ENABLED)}}},unlockAllCards:function(){this.enableAllCards()},deactivateCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_DISABLED)}}},activateCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ACTIVE)}}},hideCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_HIDDEN)}}},disableAllCards:function(){var c=this.getCards();for(var i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_DISABLED)}},disableCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_DISABLED)}}},addSolutionCards:function(c,M){this.removeAllCards();if(M){this.setMaterialShortageHasNoSolution(true)}else{this.setMaterialShortageHasNoSolution(false);for(var i=0;i<c.length;i++){var C=new i2d.pp.mrpcockpit.reuse.controls.SolutionCard({myCard:c[i]});C.setModel(this.getModel("Common_i18n"),"Common_i18n");C.initCard();C.setState(this.Constants.CARD_STATE_ENABLED);this.addCard(C)}this.updateStatusOfSolutionCards();var b=this.getModel("Common_i18n").getResourceBundle();var o=this.getCtrlScrollLeft();o.setTooltip(b.getText("CARD_XTOL_ARROW"));var a=this.getCtrlScrollRight();a.setTooltip(b.getText("CARD_XTOL_ARROW"))}},updateStatusOfSolutionCards:function(c){var i;var C=this.getCards();var e=this.existsSolutionCardOfType(this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE);if(e){for(i=0;i<C.length;i++){var o=C[i];if(o.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){this.enableCard(o)}else if(o.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT){this.hideCard(o)}else{this.lockCard(o)}}}else{for(i=0;i<C.length;i++){var o=C[i];if(o!==c){if(c&&c.isSolutionCardActive()){this.disableCard(o)}else{this.enableCard(o)}}}}},existsSolutionCardOfType:function(s){var c=this.getCards();var e=false;for(var i=0;i<c.length;i++){if(c[i].getMaterialShortageSolutionType()===s){e=true}}return e},existsSolutionCardOfState:function(s){var c=this.getCards();for(var i=0;i<c.length;i++){if(c[i].hasState(s)){return true}}return false},addSolutionCard:function(c){var s=new i2d.pp.mrpcockpit.reuse.controls.SolutionCard({myCard:c});s.setModel(this.getModel("Common_i18n"),"Common_i18n");s.initCard();s.setState(this.Constants.CARD_STATE_ENABLED);this.addCard(s);this.updateStatusOfSolutionCards()},removeCards:function(){this.removeAllCards()},renderer:function(r,c){r.write('<div');r.addClass("sapMRPSolutions");r.writeClasses();r.writeControlData(c);r.write(">");if(c.getMaterialShortageHasNoSolution()){var m=new sap.m.TextArea({value:c.getModel("Common_i18n").getResourceBundle().getText("MATERIAL_SHORTAGE_HAS_NO_SOLUTION_MSG"),valueState:sap.ui.core.ValueState.Warning,rows:8,cols:100,editable:false});m.addStyleClass("sapMRPMaterialShortageHasNoSolutionDescription");r.renderControl(m)}else{r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardNavLeft");r.addClass("sapMRPSCLeft");r.addClass("sapMRPSCNav");r.writeClasses();r.write(">");r.renderControl(c.getCtrlScrollLeft());r.write("</div>");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardNavRight");r.addClass("sapMRPSCRight");r.addClass("sapMRPSCNav");r.writeClasses();r.write(">");r.renderControl(c.getCtrlScrollRight());r.write("</div>");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardMiddle");r.addClass("sapMRPSCMiddle");r.writeClasses();r.write(">");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardContainer");r.write(">");var C=c.getCards();for(var i=0;i<C.length;i++){r.renderControl(C[i])}}r.write("</div>")},onBeforeRendering:function(e){},onAfterRendering:function(e){this.updateSolutionCardContainerSize()},_getTapLocation:function(e){var t="";var l=jQuery("#"+this.getId());var c=l.children();var C=null;for(var i=0;i<c.length;i++){C=c[i];if(C.contains(e.target)){switch(e.target.id){case"mrpScrollLeft":t=this.Constants.CARD_AREA_SCROLLLEFT;break;case"mrpScrollRight":t=this.Constants.CARD_AREA_SCROLLRIGHT;break;case"mrpSolCardMiddle":t=this.Constants.CARD_AREA_OUTSIDE;break;default:t=this.Constants.CARD_AREA_INSIDE;break}}}return t},_getTapedSolutionCard:function(c){for(var i=0;i<7;i++){if(!c.getMaterialShortageSolutionType){c=c.getParent()}}if(c.getMaterialShortageSolutionType){return c}else{return null}},ontap:function(e){var c=null;var t=this._getTapLocation(e);switch(t){case this.Constants.CARD_AREA_SCROLLLEFT:this.moveToLeft(this.getScrollStep());break;case this.Constants.CARD_AREA_SCROLLRIGHT:this.moveToRight(this.getScrollStep());break;case this.Constants.CARD_AREA_INSIDE:case this.Constants.CARD_AREA_ICON:c=e.srcControl;c=this._getTapedSolutionCard(c);if(!c){return}if(c.isSolutionCardLocked()){return}if(c.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT){this.enableAllCards();return}if(c.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){return}this.updateStatusOfSolutionCards(c);break;case this.Constants.CARD_AREA_OUTSIDE:if(this.existsSolutionCardOfState(this.Constants.CARD_STATE_LOCKED)){return}this._triggerSolutionCardCancelPreview();this.enableAllCards();this.setActiveCard(null);break}},onswipeleft:function(e){this.moveToRight((this.getScrollStep()/2))},onswiperight:function(e){this.moveToLeft((this.getScrollStep()/2))},moveToLeft:function(p){$("#mrpSolCardMiddle").animate({scrollLeft:"-="+(p).toString()+"px"},this.getAnimationSpeed())},moveToRight:function(p){$("#mrpSolCardMiddle").animate({scrollLeft:"+="+(p).toString()+"px"},this.getAnimationSpeed())},updateSolutionCardContainerSize:function(){var c=this.getContainerWidth();$("#mrpSolCardContainer").width(c);var s=$(".sapMRPSolutions").parent().width();$(".sapMRPSolutions").width("100%");var S=32;var i=s-S;if(c<i){this._hideScrollArrows();this.setScrollStep(0)}else{this._showScrollArrows();var a=this.calculateScrollStep();this.setScrollStep(a)}},getContainerWidth:function(){var a=this.getCards().length;var c=$(".sapMRPSC").outerWidth(true);var s=10;return(a*c+s)},getContainerHeight:function(){var s=$(".sapMRPSolutions").height();return s},calculateScrollStep:function(){var a=0;var c=0;var C=$("#mrpSolCardMiddle").width();c=$(".sapMRPSC").outerWidth(true);if(c&&(c>0)){a=Math.floor(C/c)}return c*a},_hideScrollArrows:function(){$("#mrpScrollLeft").addClass("sapMRPScrollHidden");$("#mrpScrollRight").addClass("sapMRPScrollHidden")},_showScrollArrows:function(){$("#mrpScrollLeft").removeClass("sapMRPScrollHidden");$("#mrpScrollRight").removeClass("sapMRPScrollHidden")},_triggerSolutionCardCancelPreview:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_CANCEL,{model:null})},_getCountVisibleSolutionCards:function(){var c=0;var C=this.getCards();for(var i=0;i<C.length;i++){if(!C[i].hasState(this.Constants.CARD_STATE_HIDDEN)){c++}}return c}});
