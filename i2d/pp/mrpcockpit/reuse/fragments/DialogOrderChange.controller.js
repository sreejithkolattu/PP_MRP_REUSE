/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CollaborationHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CommonConstants");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.fragments.DialogRoot");jQuery.sap.require("sap.ca.ui.utils.busydialog");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.Number");jQuery.sap.require("sap.ca.ui.model.format.QuantityFormat");i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE);m.setProperty("/DialogRequestActive",this.Constants.REQUEST_ACTIVE);if(this.oDialog.getModel('ServiceVersions').getData().iServiceSchemaVersion<3){m.setProperty("/DialogRequestActive",this.Constants.REQUEST_INACTIVE)}switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PO_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_PO_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_PO_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var c=false;switch(d.SolutionRequestStatus){case this.Constants.REQUEST_STATUS_REQUESTED:case this.Constants.REQUEST_STATUS_ANSWERED:c=true;break;default:c=false}var E="";switch(d.DialogActivity){case this.Constants.SolutionDialogActivity_EXECUTE:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_APPLIED;E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePurchaseOrderBatch(d,this._oHandlerOrder,c,"x30");break;case this.Constants.SolutionDialogActivity_CR_REQUEST:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_REQUESTED;if(c===false){E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createRequestBatch(d,this._oHandlerCR)}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updateRequestBatch(d,this._oHandlerCR,"x30")}break;case this.Constants.SolutionDialogActivity_CR_COLLECT:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_COLLECTED;if(c===false){E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createRequestBatch(d,this._oHandlerCR)}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updateRequestBatch(d,this._oHandlerCR,"x30")}break;default:jQuery.sap.log.error("Dialog activity "+d.DialogActivity+" is unknown.")}if(E){var m="";sap.ca.ui.utils.busydialog.releaseBusyDialog();if(d.DialogActivity===this.Constants.SolutionDialogActivity_EXECUTE){m=this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR")}else{m=this.Common_i18n.getText("SOLUTION_DIALOG_MSG_REQUEST_SAVE_FAILED",[d.MRPElementExternalID,d.MRPElementItemExternalID])}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m,details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},_onSelectRadioButton1:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE)},_onSelectRadioButton2:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_CR_COLLECT)},_onSelectRadioButton3:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_CR_REQUEST)}});
