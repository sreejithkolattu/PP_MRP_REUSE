/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CollaborationHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CommonConstants");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.fragments.DialogRoot");jQuery.sap.require("sap.ca.ui.utils.busydialog");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.Number");jQuery.sap.require("sap.ca.ui.model.format.QuantityFormat");i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE);m.setProperty("/DialogConfigSourceDefined",true);m.setProperty("/DialogConfigCtrlOptionConvToProdOrd",true);m.setProperty("/DialogConfigCtrlOptionConvToProcOrd",true);m.setProperty("/DialogConfigCtrlOptionConvToReq",true);switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PA_STOCK_CHANGE:case this.Constants.SOLUTIONTYPE_PA_VENDOR_CHANGE:case this.Constants.SOLUTIONTYPE_PA_UNSRC_CHANGE:case this.Constants.SOLUTIONTYPE_PA_PLANT_CHANGE:case this.Constants.SOLUTIONTYPE_PA_REPLANT_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PA_CHANGE;break;case this.Constants.SOLUTIONTYPE_PA_PROD_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.getProperty("/PlannedOrder"),m.getProperty("/PlannedOrder")]));this.dialogAction=this.Constants.SolutionDialogAction_PA_CHANGE;break}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";switch(d.DialogActivity){case this.Constants.SolutionDialogActivity_EXECUTE:if((d.OrderFinishDate===d.ChangedOrderFinishDate)&&(d.MRPElementOriginalTotalQty===d.MRPElementChangedTotalQuantity)){E=this.Common_i18n.getText("SOLUTION_NO_CHANGES_MADE")}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePlannedOrderBatch(d,this._oHandlerOrder)}break;case this.Constants.SolutionDialogActivity_PROC_CONVERT:case this.Constants.SolutionDialogActivity_PROD_CONVERT:case this.Constants.SolutionDialogActivity_REQ_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePlannedOrderBatch(d,this._oHandlerOrder);break;default:jQuery.sap.log.error("Dialog action "+this.dialogAction+" is unknown.")}if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},_onSelectRadioButton1:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE)},_onSelectRadioButton2:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_PROD_CONVERT)},_onSelectRadioButton3:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_PROC_CONVERT)},_onSelectRadioButton4:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_REQ_CONVERT)}});
