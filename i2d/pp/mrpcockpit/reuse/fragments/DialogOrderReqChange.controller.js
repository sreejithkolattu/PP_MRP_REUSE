/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CollaborationHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CommonConstants");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.fragments.DialogRoot");jQuery.sap.require("sap.ca.ui.utils.busydialog");jQuery.sap.require("sap.ca.ui.message.message");jQuery.sap.require("sap.ca.ui.model.type.Number");jQuery.sap.require("sap.ca.ui.model.format.QuantityFormat");i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogConfigSourceDefined",true);m.setProperty("/DialogConfigCtrlOptionConvToOrd",false);m.setProperty("/DialogConfigCtrlOptionChangeReq",true);switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_PR_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_PR_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break}if(this.dialogAction===this.Constants.SolutionDialogAction_PR_CHANGE&&!m.getProperty("/Vendor")){m.setProperty("/DialogConfigSourceDefined",false)}else if(this.dialogAction===this.Constants.SolutionDialogAction_TOR_CHANGE&&!m.getProperty("/SupplyingPlant")){m.setProperty("/DialogConfigSourceDefined",false)}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";switch(this.dialogAction){case this.Constants.SolutionDialogAction_PR_CHANGE:case this.Constants.SolutionDialogAction_TOR_CHANGE:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePurchaseRequisitionBatch(d,this._oHandlerOrder);break;case this.Constants.SolutionDialogAction_PR_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.convertPurchaseRequisitionBatch(d,this._oHandlerOrder);d.MaterialShortageSolutionType=this.Constants.SOLUTIONTYPE_PO_CREATE;break;case this.Constants.SolutionDialogAction_TOR_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.convertPurchaseRequisitionBatch(d,this._oHandlerOrder);d.MaterialShortageSolutionType=this.Constants.SOLUTIONTYPE_TO_CREATE;break;default:jQuery.sap.log.error("Dialog action "+this.dialogAction+" is unknown.")}if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},onSelectOptionChangeReq:function(e){var m=e.getSource().getParent().getModel();var M=m.getProperty("/MaterialShortageSolutionType");switch(M){case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_PR_INCREASE:case this.Constants.SOLUTIONTYPE_PR_CHANGE:if(e.getParameter("selected")){this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE}else{this.dialogAction=this.Constants.SolutionDialogAction_PR_CONVERT}break;case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_TOR_INCREASE:case this.Constants.SOLUTIONTYPE_TOR_CHANGE:if(e.getParameter("selected")){this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE}else{this.dialogAction=this.Constants.SolutionDialogAction_TOR_CONVERT}break}}});
