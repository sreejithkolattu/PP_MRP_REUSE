/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.AoRAddDialog",{_DIALOG_ID:"DLG_SELECT",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n");jQuery.sap.require("sap.m.MessageToast");var d=this.getView().byId(this._DIALOG_ID);var o=(d._getOkButton?d._getOkButton():d.getOkButton());o.setEnabled(false);d._list.attachSelectionChange(function(E){var l=E.getSource();if(l.getSelectedItems().length>0){o.setEnabled(true)}else{o.setEnabled(false)}});d._list.attachUpdateStarted(function(){var l=d._busyIndicator||d._oBusyIndicator;d._listUpdateRequested+=d._ListUpdateRequested;if(d._listUpdateRequested>0){d._list.addStyleClass('sapMSelectDialogListHide');l.$().css('display','inline-block')}},this);d._list.attachUpdateFinished(function(){var l=d._busyIndicator||d._oBusyIndicator;d._list.removeStyleClass('sapMSelectDialogListHide');l.$().css('display','none');d._listUpdateRequested=0;d._ListUpdateRequested=0;d._list.setShowNoData(true)},this)},handleClose:function(e){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/closeFunction");c(e)},handleConfirm:function(e){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/confirmFunction");c(e)},search:function(e){var v=e.getParameter("value");var f=[];var F=new sap.ui.model.Filter("TextSearch",sap.ui.model.FilterOperator.Contains,v);f.push(F);var b=e.getSource().getBinding("items");var o=new sap.ui.model.Filter(f,false);b.filter(o)},});sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.AoRMainDialog",{_DIALOG_ID:"DLG_AOR_ID",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n");jQuery.sap.require("sap.m.MessageToast")},beforeOpen:function(e){var f=[];var F=new sap.ui.model.Filter("AreaOfResponsibility",sap.ui.model.FilterOperator.EQ,true);f.push(F);var b=e.getSource().getBinding("items");var o=new sap.ui.model.Filter(f,false);b.filter(o)},openSelDialog:function(e){var d=sap.ui.getCore().byId(this._DIALOG_ID);var o=d.getModel().getProperty("/addFunction");o(e);d.close()},onConfirmDialog:function(e){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/confirmFunction");d.close();c(e)},myDelete:function(e){var i=e.getParameter("listItem");var m=i.getParent().getModel("items");var d=m.getData();jQuery.each(i.getParent().getItems(),function(a,b){if(b==i){d.data.splice(a,1);return}});m.setData(d)},checkNumberOfItems:function(e){var d=sap.ui.getCore().byId(this._DIALOG_ID);if(e.getParameters().actual>0){setTimeout(function(){d.getBeginButton().setEnabled(true)},0)}else{setTimeout(function(){d.getBeginButton().setEnabled(false)},0)}}});sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.VariantDeleteDialog",{_VARIANT_NAME_ID:"TXF_VARIANT_NAME",_DIALOG_ID:"DLG_VARIANT_DELETE",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n")},onCancelDialog:function(e){var r={isConfirmed:false};this.closeDialog(r)},closeDialog:function(r){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/closeFunction");d.close();c(r)},onConfirmDialog:function(e){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/confirmFunction");d.close();c(e)}});jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.library-all');jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.AoRAddDialog');jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.AoRMainDialog');jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.VariantDeleteDialog');if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.ChartValue')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.controls.ChartValue");sap.ui.core.Element.extend("i2d.pp.mrpcockpit.reuse.controls.ChartValue",{metadata:{properties:{date:"string",demand:{type:"float",defaultValue:0},supply:{type:"float",defaultValue:0},shortageAccepted:{type:"boolean",defaultValue:false}}}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.ObjectIdentifier')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.controls.ObjectIdentifier");sap.m.ObjectIdentifier.extend("i2d.pp.mrpcockpit.reuse.controls.ObjectIdentifier",{metadata:{aggregations:{"link":{type:"sap.m.Link",multiple:false,singularName:"link"}},defaultAggregation:"link"},renderer:function(r,o){var l=o.getAggregation("link");if(l&&l.getEnabled()){r.write("<div");r.writeControlData(o);r.addClass("sapMObjectIdentifier sapMRPObjectIdentifier");r.writeClasses();r.write(">");r.write("<div");r.addClass("sapMObjectIdentifierTopRow");r.writeClasses();r.write(">");r.write("<div");r.addClass("sapMObjectIdentifierIcons");r.writeClasses();r.write(">");if(o.getBadgeAttachments()){r.write("<span");r.addClass("sapMObjectIdentifierIconSpan");r.writeClasses();r.write(">");r.renderControl(o._getAttachmentsIcon());r.write("</span>")}if(o.getBadgeNotes()){r.write("<span");r.addClass("sapMObjectIdentifierIconSpan");r.writeClasses();r.write(">");r.renderControl(o._getNotesIcon());r.write("</span>")}if(o.getBadgePeople()){r.write("<span");r.addClass("sapMObjectIdentifierIconSpan");r.writeClasses();r.write(">");r.renderControl(o._getPeopleIcon());r.write("</span>")}r.write("</div>");r.write("<div");r.addClass("sapMObjectIdentifierTitle");r.writeClasses();r.write(">");r.renderControl(l);r.write("</div>");r.write("</div>");r.write("<div");r.addClass("sapMObjectIdentifierText");r.writeClasses();r.write(">");r.writeEscaped(o.getText());r.write("</div>");r.write("</div>")}else{sap.m.ObjectIdentifierRenderer.render(r,o)}},})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.ObjectStatusBar')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.controls.ObjectStatusBar");sap.m.ObjectStatus.extend("i2d.pp.mrpcockpit.reuse.controls.ObjectStatusBar",{metadata:{aggregations:{layout:{type:"sap.ui.layout.HorizontalLayout",hidden:true,multiple:false},content:{type:"sap.m.ObjectStatus",multiple:true},},},init:function(){this.setAggregation("layout",new sap.ui.layout.HorizontalLayout())},addContent:function(s){return this.getAggregation("layout").addContent(s)},removeContent:function(s){return this.getAggregation("layout").removeContent(s)},destroyContent:function(s){return this.getAggregation("layout").destroyContent(s)},indexOfContent:function(s){return this.getAggregation("layout").indexOfContent(s)},removeAllContent:function(){return this.getAggregation("layout").removeAllContent()},renderer:function(r,o){r.write("<div");r.writeControlData(o);r.addClass("sapMRPObjStatusBar");r.writeClasses();r.write(">");r.renderControl(o.getAggregation("layout"));r.write("</div>")},})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.Stock')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.controls.Stock');jQuery.sap.require('sap.ca.ui.model.format.NumberFormat');sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.Stock",{metadata:{properties:{"name":"string","number":"string","numberUnit":"string","mrpavailability":"string","mergingKey":"string","renderAsButton":"boolean","tooltip":"string"},events:{"press":{}}},renderer:function(r,c){if(c.getRenderAsButton()){var b=new sap.m.Button({text:c.getNumber()+" "+c.getNumberUnit(),icon:"sap-icon://navigation-right-arrow",tooltip:c.getTooltip(),press:function(){c.firePress()}});switch(c.getMrpavailability()){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE:break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_SAFETYSTOCK:b.addStyleClass("sapMRPStockSafetyStockBtn");break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_BELOWZERO:b.addStyleClass("sapMRPStockShortageBtn");break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED:b.addStyleClass("sapMRPStockAcceptedBtn");break;default:break}b.setIconFirst(false);b.addStyleClass("sapMRPStockBtn");r.renderControl(b)}else{var o=new sap.m.ObjectNumber({number:c.getNumber(),numberUnit:c.getNumberUnit()});switch(c.getMrpavailability()){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE:break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_SAFETYSTOCK:o.addStyleClass("sapMRPStockSafetyStockNumber");break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_BELOWZERO:o.addStyleClass("sapMRPStockShortageNumber");break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED:o.addStyleClass("sapMRPStockAcceptedNumber");break;default:break}r.renderControl(o)}}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.VisualStatusForecast')){"use strict";jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.controls.VisualStatusForecast");sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.VisualStatusForecast",{sControlName:"STOCKAVAILABILITYCHART",metadata:{properties:{"internStatus":"string","daysNo":"int","tooltip":"string"},aggregations:{content:{type:"i2d.pp.mrpcockpit.reuse.controls.VisualStatus",multiple:true,singularName:"content"}}},setInternStatus:function(a){this.removeAllContent();var d=this.getDaysNo()>31?31:this.getDaysNo();if(a){for(var i=1;i<=d;i++){this.addContent(new i2d.pp.mrpcockpit.reuse.controls.VisualStatus({status:a.slice(i,i+1)}).setTooltip(this.getTooltip_AsString()))}this.setProperty("internStatus",a,true)}},getControlName:function(){return this.sControlName},renderer:function(r,c){r.write("<div");r.addClass("sapUiVisualStatusForecast");r.writeControlData(c);r.writeClasses();if(null!==c.getTooltip()){r.write(" title=\"");r.writeEscaped(c.getTooltip());r.write("\"")}r.write(">");var C=c.getContent();for(var i=0;i<C.length;i++){r.renderControl(C[i])}r.write("</div>")},init:function(e){},});sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.VisualStatus",{metadata:{properties:{status:"string",text:"string",tooltip:"string"}},renderer:function(r,c){var s="negative";switch(c.getStatus()){case"0":s="positive";break;case"1":s="warning";break;case"2":s="negative";break;case"3":s="positive_we";break;case"4":s="warning_we";break;case"5":s="negative_we";break;case"6":s="negative_acc";break;case"7":s="negative_we_acc";break;default:s="negative";break}r.write("<span");r.addClass(s);r.writeControlData(c);r.writeClasses();r.write(">");r.write("</span>")},})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.library')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.library");jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');sap.ui.getCore().initLibrary({name:"i2d.pp.mrpcockpit.reuse",dependencies:["sap.ui.core"],types:[],interfaces:[],controls:[],elements:[],noLibraryCSS:true,version:"1.5.7"})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.CommonConstants')){
/*
 * CommonConstants.js - App independent Constants
 * 
 * @author D054795
 * 
 * @version 24.10.2013
 * 
 * =============================================================================
 * 
 * (c) Copyright 2011-2013 by SAP AG, Dornierstr. 3, 88677 Markdorf, Germany All
 * rights reserved.
 * =============================================================================
 * 
 * This material is a CONFIDENTIAL, unpublished work of authorship created
 * between 2011 and 2013 and subsequently updated. It is a TRADE SECRET which is
 * property of SAP AG, if not explicitly agreed to otherwise.
 * 
 * All use, disclosure, and / or reproduction not specifically authorized by SAP
 * AG in writing is prohibited.
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.CommonConstants");i2d.pp.mrpcockpit.reuse.util.CommonConstants={};i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED="i2d.pp.mrpcockpit.reuse.fragments.DialogChange";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_PREVIEW="i2d.pp.materialshortge.details.preview";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_SOLCARD="i2d.pp.materialshortge.details.solCard";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_AOR_CHANGED="i2d.pp.mrpcockpit.reuse.view.AoRHandler.AORChange";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CHANGE_REQUEST="i2d.pp.changerequest.details.Changed";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CHANGE_REQUEST_STR="i2d.pp.changerequest.details.ChangedSTR";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_PROCESSED="processed";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_EXECUTE="execute";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_SetToRequested="setToRequested";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_RUN="run";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_OK="ok";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_CANCEL="cancel";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_ERROR="error";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_DIALOG_START="dialogStart";i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_DIALOG_CANCEL="dialogCancel";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_ENABLED="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_DISABLED="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_ACTIVE="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_LOCKED="04";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_CLICKED="05";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_STATE_HIDDEN="06";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_TYPE_ACCEPTED="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_TYPE_REJECTED="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_TYPE_PENDING="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_TYPE_CANCELLED="04";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_CATEGORY_ACCEPT="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_CATEGORY_INCREASE="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_CATEGORY_RESCHEDULE="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_CATEGORY_CHANGE="04";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_ACCEPT="sap-icon://accept";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_ACCEPT_REMOVE="sap-icon://accept";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_INCREASE="sap-icon://BusinessSuiteInAppSymbols/icon-increase";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_RESCHEDULE="sap-icon://BusinessSuiteInAppSymbols/icon-expedite";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_CHANGE="sap-icon://edit";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_TRANSFER="sap-icon://shipping-status";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_ICON_PROCURE="sap-icon://cart-2";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_INSIDE="OnCard";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_ICON="OnIcon";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_EXECUTE="OnExecute";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_OUTSIDE="NotOnCard";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_SCROLLLEFT="OnScrollLeft";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CARD_AREA_SCROLLRIGHT="OnScrollRight";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES="AR";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS="BA";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SUBREQ="BB";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM="BE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRCORD="BR";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD="FE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PMORDR="IH";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SHPGNT="LA";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SCHLNE="LE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_NTWORD="NE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLDORD="PA";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_INDREQ="PP";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RETURN="RP";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_DEPREQ="SB";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RELORD="U1";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL="U2";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLOREL="U3";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STTRES="UL";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_TRNRES="UR";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_CUSORD="VC";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK="WB";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_SUPPLIER="1";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_CUSTOMER="2";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_ISSUINGLOC="3";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_RECEIVLOC="4";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_ACCEPT="00";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_ACCEPT_REMOVE="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_CREATE="11";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_INCREASE="12";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_RESCHEDULE="13";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CREATE="14";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_INCREASE="15";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_RESCHEDULE="16";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_CREATE="17";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_INCREASE="18";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_RESCHEDULE="19";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_CREATE="20";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_INCREASE="21";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_RESCHEDULE="22";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_CHANGE="23";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CHANGE="24";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_CHANGE="25";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_CHANGE="26";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_STOCK_CHANGE="41";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_VENDOR_CHANGE="42";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_UNSRC_CHANGE="43";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PLANT_CHANGE="44";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PROD_CHANGE="45";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_REPLANT_CHANGE="46";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PO_CHANGE="PO_CHANGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_TO_CHANGE="TO_CHANGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PO_CREATE="PO_CREATE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_TO_CREATE="TO_CREATE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PR_CHANGE="PR_CHANGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PR_CREATE="PR_CREATE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PR_CONVERT="PR_CONVERT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_TOR_CHANGE="TOR_CHANGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_TOR_CREATE="TOR_CREATE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_TOR_CONVERT="TOR_CONVERT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_ACCEPT="SHORTAGE_ACCEPT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PA_CHANGE="PA_CHANGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PROD_CONVERT="PROD_CONVERT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_PROC_CONVERT="PROC_CONVERT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogAction_REQ_CONVERT="REQ_CONVERT";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_EXECUTE="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_CR_REQUEST="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_CR_COLLECT="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_PROD_CONVERT="04";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_PROC_CONVERT="05";i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_REQ_CONVERT="06";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_REQUESTED="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_APPLIED="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_DISCARDED="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_ANSWERED="04";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_COLLECTED="05";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_CLOSED="C1";i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_ACTIVE=true;i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_INACTIVE=false;i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_ACCEPTED="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_REJECTED="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.COMMUNICATION_CHANNEL_TEL="01";i2d.pp.mrpcockpit.reuse.util.CommonConstants.COMMUNICATION_CHANNEL_MAIL_DIRECT="02";i2d.pp.mrpcockpit.reuse.util.CommonConstants.COMMUNICATION_CHANNEL_MAIL_COLLECTIVE="03";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE="POST";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_READ="GET";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE="MERGE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_DELETE="DELETE";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUEST="/ChangeRequests";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUESTVENDOR="/ChangeRequestVendors";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUESTPROPOSAL="/ChangeRequestProposals";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_ACCEPTSHORTAGE="/AcceptedShortages";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PO_HEADER="/MMPurchaseOrderHeaders";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PO_SCHEDLINE="/MMPurchaseOrderScheduleLines";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PR_HEADER="/MMPurchaseRequisitionHeaders";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PR_ITEM="/MMPurchaseRequisitionItems";i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_QUICKVIEWS="/QuickViews";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_SHORTAGE=0;i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_ACCEPTED=1;i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PENDING=2;i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PROCESSED=3;i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_NO_SHORTAGE=4;i2d.pp.mrpcockpit.reuse.util.CommonConstants.DAYS_OF_SUPPLY_NO_SHORTAGE=999;i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE="0";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_SAFETYSTOCK="1";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_BELOWZERO="2";i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED="6";i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S3="S3";i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S4="S4";i2d.pp.mrpcockpit.reuse.util.CommonConstants.DEMAND_TYPE_SALES_ORDER="1";i2d.pp.mrpcockpit.reuse.util.CommonConstants.DEMAND_TYPE_TRANSPORT_ORDER="2";i2d.pp.mrpcockpit.reuse.util.CommonConstants.DEMAND_TYPE_PRODUCTION_ORDER="4";i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED="AOR_DEFINITION_CANCELED";i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_FAILED="AOR_DEFINITION_FAILED";i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT={PRDORD:"031",ORDRES:"032",PRCORD:"033",PLANORD_STOCK:"041",PLANORD_VENDOR:"042",PLANORD_UNSRC:"043",PLANORD_PLANT:"044",PLANORD_PROD:"045",PLANORD_REPLANT:"046",CHANGE_PLANORD:"000",CONV_REQ:"100",CONV_PROD:"200",CONV_PROC:"300"};i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRPElementCategory={MRP_ELEMENT_CATEGORY_ORDRES:"AR",MRP_ELEMENT_CATEGORY_PURRQS:"BA",MRP_ELEMENT_CATEGORY_SUBREQ:"BB",MRP_ELEMENT_CATEGORY_POITEM:"BE",MRP_ELEMENT_CATEGORY_PRCORD:"BR",MRP_ELEMENT_CATEGORY_PRDORD:"FE",MRP_ELEMENT_CATEGORY_PMORDR:"IH",MRP_ELEMENT_CATEGORY_SHPGNT:"LA",MRP_ELEMENT_CATEGORY_SCHLNE:"LE",MRP_ELEMENT_CATEGORY_NTWORD:"NE",MRP_ELEMENT_CATEGORY_PLDORD:"PA",MRP_ELEMENT_CATEGORY_INDREQ:"PP",MRP_ELEMENT_CATEGORY_RETURN:"RP",MRP_ELEMENT_CATEGORY_DEPREQ:"SB",MRP_ELEMENT_CATEGORY_RELORD:"U1",MRP_ELEMENT_CATEGORY_PRQREL:"U2",MRP_ELEMENT_CATEGORY_PLOREL:"U3",MRP_ELEMENT_CATEGORY_STTRES:"UL",MRP_ELEMENT_CATEGORY_TRNRES:"UR",MRP_ELEMENT_CATEGORY_CUSORD:"VC",MRP_ELEMENT_CATEGORY_STOCK:"WB"};i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING={DETAIL:"MRPDetailRoute",SUB_DETAIL:"subDetail",SUB_DETAIL_WAVE3:"subDetail_Wave3"};i2d.pp.mrpcockpit.reuse.util.CommonConstants.NavToCR="MRPCockpitNavigation.540";i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME=60;i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S=99;i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT=false};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.CommonFormatter')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.CommonFormatter");jQuery.sap.require('sap.ca.ui.model.format.DateFormat');jQuery.sap.require('sap.ca.ui.model.format.NumberFormat');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.util.CommonFormatter={hideQuantityBasedOnStatus:function(v,p,s){switch(Number(s)){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_ACCEPTED:return"";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PENDING:if(v){return sap.ca.ui.model.format.NumberFormat.getInstance({decimals:p}).format(v)}return"";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PROCESSED:return"";default:if(v===0.000){return""}else if(v){return sap.ca.ui.model.format.NumberFormat.getInstance({decimals:p}).format(v)}}},colorFormatObjectStatus:function(s,a,b){if((s=="")&&(a==0)&&(b==0)){return sap.ui.core.ValueState.Success}switch(Number(s)){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_SHORTAGE:return sap.ui.core.ValueState.None;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_ACCEPTED:return sap.ui.core.ValueState.Success;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PENDING:return sap.ui.core.ValueState.None;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_PROCESSED:return sap.ui.core.ValueState.Success;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MASTER_LIST_STATUS_NO_SHORTAGE:return sap.ui.core.ValueState.Success;default:return sap.ui.core.ValueState.None}},requestStatusIcon:function(r){if(r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_PENDING){return"sap-icon://pending"}else{return""}},requestStatusIconSolView:function(r,c,q){if(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK||(q<0)){return""}else{return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.requestStatusIcon(r)}},getSolutionDialogNotesVisible:function(d){if(d===i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_EXECUTE){return false}else{return true}},getChangeRequestVisibility:function(r,c,q){if(r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_REQUESTED||r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_ANSWERED||r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_COLLECTED){return true}else{return false}},getChangeRequestTooltip:function(r,v){if(r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_REQUESTED){this.addStyleClass("sapMRPIconNormal");return this.getModel('Common_i18n').getResourceBundle().getText("REQUEST_STATUS_TOOLTIP_CREATED")}else if(r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_COLLECTED){this.addStyleClass("sapMRPIconNormal");return this.getModel('Common_i18n').getResourceBundle().getText("REQUEST_STATUS_TOOLTIP_COLLECTED")}else if(r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_ANSWERED){switch(v){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_ACCEPTED:this.addStyleClass("sapMRPIconGreen");return this.getModel('Common_i18n').getResourceBundle().getText("REQUEST_STATUS_TOOLTIP_ACCEPTED");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_REJECTED:this.addStyleClass("sapMRPIconRed");return this.getModel('Common_i18n').getResourceBundle().getText("REQUEST_STATUS_TOOLTIP_REJECTED");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED:this.addStyleClass("sapMRPIconOrange");if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(this.getModel('ServiceVersions')){var i=i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForFieldInt({sI18nID:"REQUEST_STATUS_TOOLTIP_PROPOSED",sSoHI18nID:"REQUEST_STATUS_TOOLTIP_PROPOSEDSoH",sModSI18nID:"REQUEST_STATUS_TOOLTIP_PROPOSEDModS",iServiceVersion:this.getModel('ServiceVersions').getData().iServiceSchemaVersion});return this.getModel('Common_i18n').getResourceBundle().getText(i)}}return this.getModel('Common_i18n').getResourceBundle().getText("REQUEST_STATUS_TOOLTIP_PROPOSED");default:this.addStyleClass("sapMRPIconNormal");return this.getModel('Common_i18n').getResourceBundle().getText("CARD_TIT_UNKNOWN")}}else{this.addStyleClass("sapMRPIconNormal");return""}},flagIconSrc:function(i,a,b){if(i){return"sap-icon://locked"}else if(b){return"sap-icon://BusinessSuiteInAppSymbols/icon-partially-delivered"}else if(a){return"sap-icon://BusinessSuiteInAppSymbols/icon-approved"}else{return""}},flagIconVisible:function(i,a,b){if(i){return true}else if(b){return true}else if(a){return true}else{return false}},flagIconTooltip:function(i,a,b,c){if(!c){c=this}if(i){return c.getModel('Common_i18n').getResourceBundle().getText("IS_FIRM")}else if(b){return c.getModel('Common_i18n').getResourceBundle().getText("IS_PARTIALLY_DELIVERED")}else if(a){return c.getModel('Common_i18n').getResourceBundle().getText("IS_RELEASED")}else{return""}},flagIconSolView:function(i,a,b,c,q){if(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK||(q<0)){return""}else{return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSrc(i,a,b)}},flagIconSolViewVisible:function(i,a,b,c,q){if(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK||(q<0)){return false}else{return true}},flagIconSolViewTooltip:function(i,a,b,c,q){if(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK||(q<0)){return""}else{return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconTooltip(i,a,b,this)}},sditemicon:function(q,c){if((Number(q)==0)||i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(c)){return"sap-icon://BusinessSuiteInAppSymbols/icon-current-stock"}if(Number(q)<0){return"sap-icon://down"}else{return"sap-icon://up"}},sditemtooltip:function(q,c){if((Number(q)==0)||i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(c)){return this.getModel('Common_i18n').getResourceBundle().getText("XTOL_CURRENT_STOCK")}if(Number(q)<0){return this.getModel('Common_i18n').getResourceBundle().getText("XTOL_REQIREMENT_QTY")}else{return this.getModel('Common_i18n').getResourceBundle().getText("XTOL_RECEIPT_QTY")}},isShortage:function(v){if(v<0){return true}else{return false}},categoryLongName:function(c,a,n,i,d,s,b,e){switch(c){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_INDREQ:return a+" "+d;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SUBREQ:if(!e){return a+" "+b+" ("+s+")"}else{return a+" "+b+"-"+e+" ("+s+")"}break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES:return a+" "+b;default:if(!i){return a+" "+n}else{return a+" "+n+"-"+i}}},sdIconState:function(v,c){if((Number(v)==0)||i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(c)){return sap.ui.core.ValueState.None}if(Number(v)>0){return sap.ui.core.ValueState.Success}else{return sap.ui.core.ValueState.Error}},email:function(v){return"mailto:"+v},tel:function(v){if(v){v=v.replace(/[\s\-\[\]\/\{\}\(\)\*\?\.\\\^\$\|]/g,"");return"tel:"+v}return v},getVendorOrPlantLabel:function(s){switch(s){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_CREATE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_INCREASE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_RESCHEDULE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CREATE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_INCREASE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_RESCHEDULE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_VENDOR_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_UNSRC_CHANGE:return this.getModel('Common_i18n').getResourceBundle().getText("VENDOR");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_CREATE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_INCREASE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_RESCHEDULE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_CREATE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_INCREASE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_RESCHEDULE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PLANT_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_REPLANT_CHANGE:return this.getModel('Common_i18n').getResourceBundle().getText("PLANT");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_STOCK_CHANGE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PROD_CHANGE:return this.getModel('Common_i18n').getResourceBundle().getText("PRODUCTION_SUPERVISOR")}},getVendorOrPlantName:function(p,n){if(p){if(n){return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_PARENTHESIS",[p,n])}else{return p}}else if(n){return n}else{return this.getModel('Common_i18n').getResourceBundle().getText("NOT_YET_DETERMINED")}},quantity:function(q,p){var v=Math.abs(q);return sap.ca.ui.model.format.NumberFormat.getInstance({decimals:p}).format(v)},stockQuantity:function(q,p){var a=Number(q);return sap.ca.ui.model.format.NumberFormat.getInstance({decimals:p}).format(a)},stockQuantitySolView:function(q,p,u){var a=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.stockQuantity(q,p);return a+" "+u},isRequisition:function(c){if((c==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS)||(c==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL)){return true}return false},isNoRequisition:function(c){return!i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isRequisition(c)},isSupplyDemandItem:function(c){return!i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(c)},isStockItem:function(c){return(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK)},hideStockDate:function(c,d){if(d&&!i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(c)){return d.toLocaleDateString()}else{return""}},availableQuantityMergingKey:function(c,d,q){if(c===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK){return c+d+q}return d+q},dateTo:function(d,a){var b=(new sap.ca.ui.model.type.Date()).oOutputFormat.format(d,{style:'medium'});var c=(new sap.ca.ui.model.type.Date()).oOutputFormat.format(a,{style:'medium'});return this.getModel('Common_i18n').getResourceBundle().getText("DATE_TO",[b,c])},vendorOrReq:function(r,c,n,t,b,d,a,s,p,u){if(Number(r)>0){return""}else{return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getBusinessPartnerName(c,n,t,b,d,a,s,p,u,this)}},formatDayValue:function(d){if(d&&(d==1)){return this.getModel('Common_i18n').getResourceBundle().getText("ONE_DAY")}else if(d&&(d>1)){return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[d])}else{return""}},formatBooleanValue:function(b,c){if(!c){c=this}if(b){return c.getModel('Common_i18n').getResourceBundle().getText("YES_TEXT")}else{return c.getModel('Common_i18n').getResourceBundle().getText("NO_TEXT")}},getRequirements:function(r,c,a,n,i,d,s,b,e){if(Number(r)>0){return this.getModel('Common_i18n').getResourceBundle().getText("REQUIREMENT_COUNT",[r])}return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.categoryLongName(c,a,n,i,d,s,b,e)},getBusinessPartnerName:function(c,n,t,b,d,a,s,p,u,e){if(!e){e=this}var f=e.getModel('Common_i18n').getResourceBundle().getText("UNSOURCED");var g=e.getModel('Common_i18n').getResourceBundle().getText("PLANT_LONG",[b,n]);var h=0;switch(c){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK:if(Number(s)>0){h=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.stockQuantity(s,p);return e.getModel('Common_i18n').getResourceBundle().getText("SAFETY_STOCK",[h,u])}else{return e.getModel('Common_i18n').getResourceBundle().getText("NO_SAFETY_STOCK")}case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SHPGNT:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SCHLNE:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RETURN:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STTRES:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_TRNRES:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RELORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL:if(t===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_SUPPLIER||t===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_CUSTOMER){return n}else if(t===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_ISSUINGLOC||t===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_BUSINESSPARTNERTYPE_RECEIVLOC){return g}else{return f}break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_CUSORD:if(!n){return f}else{return n}break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRCORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PMORDR:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_NTWORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLDORD:return d;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_SUBREQ:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_DEPREQ:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES:return a;default:return""}},hasValue:function(){for(var i in arguments){if(arguments[i]&&!(/^\s*$/.test(arguments[i]))&&(Number(arguments[i])!==0)){return true}}return false},hasValueAll:function(v,a){if((!v||/^\s*$/.test(v)||(Number(v)==0))||(!a||/^\s*$/.test(a)||(Number(a)==0))){return false}return true},hasFirstValueOnly:function(v,a){if(((v&&!/^\s*$/.test(v))||(Number(v)!=0))&&(!a||/^\s*$/.test(a)||(Number(a)==0))){return true}return false},colorFormatStockStatus:function(s){switch(s){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE:return sap.ui.core.ValueState.None;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_SAFETYSTOCK:return sap.ui.core.ValueState.Warning;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_BELOWZERO:return sap.ui.core.ValueState.Error;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED:return sap.ui.core.ValueState.None;default:return sap.ui.core.ValueState.None}},formatLineBreak:function(t){if(t){var a=t.split(" ");var s=a[0]+"\n"+a.slice(1).join(" ");return s}else{return""}},numberFormat:function(n,d){return sap.ca.ui.model.format.NumberFormat.getInstance({decimals:d}).format(n)},numberWithNoLeadingZeros:function(n){if(n&&typeof(n)==="string"){return n.replace(/^0*((?:[1-9]\d*)|0)$/,"$1")}else{return n}},formatDateShort:function(d){if(d){return sap.ca.ui.model.format.DateFormat.getDateInstance({style:"short"}).format(d)};return""},formatQuantity:function(v,p,u){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v)){if(u){var f=sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(v,u,p);return f+" "+u};return v};return""},formatQuantityMultiplyMinusOne:function(v,p,u){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v)){if(u){var f=sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(v,u,p);var m=f*(-1);return m+" "+u};var m=f*(-1);return m};return false},formatQuantityWithSign:function(v,p,u){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v)){if(u){var f=sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(v,u,p);if(v>0){return"+"+f+" "+u}else{return f+" "+u}};if(v>0){return"+"+v}else{return v}};return""},formatMinMaxQuantity:function(m,a,p,u){var b=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.formatQuantity(m,p,u);var c=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.formatQuantity(a,p,u);if(((m==0)||(m==null))&&((a==0)||(a==null))){return""}else if((((m==0)||(m==null))&&((a>0)||(a>null)))||(((m>0)||(m>null))&&((a==0)||(a=null)))){return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_BLANK",[b,c])}else{return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_SLASH",[b,c])}},formatRatioInPct:function(v,p){if((v!=null)&&(p!=null)){var f=sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(v,p);return f+" "+"%"};return v+" "+"%"},formatTitle:function(t,a){if((t===null)||(t==="")){return a}else{return t}},formatText:function(t,a){if((t===null)||(t==="")){return null}else{return a}},visibleOnlyOnDesktop:function(){if(sap.ui.Device.system.desktop){return true}else{return false}},getPartialDelivery:function(p,n){if(p&&n){return this.getModel('Common_i18n').getResourceBundle().getText("PARTIAL_DELIVERY",[p,n])}else if(p&&!n){return p}else{return""}},getTextPairWithParenthesis:function(m,a,c){if(!c){c=this}if(m&&a){return c.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_PARENTHESIS",[m,a])}else if(m&&!a){return m}else if(!m&&a){return a}else{return""}},getTextPairWithDash:function(m,a){if(m&&a){return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_DASH",[m,a])}else if(m){return m}else if(a){return a}else{return""}},getTextPairWithSlash:function(f,s){if(f&&s){return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_SLASH",[f,s])}else if(f){return f}else if(s){return s}else{return""}},getBooleanPairWithSlash:function(f,s){f=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.formatBooleanValue(f,this);s=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.formatBooleanValue(s,this);return this.getModel('Common_i18n').getResourceBundle().getText("TUPEL_WITH_SLASH",[f,s])},getAlternativeText:function(s,t,T,a,b,c,d){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){var i,I,e;if(s){i=t;I=(a)?a:i;e=(c)?c:i}else{i=T;I=(b)?b:i;e=(d)?d:i}if(!this.getModel('ServiceVersions')){return i}else if(this.getModel('ServiceVersions').getData().iServiceSchemaVersion===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return e}else{return I}}return(s)?t:T},getTextOutOf3Alternatives:function(s,S,t,T,a,b,c){if(s){return t}else if(S){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(!this.getModel('ServiceVersions')){return T}else if(this.getModel('ServiceVersions').getData().iServiceSchemaVersion===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return c}else{return b}}return T}else{return a}},getPurchaseDocumentText:function(c,p,a){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isRequisition(c)){return p}else{return a}},getMRPAreaOrPlant:function(m,p,c){if(!c){c=this}if(p&&(!m||m===p)){return c.getModel('Common_i18n').getResourceBundle().getText("PLANT_WITH_ID",[p])}else if(m){return c.getModel('Common_i18n').getResourceBundle().getText("MRPAREA_WITH_ID",[m])}else{return""}},getMRPAreaOrPlantLabel:function(m,p,c){if(!c){c=this}if(p&&(!m||m===p)){return c.getModel('Common_i18n').getResourceBundle().getText("PLANT")}else if(m){return c.getModel('Common_i18n').getResourceBundle().getText("MRPAREA")}else{return""}},getMaterialWithPlant:function(m,a,p){var b=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getMRPAreaOrPlant(a,p,this);return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getTextPairWithParenthesis(m,b,this)},getMaterialWithPlantTooltip:function(m,p){var a=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getMRPAreaOrPlantLabel(m,p,this);return this.getModel('Common_i18n').getResourceBundle().getText("MATERIAL_NUMBER_PLANT_TOOLTIP",[a])},formatPlantController:function(n,i){if(n&&i){return n+" ("+i+")"}else if(n){return n}else if(i){return i}else{return null}},allowSolutionNavigation:function(m,a,d,b){if(b===1){if(m!==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE&&a!==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK){return true}else{return false}}else{return d}},showStockNavigation:function(m,a,d,b){return i2d.pp.mrpcockpit.reuse.util.CommonFormatter.allowSolutionNavigation(m,a,d,b)},stockCSSClass:function(m){switch(m){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE:return"sapMRPStockNoShortage";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_SAFETYSTOCK:return"sapMRPShortageSafetyStock";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_BELOWZERO:return"sapMRPShortage";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED:return"sapMRPShortageAccepted";default:return"sapMRPStockNoShortage"}},formatDateLong:function(d){if(d){return sap.ca.ui.model.format.DateFormat.getDateInstance({style:"long"}).format(d)}},textStockAvailability:function(a){return this.getModel('Common_i18n').getResourceBundle().getText("VisualStatusForecast",['21'])},lapseOfStockAvailability:function(T){return this.getModel('Common_i18n').getResourceBundle().getText(T,['21'])},deleteFirstLeadingZeros:function(n){if(n){if(n==0){return"0"}}else{return""}},formatDelay:function(n){if(n){if(n==0){return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[0])}else if((n==1)||(n==-1)){return this.getModel('Common_i18n').getResourceBundle().getText("DAY",[n.replace(/^(0+)/g,'')])}else if(n>0){return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[n.replace(/^(0+)/g,'')])}else{return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[n])}}else{return""}},formatDelayInt:function(n){if(n==0){return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[0])}else if((n==1)||(n==-1)){return this.getModel('Common_i18n').getResourceBundle().getText("DAY",[n])}else{return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[n])}},formatTimeShort:function(d){if(d){return sap.ca.ui.model.format.DateFormat.getTimeInstance({style:"short"}).format(d)}return""},getQVEditButtonText:function(c,C){switch(c){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS:return this.getModel('Common_i18n').getResourceBundle().getText("QV_PR_EditButton");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM:if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility(C)){return this.getModel('Common_i18n').getResourceBundle().getText("QV_CR_EditButton")}else{return this.getModel('Common_i18n').getResourceBundle().getText("QV_PO_EditButton")}break;default:return""}},joinedByHyphen:function(v,a){return v+"-"+a},isValueGreaterEqualZero:function(v){var l=Math.round(v);if(l>=0){return true}else{return false}},formatQuantityAlways:function(v,p,u){if(u){var f=sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(v,u,p);return f+" "+u};return v},formatDayValueAlways:function(d){if(d&&(d==1)){return this.getModel('Common_i18n').getResourceBundle().getText("ONE_DAY")}else if(d&&(d>1)){return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[d])}else{return this.getModel('Common_i18n').getResourceBundle().getText("DAYS",[d])}},formatMinMaxQuantityText:function(m,a){if((m>0)&&(a>0)){return this.getModel('Common_i18n').getResourceBundle().getText("MIN_MAX_LOT_SIZE")}else if((m>0)&&(a<1)){return this.getModel('Common_i18n').getResourceBundle().getText("xfldMaterialMinLotSizeQty")}else if((m<1)&&(a>0)){return this.getModel('Common_i18n').getResourceBundle().getText("xfldMaterialMaxLotSizeQty")}else{return this.getModel('Common_i18n').getResourceBundle().getText("MIN_MAX_LOT_SIZE")}},releaseVisibleCheck:function(v,t){if(!t){t=this}var V=t.getModel('ServiceVersions').getData().iServiceSchemaVersion;if(V===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return false}else{return true}},visibleForModelS:function(v,t){if(!t){t=this}var V=t.getModel('ServiceVersions').getData().iServiceSchemaVersion;if(V===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return true}else{return false}},visibleCheck:function(){if((i2d.pp.mrpcockpit.reuse.util.CommonFormatter.visibleOnlyOnDesktop()===false)||(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.releaseVisibleCheck(null,this)===false)){return false}else{return true}},VisibleCheckPONavigation:function(){if((i2d.pp.mrpcockpit.reuse.util.CommonFormatter.visibleOnlyOnDesktop()===false)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.releaseVisibleCheck(null,this)===true)){return false}else{return true}},formatVersionTextSoHVsSLog:function(t,a,b){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(!this.getModel('ServiceVersions')){return a}else if(this.getModel('ServiceVersions').getData().iServiceSchemaVersion===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return b}else{return a}}else{return t}},formatTextSoHVsSLog:function(t,a){if(!this.getModel('ServiceVersions')){return t}else if(this.getModel('ServiceVersions').getData().iServiceSchemaVersion===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return a}else{return t}},formatLAMA:function(m){if(m!==null){var t="OxOxOxOxOxOxOxOxO-";return m+"-"+t.slice(m.length-1)+"TestLongMaterialNumber"}},formatDateDaysAgo:function(d){if(d){return sap.ca.ui.model.format.DateFormat.getDateInstance({style:"daysAgo"}).format(d)};return""},formatStatusState:function(s,v){var V="None";switch(s){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_REQUESTED:V="Error";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_APPLIED:V="Success";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_DISCARDED:V="Error";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_ANSWERED:if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_ACCEPTED){V="Success"}else if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_REJECTED){V="Error"}else if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED){V="Warning"}break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_COLLECTED:V="None";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_CLOSED:V="None";break;default:V="None"}return V},getIsEditButtonVisible:function(M){if(M==='X'){return true}else{return false}},noMatchedValue:function(v,n){if(v&&n){if(v===n){return false}return true}},catNotAllowedAndHasValue:function(v,c,n){if(c&&n){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.noMatchedValue(c,n)){if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v)){return true}return false}return false}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.Helper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.Helper");jQuery.sap.require('sap.ca.ui.utils.Lessifier');i2d.pp.mrpcockpit.reuse.util.Helper={isBatchModeActive:function(){var n;if(n=="X"){return false}return true},factsheetNavigate:function(s,a,p){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNavigator=f&&f("CrossApplicationNavigation");if(this.oCrossAppNavigator){this.oCrossAppNavigator.toExternal({target:{semanticObject:s,action:a},params:p})}},getORMultiFilter:function(f,v){var o=new Array();for(var i=0;i<v.length;i++){o.push(new sap.ui.model.Filter(f,sap.ui.model.FilterOperator.EQ,v[i]))}var O=new sap.ui.model.Filter(o,false);return O},extractErrorMsgFromStream:function(b,x){var t="";try{var p=new DOMParser();var a=p.parseFromString(x,"text/xml");var m=[];if(a){m=a.getElementsByTagName("message")}if(m.length>0){if(m[0]&&m[0].childNodes[0]&&m[0].childNodes[0].nodeValue){t=m[0].childNodes[0].nodeValue}else{t=b.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}}else{var M=new sap.ui.model.json.JSONModel();M.setJSON(x);if(M.oData&&M.oData.error&&M.oData.error.message&&M.oData.error.message.value){t=M.oData.error.message.value}else{t=b.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}}}catch(e){var M=new sap.ui.model.json.JSONModel();M.setJSON(x);if(M.oData&&M.oData.error&&M.oData.error.message&&M.oData.error.message.value){t+=M.oData.error.message.value}else{t=x}}return t},extractErrorMsgFromBatchResponse:function(b,e){var E="";var t="";for(var i=0;i<e.length;i++){if(i>0){E+="; "}if(e[i].response&&e[i].response.body){t=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,e[i].response.body)}else{t=b.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}E+=t}return E},resizeUiControls:function(c,s,o){var p=jQuery("#"+c.getView().getId()+"--"+'panel');var S=$('.sapMRPSolutions').height();if(S===null||S===undefined){S=0}if(p&&p.length){var C=c.getView().byId("chart");var a;var w=0;var b=0;var d=0;var e=0;var f="";var g=0;b=p[0].offsetTop;w=p.width();a=p.parent();f=a.css("padding-bottom");g=(f)?parseInt(f):0;while((a.length!=0)&&!(a.attr('id')==c.getView().getId()+"--"+"mainPage-cont")){b+=a[0].offsetTop;a=a.parent()}d=(a)?a.height():0;f=(a)?a.css("border-bottom"):"";d+=(f)?parseInt(f):0;if(s===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S3){e=d-b-g}else if(s===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S4){e=d-b-g-S}else{e=d-b-g}if((w<64)&&(e<10)){return}if(w<64){C.setHeight((e-2)+"px");return}if(e<10){C.setWidth((w-64)+"px",true);return}if(o>0){e=e-o}var P=jQuery("#"+c.getView().getId()+"--"+'panelToolbar');e=e-P[0].offsetHeight;jQuery.sap.log.debug("set chart size of S3 chart: "+(w-64)+"x"+(e-10));C.setWidth((w-64)+"px",true);C.setHeight((e-2)+"px");var i=d-S;var h=i+"px";var j=c.getView().byId("oScrollContainer");if(j){j.setHeight(h)}}},convertStatusToMasterListStatus:function(d){var c=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var s=c.MASTER_LIST_STATUS_SHORTAGE;if(d&&d.model&&d.model.cardModel&&d.model.cardModel.getData()){switch(d.model.cardModel.getData().SolutionRequestStatus){case c.REQUEST_STATUS_REQUESTED:s=c.MASTER_LIST_STATUS_PROCESSED;break;case c.REQUEST_STATUS_APPLIED:s=c.MASTER_LIST_STATUS_PROCESSED;break;case c.REQUEST_STATUS_DISCARDED:s=c.MASTER_LIST_STATUS_SHORTAGE;break;case c.REQUEST_STATUS_ANSWERED:s=c.MASTER_LIST_STATUS_PROCESSED;break;case c.REQUEST_STATUS_COLLECTED:s=c.MASTER_LIST_STATUS_PROCESSED;break;default:s=c.MASTER_LIST_STATUS_PROCESSED;break}}return s},lessifyCSSx30:function(){if(sap.ca.ui.utils.Lessifier){sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPx30.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/SolutionCards.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/Chart.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/Stock.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPScrollbar.css",true)}},lessifyCSSx10:function(){if(sap.ca.ui.utils.Lessifier){sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPx10.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPScrollbar.css",true)}},getSpecialTextForField:function(p,c,d){var s=function(a,b){var i,e=-1;for(i=0;i<a.length;i++){if(a[i][0]===b){e=i;break}}return e};if(!i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){return p}if(!d){if(!c){return p}else if(c.aDiffFieldText){d=c.aDiffFieldText}}if(d){var m=s(d,p);if(m>=0){if(d[m][1]){if(c.getServiceSchemaVersion()===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){return d[m][1][1]}else{return d[m][1][0]}}else{return p}}else{return p}}else{return p}},getSpecialTextForFieldInt:function(o){var d={bGetText:false,sI18nID:null,oController:null,aDiffFieldText:null,iServiceVersion:null,sSoHI18nID:null,sModSI18nID:null};o=$.extend({},d,o);var m=null;var s=function(p,a){var i,b=-1;for(i=0;i<p.length;i++){if(p[i][0]===a){b=i;break}}return b};var g=function(S,D,a,M){var i=D;if(S){switch(S){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S:if(M){i=M}break;default:if(a){i=a}break}}if(o.bGetText&&o.oController.oResourceBundle.getText){return o.oController.oResourceBundle.getText(i)}return i};if(!i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){return g(o.iServiceVersion,o.sI18nID,o.sI18nID,o.sI18nID)}if(!o.sI18nID){if(!(o.iServiceVersion&&o.sSoHI18nID&&o.sModSI18nID)){if(o.sSoHI18nID){return o.sSoHI18nID}else if(o.sModSI18nID){return o.sModSI18nID}else{return null}}}if(o.iServiceVersion&&o.sSoHI18nID&&o.sModSI18nID){return g(o.iServiceVersion,o.sI18nID,o.sSoHI18nID,o.sModSI18nID)}if(o.oController){if(!o.iServiceVersion){if(o.oController.getServiceSchemaVersion){o.iServiceVersion=o.oController.getServiceSchemaVersion()}else{o.iServiceVersion=2}}if(!o.aDiffFieldText){if(o.oController.aDiffFieldText){o.aDiffFieldText=o.oController.aDiffFieldText}else{return g(o.iServiceVersion,o.sI18nID,o.sSoHI18nID,o.sModSI18nID)}}if(o.aDiffFieldText){m=s(o.aDiffFieldText,o.sI18nID);if(m>=0){if(o.aDiffFieldText[m][1]){o.sSoHI18nID=o.aDiffFieldText[m][1][0];o.sModSI18nID=o.aDiffFieldText[m][1][1];return g(o.iServiceVersion,o.sI18nID,o.sSoHI18nID,o.sModSI18nID)}}}}else{if(o.aDiffFieldText&&o.iServiceVersion){m=s(o.aDiffFieldText,o.sI18nID);if(m>=0){if(o.aDiffFieldText[m][1]){return g(o.iServiceVersion,o.sI18nID,o.aDiffFieldText[m][1][0],o.aDiffFieldText[m][1][1])}}}}return o.sI18nID}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper");i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper={initialize:function(m,e,a){var t=m;if(m===undefined||m===null){t=sap.ca.scfld.md.app.Application.getImpl().getODataModel()}var s=this._getServiceSchemaVersion(t,e);var S=this._getServiceVersion(t,e);var v={iServiceSchemaVersion:s,iServiceVersion:S};a.setApplicationModel("ServiceVersions",new sap.ui.model.json.JSONModel(v))},getInteroperabilityModel:function(m,e){return new sap.ui.model.json.JSONModel({backendVersion:i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(m,e),frontendVersion:i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFrontendVersion()})},getFilterFrontendVersion:function(){return new sap.ui.model.Filter("Version",sap.ui.model.FilterOperator.EQ,"3")},getFrontendVersion:function(){return"3"},addFilterFrontendVersion:function(f,m,e){if(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(m,e)>1){f.push(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFilterFrontendVersion())}},getServiceVersion:function(a){if(a.getApplicationModel("ServiceVersions")){return a.getApplicationModel("ServiceVersions").getData().iServiceVersion}else{return undefined}},getServiceSchemaVersion:function(a){if(a.getApplicationModel("ServiceVersions")){return a.getApplicationModel("ServiceVersions").getData().iServiceSchemaVersion}else{return undefined}},_getEntityAnnotation:function(m,a,e){var M=m.getServiceMetadata();if((M!=null)&&(M.dataServices!=null)&&(M.dataServices.schema!=null)&&(M.dataServices.schema.length>0)&&(M.dataServices.schema[0].entityType!=null)){var E=M.dataServices.schema[0].entityType;for(var i=0;i<E.length;i++){if(E[i].extensions!=null){for(var j=0;j<E[i].extensions.length;j++){if(((e===undefined)||(e===E[i].name))&&(E[i].extensions[j].name===a)){return E[i].extensions[j].value}}}}}return null},getEntityPropertyNames:function(m,e){var M=m.getServiceMetadata();if((M!=null)&&(M.dataServices!=null)&&(M.dataServices.schema!=null)&&(M.dataServices.schema.length>0)&&(M.dataServices.schema[0].entityType!=null)){var E=M.dataServices.schema[0].entityType;var a=[];for(var i=0;i<E.length;i++){if(e===E[i].name){for(var j=0;j<E[i].property.length;j++){a.push(E[i].property[j].name)}return a}}}return null},_getServiceSchemaVersion:function(m,e){var v=this._getEntityAnnotation(m,"service-schema-version",e);return(v!=null)?parseInt(v):1},_getServiceVersion:function(m,e){var v=this._getEntityAnnotation(m,"service-version",e);return(v!=null)?parseInt(v):1},removeNeedlessColumnsFromTable:function(m,e,t,d){var E=this.getEntityPropertyNames(m,e);if((E!=null)&&(E!=undefined)){var c=t.getColumns();for(var i=0;i<c.length;i++){var T=[];var s="";s=c[i].data(d);if(s!=""){T=s.split(",");var b=false;for(var j=0;j<T.length;j++){if((j>0)&&(b==false)){break}b=false;for(var k=0;k<E.length;k++){if(T[j]==E[k]){b=true;break}}}if(!b){t.removeColumn(c[i].sId)}}}}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.Lessifier')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.Lessifier");jQuery.sap.require('sap.ca.ui.utils.Lessifier');i2d.pp.mrpcockpit.reuse.util.Lessifier={lessifyCSSx10:function(){if(sap.ca.ui.utils.Lessifier){sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRP.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPx10.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/VisualStatusForecast.css",true)}},lessifyCSSx30:function(){if(sap.ca.ui.utils.Lessifier){sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRP.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","styles/sapMRPx30.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/SolutionCards.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/Chart.css",true);sap.ca.ui.utils.Lessifier.lessifyCSS("i2d.pp.mrpcockpit.reuse","controls/Stock.css",true)}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.QUnitHelper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.QUnitHelper");i2d.pp.mrpcockpit.reuse.util.QUnitHelper={mockInfrastructure:function(){var i={};i.getImpl=function(){var a={};var c={};var A={};A.getResourceBundle=function(){var b={};b.getText=function(){var t='Text';return t};return b};c.oApplicationFacade=A;a.oConfiguration=c;var h={};h.defineMasterHeaderFooter=function(){};a.oMHFHelper=h;return a};sap.ca.scfld.md.app.Application=i}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.QuickViewHelper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.QuickViewHelper");i2d.pp.mrpcockpit.reuse.util.QuickViewHelper={_quickViewMetaData:{"001":{semanticObject:"SalesOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"SalesOrder"},"010":{semanticObject:"PurchaseOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PO_CHANGE,mrpElemParamName:"PurchaseOrder"},"011":{semanticObject:"PurchaseOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TO_CHANGE,mrpElemParamName:"PurchaseOrder"},"012":{semanticObject:"PurchaseOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"PurchaseOrder"},"021":{semanticObject:"PurchaseRequisition",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CHANGE,mrpElemParamName:"PurchaseRequisition",mrpElemItemParamName:"PurchaseRequisitionItem",mrpElemItemValueLength:5},"022":{semanticObject:"PurchaseRequisition",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_TOR_CHANGE,mrpElemParamName:"PurchaseRequisition",mrpElemItemParamName:"PurchaseRequisitionItem",mrpElemItemValueLength:5},"023":{semanticObject:"PurchaseRequisition",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"PurchaseRequisition",mrpElemItemParamName:"PurchaseRequisitionItem",mrpElemItemValueLength:5},"024":{semanticObject:"PurchaseRequisition",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PR_CHANGE,mrpElemParamName:"PurchaseRequisition",mrpElemItemParamName:"PurchaseRequisitionItem",mrpElemItemValueLength:5},"031":{semanticObject:"ProductionOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"ProductionOrder"},"032":{semanticObject:"ProductionOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"ProductionOrder"},"033":{semanticObject:"ProcessOrder",transactionAction:"display",factsheetAction:"displayFactSheet",editAllowed:false,editFragment:"",solutionType:"",mrpElemParamName:"ProcessOrder"},"041":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_STOCK_CHANGE,mrpElemParamName:"PlannedOrder"},"042":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_VENDOR_CHANGE,mrpElemParamName:"PlannedOrder"},"043":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_UNSRC_CHANGE,mrpElemParamName:"PlannedOrder"},"044":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PLANT_CHANGE,mrpElemParamName:"PlannedOrder"},"045":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_PROD_CHANGE,mrpElemParamName:"PlannedOrder"},"046":{semanticObject:"PlannedOrder",transactionAction:"change",factsheetAction:"displayFactSheet",editAllowed:true,editFragment:"i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",solutionType:i2d.pp.mrpcockpit.reuse.util.CommonConstants.SOLUTIONTYPE_PA_REPLANT_CHANGE,mrpElemParamName:"PlannedOrder"}},getQuickViewMetaData:function(q){return this._quickViewMetaData[q]},getQuickViewFragment:function(m){switch(m){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_CUSORD:return"i2d.pp.mrpcockpit.reuse.fragments.SalesOrderQuickView";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RELORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL:return"i2d.pp.mrpcockpit.reuse.fragments.PurchaseOrderQuickView";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRCORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES:return"i2d.pp.mrpcockpit.reuse.fragments.ProductionOrderQuickView";case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLDORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_DEPREQ:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLOREL:return"i2d.pp.mrpcockpit.reuse.fragments.PlannedOrderQuickView";default:return undefined}},getSemanticObject:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.semanticObject}else{return undefined}},getTransactionAction:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.transactionAction}else{return undefined}},getFactsheetAction:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.factsheetAction}else{return undefined}},getNavigationParameter:function(q,m,a,p){var b=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(b){var n={};if(b.mrpElemParamName){if(q==="045"){n[b.mrpElemParamName]=p}else{n[b.mrpElemParamName]=m}}if(b.mrpElemItemParamName&&a){if(b.mrpElemItemValueLength){n[b.mrpElemItemParamName]=a.slice(-b.mrpElemItemValueLength)}else{n[b.mrpElemItemParamName]=a}}return n}else{return undefined}},isHyperlinkActive:function(m,s,S){var i=s;if(!i){i=this.getModel("ServiceVersions").getData().iServiceSchemaVersion}switch(i){case 1:return false;case 2:switch(m){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_CUSORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RELORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLDORD:return true;default:return false}default:switch(m){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_CUSORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_POITEM:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_RELORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PURRQS:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRQREL:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLDORD:return true;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES:if((S===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRDORD)||(S===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRCORD)){return true}else{return false};case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PRCORD:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_DEPREQ:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_PLOREL:return true;default:return false}}},isEditAllowed:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.editAllowed}else{return false}},getEditFragment:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.editFragment}else{return undefined}},getSolutionType:function(q){var m=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewMetaData(q);if(m){return m.solutionType}else{return undefined}},getProductionPlantVisible:function(p,m){return p!==m?true:false},getPlannedOrderContactTitle:function(q){if(!i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){switch(q){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK:return this.getModel('Common_i18n').getResourceBundle().getText("INTERNAL_CONTACT");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_VENDOR:return this.getModel('Common_i18n').getResourceBundle().getText("VENDOR_INFO");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC:return this.getModel('Common_i18n').getResourceBundle().getText("VENDOR_INFO");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PLANT:return this.getModel('Common_i18n').getResourceBundle().getText("SUPPLYING_PLANT");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD:return this.getModel('Common_i18n').getResourceBundle().getText("INTERNAL_CONTACT");case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_REPLANT:return this.getModel('Common_i18n').getResourceBundle().getText("RECEIVING_PLANT")}}else{var i,s,m;switch(q){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK:i="INTERNAL_CONTACT";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_VENDOR:case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC:i="VENDOR_INFO";s=i+"SoH";m=i+"ModS";if(this.getModel('ServiceVersions')){i=i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForFieldInt({sI18nID:i,sSoHI18nID:s,sModSI18nID:m,iServiceVersion:this.getModel('ServiceVersions').getData().iServiceSchemaVersion})}break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PLANT:i="SUPPLYING_PLANT";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD:i="INTERNAL_CONTACT";break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_REPLANT:i="RECEIVING_PLANT";break}if(i){return this.getModel('Common_i18n').getResourceBundle().getText(i)}}},getTextByProcurementType:function(q,t,a){return((q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK)||(q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD))?t:a},getTextProductionOrProcess:function(q,t,a){return((q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PRDORD)||(q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.ORDRES))?t:a},getVisibilityByQuickViewType:function(q,r){if((q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK)||(q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD)){return true}else{return false}},getVisibilityByNotQuickViewType:function(q,r){if((q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK)||(q===i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD)){return false}else{return true}},matchCategoryAndHasValue:function(v,c,r,a,b,d){var h=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v);return(h&&(c===r||c===a||c===b||c===d))},matchCategoryAndHasValues:function(v,a,c,r,b,d,e){var h=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v,a);return(h&&(c===r||c===b||c===d||c===e))},matchCategoryAndHasValues3:function(v,a,b,c,r,d,e,f){var h=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v,a,b);return(h&&(c===r||c===d||c===e||c===f))},matchCategoryHasValues5:function(v,a,b,c,q){if((v==null||v=="")||(a==null||a=="")||(b==null||b=="")||(c==null||c=="")||(q==null||q=="")){return false};switch(q){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD:if(v==0&&a==0&&b==0&&c==0){return false}else{return true}default:return false}},matchCategoryHasValues4DiffPlants:function(v,a,b,c,d,r,e,f,g){if(v==null||a==null||b==null||c==null){return};if(b===c){if((v==0)||(v=='')&&(a==0)||(a=='')&&(b==0)||(b=='')&&(c==0)||(c=='')){return(false&&(d===r||d===e||d===f||d===g))}return(true&&(d===r||d===e||d===f||d===g))}else if(b!==c){return(true&&(d===r||d===e||d===f||d===g))}},matchCategoryForEveryValue:function(v,c,r,a,b,d){var e=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isValueGreaterEqualZero(v);return(e&&(c===r||c===a||c===b||c===d))},matchCategoryUnsrc:function(v,q){if(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC){return true}else{return false}},matchCategoryVendor:function(v,q){if((q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_VENDOR)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC)){return true}else{return false}},matchCategoryProcurement:function(v,q){if((q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD)){return true}else{return false}},matchCategoryPlanned:function(v,q){if((q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_VENDOR)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PLANT)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD)||(q==i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_REPLANT)){return true}else{return false}},matchDifferentValue:function(v,a){var h=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hasValue(v);return(h&&(v!==a))},handlePressDispoElementQuickView:function(e,t){t._oSelectedMRPElementItem=e.getSource();var m=t._oSelectedMRPElementItem.getBindingContext().getObject();if(!t._oQuickViewContainer){t._oQuickViewContainer={}}var v=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewFragment(m.MRPElementCategory);var q=undefined;if(!t._oQuickViewContainer[v]){q=sap.ui.xmlfragment(v,t);q.setModel(t.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");q.setModel(t.getView().getModel("Common_i18n"),"Common_i18n");q.setModel(t.getView().getModel());var Q=new sap.ui.model.json.JSONModel(i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT);q.setModel(Q,"QuickViewConstantsModel");var M=new sap.ui.model.json.JSONModel(i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRPElementCategory);q.setModel(M,"MRPElementConstantsModel")}else{q=t._oQuickViewContainer[v]}var a="/QuickViews(";if(m.MRPElementCategory===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_ORDRES){a+="MRPElementCategory='"+encodeURIComponent(m.SourceMRPElementCategory)+"',";a+="MRPElement='"+encodeURIComponent(m.SourceMRPElement)+"',";a+="MRPElementItem='"+encodeURIComponent(m.SourceMRPElementItem)+"',";a+="MRPElementScheduleLine='"+encodeURIComponent(m.SourceMRPElementScheduleLine)+"'"}else{a+="MRPElementCategory='"+encodeURIComponent(m.MRPElementCategory)+"',";a+="MRPElement='"+encodeURIComponent(m.MRPElement)+"',";a+="MRPElementItem='"+encodeURIComponent(m.MRPElementItem)+"',";a+="MRPElementScheduleLine='"+encodeURIComponent(m.MRPElementScheduleLine)+"'"}a+=")";q.bindElement(a);t._oQuickViewContainer[v]=q},destroyQuickViews:function(t){if(t._oQuickViewContainer){for(var i in t._oQuickViewContainer){if(t._oQuickViewContainer[i]){t._oQuickViewContainer[i].destroy();t._oQuickViewContainer[i]=undefined}}}},matchCategoryValueInAnyField:function(v,a,b,q){switch(q){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_STOCK:if(v==null||v==""){return false}else{return true}case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_VENDOR:return false;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_UNSRC:return false;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PLANT:if(b==null||b==""){return false}else{return true}case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_PROD:if(v==null||v==""){return false}else{return true}case i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.PLANORD_REPLANT:if(b==null||b==""){return false}else{return true}}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.StateMachine')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.StateMachine");i2d.pp.mrpcockpit.reuse.util.StateMachine={oState:{initial:"initial",waitVariantData:"waitVariantData",waitFacetOrTableData:"waitFacetOrTableData",started:"started",waitFirstAORDialogFinished:"waitFirstAORDialogFinished",waitAORDialogFinished:"waitAORDialogFinished",waitFacetDataForNewAOR:"waitFacetFilterDataForNewAOR",waitSelectedVariantData:"waitSelectedVariantData"},oEvent:{start:"start",varDataReceived:"varDataReceived",facetDataReceived:"facetDataReceived",noFacetDataReceived:"noFacetDataReceived",tableDataReceived:"tableDataReceived",aORUndefined:"aORUndefined",firstAORDialogFinished:"aORFirstDialogFinished",aORDialogFinished:"aORDialogFinished",aORDialogCancelled:"aORDialogCancelled",filterChanged:"filterChanged",tableChanged:"tableChanged",aORButtonPressed:"aORButtonPressed",variantSelected:"variantSelected"},oAction:{getVariantDataByName:function(c){i2d.pp.mrpcockpit.reuse.view.DisplayVariant.readVariantByName(c.sCurrentVariantName)},getVariantDataById:function(c){i2d.pp.mrpcockpit.reuse.view.DisplayVariant.readVariantById(c.sVariantID)},getTableData:function(c){c._rebindRefreshTable()},getFacetAndTableData:function(c){c._setupFacetFilterCall();c._rebindRefreshTable()},startFirstAORDialog:function(c){i2d.pp.mrpcockpit.reuse.view.AoRHandler.openFirstOnboardingDialog(c.oDataModel,c._firstAORDialogFinished.bind(c),c)},setFacetFilterVariant:function(c){c.oViewState.FacetFilterState=c.oVariantData.FacetFilterState;c._setFacetFilterState(c.oVariantData.FacetFilterState);i2d.pp.mrpcockpit.reuse.view.FacetFilter._recreateFacetFilterFilters(c)},startAORDialog:function(c){i2d.pp.mrpcockpit.reuse.view.AoRHandler.openOnboardingDialog(null,c.oDataModel,c._aORDialogFinished.bind(c),c)},restoreFacetFilterState:function(c){if(c.aStoredFacetFilterState!=undefined){c.oViewState.FacetFilterState=c.aStoredFacetFilterState;c._setFacetFilterState(c.oViewState.FacetFilterState)}},doNothing:function(){}}};i2d.pp.mrpcockpit.reuse.util.StateMachine.aStateTable=[{transition:"1",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.initial,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.start,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getVariantDataById,actionName:"getVariantDataById",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitVariantData},{transition:"2",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitVariantData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.varDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getFacetAndTableData,actionName:"getFacetAndTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"3",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.facetDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.setFacetFilterVariant,actionName:"setFacetFilterVariant",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"4",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.tableDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"5",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.aORButtonPressed,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.startAORDialog,actionName:"startAORDialog",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitAORDialogFinished},{transition:"6",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitAORDialogFinished,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.aORDialogFinished,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getFacetAndTableData,actionName:"getFacetAndTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetDataForNewAOR},{transition:"7",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetDataForNewAOR,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.facetDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.restoreFacetFilterState,actionName:"restoreFacetFilterState",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"8",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.variantSelected,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getVariantDataByName,actionName:"getVariantDataByName",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitSelectedVariantData},{transition:"9",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.filterChanged,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getTableData,actionName:"getTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"10",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFirstAORDialogFinished,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.firstAORDialogFinished,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getFacetAndTableData,actionName:"getFacetAndTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"11",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.aORUndefined,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.startFirstAORDialog,actionName:"startFirstAORDialog",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFirstAORDialogFinished},{transition:"12",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.facetDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.setFacetFilterVariant,actionName:"setFacetFilterVariant",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"13",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.tableDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"14",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetDataForNewAOR,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.tableDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetDataForNewAOR},{transition:"15",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.tableChanged,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getTableData,actionName:"getTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"16",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.noFacetDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"17",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitSelectedVariantData,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.varDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getTableData,actionName:"getTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"18",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.varDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.getTableData,actionName:"getTableData",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetOrTableData},{transition:"19",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitAORDialogFinished,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.aORDialogCancelled,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started},{transition:"20",currentState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.waitFacetDataForNewAOR,event:i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent.noFacetDataReceived,action:i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction.doNothing,actionName:"doNothing",newState:i2d.pp.mrpcockpit.reuse.util.StateMachine.oState.started}];i2d.pp.mrpcockpit.reuse.util.StateMachine.runStateMachine=function(c,e){c.logger.info("-----------------------------------------------------------------");c.logger.info("Current State: "+c.sState);c.logger.info("Event:         "+e);for(var i=0;i<i2d.pp.mrpcockpit.reuse.util.StateMachine.aStateTable.length;i++){var E=i2d.pp.mrpcockpit.reuse.util.StateMachine.aStateTable[i];if((E.currentState==c.sState)&&(E.event==e)){c.logger.info("Transition:    "+E.transition);c.logger.info("Action:        "+E.actionName);c.logger.info("-->            "+E.newState);c.sState=E.newState;E.action(c);break}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper");jQuery.sap.require('sap.ca.ui.message.message');i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper={setODataModel:function(m,b){this.oModelGlobal=m;this.backendVersion=b},_mapOData3ToOdata5:function(d){d.MRPElementChangedTotalQuantity=d.MRPElementChangeOpenQuantity;d.MRPElementOriginalTotalQty=d.MRPElementOpenQuantity;d.OrderQuantityUnitDcmls=d.TargetQuantityUnitDcmls;d.OrderUnitOfMeasureTechnicalName=d.UnitOfMeasureTechnicalName},_mapOData5ToOdata3:function(d){d.MRPElementChangeOpenQuantity=d.MRPElementChangedTotalQuantity;d.MRPElementOpenQuantity=d.MRPElementOriginalTotalQty;d.TargetQuantityUnitDcmls=d.OrderQuantityUnitDcmls;d.UnitOfMeasureTechnicalName=d.OrderUnitOfMeasureTechnicalName;d.MRPElementItem=this._adaptItemIdForMM(d.MRPElementItem)},_adaptItemIdForMM:function(i){var I=i;if(I.length>5){I=I.substring(1)}return I},readRequest:function(m){var u="/RequestNotes";var r=null;var f="MRPElement eq '";f+=m.PurchaseOrderID;f+="' and MRPElementItem eq '";f+=m.ItemID;f+="' and MRPElementScheduleLine eq '";f+=m.ScheduleLineID;f+="' and Type eq '";f+=m.Type;f+="'";var U=new Array();var t="$filter="+f;U.push(t);this.oModelGlobal.read(u,null,U,false,function(d,R){r=R.data.results[0]},function(e){r=null});return r},writeRequest:function(d,r){var f=false;var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var u="/RequestNotes";var o={};o.MRPElement=d.MRPElement;o.MRPElementItem=d.MRPElementItem;o.MRPElementScheduleLine=d.MRPElementScheduleLine;o.Vendor=d.Vendor;o.MaterialShortageSolutionType=d.MaterialShortageSolutionType;o.SolutionRequestStatus=d.SolutionRequestStatus;o.MaterialID=d.MaterialID;o.SolutionRequestNote=d.SolutionRequestNote;o.MaterialShortageSolnRequest="";o.DummyMrpReqNote="";o.MRPElementTargetQuantity=(d.MRPElementChangeOpenQuantity).toString();o.MRPElementOriginalQuantity=(d.MRPElementOpenQuantity).toString();var a=d.MRPElementChgAvailyOrRqmtDate;o.MRPElementTargetDate=D.format(a)+"T00:00:00";a=d.MRPElementAvailyOrRqmtDate;o.MRPElementOriginalDate=D.format(a)+"T00:00:00";this.oModelGlobal.create(u,o,null,function(){f=true},function(e){f=false});return f},deleteShortageAccept:function(m,r){this._mapOData5ToOdata3(m);var f=false;var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var a=d.format(m.MaterialShortageStartDate)+"T00:00:00";var b=d.format(m.MaterialShortageEndDate)+"T00:00:00";var u="/AcceptedShortages(MaterialShortageProfile='"+m.MaterialShortageProfile+"',MaterialShortageProfileCount='"+m.MaterialShortageProfileCount+"',MaterialID='"+m.MaterialID+"',MRPPlant='"+m.MRPPlant+"',MRPArea='"+m.MRPArea+"',MRPPlanningSegmentType='"+m.MRPPlanningSegmentType+"',MRPPlanningSegmentNumber='"+m.MRPPlanningSegmentNumber+"',MaterialShortageStartDate=datetime'"+a+"',MaterialShortageEndDate=datetime'"+b+"')";this.oModelGlobal.remove(u,{fnSuccess:function(){f=""},fnError:function(e){f=false}});return f},writeShortageAccept:function(d,r){this._mapOData5ToOdata3(d);var f=false;var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var u="/AcceptedShortages";var o={};o.MaterialShortageProfile=d.MaterialShortageProfile;o.MaterialShortageProfileCount=d.MaterialShortageProfileCount;o.MaterialID=d.MaterialID;o.MRPPlant=d.MRPPlant;o.MRPArea=d.MRPArea;o.MRPPlanningSegmentType=d.MRPPlanningSegmentType;o.MRPPlanningSegmentNumber=d.MRPPlanningSegmentNumber;o.MaterialShortageStartDate=D.format(d.MaterialShortageStartDate)+"T00:00:00";o.MaterialShortageEndDate=D.format(d.MaterialShortageEndDate)+"T00:00:00";o.MaterialShortageQuantity=(d.MaterialShortageQuantity).toString();o.AcceptShortageNote=d.SolutionRequestNote;this.oModelGlobal.create(u,o,null,function(){f=""},function(e){f=false});return f},deleteShortageAcceptBatch:function(m,h){this._mapOData5ToOdata3(m);var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var c=[];var D={};var a=d.format(m.MaterialShortageStartDate)+"T00:00:00";var b=d.format(m.MaterialShortageEndDate)+"T00:00:00";var u="/AcceptedShortages(MaterialShortageProfile='"+m.MaterialShortageProfile+"',MaterialShortageProfileCount='"+m.MaterialShortageProfileCount+"',MaterialID='"+m.MaterialID+"',MRPPlant='"+m.MRPPlant+"',MRPArea='"+m.MRPArea+"',MRPPlanningSegmentType='"+m.MRPPlanningSegmentType+"',MRPPlanningSegmentNumber='"+m.MRPPlanningSegmentNumber+"',MaterialShortageStartDate=datetime'"+encodeURIComponent(a)+"',MaterialShortageEndDate=datetime'"+encodeURIComponent(b)+"')";var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_DELETE;var C=this.oModelGlobal.createBatchOperation(u,o,D,null);c.push(C);this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},createShortageAcceptBatch:function(d,h){this._mapOData5ToOdata3(d);var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var u="/AcceptedShortages";this.oModelGlobal.setUseBatch(true);this.oModelGlobal.clearBatch();var a={};a.MaterialShortageProfile=d.MaterialShortageProfile;a.MaterialShortageProfileCount=d.MaterialShortageProfileCount;a.MaterialID=d.MaterialID;a.MRPPlant=d.MRPPlant;a.MRPArea=d.MRPArea;a.MRPPlanningSegmentType=d.MRPPlanningSegmentType;a.MRPPlanningSegmentNumber=d.MRPPlanningSegmentNumber;a.MaterialShortageStartDate=D.format(d.MaterialShortageStartDate)+"T00:00:00";a.MaterialShortageEndDate=D.format(d.MaterialShortageEndDate)+"T00:00:00";a.MaterialShortageQuantity=(d.MaterialShortageQuantity).toString();a.AcceptShortageNote=d.SolutionRequestNote;var C=this.oModelGlobal.createBatchOperation(u,o,a,null);c.push(C);this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},writePurchaseOrder:function(d,r){var f=false;var u="/MMPurchaseOrderScheduleLines(PurchaseOrderID='";u+=d.MRPElement;u+="',ItemID='";u+=d.MRPElementItem;u+="',ScheduleLineID='";u+=d.MRPElementScheduleLine;u+="')";var D=d.MRPElementChgAvailyOrRqmtDate;var o=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e={};e.DeliveryDate=o.format(D)+"T00:00:00";e.PurchasingDocumentOrderQty=(d.MRPElementChangeOpenQuantity).toString();var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";p.fnSuccess=function(){f=true};p.fnError=function(E){f=false};p.bMerge=true;this.oModelGlobal.update(u,e,p);return f},writePurchaseRequisition:function(d,r){var f=false;var u="/MMPurchaseRequisitionItems(PurchaseRequisitionID='";u+=d.MRPElement;u+="',ItemID='";u+=d.MRPElementItem;u+="')";var D=d.MRPElementChgAvailyOrRqmtDate;var o=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e={};e.DeliveryDate=o.format(D)+"T00:00:00";e.RequestedQuantity=(d.MRPElementChangeOpenQuantity).toString();e.PurchaseRequisitionIsFixed=true;var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";p.fnSuccess=function(){f=true};p.fnError=function(E){f=false};p.bMerge=true;this.oModelGlobal.update(u,e,p);return f},writePurchaseOrderBatch:function(d,r,h){this._mapOData5ToOdata3(d);var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});if(!d.MRPElement||!d.MRPElementItem||!d.MRPElementScheduleLine||!d.MaterialShortageSolutionType||!d.MaterialID||!d.MRPElementChgAvailyOrRqmtDate||!d.MRPElementAvailyOrRqmtDate||!d.MRPElementOpenQuantity||!d.MRPElementChangeOpenQuantity){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}this.oModelGlobal.setUseBatch(true);this.oModelGlobal.clearBatch();var u="/MMPurchaseOrderScheduleLines(PurchaseOrderID='";u+=d.MRPElement;u+="',ItemID='";u+=d.MRPElementItem;u+="',ScheduleLineID='";u+=d.MRPElementScheduleLine;u+="')";var e={};var o=d.MRPElementChgAvailyOrRqmtDate;e.DeliveryDate=D.format(o)+"T00:00:00";e.PurchasingDocumentOrderQty=(d.MRPElementChangeOpenQuantity).toString();var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";var C=this.oModelGlobal.createBatchOperation(u,"MERGE",e,p);c.push(C);u="/RequestNotes";var a={};a.MRPElement=d.MRPElement;a.MRPElementItem=d.MRPElementItem;a.MRPElementScheduleLine=d.MRPElementScheduleLine;a.Vendor=d.Vendor;a.MaterialShortageSolutionType=d.MaterialShortageSolutionType;a.SolutionRequestStatus=d.SolutionRequestStatus;a.MaterialID=d.MaterialID;a.SolutionRequestNote=d.SolutionRequestNote;a.MaterialShortageSolnRequest="";a.DummyMrpReqNote="";a.MRPElementTargetQuantity=(d.MRPElementChangeOpenQuantity).toString();a.MRPElementOriginalQuantity=(d.MRPElementOpenQuantity).toString();var o=d.MRPElementChgAvailyOrRqmtDate;a.MRPElementTargetDate=D.format(o)+"T00:00:00";o=d.MRPElementAvailyOrRqmtDate;a.MRPElementOriginalDate=D.format(o)+"T00:00:00";this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},writePurchaseRequisitionBatch:function(d,r,h){this._mapOData5ToOdata3(d);var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});if(!d.MRPElement||!d.MRPElementItem||!d.MaterialShortageSolutionType||!d.MaterialID||!d.MRPElementChgAvailyOrRqmtDate||!d.MRPElementAvailyOrRqmtDate||!d.MRPElementOpenQuantity||!d.MRPElementChangeOpenQuantity){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}this.oModelGlobal.setUseBatch(true);this.oModelGlobal.clearBatch();var u="/MMPurchaseRequisitionItems(PurchaseRequisitionID='";u+=d.MRPElement;u+="',ItemID='";u+=d.MRPElementItem;u+="')";var e={};var o=d.MRPElementChgAvailyOrRqmtDate;e.DeliveryDate=D.format(o)+"T00:00:00";e.RequestedQuantity=(d.MRPElementChangeOpenQuantity).toString();e.PurchaseRequisitionIsFixed=true;var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";var C=this.oModelGlobal.createBatchOperation(u,"MERGE",e,p);c.push(C);u="/RequestNotes";var a={};a.MRPElement=d.MRPElement;a.MRPElementItem=d.MRPElementItem;a.MRPElementScheduleLine=d.MRPElementScheduleLine;a.Vendor=d.Vendor;a.MaterialShortageSolutionType=d.MaterialShortageSolutionType;a.SolutionRequestStatus=d.SolutionRequestStatus;a.MaterialID=d.MaterialID;a.SolutionRequestNote=d.SolutionRequestNote;a.MaterialShortageSolnRequest="";a.DummyMrpReqNote="";a.MRPElementTargetQuantity=(d.MRPElementChangeOpenQuantity).toString();a.MRPElementOriginalQuantity=(d.MRPElementOpenQuantity).toString();var o=d.MRPElementChgAvailyOrRqmtDate;a.MRPElementTargetDate=D.format(o)+"T00:00:00";o=d.MRPElementAvailyOrRqmtDate;a.MRPElementOriginalDate=D.format(o)+"T00:00:00";this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},createPurchaseOrderBatch:function(d,r,h){this._mapOData5ToOdata3(d);var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var f="0001";var A="01";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!f||!d.PurchasingOrganisation||!d.MRPElementChangeOpenQuantity||!d.ReceivingPlant||!d.MaterialID||!d.MaterialBaseUnit||!A){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PO_CREATE&&!d.Vendor){return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TO"}var s={};var o=d.MRPElementChgAvailyOrRqmtDate;s.ItemID=M;s.ScheduleLineID=f;if(!o){s.DeliveryDate=" "}else{s.DeliveryDate=D.format(o)+"T00:00:00"}s.PurchasingDocumentOrderQty=this.replaceEmptyValues((d.MRPElementChangeOpenQuantity).toString());var a=new Array();a.push(s);var g={};g.ItemID=M;g.AccountAssignmentID=A;g.SalesOrder=this.replaceEmptyValues(d.SalesOrder);g.SalesOrderItem=this.replaceEmptyValues(d.SalesOrderItem);g.WBSElement=this.replaceEmptyValues(d.WBSElement);var e=new Array();e.push(g);var i={};i.ItemID=M;i.AcctAssignmentCategory=this.replaceEmptyValues(d.AcctAssignmentCategory);i.Material=this.replaceEmptyValues(d.MaterialID);i.PurchasingDocumentOrderQty=this.replaceEmptyValues((d.MRPElementChangeOpenQuantity).toString());i.PurgDocOrderQuantityUnit=this.replaceEmptyValues(d.MaterialBaseUnit);i.ReceivingPlant=this.replaceEmptyValues(d.ReceivingPlant);i.SupplyingStorageLocation=this.replaceEmptyValues(d.SupplyingStorageLocation);i.ReceivingStorageLocation=this.replaceEmptyValues(d.ReceivingStorageLocation);i.PurchasingInfoRecord=this.replaceEmptyValues(d.PurchasingInfoRecord);i.PurchaseContract=this.replaceEmptyValues(d.PurchaseContract);i.PurchaseContractItem=this.replaceEmptyValues(d.PurchaseContractItem);i.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);i.MMPurchaseOrderScheduleLines=a;i.MMPurchaseOrderAccAssignments=e;var b=new Array();b.push(i);var u="/MMPurchaseOrderHeaders";var H={};H.PurchasingOrganisation=d.PurchasingOrganisation;H.PurchasingGroup=d.PurchasingGroup;H.CompanyCode=d.CompanyCode;H.Vendor=this.replaceEmptyValues(d.Vendor);H.SupplyingPlant=this.replaceEmptyValues(d.SupplyingPlant);if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE){H.StockTransportOrderIndicator=true}else{H.StockTransportOrderIndicator=false}H.MMPurchaseOrderItems=b;var j=this.oModelGlobal.createBatchOperation(u,"POST",H,null);c.push(j);this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},replaceEmptyValues:function(v){if(!v){return" "}else{return v}},createPurchaseRequisitionBatch:function(d,r,h){this._mapOData5ToOdata3(d);var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var A="01";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!d.MRPElementChangeOpenQuantity||!d.MaterialID||!d.MaterialBaseUnit||!A){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PO_CREATE&&!d.Vendor){return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PR"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TR"}if(d.Vendor&&!d.PurchasingOrganisation){return"SOLUTION_DIALOG_MSG_PURCHASING_ORGANIZATION_MISSING_PR"}var a={};a.ItemID=M;a.AccountAssignmentID=A;a.SalesOrder=this.replaceEmptyValues(d.SalesOrder);a.SalesOrderItem=this.replaceEmptyValues(d.SalesOrderItem);a.WBSElement=this.replaceEmptyValues(d.WBSElement);var e=new Array();e.push(a);var i={};var o=d.MRPElementChgAvailyOrRqmtDate;i.ItemID=M;i.PurchasingOrganisation=this.replaceEmptyValues(d.PurchasingOrganisation);i.PurchasingGroup=this.replaceEmptyValues(d.PurchasingGroup);i.PurchasingDocumentItemCategory=this.replaceEmptyValues(d.MaterialProcurementType);i.SupplyingPlant=this.replaceEmptyValues(d.SupplyingPlant);i.AcctAssignmentCategory=this.replaceEmptyValues(d.AcctAssignmentCategory);i.Material=this.replaceEmptyValues(d.MaterialID);i.PurReqQuantityUnit=this.replaceEmptyValues(d.MaterialBaseUnit);i.ReceivingPlant=this.replaceEmptyValues(d.ReceivingPlant);i.SupplyingStorageLocation=this.replaceEmptyValues(d.SupplyingStorageLocation);i.ReceivingStorageLocation=this.replaceEmptyValues(d.ReceivingStorageLocation);i.PurchasingInfoRecord=this.replaceEmptyValues(d.PurchasingInfoRecord);i.PurchaseContract=this.replaceEmptyValues(d.PurchaseContract);i.PurchaseContractItem=this.replaceEmptyValues(d.PurchaseContractItem);i.RequestedQuantity=this.replaceEmptyValues((d.MRPElementChangeOpenQuantity).toString());i.FixedVendor=this.replaceEmptyValues(d.Vendor);if(!o){i.DeliveryDate=" "}else{i.DeliveryDate=D.format(o)+"T00:00:00"}i.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);i.MMPurchaseReqAccAssignments=e;i.PurchaseRequisitionIsFixed=true;var b=new Array();b.push(i);var u="/MMPurchaseRequisitionHeaders";var H={};H.MMPurchaseRequisitionItems=b;var f=this.oModelGlobal.createBatchOperation(u,"POST",H,null);c.push(f);this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},convertPurchaseRequisitionBatch:function(d,r,h){var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var e="0001";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!e||!d.MRPElementChangeOpenQuantity||!d.MRPElement){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if((d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PR_CHANGE||d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PR_INCREASE||d.MaterialShortageSolutionType===C.SSOLUTIONTYPE_PR_RESCHEDULE)&&!d.Vendor){return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO"}if((d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TOR_CHANGE||d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TOR_INCREASE||d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TOR_RESCHEDULE)&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TO"}var s={};var o=d.MRPElementChgAvailyOrRqmtDate;s.ItemID=M;s.ScheduleLineID=e;if(!o){s.DeliveryDate=" "}else{s.DeliveryDate=D.format(o)+"T00:00:00"}s.PurchasingDocumentOrderQty=this.replaceEmptyValues((d.MRPElementChangeOpenQuantity).toString());var a=new Array();a.push(s);var i={};i.ItemID=M;i.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);i.PurchaseRequisition=this.replaceEmptyValues(d.MRPElement);i.PurchaseRequisitionItem=M;i.MMPurchaseOrderScheduleLines=a;var b=new Array();b.push(i);var u="/MMPurchaseOrderHeaders";var H={};if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TOR_CHANGE||d.SolutionTyp===C.SOLUTIONTYPE_TOR_INCREASE||d.SolutionTyp===C.SOLUTIONTYPE_TOR_RESCHEDULE){H.StockTransportOrderIndicator=true}else{H.StockTransportOrderIndicator=false}H.MMPurchaseOrderItems=b;var f=this.oModelGlobal.createBatchOperation(u,"POST",H,null);c.push(f);this.oModelGlobal.addBatchChangeOperations(c);this.oModelGlobal.submitBatch(h.fnSuccess,h.fnError,true);return""},extractErrorMsgFromXml:function(x){var t="";try{var p=new DOMParser();var a=p.parseFromString(x,"text/xml");var m=a.getElementsByTagName("message");if(m.length>0){t=m[0].childNodes[0].nodeValue}else{var M=new sap.ui.model.json.JSONModel();M.setJSON(x);t=M.oData.error.message.value}}catch(e){var M=new sap.ui.model.json.JSONModel();M.setJSON(x);if(M.oData&&M.oData.error&&M.oData.error.message&&M.oData.error.message.value){t+=M.oData.error.message.value}else{t=x}}return t},extractErrorMsgFromBatchResponse:function(e){var E="";var t="";var r=null;for(var i=0;i<e.length;i++){if(i>0){E+="; "}r=e[i].response;t=i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.extractErrorMsgFromXml(r.body);E+=t}return E}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.Wave3Helper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.Wave3Helper");i2d.pp.mrpcockpit.reuse.util.Wave3Helper={calcShortagePeriod:function(d){var v=this.getView();var D=v.getModel().oData;var s=this.getView().byId("SDItems");var I=(s)?s.getItems():[];var l=(I&&I.length)?I.length:0;var o;var a;var f=null;var b=null;for(var i=1;i<l;i++){o=D[I[i].getBindingContext().getPath().slice(1)];if(o.MRPElementAvailyOrRqmtDate<d){if(i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){a=o;f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else if(!i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){f=null;a=null}}else if(o.MRPElementAvailyOrRqmtDate.getTime()==d.getTime()){a=o;f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else{if(i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else{b=new Date(o.MRPElementAvailyOrRqmtDate.getTime()-24*3600*1000);break}}}if(!f&&(l>0)){o=D[I[0].getBindingContext().getPath().slice(1)];a=o;f=o.MRPElementAvailyOrRqmtDate}if(!b){b=new Date();b.setUTCFullYear(9999);b.setUTCMonth(11);b.setUTCDate(31);b.setUTCHours(0)}return{shortageItem:a,firstDate:f,lastDate:b}},isShortage:function(i){return(i.MRPAvailability!==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE)},getPathSolutionView:function(){var p="/PPMRPSolHeaders(";p+="MaterialID='"+encodeURIComponent(this.navParameter.MaterialID);p+="',MRPPlant='"+encodeURIComponent(this.navParameter.MRPPlant);p+="',MRPArea='"+encodeURIComponent(this.navParameter.MRPArea);p+="',MRPPlanningSegmentType='"+encodeURIComponent(this.navParameter.MRPPlanningSegmentType);p+="',MRPPlanningSegmentNumber='"+encodeURIComponent(this.navParameter.MRPPlanningSegmentNumber);p+="',MaterialShortageDefinitionID='"+encodeURIComponent(this.navParameter.MaterialShortageDefinitionID);p+="',MaterialShortageStartDate=datetime'"+encodeURIComponent(this.dateStart);p+="',MaterialShortageEndDate=datetime'"+encodeURIComponent(this.dateEnd);p+="')";return p},_getListTemplate:function(i,c){var C=true;var o=sap.ui.getCore();var a=i.split("--")[0];var v=o.getElementById(a);if(v){C=v.getController()._bCrIconClickable}var I=new sap.ui.core.Icon({visible:"{parts: [{path:'SolutionRequestStatus'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility'}",src:"sap-icon://request",tooltip:"{parts: [{path:'SolutionRequestStatus'}, {path:'VendorResponse'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestTooltip'}"});if(C===true){I.attachPress(function(g){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.onCRPressed(g);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}})}var b=new sap.ui.core.Icon({visible:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewVisible'}",tooltip:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewTooltip'}",src:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolView'}"});var t=new sap.m.ColumnListItem({unread:false,cells:[new sap.m.Label({text:"{path: 'MRPElementAvailyOrRqmtDate', type:'sap.ca.ui.model.type.Date', formatOptions: {style:'short'}}",visible:"{path:'MRPElementCategory', formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isSupplyDemandItem'}",customData:[new sap.ui.core.CustomData({key:"hideStockDate",value:"{parts: [{path:'MRPElementCategory'},{path:'MRPElementAvailyOrRqmtDate'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hideStockDate'}"})]}),new sap.ui.layout.HorizontalLayout({content:[b,I]}),new sap.m.ObjectIdentifier({title:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementCategoryShortName'}, {path: 'MRPElement'}, {path: 'MRPElementItem'}, {path: 'MRPElementDocumentType'}, {path: 'SourceMRPElementCategory'}, {path: 'SourceMRPElement'}, {path: 'SourceMRPElementItem'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getRequirements'}",text:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementBusinessPartnerName'}, {path: 'MRPElementBusinessPartnerType'}, {path: 'MRPElementBusinessPartnerID'}, {path: 'MRPElementDocumentType'}, {path: 'Assembly'}, {path: 'MaterialSafetyStockQty'}, {path: 'TargetQuantityUnitDcmls'}, {path: 'UnitOfMeasureTechnicalName'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.vendorOrReq'}"}),new sap.ui.layout.HorizontalLayout({content:[new sap.m.ObjectStatus({icon:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemicon'}",state:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sdIconState'}",tooltip:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemtooltip'}"}),new sap.m.Text({width:"0.5rem"}),new sap.m.ObjectNumber({number:"{parts:[ {path: 'MRPElementOpenQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.quantity'}",numberUnit:"{UnitOfMeasureTechnicalName}",emphasized:false})]}).addStyleClass("sapMRPStockQty"),new sap.m.ObjectNumber({number:"{parts:[{path: 'MRPAvailableQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.numberFormat'}",numberUnit:"{UnitOfMeasureTechnicalName}",visible:"{path: 'StockQuantityVisible'}",customData:{Type:"sap.ui.core.CustomData",key:"getMergingKey",value:"{parts:[{path:'MRPElementCategory'}, {path: 'MRPElementAvailyOrRqmtDate'}, {path: 'MRPAvailableQuantity'}], formatter: 'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.availableQuantityMergingKey'}"}}).addStyleClass("sapMRPAvailableQuantity")]});var d=parseFloat(c.getProperty("MRPAvailableQuantity"));var e=parseFloat(c.getProperty("MaterialShortageCriticalQty"));var f=parseFloat(c.getProperty("MaterialShortageThresholdQty"));var O=c.getObject();t.removeStyleClass("sapMRPShortage");t.removeStyleClass("sapMRPShortageSolved");t.removeStyleClass("sapMRPElementChanged");t.removeStyleClass("sapMRPShortageAccepted");t.removeStyleClass("sapMRPShortageSafetyStock");if(O.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED){t.addStyleClass("sapMRPShortageAccepted")}else{if(O.ChangedMrpElement&&O.ChangedMrpElement===true){t.addStyleClass("sapMRPElementChanged")}else if((d<f)){t.addStyleClass("sapMRPShortage")}else if(d<e){t.addStyleClass("sapMRPShortageSafetyStock")}else if((d>=e)&&(O.InitialShortage&&O.InitialShortage===true)){t.addStyleClass("sapMRPShortageSolved")}}return t},_writeSafetyStock:function(c,s,a){for(var b=0;b<c.length;b++){if(c[b].getId().indexOf(a)!=-1){c[b].setText(s);return true}if(c[b].getContent&&this._writeSafetyStock(c[b].getContent(),s,a)){return true}}return false},determineAndWriteSafetyStock:function(v){var s=v.byId("SDItems");var a=s.getItems();var b;var c;var i=v.getModel("Common_i18n");var B=i.getResourceBundle();var d="";var e=s.getBindingContext();var f=(e)?e.getObject():null;if(f){if(f.MaterialSafetyStockQty&&Number(f.MaterialSafetyStockQty)!==0.0){var g=sap.ca.ui.model.format.NumberFormat.getInstance({decimals:f.TargetQuantityUnitDcmls}).format(f.MaterialSafetyStockQty);d=B.getText("SAFETY_STOCK",[g,f.UnitOfMeasureTechnicalName])}else{d=B.getText("NO_SAFETY_STOCK")}}for(var h=0 in a){b=a[h];c=b.getBindingContext().getObject();if(c.MRPElementCategory===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK){var j=a[h].getCells();this._writeSafetyStock(j,d,"stockElement");break}}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog');jQuery.sap.require('sap.ushell.services.CrossApplicationNavigation');sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog",{_DIALOG_ID:"DLG_WLC",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n")},onCancelDialog:function(e){var r={isConfirmed:false};var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNav=f&&f("CrossApplicationNavigation");var h=(this.oCrossAppNav&&this.oCrossAppNav.toExternal({target:{shellHash:"#"}}))||"";var d=this.getView().byId(this._DIALOG_ID);d.close()},onConfirmDialog:function(e){var v=this.byId("DLG_WLC");var m=v.getModel();var o=m.getProperty("/fnOpenAoRAddDialog");o(e);var d=this.getView().byId(this._DIALOG_ID);d.close()},})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.DisplayVariant')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.DisplayVariant");i2d.pp.mrpcockpit.reuse.view.DisplayVariant={getDisplayVariantPopover:function(c){this.oController=c;this.oDisplayVariantSaveAction=new sap.m.ActionListItem({text:c.getView().getModel("Common_i18n").getResourceBundle().getText("ButtonSaveVariant"),press:function(e){this.openVariantDialog(this.oController);this.oDisplayVariantPopover.close()}.bind(this)});this.oDisplayVariantSaveAction.isSelectable=function(){};this.oDisplayVariantDeleteAction=new sap.m.ActionListItem({text:c.getView().getModel("Common_i18n").getResourceBundle().getText("ButtonDeleteVariant"),visible:false,press:function(e){if(this.sCurrentDisplayVariant==""){this.oDisplayVariantPopover.close()}else{this.openDeleteVariant(this.oController);this.oDisplayVariantPopover.close()}}.bind(this)});this.oDisplayVariantDeleteAction.isSelectable=function(){};this.oDisplayVariantChangePropertiesAction=new sap.m.ActionListItem({text:c.getView().getModel("Common_i18n").getResourceBundle().getText("ButtonChangeProperties"),visible:false,press:function(e){var C=this.oController.oObjectHeader.getTitle();if(C==this.oController.getObjectHeaderTitle()){this.oDisplayVariantPopover.close()}else{this.openVariantPropertiesDialog(this.oController);this.oDisplayVariantPopover.close()}}.bind(this)});this.oDisplayVariantChangePropertiesAction.isSelectable=function(){};this.oDisplayVariantList=new sap.m.List({mode:"SingleSelectMaster",includeItemInSelection:true,items:[this.oDisplayVariantSaveAction,this.oDisplayVariantDeleteAction,this.oDisplayVariantChangePropertiesAction],select:function(e){var s=e.getParameter("listItem");if((s!=this.oDisplayVariantSaveAction)&&(s!=this.oDisplayVariantDeleteAction)&&(s!=this.oDisplayVariantChangePropertiesAction)){this.oDisplayVariantDeleteAction.setVisible(true);this.oDisplayVariantChangePropertiesAction.setVisible(true);this.oController.sCurrentVariantName=s.getTitle();this.oController.runStateMachine(this.oController,this.oController.oEvent.variantSelected)};this.oDisplayVariantPopover.close()}.bind(this)});this.oDisplayVariantPopover=new sap.m.Popover({placement:sap.m.PlacementType.Bottom,showHeader:false,content:this.oDisplayVariantList});return this.oDisplayVariantPopover},unpackVariantData:function(r,v,V){this.oController.oVariantData=v;if(V){this.oController.sCurrentVariantName=V}if(this.oController.sCurrentVariantName){if(v!=null&&v.ViewChanged){this.oController.oObjectHeader.setTitle(this.oController.sCurrentVariantName+" *");this.oController.oViewState.ViewChanged=true}else{this.oController.oObjectHeader.setTitle(this.oController.sCurrentVariantName);this.oController.oViewState.ViewChanged=false}this.oController.oViewState.VariantName=this.oController.sCurrentVariantName}else{if(v!=null&&v.ViewChanged){this.oController.oObjectHeader.setTitle(this.oController.getObjectHeaderTitle()+" *");this.oController.oViewState.ViewChanged=true}else{this.oController.oObjectHeader.setTitle(this.oController.getObjectHeaderTitle());this.oController.oViewState.ViewChanged=false}this.oController.oViewState.VariantName=this.oController.getObjectHeaderTitle()}if(v!=null){if(v.OrderCategory){this.oController.sOrderCategory=v.OrderCategory;this.oController.oViewState.OrderCategory=v.OrderCategory;if(this.oController._changeAppName){this.oController._changeAppName(v.OrderCategory)}}this.oController.oViewState.MaterialShortageDefinitionID=this.oController.oVariantData.MaterialShortageDefinitionID;this.oController.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,this.oController.oVariantData.MaterialShortageDefinitionID);var I=this.oController.oShortageSelect.getItems();if(this.oController.oVariantData.MaterialShortageDefinitionID!=""){if(this.oController.aShortageDefinitionKeys.length>0){var s=false;for(var i=0;i<this.oController.aShortageDefinitionKeys.length;i++){if(this.oController.aShortageDefinitionKeys[i]==this.oController.oVariantData.MaterialShortageDefinitionID){s=true;this.oController.oShortageSelect.setSelectedKey(this.oController.oVariantData.MaterialShortageDefinitionID);break}}if(s==false){var S=this.oController.oShortageSelect.getSelectedKey();this.oController.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,S);this.oController.oViewState.MaterialShortageDefinitionID=S;sap.m.MessageBox.alert(this.oController.getView().getModel("Common_i18n").getResourceBundle().getText("SHORTDEF_MISSING_MSG"))}}}else{if(this.oController.aShortageDefinitionKeys.length>0){this.oController.oShortageSelect.setSelectedItem(I[0]);var S=this.oController.oShortageSelect.getSelectedKey();this.oController.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,S);this.oController.oViewState.MaterialShortageDefinitionID=S}}this.oController.oViewState.TimeHorizon=this.oController.oVariantData.TimeHorizon;if(this.oController.oTimeHorizonSelect){this.oController.oTimeHorizonSelect.setSelectedKey(this.oController.oVariantData.TimeHorizon)}this.oController.filterTimeHorizon=new sap.ui.model.Filter("DynamicHorizonCode",sap.ui.model.FilterOperator.EQ,this.oController.oVariantData.TimeHorizon);i2d.pp.mrpcockpit.reuse.view.FacetFilter._resetFacetFilter(this.oController);this.oController.oViewState.FacetFilterState=this.oController.oVariantData.FacetFilterState;this.oController._setFacetFilterState(this.oController.oVariantData.FacetFilterState);this.oController._recreateFacetFilterFiltersFromVariant(this.oController.oVariantData.FacetFilterState);if(this.oController.oVariantData.TableState.aColumns){this.oController._applyTableStateToTable(this.oController.oVariantData.TableState);this.oController.oViewState.TableState=this.oController.oVariantData.TableState;this.oController._refilloDataSelectFields(this.oController.oVariantData.TableState)}else{if(this.oController.oViewState.TableState.aColumns){this.oController.oViewState.TableState={};this.oController._resetTableStateToTable();this.oController.sDataFieldSelect=this.oController.getInitialSelectFields()}};this.oController.oViewState.SortDescending=this.oController.oVariantData.SortDescending;this.oController.oViewState.SortKey=this.oController.oVariantData.SortKey;if(this.oController.oVariantData.SortKey==""){this.oController.oSorter.length=0}else{var a=[];a.push(new sap.ui.model.Sorter(this.oController.oVariantData.SortKey,this.oController.oVariantData.SortDescending));this.oController.oSorter=a}if(!V){}else{this.oController.bNewVSDialogRequiredAfterTablePers=true;if(this.oController.oVariantData.DefaultVariant){this.oDisplayVariantDeleteAction.setVisible(false);this.oDisplayVariantChangePropertiesAction.setVisible(false)}else{this.oDisplayVariantDeleteAction.setVisible(true);this.oDisplayVariantChangePropertiesAction.setVisible(true)}}this.oController.bViewHasBeenChanged=false}i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.saveViewStateInContainer(null,this.oController.oViewState,this.oController.sStateID,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME);this.oController.runStateMachine(this.oController,this.oController.oEvent.varDataReceived)},recreateDisplayVariantList:function(r,d){this.oDisplayVariantList.removeAllItems();this.oController.aDisplayVariantNames=d;if(d!=null){for(var i=0;i<d.length;i++){var n=new sap.m.StandardListItem({title:d[i],press:[function(e){var s=e.getSource();this.oController.sCurrentVariantName=s.getTitle();this.oController.runStateMachine(this.oController,this.oController.oEvent.variantSelected)},this]});this.oDisplayVariantList.addItem(n)}}this.oDisplayVariantList.addItem(this.oDisplayVariantSaveAction);this.oDisplayVariantList.addItem(this.oDisplayVariantDeleteAction);this.oDisplayVariantList.addItem(this.oDisplayVariantChangePropertiesAction);this.oDisplayVariantPopover.openBy(this.oController.oObjectHeaderIconDomRef)},readVariantList:function(c){this.oController=c;i2d.pp.mrpcockpit.reuse.view.VariantHandler.getAllVariants(this.recreateDisplayVariantList.bind(this),this.oController.getVariantContainerPrefix())},readVariantByName:function(v){i2d.pp.mrpcockpit.reuse.view.VariantHandler.getVariantByName(this.unpackVariantData.bind(this),this.oController.sVariantContainerPrefix,v)},readVariantById:function(v){var m=/id-.*-.*/;var s=m.exec(sap.ui.core.routing.HashChanger.getInstance().getHash());if(s){s=s[0]}else{s=""}i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.getViewState(this.unpackVariantData.bind(this),this.oController.sVariantContainerPrefix,this.oController.oDefaultVariantData,v,this.oController.sCurrentVariantName,s,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME)},readTempViewSateFromContainer:function(t){i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.getViewStateFromContainer(this.unpackVariantData.bind(this),t,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME,this.oController.oDefaultVariantData)},openVariantDialog:function(c,e){var v=c.oViewState;var s=c.oDataModel.sServiceUrl+c.getMasterEntity()+"/$count?"+c.byId(c.getTableId()).getBindingInfo('items').binding.sFilterParams;var a="#"+c.getVariantContainerPrefix();var V=c.aDisplayVariantNames;var n=c.getNumberUnit();var l=c.getMonitorAppIcon();var L=c.getManageAppIcon();i2d.pp.mrpcockpit.reuse.view.VariantHandler.openVariantSaveDialog(this.callbackFunctionVariantSave.bind(this),c.getVariantContainerPrefix(),v,V,s,a,n,l,L,c.sCurrentVariantName,false,false,true,c)},callbackFunctionVariantSave:function(r,v){if(r){this.oDisplayVariantDeleteAction.setVisible(true);this.oDisplayVariantChangePropertiesAction.setVisible(true);this.oController.oObjectHeader.setTitle(v);this.oController.sCurrentVariantName=v;this.oController.oViewState.VariantName=v;this.oController.oViewState.ViewChanged=false;this.oController.bViewHasBeenChanged=false}},openDeleteVariant:function(c,e){var a="#"+c.getVariantContainerPrefix();i2d.pp.mrpcockpit.reuse.view.VariantHandler.openVariantDeleteDialog(this.callbackFunctionVariantDelete.bind(this),c.getVariantContainerPrefix(),c.sCurrentVariantName,a,c)},callbackFunctionVariantDelete:function(r,v){if(r){this.oController.sCurrentVariantName="";this.oController.oObjectHeader.setTitle(this.oController.getObjectHeaderTitle());this.oController.oViewState.VariantName=this.oController.getObjectHeaderTitle();this.oController.oViewState.ViewChanged=false;this.oDisplayVariantDeleteAction.setVisible(false);this.oDisplayVariantChangePropertiesAction.setVisible(false)}},openVariantPropertiesDialog:function(c,e){var s=c.oDataModel.sServiceUrl+c.getMasterEntity()+"/$count?"+c.byId(c.getTableId()).getBindingInfo('items').binding.sFilterParams;var a="#"+c.getVariantContainerPrefix();var n=c.getNumberUnit();var l=c.getMonitorAppIcon();var L=c.getManageAppIcon();i2d.pp.mrpcockpit.reuse.view.VariantHandler.openVariantPropertiesDialog(this.callbackFunctionVariantProperties.bind(this),c.getVariantContainerPrefix(),s,a,n,l,L,c.sCurrentVariantName,c)},callbackFunctionVariantProperties:function(r,v){if(r){this.oController.oObjectHeader.setTitle(v);this.oController.sCurrentVariantName=v;this.oController.oViewState.VariantName=v;this.oController.oViewState.ViewChanged=false;this.oController.bViewHasBeenChanged=false}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.FacetFilter')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.FacetFilter");i2d.pp.mrpcockpit.reuse.view.FacetFilter={_toObject:function(a){var r={};for(var i=0;i<a.length;++i){r[a[i][0]]=a[i][1]}return r},_setFacetFilterState:function(c,f){this.oController=c;if(f.length==0){this._resetFacetFilter(c)}else{var l=this.oController.oFacetFilter.getLists();for(var F=0;F<f.length;F++){var o=f[F];for(var L=0;L<l.length;L++){var a=l[L];if(a.getKey()!==o.listKey){continue}else{a.setActive(o.active);var s=this._toObject(o.selectedItemKeys);a.setSelectedKeys(s)}}}}this.oController.oFacetFilter.setVisible(false);this.oController.oFacetFilter.setVisible(true)},_recreateFacetFilterFiltersFromVariant:function(c,f){this.oController=c;this.oController.aFacetFilterFilters.length=0;for(var F=0;F<f.length;F++){var o=f[F];for(var i=0;i<o.selectedItemKeys.length;i++){var n=new sap.ui.model.Filter(o.listKey,sap.ui.model.FilterOperator.EQ,o.selectedItemKeys[i][0]);this.oController.aFacetFilterFilters.push(n)}}},_handleFacetFilterReset:function(c,f){this.oController=c;if(f.length==0){this._resetFacetFilter(c)}else{this.oController.aFacetFilterFilters.length=0;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];for(var F=0;F<f.length;F++){var a=f[F];if(o.getKey()!==a.listKey){o.setActive(false);var s=this._toObject([]);o.setSelectedKeys(s)}else{o.setActive(true);var s=this._toObject([]);o.setSelectedKeys(s);break}}}}this._recreateFacetFilterFilters(c);this.oController.registerViewChanged();this.oController.runStateMachine(this.oController,this.oController.oEvent.filterChanged);this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_recreateFacetFilter:function(c,f){this.oController=c;this.oController.oFacetFilter.destroyLists();for(var i=0;i<f.length;i++){var I=[];for(var j=0;j<f[i].To_FacetFilterValues.results.length;j++){var n=f[i].To_FacetFilterValues.results[j];if(n.FacetFilterValueID!=""){I.push(n)}}var m="MultiSelect";if(c.getSingleSelectFacetFilter){for(var k=0;k<c.getSingleSelectFacetFilter().length;k++){var s=c.getSingleSelectFacetFilter();if(f[i].FacetFilterField==s[k]){m="SingleSelectMaster";break}}}var o=new sap.ui.model.json.JSONModel({values:I});o.setSizeLimit(I.length);var F="{i18n>FF"+f[i].FacetFilterField+"}";if(this.oController.aDiffFieldText){F="{i18n>"+i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForField("FF"+f[i].FacetFilterField,c)+"}"}var N=new sap.m.FacetFilterList({key:f[i].FacetFilterField,title:F,mode:m,active:false,selectedKeys:undefined,rememberSelections:false,items:{path:"/values",template:new sap.m.FacetFilterItem({text:"{FacetFilterValueText}",key:"{FacetFilterValueID}"})}});N.addStyleClass("sapMRPFFList");N.setModel(o);this.oController.oFacetFilter.addList(N);N.attachListClose(function(){this._handleFacetFilterListClose(this.oController)}.bind(this))}this.oController.oFacetFilter.setShowPersonalization(true);this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_getFacetFilterState:function(c){this.oController=c;var f=[];var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];var n={listKey:o.getKey(),active:o.getActive(),selectedItemKeys:[]};var s=o.getSelectedKeys();for(var S in s){n.selectedItemKeys.push([S,s[S]])}f.push(n)}return f},_handleFacetFilterListClose:function(c){this.oController=c;this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c);this.oController.aStoredFacetFilterState=this.oController.oViewState.FacetFilterState;var f=false;var F=[];for(var i=0;i<this.oController.aFacetFilterFilters.length;i++){F.push(this.oController.aFacetFilterFilters[i])}this._recreateFacetFilterFilters(c);if(this.oController.aFacetFilterFilters.length!=F.length){f=true}else{for(var i=0;i<this.oController.aFacetFilterFilters.length;i++){var o=F[i];var a=this.oController.aFacetFilterFilters[i];if((a.oValue1!=o.oValue1)||(a.sOperator!=o.sOperator)||(a.sPath!=o.sPath)){f=true}}}if(f==true){this.oController.registerViewChanged();this.oController.runStateMachine(this.oController,this.oController.oEvent.filterChanged)}},_resetFacetFilter:function(c){this.oController=c;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];o.setActive(false);var i=o.getItems();for(var I=0;I<i.length;I++){i[I].setSelected(false)}o.removeSelections(true)}this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_recreateFacetFilterFilters:function(c){this.oController=c;this.oController.aFacetFilterFilters.length=0;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];if(o.getActive()==true){var k=o.getKey();var s=o.getSelectedKeys();for(var S in s){var n=new sap.ui.model.Filter(k,sap.ui.model.FilterOperator.EQ,S);this.oController.aFacetFilterFilters.push(n)}}}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.TableSorting')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.TableSorting");i2d.pp.mrpcockpit.reuse.view.TableSorting={_getVSDialogNEW:function(c){this.oController=c;if(this.oController.newVSDialog){this.oController.oVSDialog=new sap.m.ViewSettingsDialog({sortItems:this._getSortFields(),groupItems:[],filterItems:[],confirm:function(e){var p=e.getParameters();var s=[];if(p.groupItem){var P=p.groupItem.getKey();var d=p.groupDescending;var g=this.oController.oController.mGroupFunctions[P];s.push(new sap.ui.model.Sorter(P,d,g))}var P=p.sortItem.getKey();var d=p.sortDescending;if(!this.oController.bSortDescending){this.oController.bsortDescending=d}else{d=this.oController.bsortDescending};this.oController.bSortPath=P;s.push(new sap.ui.model.Sorter(P,d));this.oController.oSorter=s;this.oController.runStateMachine(this.oController,this.oController.oEvent.tableChanged);this.oController.oViewState.SortKey=P;this.oController.oViewState.SortDescending=d;this.oController.registerViewChanged()}.bind(this)});this.oController.newVSDialog=false}return this.oController.oVSDialog},_getSortFields:function(){var s=function(p,d){var i,e=-1;for(i=0;i<p.length;i++){if(p[i][0]===d){e=i;break}}return e};var S=false;var a=[];var b="";var c=this._getCellsInOrder();if(c.length!==0){for(var i=0;i<c.length;i++){var m=s(this.oController.aDefaultSorting,c[i]);if(m>=0){if(this.oController.aDiffFieldText){b=this.oController.oResourceBundle.getText(i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForField(c[i],this.oController))}else{b=this.oController.oResourceBundle.getText(c[i])}S=((this.oController.bSortPath&&(this.oController.bSortPath===c[i]))||(!this.oController.bSortPath&&(this.oController.aDefaultSorting[m][1]===1)));var v=new sap.m.ViewSettingsItem({text:b,key:c[i],selected:S});a.push(v)}}}return a},_getCellsInOrder:function(p){var t=[];var a=[];this.oController.oTable.getColumns().forEach(function(c){if((c.getVisible()&&p)||!p){a[this.oController.oTable.getColumns(true).indexOf(c)]=c.data("mrpcoDataField")}}.bind(this));a.forEach(function(c){var C=[];C=c.split(",");C.forEach(function(b){t.push(b)})});return t}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog');jQuery.sap.require('sap.ushell.services.CrossApplicationNavigation');sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog",{_DIALOG_ID:"DLG_CHANGE_VARIANT_CONFIRMATION",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n")},onConfirmDialog:function(e){var d=this.getView().byId(this._DIALOG_ID);var s=d.getModel().getProperty("/saveFunction");s();this.closeDialog(e)},onCancelDialog:function(e){var r={isConfirmed:false};this.closeDialog(e)},closeDialog:function(r){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/closeFunction");d.close();c(r)},})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog');jQuery.sap.require('sap.ushell.services.CrossApplicationNavigation');sap.ui.controller("i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog",{_VARIANT_NAME_ID:"TXF_VARIANT_NAME",_DIALOG_ID:"DLG_VARIANT_SAVE",onInit:function(){var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"commondialogs_i18n");jQuery.sap.require("sap.m.MessageToast");var t=this.getView().byId(this._VARIANT_NAME_ID);t.attachLiveChange(function(){})},beforeOpen:function(e){var d=this.getView().byId(this._DIALOG_ID);var t=this.getView().byId(this._VARIANT_NAME_ID);t.setValue(d.getModel().getProperty("/oldVariantName"));this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").setSelected(d.getModel().getProperty("/b2MonitorTile"));this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").setSelected(d.getModel().getProperty("/b2ManageTile"));if(d.getModel().getProperty("/forcasteDemandApp")&&d.getModel().getProperty("/forcasteDemandApp")===true){this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").setVisible(false);this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").setText(this.getView().getModel('commondialogs_i18n').getResourceBundle().getText("VariantCheckBoxMonitor"))}},onConfirmDialog:function(e){var t=this.getView().byId(this._VARIANT_NAME_ID).getValue();t=t.trim();var r={isConfirmed:true,sInput:t};var d=this.getView().byId(this._DIALOG_ID);if(t==""){sap.m.MessageToast.show(this.getView().getModel('commondialogs_i18n').getResourceBundle().getText("VariantMessageEmptyName"))}else if(t.toLowerCase()==d.getModel().getProperty("/sDefaultLayoutName").toLowerCase()||t.toLowerCase()==d.getModel().getProperty("/sListName").toLowerCase()){sap.m.MessageToast.show(this.getView().getModel('commondialogs_i18n').getResourceBundle().getText("VariantMessageProtectedName",t))}else{var a=d.getModel().getProperty("/variantList");var v=false;if(a!=null){for(var i=0;i<a.length;i++){if(a[i]==t){v=true}}}if(v){var c=d.getModel().getProperty("/changeVariantFunction");var C=this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").getSelected();var b=this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").getSelected();c(t,C,b);this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").setSelected(false);this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").setSelected(false);this.getView().byId(this._VARIANT_NAME_ID).setValue("");d.close()}else{var s=d.getModel().getProperty("/saveFunction");var C=this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").getSelected();var b=this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").getSelected();s(t,C,b);this.getView().byId(this._VARIANT_NAME_ID).setValue("");this.getView().byId("CHB_VARIANT_AS_TILE_MONITOR").setSelected(false);this.getView().byId("CHB_VARIANT_AS_TILE_MANAGE").setSelected(false);this.closeDialog(r)}}},checkVariantName:function(d){},onCancelDialog:function(e){var r={isConfirmed:false};this.getView().byId(this._VARIANT_NAME_ID).setValue("");this.closeDialog(r)},closeDialog:function(r){var d=this.getView().byId(this._DIALOG_ID);var c=d.getModel().getProperty("/closeFunction");d.close();c(r)},variantNameChanged:function(c){}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.ViewStateHandler')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.ViewStateHandler");i2d.pp.mrpcockpit.reuse.view.ViewStateHandler={i18NCommonReuseModel:new sap.ui.model.resource.ResourceModel({bundleUrl:jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties"}),getViewState:function(c,v,d,V,s,t,n){if(V!==""&&(s=="")){this.getViewStateFromContainer(c,t,n,d,v,V)}else if(s!==""&&(V=="")){i2d.pp.mrpcockpit.reuse.view.VariantHandler.getVariantByName(c.bind(this),v,s)}else{this.getViewStateFromContainer(c,t,n,d)}},saveViewStateInContainer:function(c,v,t,n,V){if(!this.oPersonalizationService){this.oPersonalizationService=sap.ushell.Container.getService("Personalization")}if(this.oPersonalizationService.getContainer){this.oPersonalizationService.getContainer(t,{validity:0}).fail(function(){jQuery.sap.log.error("Loading personalization data failed.")}).done(function(C){C.setItemValue("ViewState",v);C.save().done(function(){jQuery.sap.log.info("saveViewStateInContainer: oContainer.save");if(n>0){this.oPersonalizationService.getContainer(t,{validity:n}).fail(function(){jQuery.sap.log.error("Loading personalization data failed.")}).done(function(C){jQuery.sap.log.info("saveViewStateInContainer: this.oPersonalizationService.getContainer");C.setItemValue("ViewState",v);C.save().done(function(){jQuery.sap.log.info("saveViewStateInContainer: oContainer.save");if(c){c(true)}})}.bind(this))}else{if(c){c(true)}}}.bind(this))}.bind(this))}},deleteViewStateInContainer:function(c,t,n){if(!this.oPersonalizationService){this.oPersonalizationService=sap.ushell.Container.getService("Personalization")}if(this.oPersonalizationService.getContainer){this.oPersonalizationService.getContainer(t,{validity:0}).fail(function(){jQuery.sap.log.error("Loading personalization data failed.")}).done(function(C){C.delItem("ViewState");C.save().done(function(){if(n>0){this.oPersonalizationService.getContainer(t,{validity:n}).fail(function(){jQuery.sap.log.error("Loading personalization data failed.")}).done(function(C){C.delItem("ViewState");C.save().done(function(){if(c){c(true)}})}.bind(this))}else{if(c){c(true)}}}.bind(this))}.bind(this))}},getViewStateFromContainer:function(c,t,n,d,v,V){if(!this.oPersonalizationService){this.oPersonalizationService=sap.ushell.Container.getService('Personalization')}if(this.oPersonalizationService.getContainer){this.oPersonalizationService.getContainer(t,{validity:0}).done(function(C){var s=C.getItemValue("ViewState");var a="";if(c){if(s){if(s.VariantName){a=s.VariantName}c(true,s,a)}else{this.oPersonalizationService.getContainer(t,{validity:n}).done(function(C){var s=C.getItemValue("ViewState");var a="";if(c){if(s){if(s.VariantName){a=s.VariantName}c(true,s,a)}else{if(V){i2d.pp.mrpcockpit.reuse.view.VariantHandler.getVariantByID(c.bind(this),v,V)}else{c(true,d,"")}}}}.bind(this)).fail(function(){if(c){c(true,d,"")}}.bind(this))}}}.bind(this)).fail(function(){if(c){c(true,d,"")}}.bind(this))}else{if(V){i2d.pp.mrpcockpit.reuse.view.VariantHandler.getVariantByID(c.bind(this),v,V)}else{c(true,d,"")}}}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.Chart')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.controls.Chart");jQuery.sap.require('sap.ui.thirdparty.d3');jQuery.sap.require('sap.m.MessageToast');sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.Chart",{metadata:{properties:{minBarSize:{type:"int",defaultValue:19},minOverviewBarSize:{type:"float",defaultValue:2},height:{type:"sap.ui.core.CSSSize",defaultValue:"240px"},width:{type:"sap.ui.core.CSSSize",defaultValue:"240px"},minChartHeight:{type:"sap.ui.core.CSSSize",defaultValue:"240px"},fixOverviewHeight:{type:"int",defaultValue:0},showOverview:{type:"boolean",defaultValue:true},shiftLeft:{type:"float",defaultValue:0},allowNavigation:{type:"boolean",defaultValue:false},noNavigationText:{type:"string",defaultValue:""},unitDecimals:{type:"int",defaultValue:0},startBalance:{type:"float",defaultValue:0},minStock:{type:"float",defaultValue:0},safetyStock:{type:"float",defaultValue:0},minDate:"string",maxDate:"string",balanceDotTooltip:{type:"string",defaultValue:""}},aggregations:{values:{type:"i2d.pp.mrpcockpit.reuse.controls.ChartValue",multiple:true,singularName:"value",bindable:"bindable"},deltas:{type:"i2d.pp.mrpcockpit.reuse.controls.ChartValue",multiple:true,singularName:"delta",bindable:"bindable"}},events:{"selected":{}},defaultAggregation:"values"},init:function(){jQuery.sap.require("sap.ca.ui.model.format.DateFormat");jQuery.sap.require("sap.ca.ui.model.format.QuantityFormat");this._oChartFormatter=sap.ca.ui.model.format.DateFormat.getDateInstance({style:'short'});this._dataset="basic";this._duration=2000;this._oChartSettings={};this._oOverviewSettings={};this._ovrBtnLeft=new sap.ui.core.Icon({id:this.getId()+"-ovrBtnLeft",src:"sap-icon://navigation-left-arrow"});this._ovrBtnRight=new sap.ui.core.Icon({id:this.getId()+"-ovrBtnRight",src:"sap-icon://navigation-right-arrow"})},exit:function(){this.removeHandler()},removeHandler:function(){if(this._triggerDeltaDisplay){jQuery.sap.clearDelayedCall(this._triggerDeltaDisplay);this._triggerDeltaDisplay=null}},setDeltas:function(d,n){var h=function(){this.setDeltas(d)};var o=d3.select("#"+this.getId()+"-overview-chartArea svg").remove();var c=d3.select("#"+this.getId()+"-chartArea svg").remove();var a=d3.select("#"+this.getId()+"-backgroundArea svg").remove();var l=(d&&d.length)?d.length:0;var b=this.getDeltas().length;var p=(b>0)&&(this._dataset==="preview");this.removeHandler();if((l>0)&&!p){this.removeAllAggregation("deltas",true);for(var i=0;i<l;i++){this.addAggregation("deltas",new i2d.pp.mrpcockpit.reuse.controls.ChartValue({date:d[i].date,demand:d[i].demand,supply:d[i].supply}),true)}this.calcChartSettings("basic");this.calcChartSettings("preview");this.calcOverviewSettings("basic");this.calcOverviewSettings("preview");if(!n){this.renderChart();this.updateChart()}else{this.renderChart("preview")}this._dataset="preview"}else{var e=this._duration;if(p&&!n){this._duration/=2}this.calcChartSettings("basic");this.calcChartSettings("preview");this.calcOverviewSettings("basic");this.calcOverviewSettings("preview");if(!n){this.renderChart("preview");this.updateChart("basic")}else{this.renderChart("basic")}this._dataset="basic";this.removeAllAggregation("deltas",true);if((l>0)&&p&&!n){this.removeHandler();this._triggerDeltaDisplay=jQuery.sap.delayedCall(this._duration,this,jQuery.proxy(h,this))}this._duration=e}},setHeight:function(h,s){this.setProperty("height",h,true);if(!s){this.resizeChart()}},setWidth:function(w,s){this.setProperty("width",w,true);if(!s){this.resizeChart()}},getDate:function(d){var v=this.getValues();var D="";if(v&&(v.length>d)&&(d>=0)&&(d===parseInt(d))){D=new Date(v[d].getDate())}return D},getDateFormatted:function(d){return this.formatDate(this.getDate(d))},formatDate:function(d){if(d){return this._oChartFormatter.format(d)}return""},formatNumber:function(n){var u=this.getUnitDecimals();var b=(n>=10000)||(n<=-10000);var s=(n<100)&&(n>-100);if(b){return sap.ca.ui.model.format.QuantityFormat.FormatQuantityShort(n,null,u)}else if(s){return sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(n,null,u)}else{return sap.ca.ui.model.format.QuantityFormat.FormatQuantityStandard(Math.round(n))}},roundNumber:function(n){return Math.round(n*1000000)/1000000},getDemand:function(d,w){var v=this.getValues();var D=this.getDeltas();var f=0;if(v&&(v.length>d)&&(d>=0)){f=v[d].getDemand();if(!w){var l=(D&&D.length)?D.length:0;for(var i=0;i<l;i++){if(D[i].getDate()==v[d].getDate()){f+=D[i].getDemand()}}}}return f},getSupply:function(d,w){var v=this.getValues();var D=this.getDeltas();var s=0;if(v&&(v.length>d)&&(d>=0)){s=v[d].getSupply();if(!w){var l=(D&&D.length)?D.length:0;for(var i=0;i<l;i++){if(D[i].getDate()==v[d].getDate()){s+=D[i].getSupply()}}}}return s},getShortageAccepted:function(d){var v=this.getValues();if(v&&(v.length>d)&&(d>=0)){return v[d].getShortageAccepted()}return false},reDomain:function(v){if(v>0){var d=Math.pow(10,Math.round(Math.log(v+1)/Math.log(10))-1);return Math.ceil((v+1)/d)*d}else if(v<0){return-this.reDomain(-v)}else{return 0}},convertIntoOverviewPos:function(c,o,p){return Math.round(((p-c.chartSize.leftSpace)/c.daySize*o.daySize+o.chartSize.leftSpace)*10)/10},convertIntoDetailPos:function(c,o,p){return Math.round(((p-o.chartSize.leftSpace)/o.daySize*c.daySize+c.chartSize.leftSpace)*10)/10},isVisible:function(d){var c=this.getChartSettings(d);var o=this.getOverviewSettings(d);var C=jQuery("#"+this.getId());if(C&&C.length){if(C.innerWidth()===0){jQuery.sap.log.debug("Chart has width = 0");return false}}else{jQuery.sap.log.debug("Chart not in DOM tree");return false}if(c.chartSize.chartHeight===0){jQuery.sap.log.debug("Chart has calculated height = 0");return false}if(this.getShowOverview()&&o.chartSize.chartHeight===0){}return true},getChartSettings:function(d){return this._oChartSettings[d]},getOverviewSettings:function(d){return this._oOverviewSettings[d]},getScalingFunctions:function(c,v,t){var s={};var a=c.valueWidth/(t.maxX-t.minX);if((t.maxX-t.minX)===1){s.xScale=d3.scale.linear().domain([-1,0]).range([0,a])}else{s.xScale=d3.scale.linear().domain([t.minX,t.maxX-1]).range([a,c.valueWidth])}s.yScale=d3.scale.linear().domain([v.minY,v.maxY]).range([c.valueHeight,0]);return s},calcChartSettings:function(d){var t={basic:this.getTimeframe("basic"),preview:this.getTimeframe("preview")};var D=this.d3Data(d,t[d]);var a=D.length||2;var f={basic:this.getFirstBalance(t.basic),preview:this.getFirstBalance(t.preview)};var c=jQuery("#"+this.getId()+"-visArea");var b=(c&&c.length)?c.innerWidth():200;var e=(c&&c.length)?c.innerHeight():200;var l=11;var r=12;var T=15;var B=38+10;var m=a*(this.getMinBarSize()/8*21)+(l+r);if(b<m){b=m}var C={leftSpace:l,rightSpace:r,topBorder:T,bottomBorder:B,chartWidth:b,valueWidth:b-(l+r),chartHeight:e,valueHeight:e-(T+B)};var o=t[d];var v=this.getNumberRange(D,d);var s=this.getScalingFunctions(C,v,o);var i=s.xScale(1)-s.xScale(0);var g=(i<48+24)?Math.round(D.length/2):D.length;var h=Math.round(C.valueHeight/40);this._oChartSettings[d]={chartId:this.getId(),firstBalance:f,data:D,timeframe:o,xScale:s.xScale,yScale:s.yScale,tickCntX:g,tickCntY:h,chartSize:C,posY0:s.yScale(0),daySize:i,displayText:true,fireEvent:true}},calcOverviewSettings:function(d){var t={basic:this.getTimeframe("basic"),preview:this.getTimeframe("preview")};var D=this.d3Data(d,t[d]);var a=D.length||2;var f={basic:this.getFirstBalance(t.basic),preview:this.getFirstBalance(t.preview)};var o=jQuery("#"+this.getId()+"-overview-area");var c=jQuery("#"+this.getId()+"-overview-visArea");var b=(c&&c.length)?c.width():200;var e=(c&&c.length)?c.height():0;var C=this.getChartSettings(d);var m=this.getMinOverviewBarSize()/8*21;var g=C.chartSize.chartWidth/C.daySize*m;var h=0;if(m>0){if(b<g){b=g}h=m*b/g}else{h=C.daySize/C.chartSize.chartWidth*b}var l=C.chartSize.leftSpace/C.daySize*h;var r=C.chartSize.rightSpace/C.daySize*h;var T=0;var B=0;var i={leftSpace:l,rightSpace:r,topBorder:T,bottomBorder:B,chartWidth:b,valueWidth:b-(l+r),chartHeight:e,valueHeight:e-(T+B)};var j=t[d];var v=this.getNumberRange(D,d);var s=this.getScalingFunctions(i,v,j);var k=s.xScale(1)-s.xScale(0);var n=(k<48+24)?Math.round(D.length/2):D.length;var p=Math.round(i.valueHeight/40);this._oOverviewSettings[d]={chartId:this.getId()+"-overview",firstBalance:f,data:D,timeframe:j,xScale:s.xScale,yScale:s.yScale,tickCntX:n,tickCntY:p,chartSize:i,posY0:s.yScale(0),daySize:k,displayText:false,fireEvent:false}},getNumberRange:function(D,s){var m=d3.min(D,function(d){return Math.min(0,d[s].balanceStart,d[s].balanceIntraday,d[s].balanceEnd)});var a=d3.max(D,function(d){return Math.max(0,d[s].balanceStart,d[s].balanceIntraday,d[s].balanceEnd)});if(m>-a/20){m=-a/20}if(a<-m/20){a=-m/20}return{minY:this.reDomain(m),maxY:this.reDomain(a)}},getTimeframe:function(d){var m=this.getMinDate();var M=this.getMaxDate();var o=(m)?new Date(m):null;var a=(M)?new Date(M):null;var c=this.getValues();var C=(c)?c.length:0;var b={};var t={minX:0,maxX:C,minXBasic:0,maxXBasic:C};if(o||a){if(d=="preview"){var D=this.getDeltas();var e;var l=(D&&D.length)?D.length:0;for(var i=0;i<l;i++){e=D[i];var f=new Date(e.getDate());if(f<o){o=f}if(f>a){a=f}}var B=this.getTimeframe("basic");t.minXBasic=B.minX;t.maxXBasic=B.maxX}for(var i=0;i<C;i++){b=c[i];if(b.getDate()==o){t.minX=i;break}}for(var i=0;i<C;i++){b=c[i];if(b.getDate()==a){t.maxX=i+1}}}return t},getFirstBalance:function(t,w){var d=0;var s=0;var b=this.getStartBalance();for(var i=0;i<t.minX;i++){d=this.getDemand(i,w);s=this.getSupply(i,w);b=b+d+s}return this.roundNumber(b)},d3Data:function(d,t){var s=false;var D=0;var S=0;var f=0;var a=0;var b=this.getFirstBalance(t,true);var B=this.getFirstBalance(t,false);var m=this.getMinStock();var c=this.getSafetyStock();var o;var e=[];for(var i=t.minX;i<t.maxX;i++){s=this.getShortageAccepted(i);S=this.getSupply(i,true);D=this.getDemand(i,true);a=this.getSupply(i);f=this.getDemand(i);o={index:i,date:this.getDate(i),minStock:m,safetyStock:c,shortageAccepted:s,basic:{balanceStart:this.roundNumber(b),supply:S,balanceIntraday:this.roundNumber(b+S),demand:D,balanceEnd:this.roundNumber(b+S+D)},preview:{balanceStart:this.roundNumber(B),supply:this.getSupply(i),balanceIntraday:this.roundNumber(B+a),demand:this.getDemand(i),balanceEnd:this.roundNumber(B+a+f)}};e.push(o);b+=o.basic.demand+o.basic.supply;B+=o.preview.demand+o.preview.supply}var g=function(i){return e[i]};var l=t.maxX-t.minX;return d3.range(l).map(g)},setChartSize:function(){var c=jQuery("#"+this.getId());if(c&&c.length){var v=c.width();var a=c.height();var o=0;if(this.getShowOverview()){o=this.getFixOverviewHeight();if(!o){o=Math.round(a/8)}}a-=o;var b=jQuery("#"+this.getId()+"-backgroundArea");if(b&&b.length){b[0].style.width=v+"px";b[0].style.height=a+"px"}var d=v;var V=jQuery("#"+this.getId()+"-visArea");if(V&&V.length){V[0].style.height=a+"px";d=V.innerWidth()}this.calcChartSettings("basic");this.calcChartSettings("preview");var C=this.getChartSettings(this._dataset);var e=jQuery("#"+this.getId()+"-chartArea");if(e&&e.length){e[0].style.width=C.chartSize.chartWidth+"px";var m=d-e.outerWidth();var s=Math.min(Math.max(this.getShiftLeft(),m),0);e[0].style.left=s+"px";this.setProperty("shiftLeft",s,true)}if(this.getShowOverview()){var f=v;var O=jQuery("#"+this.getId()+"-overview-area");var g=jQuery("#"+this.getId()+"-overview-visArea");if(O&&O.length){O[0].style.height=o+"px"}if(g&&g.length){f=g.innerWidth()}this.calcOverviewSettings("basic");this.calcOverviewSettings("preview");var h=this.getOverviewSettings(this._dataset);var i=jQuery("#"+this.getId()+"-overview-chartArea");if(i&&i.length){i[0].style.width=h.chartSize.chartWidth+"px";var m=f-i.outerWidth();var s=Math.min(Math.max(i.position().left,m),0);i[0].style.left=s+"px"}var j=jQuery("#"+this.getId()+"-ovrScrollLeft");var k=jQuery("#"+this.getId()+"-ovrScrollRight");if(j&&j.length){var l=j.innerHeight();j[0].style.lineHeight=l+"px";if(l&&(l<16)){j[0].style.fontSize=l+"px"}}if(k&&k.length){var l=k.innerHeight();k[0].style.lineHeight=l+"px";if(l&&(l<16)){k[0].style.fontSize=l+"px"}}}}},showDetailsInOverview:function(){if(!this.getShowOverview()){return}if(!this.isVisible(this._dataset)){return}var c=this.getChartSettings(this._dataset);var o=this.getOverviewSettings(this._dataset);var C=jQuery("#"+this.getId()+"-chartArea");var O=jQuery("#"+this.getId()+"-overview-chartArea");if(C&&C.length&&O&&O.length){var s=-C[0].offsetLeft;var v=C.parent().innerWidth();var a=-O[0].offsetLeft;var b=O.parent().innerWidth();var f=this.convertIntoOverviewPos(c,o,s);var t=this.convertIntoOverviewPos(c,o,s+v-c.chartSize.leftSpace);if(f<a){O[0].style.left=-f+"px"}if(t+o.chartSize.leftSpace>a+b){O[0].style.left=b-t-o.chartSize.leftSpace+"px"}var d=d3.select("#"+o.chartId+"-chartArea svg g");this.updateOverviewWindow(d,o,f,t)}},showOverviewInDetails:function(){var c=this.getChartSettings(this._dataset);var o=this.getOverviewSettings(this._dataset);var C=jQuery("#"+this.getId()+"-chartArea");var O=jQuery("#"+this.getId()+"-overview-chartArea");if(C&&C.length&&O&&O.length){var a=d3.select("#"+o.chartId+"-hidden-left").attr("width");var b=d3.select("#"+o.chartId+"-hidden-right").attr("x");var s=this.convertIntoDetailPos(c,o,a-o.chartSize.leftSpace)+c.chartSize.leftSpace;C[0].style.left=-s+"px";this.setProperty("shiftLeft",-s,true);return-s}return 0},shiftLeftChart:function(p,d){var v=jQuery("#"+p+"-visArea");var c=jQuery("#"+p+"-chartArea");if(v&&v.length&&c&&c.length){var m=v.innerWidth()-c.outerWidth();var s=Math.min(Math.max(this._iStartOffsetX+d,m),0);c[0].style.left=s+"px";this.setProperty("shiftLeft",s,true);return s}return this._iStartOffsetX},shiftLeftOverviewWindow:function(d){var o=d3.select("#"+this.getId()+"-overview-hidden-left");var a=d3.select("#"+this.getId()+"-overview-hidden-right");var b=d3.select("#"+this.getId()+"-overview-hidden-window");var v=jQuery("#"+this.getId()+"-overview-visArea");var c=jQuery("#"+this.getId()+"-overview-chartArea");var e=parseFloat(o.attr("x"));var f=parseFloat(o.attr("width"));var g=parseFloat(a.attr("x"));var h=parseFloat(a.attr("width"));var O=this.getOverviewSettings(this._dataset);if(f+d<0){d=-f}if(h-d<0){d=h}if(f+d<-c[0].offsetLeft){c[0].style.left=-(f+d)+"px"}if(g+d+O.chartSize.leftSpace>v.innerWidth()-c[0].offsetLeft){c[0].style.left=v.innerWidth()-g-d-O.chartSize.leftSpace+"px"}o.attr("width",f+d);a.attr("x",g+d).attr("width",h-d);b.attr("x",e+f+d).attr("width",g-e-f);return d},resizeChart:function(){var c=jQuery("#"+this.getId());if(c&&c.length){var h=this.getHeight();var w=this.getWidth();c[0].style.height=h;c[0].style.width=w;var o=d3.select("#"+this.getId()+"-overview-chartArea svg").remove();var a=d3.select("#"+this.getId()+"-chartArea svg").remove();var b=d3.select("#"+this.getId()+"-backgroundArea svg").remove();this.setChartSize();this.renderChart(this._dataset)}},onShortageSelected:function(d){if(d[this._dataset].balanceEnd<d.safetyStock){if(this.getAllowNavigation()===true){this.fireEvent("selected",d)}else{if(this.getNoNavigationText()!=""){sap.m.MessageToast.show(this.getNoNavigationText())}}}},onclick:function(e){var c=function(n,i){if(n.compareDocumentPosition){return(n===i)||(n.compareDocumentPosition(i)&16)}else if(n.contains){return n.contains(i)}else{return false}};if(!this._tapStart){return}var C=jQuery("#"+this.getId()+"-chartArea");var o=jQuery("#"+this.getId()+"-overview-hidden-window");var O=jQuery("#"+this.getId()+"-ovrScrollLeft");var a=jQuery("#"+this.getId()+"-ovrScrollRight");var b=jQuery("#"+this.getId()+"-overview-hidden-left");var d=jQuery("#"+this.getId()+"-overview-hidden-right");var w=(o)?parseInt(o.attr("width")/2):0;if(C&&C.length&&c(C[0],e.target)){var p=e.getOffsetX();if(e.target.offsetLeft){p+=e.target.offsetLeft};var f=this.getChartSettings(this._dataset);var D=Math.floor((p-f.chartSize.leftSpace)/f.daySize);if((D>=0)&&(f.data[D])){this.onShortageSelected(f.data[D])}}var B=(O&&O.length&&c(O[0],e.target));var h=(b&&b.length&&c(b[0],e.target));if(B||h){this.shiftLeftOverviewWindow(-w);this.showOverviewInDetails()}var g=(a&&a.length&&c(a[0],e.target));var H=(d&&d.length&&c(d[0],e.target));if(g||H){this.shiftLeftOverviewWindow(w);this.showOverviewInDetails()}},move:function(e){var t=e.targetTouches[0]?e.targetTouches[0]:e;var c=(t.pageX)?t.pageX:t.clientX;var m=c-this._iStartMoveX;if(this._bHidden){this._iStartOffsetX=this.shiftLeftChart(this.getId()+"-overview",m);this._iStartMoveX=c}else if(this._bChart){this._iStartOffsetX=this.shiftLeftChart(this.getId(),m);this._iStartMoveX=c;this.showDetailsInOverview()}else if(this._bOverview){this._iStartOffsetX=this.shiftLeftOverviewWindow(m);this._iStartMoveX=c;var s=this.showOverviewInDetails()}if(Math.abs(this._iStartMoveX-this._iTapStartX)>5){this._tapStart=false}},ontouchstart:function(e){var c=function(n,d){if(n.compareDocumentPosition){return(n===d)||(n.compareDocumentPosition(d)&16)}else if(n.contains){return n.contains(d)}else{return false}};var t=e.targetTouches[0]?e.targetTouches[0]:e;var o=jQuery("#"+this.getId()+"-overview-hidden-window");var O=jQuery("#"+this.getId()+"-overview-hidden");var C=jQuery("#"+this.getId()+"-chartArea");this._bOverview=o&&o.length&&c(o[0],t.target);this._bHidden=(!this._bOverview)&&O&&O.length&&c(O[0],t.target);this._bChart=C&&C.length&&c(C[0],t.target);if(this._bHidden){this._iStartOffsetX=o[0].offsetLeft}else if(this._bChart){this._iStartOffsetX=C[0].offsetLeft}else if(this._bOverview){this._iStartOffsetX=o[0].offsetLeft}this._iStartMoveX=(t.pageX)?t.pageX:t.clientX;this._touchStarted=true;this._tapStart=true;this._iTapStartX=this._iStartMoveX;if(this._bOverview){var a=d3.select("#"+this.getId()+"-overview-hidden-window");var s=!this.getFixOverviewHeight();var b=(s)?"sapMRPChartOverviewWindow":"sapMRPChartOverviewWindowSimple";b+=" sapMRPChartExecDrag";a.attr("class",b)}if(this._bChart){C.removeClass("sapMRPChartNavigation");C.removeClass("sapMRPChartStartDrag");C.addClass("sapMRPChartExecDrag")}},ontouchend:function(e){this._touchStarted=false;if(this._bOverview){var o=d3.select("#"+this.getId()+"-overview-hidden-window");var s=!this.getFixOverviewHeight();var c=(s)?"sapMRPChartOverviewWindow":"sapMRPChartOverviewWindowSimple";c+=" sapMRPChartStartDrag";o.attr("class",c)}if(this._bChart){var a=this.getAllowNavigation();var C=jQuery("#"+this.getId()+"-chartArea");C.removeClass("sapMRPChartExecDrag");if(a){C.addClass("sapMRPChartNavigation")}else{C.addClass("sapMRPChartStartDrag")}}},ontouchmove:function(e){this.move(e);e.preventDefault();e.stopPropagation()},onBeforeRendering:function(){this.removeHandler()},onAfterRendering:function(){this.setChartSize();this.renderChart()},renderer:function(r,c){var a=c.getAllowNavigation();r.write("<div");r.writeControlData(c);r.addClass("sapMRPChart");r.writeClasses();var m=c.getMinChartHeight();if(m){r.addStyle("min-height",m)}r.addStyle("height",c.getHeight());r.addStyle("width",c.getWidth());r.writeStyles();r.write(">");r.write("<div id='");r.writeEscaped(c.getId());r.write("-backgroundArea' class='sapMRPChartBackground'>");r.write("</div>");r.write("<div id='");r.writeEscaped(c.getId());r.write("-visArea' class='sapMRPChartVisArea'>");r.write("<div id='");r.writeEscaped(c.getId());r.write("-chartArea'");r.addClass("sapMRPChartArea");if(a){r.addClass("sapMRPChartNavigation")}else{r.addClass("sapMRPChartStartDrag")}r.writeClasses();r.write(">");r.write("</div>");r.write("</div>");r.write("<div id='");r.writeEscaped(c.getId());r.write("-overview-area'");r.addClass("sapMRPChartOverview");if(c.getFixOverviewHeight()){}r.writeClasses();r.write(">");r.write("<div id='");r.writeEscaped(c.getId());r.write("-overview-visArea' class='sapMRPChartOverviewVisArea'>");r.write("<div id='");r.writeEscaped(c.getId());r.write("-overview-chartArea' class='sapMRPChartOverviewArea'>");r.write("</div>");r.write("</div>");if(c._ovrBtnLeft){r.write("<div id='");r.writeEscaped(c.getId());r.write("-ovrScrollLeft' class='sapMRPChartOverviewScrollLeft'>");if(c.getShowOverview()){r.renderControl(c._ovrBtnLeft)}r.write("</div>")};if(c._ovrBtnRight){r.write("<div id='");r.writeEscaped(c.getId());r.write("-ovrScrollRight' class='sapMRPChartOverviewScrollRight'>");if(c.getShowOverview()){r.renderControl(c._ovrBtnRight)}r.write("</div>")};r.write("</div>");r.write("</div>")},renderBackground:function(D,c){var C=jQuery("#"+c.chartId);var b=0;if(C&&C.length){var b=C.width()}var a=d3.select("#"+c.chartId+"-backgroundArea").append("svg:svg").attr("id",c.chartId+"-background").attr("width",b).attr("height",c.chartSize.chartHeight);var v=a.append("svg:g").attr("transform","translate(0,"+c.chartSize.topBorder+")");if((b>16+47)&&(c.chartSize.valueHeight>0)){v.append("svg:rect").attr("id",c.chartId+"-background-border").attr("class","sapMRPChartBorder").attr("x",47).attr("y",c.chartSize.topSpace).attr("width",b-16-47).attr("height",c.chartSize.valueHeight)}var y=v.append("svg:g").attr("class","yAxis");var e=y.selectAll("g.y").data(c.yScale.ticks(c.tickCntY),function(d){return d}).enter().append("svg:g").attr("class","y");e.append("svg:line").attr("class",function(d){return(d!=0)?"yLine sapMRPChartYLine":"yLine sapMRPChartAxis"}).attr("x1",42).attr("x2",b-16).attr("y1",c.yScale).attr("y2",c.yScale);var m=0;var t=40;var s="";var f=e.append("svg:text").attr("class","yText sapMRPChartYAxisDescr").attr("x",40).attr("y",c.yScale).attr("dy","5px").attr("text-anchor","end").text(jQuery.proxy(this.formatNumber,this)).attr("style",function(d){var g=this.getComputedTextLength();if(g>m){m=g}return""});if(m>t){s="font-size:"+Math.floor(875/m*t)/1000+"rem";f.attr("style",s)}},updateBackground:function(D,c){var C=jQuery("#"+c.chartId);var b=0;if(C&&C.length){var b=C.width()}var v=d3.select("#"+c.chartId+"-backgroundArea svg g");var y=v.selectAll("g.yAxis");var a=y.selectAll("g.y").data(c.yScale.ticks(c.tickCntY),function(d){return d});var n=a.enter().append("svg:g").attr("class","y");n.append("svg:line").attr("class","yLine sapMRPChartYLine").attr("x1",42).attr("x2",b-16).attr("y1",function(d){return(d<0)?c.chartSize.valueHeight:this._Y0Pos}).attr("y2",function(d){return(d<0)?c.chartSize.valueHeight:this._Y0Pos}).transition().duration(this._duration).attr("y1",c.yScale).attr("y2",c.yScale);n.append("svg:text").attr("class","yText sapMRPChartYAxisDescr").attr("x",40).attr("dy","5px").attr("text-anchor","end").attr("y",function(d){return(d<0)?c.chartSize.valueHeight:this._Y0Pos}).text(jQuery.proxy(this.formatNumber,this)).transition().duration(this._duration).attr("y",c.yScale);a.select("line.yLine").transition().duration(this._duration).attr("y1",c.yScale).attr("y2",c.yScale);a.select("text.yText").transition().duration(this._duration).attr("y",c.yScale);var m=0;var t=40;var f=875;var e=a.select("text.yText").attr("style",function(d){var g=this.getComputedTextLength();if(g>m){m=g}if(this.style.fontSize){f=parseFloat(this.style.fontSize)*1000;return"font-size:"+this.style.fontSize}return""});if(m>t){jQuery.sap.log.debug("adjust font size of "+f+" as text width "+m+" > available text space");var s="font-size:"+Math.floor(f/m*t)/1000+"rem";e.attr("style",s)}var o=a.exit();o.select("line.yLine").transition().duration(this._duration).attr("y1",function(d){return(d>=0)?0:c.chartSize.valueHeight}).attr("y2",function(d){return(d>=0)?0:c.chartSize.valueHeight}).remove();o.select("text.yText").transition().duration(this._duration).attr("y",function(d){return(d>=0)?0:c.chartSize.valueHeight}).remove();o.transition().duration(this._duration).remove()},renderOverviewWindow:function(v,c){var s=!this.getFixOverviewHeight();var C=(s)?"sapMRPChartOverviewWindow":"sapMRPChartOverviewWindowSimple";C+=" sapMRPChartStartDrag";var o=v.append("svg:g").attr("id",c.chartId+"-hidden");o.append("svg:rect").attr("id",c.chartId+"-hidden-border").attr("class","sapMRPChartBorder").attr("x",-c.chartSize.leftSpace).attr("y",1).attr("width",c.chartSize.valueWidth+c.chartSize.leftSpace+c.chartSize.rightSpace).attr("height",c.chartSize.valueHeight-2);o.append("svg:rect").attr("id",c.chartId+"-hidden-left").attr("class","sapMRPChartOverviewHidden").attr("x",-c.chartSize.leftSpace).attr("y",1).attr("width",c.chartSize.leftSpace).attr("height",c.chartSize.valueHeight-2);o.append("svg:rect").attr("id",c.chartId+"-hidden-right").attr("class","sapMRPChartOverviewHidden").attr("x",c.chartSize.valueWidth).attr("y",1).attr("width",c.chartSize.rightSpace).attr("height",c.chartSize.valueHeight-2);o.append("svg:rect").attr("id",c.chartId+"-hidden-window").attr("class",C).attr("x",0).attr("y",1).attr("width",c.chartSize.valueWidth).attr("height",c.chartSize.valueHeight-2)},updateOverviewWindow:function(v,c,f,t){var o=v.select("#"+c.chartId+"-hidden");var r=c.chartSize.chartWidth-t-c.chartSize.leftSpace;if(r<0){r=0}var w=c.chartSize.leftSpace+t-f;if(w<0){w=0}o.select("#"+c.chartId+"-hidden-left").attr("width",f);o.select("#"+c.chartId+"-hidden-right").attr("x",t).attr("width",r);o.select("#"+c.chartId+"-hidden-window").attr("x",-c.chartSize.leftSpace+f).attr("width",w)},renderXAxis:function(v,d,c){var x=v.append("svg:g").attr("id",c.chartId+"-chart-xAxis");x.append("svg:line").attr("class","sapMRPChartAxis").attr("x1",-c.chartSize.leftSpace).attr("x2",c.chartSize.valueWidth+c.chartSize.rightSpace).attr("y1",c.yScale(0)).attr("y2",c.yScale(0))},updateXAxis:function(v,d,c){var x=v.select("#"+c.chartId+"-chart-xAxis");x.select("line").transition().duration(this._duration).attr("x2",c.chartSize.chartWidth).attr("y1",c.yScale(0)).attr("y2",c.yScale(0))},renderDays:function(v,D,c){var a=v.append("svg:g").attr("id",c.chartId+"-chart-days");var b=a.selectAll("rect").data(c.data,function(d){return d.date}).enter().append("rect");b.attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("y",c.chartSize.topSpace).attr("height",c.chartSize.valueHeight).attr("class",function(d){var s=((d.index-c.timeframe.minXBasic)%2==0)?"sapMRPChartEvenDay":"sapMRPChartOddDay";return s})},updateDays:function(v,D,c){var a=v.select("#"+c.chartId+"-chart-days");var b=a.selectAll("rect").data(c.data,function(d){return d.date});var n=b.enter().append("rect");n.attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).attr("y",c.chartSize.topSpace).attr("height",0).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("height",function(d){return c.chartSize.valueHeight}).attr("class",function(d){var s=((d.index-c.timeframe.minXBasic)%2==0)?"sapMRPChartEvenDay":"sapMRPChartOddDay";return s});b.transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("y",c.chartSize.topSpace).attr("height",c.chartSize.valueHeight).attr("class",function(d){var s=((d.index-c.timeframe.minXBasic)%2==0)?"sapMRPChartEvenDay":"sapMRPChartOddDay";return s});b.exit().transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).remove()},renderShortage:function(v,D,c){var s=v.append("svg:g").attr("id",c.chartId+"-chart-shortage");var a=s.selectAll("rect").data(c.data,function(d){return d.date}).enter().append("rect");a.attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("y",c.chartSize.topSpace).attr("height",c.chartSize.valueHeight).attr("class",function(d){var S="sapMRPChartNoShortage";if(!d.shortageAccepted){if(d[D].balanceEnd<d.minStock){S="sapMRPChartShortage"}else if(d[D].balanceEnd<d.safetyStock){S="sapMRPChartBelowSafetyStock"}}return S});var b=s.selectAll("line").data(c.data,function(d){return d.date}).enter().append("line");b.attr("x1",function(d){return c.xScale(d.index)}).attr("y1",0).attr("x2",function(d){return c.xScale(d.index)}).attr("y2",c.chartSize.valueHeight).attr("class","sapMRPChartDayDivider")},updateShortage:function(v,D,c){var s=v.select("#"+c.chartId+"-chart-shortage");var a=s.selectAll("rect").data(c.data,function(d){return d.date});var b=s.selectAll("line").data(c.data,function(d){return d.date});var n=a.enter().append("rect");n.attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).attr("y",c.chartSize.topSpace).attr("height",0).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("height",function(d){return c.chartSize.valueHeight}).attr("class",function(d){var S="sapMRPChartNoShortage";if(!d.shortageAccepted){if(d[D].balanceEnd<d.minStock){S="sapMRPChartShortage"}else if(d[D].balanceEnd<d.safetyStock){S="sapMRPChartBelowSafetyStock"}}return S});a.transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index-1)}).attr("width",c.daySize).attr("y",c.chartSize.topSpace).attr("height",function(d){return c.chartSize.valueHeight}).attr("class",function(d){var S="sapMRPChartNoShortage";if(!d.shortageAccepted){if(d[D].balanceEnd<d.minStock){S="sapMRPChartShortage"}else if(d[D].balanceEnd<d.safetyStock){S="sapMRPChartBelowSafetyStock"}}return S});a.exit().transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).remove();var e=b.enter().append("line");e.attr("x1",function(d){return c.xScale(d.index)}).attr("y1",0).attr("x2",function(d){return c.xScale(d.index)}).attr("y2",c.chartSize.valueHeight).attr("class","sapMRPChartDayDivider");b.transition().duration(this._duration).attr("x1",function(d){return c.xScale(d.index)}).attr("y1",0).attr("x2",function(d){return c.xScale(d.index)}).attr("y2",c.chartSize.valueHeight);b.exit().transition().duration(this._duration).attr("x1",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("x2",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).remove()},renderXTicks:function(v,D,c){var x=v.append("svg:g").attr("id",c.chartId+"-chart-xTicks").attr("minTick",c.timeframe.minX);var a=x.selectAll("g").data(c.xScale.ticks(c.tickCntX),jQuery.proxy(this.getDate,this)).enter().append("svg:g");a.append("svg:text").attr("class","sapMRPChartXAxisDescr").attr("x",function(d){return c.xScale(d)-c.daySize/2}).attr("y",c.chartSize.chartHeight-31).attr("text-anchor","middle").text(jQuery.proxy(this.getDateFormatted,this))},updateXTicks:function(v,D,c){var x=v.select("#"+c.chartId+"-chart-xTicks");var f=x.attr("minTick");var a=x.attr("minTick",c.timeframe.minX).selectAll("g").data(c.xScale.ticks(c.tickCntX),jQuery.proxy(this.getDate,this));var b=a.enter().append("svg:g");b.append("svg:text").attr("class","sapMRPChartXAxisDescr").attr("x",function(i){return(i<f)?0:c.chartSize.chartWidth}).attr("y",c.chartSize.chartHeight-31).attr("text-anchor","middle").text(jQuery.proxy(this.getDateFormatted,this)).transition().duration(this._duration).attr("x",function(i){return c.xScale(i)-c.daySize/2});a.select("text.sapMRPChartXAxisDescr").transition().duration(this._duration).attr("x",function(d){return c.xScale(d)-c.daySize/2});var e=a.exit();e.select("text.sapMRPChartXAxisDescr").transition().duration(this._duration).attr("x",function(i){return(i<c.timeframe.minX)?0:c.chartSize.chartWidth}).remove();e.transition().duration(this._duration).remove()},renderSupply:function(v,D,c){var C=this;var s=v.append("svg:g").attr("id",c.chartId+"-chart-supplies");var a=s.selectAll("g").data(c.data).enter().append("svg:g");a.append("rect").attr("class",function(d){var n=(d[D].supply>d.basic.supply);return(n)?" sapMRPChartNewSupply":"sapMRPChartSupply"}).attr("x",function(d){return c.xScale(d.index)-c.daySize/21*38/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceStart)-c.yScale(d[D].balanceIntraday)});if(c.displayText){a.append("svg:title").text(function(d){return""+(C.formatNumber(d[D].supply))})}},updateSupply:function(v,D,c){var C=this;var s=v.select("#"+c.chartId+"-chart-supplies");var a=s.selectAll("g").data(c.data,function(d){return d.date});var b=a.enter().append("svg:g");b.append("rect").attr("class",function(d){var n=(d[D].supply>d.basic.supply);return(n)?" sapMRPChartNewSupply":"sapMRPChartSupply"}).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).attr("y",c.yScale(0)).attr("height",0).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index)-c.daySize/21*38/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceStart)-c.yScale(d[D].balanceIntraday)});if(c.displayText){b.append("svg:title").text(function(d){return""+(C.formatNumber(d[D].supply))})}a.select("rect").transition().duration(this._duration).attr("class",function(d){var n=(d[D].supply>d.basic.supply);return(n)?"sapMRPChartNewSupply":this.getAttribute("class")}).attr("x",function(d){return c.xScale(d.index)-c.daySize/21*38/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceStart)-c.yScale(d[D].balanceIntraday)}).transition().delay(this._duration).duration(0).attr("class",function(d){var n=(d[D].supply>d.basic.supply);return(n)?" sapMRPChartNewSupply":"sapMRPChartSupply"});if(c.displayText){a.select("title").text(function(d){return""+(C.formatNumber(d[D].supply))})}var e=a.exit();e.select("rect").transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).remove();e.select("text").transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).remove();e.transition().duration(this._duration).remove()},renderDemand:function(v,D,c){var C=this;var a=v.append("svg:g").attr("id",c.chartId+"-chart-demands");var b=a.selectAll("g").data(c.data).enter().append("svg:g");b.append("rect").attr("class","sapMRPChartDemand").attr("x",function(d){return c.xScale(d.index)-c.daySize/21*20/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceEnd)-c.yScale(d[D].balanceIntraday)});if(c.displayText){b.append("svg:title").text(function(d){return""+(C.formatNumber(-d[D].demand))})}},updateDemand:function(v,D,c){var C=this;var a=v.select("#"+c.chartId+"-chart-demands");var b=a.selectAll("g").data(c.data,function(d){return d.date});var e=b.enter().append("svg:g");e.append("rect").attr("class","sapMRPChartDemand").attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).attr("y",c.yScale(0)).attr("height",0).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index)-c.daySize/21*20/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceEnd)-c.yScale(d[D].balanceIntraday)});if(c.displayText){e.append("svg:title").text(function(d){return""+(C.formatNumber(-d[D].demand))})}b.select("rect").transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index)-c.daySize/21*20/2}).attr("width",function(d){return c.daySize/21*8}).attr("y",function(d){return c.yScale(d[D].balanceIntraday)}).attr("height",function(d){return c.yScale(d[D].balanceEnd)-c.yScale(d[D].balanceIntraday)});if(c.displayText){b.select("title").text(function(d){return""+(C.formatNumber(-d[D].demand))})}var f=b.exit();f.select("rect").transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("width",0).remove();f.select("text").transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).remove();f.transition().duration(this._duration).remove()},renderBalanceLine:function(v,D,c){var b=v.append("svg:g").attr("id",c.chartId+"-chart-balances");var a=b.selectAll("g.balanceLines").data(c.data,function(d){return d.date}).enter().append("svg:g").attr("class","balanceLines");a.append("svg:line").attr("class","start sapMRPChartLineEndOfDay").attr("x1",function(d){return c.xScale(d.index-1)}).attr("x2",function(d){return c.xScale(d.index)-c.daySize/21*22/2}).attr("y1",function(d){return c.yScale(d[D].balanceStart)}).attr("y2",function(d){return c.yScale(d[D].balanceStart)});a.append("svg:line").attr("class",function(d){var e=((d[D].demand!=0)&&(d[D].supply!=0))?"sapMRPChartLineIntraday":"sapMRPChartLineEndOfDay";return"intraday "+e}).attr("fullX1",function(d){return c.xScale(d.index)-c.daySize/21*38/2}).attr("x1",function(d){if(d[D].supply!=0){return c.xScale(d.index)-c.daySize/21*38/2}else{return c.xScale(d.index)-c.daySize/21*22/2}}).attr("fullX2",function(d){return c.xScale(d.index)-c.daySize/21*4/2}).attr("x2",function(d){if(d[D].demand!=0){return c.xScale(d.index)-c.daySize/21*4/2}else{return c.xScale(d.index)-c.daySize/21*20/2}}).attr("y1",function(d){return c.yScale(d[D].balanceIntraday)}).attr("y2",function(d){return c.yScale(d[D].balanceIntraday)});a.append("svg:line").attr("class","end sapMRPChartLineEndOfDay").attr("x1",function(d){return c.xScale(d.index)-c.daySize/21*20/2}).attr("x2",function(d){return c.xScale(d.index)}).attr("y1",function(d){return c.yScale(d[D].balanceEnd)}).attr("y2",function(d){return c.yScale(d[D].balanceEnd)})},updateBalanceLine:function(v,D,c){var b=v.select("#"+c.chartId+"-chart-balances");var a=b.selectAll("g.balanceLines").data(c.data,function(d){return d.date});var e=a.enter().append("svg:g").attr("class","balanceLines");e.append("svg:line").attr("class","start sapMRPChartLineEndOfDay").attr("x1",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("x2",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("y1",c.yScale(0)).attr("y2",c.yScale(0)).transition().duration(this._duration).attr("x1",function(d){return c.xScale(d.index-1)}).attr("x2",function(d){return c.xScale(d.index)-c.daySize/21*22/2}).attr("y1",function(d){return c.yScale(d[D].balanceStart)}).attr("y2",function(d){return c.yScale(d[D].balanceStart)});e.append("svg:line").attr("class",function(d){var g=((d[D].demand!=0)&&(d[D].supply!=0))?"sapMRPChartLineIntraday":"sapMRPChartLineEndOfDay";return"intraday "+g}).attr("x1",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("x2",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("y1",c.yScale(0)).attr("y2",c.yScale(0)).transition().duration(this._duration).attr("fullX1",function(d){return c.xScale(d.index)-c.daySize/21*38/2}).attr("x1",function(d){if(d[D].supply!=0){return c.xScale(d.index)-c.daySize/21*38/2}else{return c.xScale(d.index)-c.daySize/21*22/2}}).attr("fullX2",function(d){return c.xScale(d.index)-c.daySize/21*4/2}).attr("x2",function(d){if(d[D].demand!=0){return c.xScale(d.index)-c.daySize/21*4/2}else{return c.xScale(d.index)-c.daySize/21*20/2}}).attr("y1",function(d){return c.yScale(d[D].balanceIntraday)}).attr("y2",function(d){return c.yScale(d[D].balanceIntraday)});e.append("svg:line").attr("class","end sapMRPChartLineEndOfDay").attr("x1",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("x2",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("y1",c.yScale(0)).attr("y2",c.yScale(0)).transition().duration(this._duration).attr("x1",function(d){return c.xScale(d.index)-c.daySize/21*20/2}).attr("x2",function(d){return c.xScale(d.index)}).attr("y1",function(d){return c.yScale(d[D].balanceEnd)}).attr("y2",function(d){return c.yScale(d[D].balanceEnd)});a.select("line.start").transition().duration(this._duration).attr("x1",function(d){return c.xScale(d.index-1)}).attr("y1",function(d){return c.yScale(d[D].balanceStart)}).attr("y2",function(d){return c.yScale(d[D].balanceStart)}).attr("x2",function(d){return c.xScale(d.index)-c.daySize/21*22/2});a.select("line.intraday").attr("class",function(d){return((d[D].demand!=0)&&(d[D].supply!=0))?"sapMRPChartLineIntraday":"sapMRPChartLineEndOfDay"}).attr("x1",function(d){return this.getAttribute("fullX1")}).attr("x2",function(d){return this.getAttribute("fullX2")}).transition().duration(this._duration).attr("y1",function(d){return c.yScale(d[D].balanceIntraday)}).attr("y2",function(d){return c.yScale(d[D].balanceIntraday)}).attr("x1",function(d){if(d[D].supply!=0){return c.xScale(d.index)-c.daySize/21*38/2}else{return c.xScale(d.index)-c.daySize/21*22/2}}).attr("x2",function(d){if(d[D].demand!=0){return c.xScale(d.index)-c.daySize/21*4/2}else{return c.xScale(d.index)-c.daySize/21*20/2}});a.select("line.end").transition().duration(this._duration).attr("x2",function(d){return c.xScale(d.index)}).attr("y1",function(d){return c.yScale(d[D].balanceEnd)}).attr("y2",function(d){return c.yScale(d[D].balanceEnd)}).attr("x1",function(d){return c.xScale(d.index)-c.daySize/21*20/2});var f=a.exit();f.selectAll("line").transition().duration(this._duration).attr("x1",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("x2",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).remove();f.transition().duration(this._duration).remove()},renderBalanceDot:function(v,D,c){var C=this;var b=v.select("#"+c.chartId+"-chart-balances");var a=b.append("svg:g").attr("class","firstBalance");a.append("svg:line").attr("class","sapMRPChartLineEndOfDay").attr("x1",-11).attr("x2",c.xScale(c.timeframe.minX-1)).attr("y1",c.yScale(c.firstBalance[D])).attr("y2",c.yScale(c.firstBalance[D]));a.append("svg:circle").attr("class","sapMRPChartBalance").attr("cx",c.xScale(c.timeframe.minX-1)).attr("cy",c.yScale(c.firstBalance[D])).attr("r",5);a.append("svg:text").attr("class","sapMRPChartBalanceDescr").attr("x",function(d){return c.xScale(c.timeframe.minX-1)}).attr("y",c.yScale(c.firstBalance[D])).attr("dy","18px").attr("text-anchor","middle").text(C.formatNumber(c.firstBalance[D])).attr("style",function(d){var s="";var t=this.getComputedTextLength();var f=c.chartSize.leftSpace+c.daySize*3/8;if(t>f){s="font-size:"+Math.floor(875/t*f)/1000+"rem"}return s}).attr("dx",function(d){var t=this.getComputedTextLength();if(t>c.chartSize.leftSpace*2){return(t-2*c.chartSize.leftSpace)+"px"}return"0px"});var e=b.selectAll("g.balanceDot").data(c.data,function(d){return d.date}).enter().append("svg:g").attr("class","balanceDot");e.append("svg:circle").attr("class","sapMRPChartBalance").attr("cx",function(d){return c.xScale(d.index)}).attr("cy",function(d){return c.yScale(d[D].balanceEnd)}).attr("r",function(d){return(d[D].demand||d[D].supply)?5:0});if(this.getBalanceDotTooltip()!=""){e.append("svg:title").text(this.getBalanceDotTooltip())}e.append("svg:text").attr("class","sapMRPChartBalanceDescr").attr("x",function(d){return c.xScale(d.index)}).attr("y",function(d){return c.yScale(d[D].balanceEnd)}).attr("dy","18px").attr("text-anchor","middle").text(function(d){if(d[D].demand||d[D].supply){return C.formatNumber(d[D].balanceEnd)}else{return""}}).attr("style",function(d){var s="";var t=this.getComputedTextLength();var f=c.daySize*3/4;if(t>f){s="font-size:"+Math.floor(875/t*f)/1000+"rem"}return s})},updateBalanceDot:function(v,D,c){var C=this;var b=v.select("#"+c.chartId+"-chart-balances");var a=b.select("g.firstBalance");a.select("line").transition().duration(this._duration).attr("x2",c.xScale(c.timeframe.minX-1)).attr("y1",c.yScale(c.firstBalance[D])).attr("y2",c.yScale(c.firstBalance[D]));a.select("circle").transition().duration(this._duration).attr("cx",c.xScale(c.timeframe.minX-1)).attr("cy",c.yScale(c.firstBalance[D]));a.select("text").transition().duration(this._duration).attr("x",function(d){return c.xScale(c.timeframe.minX-1)}).attr("y",c.yScale(c.firstBalance[D])).attr("style","").text(C.formatNumber(c.firstBalance[D])).attr("style",function(d){var s="";var t=this.getComputedTextLength();var h=c.chartSize.leftSpace+c.daySize*3/8;if(t>h){s="font-size:"+Math.floor(875/t*h)/1000+"rem"}return s}).attr("dx",function(d){var t=this.getComputedTextLength();if(t>c.chartSize.leftSpace*2){return(t-2*c.chartSize.leftSpace)+"px"}return"0px"});var e=b.selectAll("g.balanceDot").data(c.data,function(d){return d.date});var f=e.enter().append("svg:g").attr("class","balanceDot");f.append("svg:circle").attr("class","sapMRPChartBalance").attr("cx",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("cy",c.yScale(0)).attr("r",function(d){return(d[D].demand||d[D].supply)?5:0}).transition().duration(this._duration).attr("cx",function(d){return c.xScale(d.index)}).attr("cy",function(d){return c.yScale(d[D].balanceEnd)});f.append("svg:text").attr("class","sapMRPChartBalanceDescr").attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("y",c.yScale(0)).attr("dy","18px").attr("text-anchor","middle").text(function(d){if(d[D].demand||d[D].supply){return C.formatNumber(d[D].balanceEnd)}else{return""}}).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index)}).attr("y",function(d){return c.yScale(d[D].balanceEnd)});e.select("circle.sapMRPChartBalance").transition().duration(this._duration).attr("cx",function(d){return c.xScale(d.index)}).attr("cy",function(d){return c.yScale(d[D].balanceEnd)}).attr("r",function(d){return(d[D].demand||d[D].supply)?5:0});e.select("text").attr("style","").text(function(d){if(d[D].demand||d[D].supply){return C.formatNumber(d[D].balanceEnd)}else{return""}}).transition().duration(this._duration).attr("x",function(d){return c.xScale(d.index)}).attr("y",function(d){return c.yScale(d[D].balanceEnd)}).attr("style",function(d){var s="";var t=this.getComputedTextLength();var h=c.daySize*3/4;if(t>h){s="font-size:"+Math.floor(875/t*h)/1000+"rem"}return s});var g=e.exit();g.select("circle").transition().duration(this._duration).attr("cx",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("cy",c.yScale(0)).remove();g.select("text").transition().duration(this._duration).attr("x",function(d){return(d.index<c.timeframe.minXBasic)?0:c.chartSize.chartWidth}).attr("y",c.yScale(0)).remove();g.transition().duration(this._duration).remove()},renderChart:function(d){d=d||this._dataset||"basic";var c=this.getChartSettings(d);var o=this.getOverviewSettings(d);if(c.data.length===0||o.data.length===0){return}this._y0Pos=c.posY0;if(!this.isVisible(d)){return}this.renderBackground(d,c);var a=d3.select("#"+c.chartId+"-chartArea").append("svg:svg").attr("id",c.chartId+"-chart").attr("width",c.chartSize.chartWidth).attr("height",c.chartSize.chartHeight);var v=a.append("svg:g").attr("transform","translate("+c.chartSize.leftSpace+","+c.chartSize.topBorder+")");if(c.data.length){this.renderDays(v,d,c);this.renderShortage(v,d,c);this.renderXTicks(v,d,c);this.renderXAxis(v,d,c);this.renderSupply(v,d,c);this.renderDemand(v,d,c);this.renderBalanceLine(v,d,c);this.renderBalanceDot(v,d,c)}if(this.getShowOverview()&&(o.chartSize.chartHeight>0)){var b=d3.select("#"+o.chartId+"-chartArea").append("svg:svg").attr("id",o.chartId+"-chart").attr("width",o.chartSize.chartWidth).attr("height",o.chartSize.chartHeight+2);var e=b.append("svg:g").attr("transform","translate("+o.chartSize.leftSpace+","+o.chartSize.topBorder+")");if(o.data.length){if(!this.getFixOverviewHeight()){this.renderXAxis(e,d,o);this.renderSupply(e,d,o);this.renderDemand(e,d,o);this.renderBalanceLine(e,d,o)}this.renderOverviewWindow(e,o);this.showDetailsInOverview()}}},updateChart:function(d){d=d||"preview";var c=this.getChartSettings(d);var o=this.getOverviewSettings(d);if(!this.isVisible(d)){return}this.updateBackground(d,c);var a=d3.select("#"+c.chartId+"-chartArea");a.transition().duration(this._duration).style({width:c.chartSize.chartWidth+"px",left:"0px"});var s=d3.select("#"+c.chartId+"-chartArea svg");s.transition().duration(this._duration).attr("width",c.chartSize.chartWidth);var v=d3.select("#"+c.chartId+"-chartArea svg g");if(c.data.length){this.updateDays(v,d,c);this.updateShortage(v,d,c);this.updateXTicks(v,d,c);this.updateXAxis(v,d,c);this.updateSupply(v,d,c);this.updateDemand(v,d,c);this.updateBalanceLine(v,d,c);this.updateBalanceDot(v,d,c)}if(this.getShowOverview()&&(o.chartSize.chartHeight>0)){var b=d3.select("#"+o.chartId+"-chartArea");b.transition().duration(this._duration).style("left","0px");var e=d3.select("#"+o.chartId+"-chartArea svg g");if(o.data.length){this.updateXAxis(e,d,o);this.updateSupply(e,d,o);this.updateDemand(e,d,o);this.updateBalanceLine(e,d,o)}}}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.SolutionCard')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.controls.SolutionCard');sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.SolutionCard",{metadata:{properties:{"myCard":"object","title":"string","subTitle":"string","actionText":"string","materialShortageSolutionType":"string","proposalPriority":"string","state":"string","status":"string","tooltipRating":"string","tooltipAction":"string"},aggregations:{"ctrlStars":{type:"sap.m.RatingIndicator",multiple:false},"ctrlIcon":{type:"sap.ui.core.Icon",multiple:false}}},getTapLocation:function(e){var t="";var l=jQuery("#"+this.getId());var c=l.children();var C=null;if(l[0].id===e.target.id){t=this.Constants.CARD_AREA_INSIDE}else{for(var i=0;i<c.length;i++){C=c[i];if(C.contains(e.target)){switch(C.className){case"sapMRPSCTitle":case"sapMRPSCSubtitle":case"sapMRPSCRating":t=this.Constants.CARD_AREA_INSIDE;break;case"sapMRPSCAction":t=this.Constants.CARD_AREA_EXECUTE;break;case"sapMRPSCIcon":t=this.Constants.CARD_AREA_ICON;break;default:t=""}}}}return t},ontap:function(e){var c=this.getMyCard();if(this.isSolutionCardLocked()){return}var t=this.getTapLocation(e);switch(t){case this.Constants.CARD_AREA_EXECUTE:this._triggerSolutionCardExecution(c);break;case this.Constants.CARD_AREA_INSIDE:case this.Constants.CARD_AREA_ICON:if(this.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){return}if(this.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT){this._triggerSolutionCardCancelPreview();this.setState(this.Constants.CARD_STATE_ENABLED);return}if(this.hasState(this.Constants.CARD_STATE_ACTIVE)){this._triggerSolutionCardCancelPreview();this.setState(this.Constants.CARD_STATE_ENABLED)}else{this._triggerSolutionCardRunPreview(c);this.setState(this.Constants.CARD_STATE_ACTIVE)}break}},_triggerSolutionCardExecution:function(c){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_DIALOG_START);b.publish(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_EXECUTE,{model:c})},_triggerSolutionCardRunPreview:function(c){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_RUN,{model:c})},_triggerSolutionCardCancelPreview:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_CANCEL,{model:null})},init:function(){var c=new sap.m.RatingIndicator({maxValue:2,iconSize:"1.125rem",value:0,enabled:false});this.setCtrlStars(c);this.setProposalPriority("0");this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants},isSolutionCardActive:function(){return this.hasState(this.Constants.CARD_STATE_ACTIVE)},isSolutionCardLocked:function(){return this.hasState(this.Constants.CARD_STATE_LOCKED)},isSolutionCardClicked:function(){return this.hasState(this.Constants.CARD_STATE_CLICKED)},hasState:function(s){var r=false;switch(s){case this.Constants.CARD_STATE_ENABLED:r=this.hasStyleClass("sapMRPSCStatusEnabled");break;case this.Constants.CARD_STATE_DISABLED:r=this.hasStyleClass("sapMRPSCStatusDisabled");break;case this.Constants.CARD_STATE_ACTIVE:r=this.hasStyleClass("sapMRPSCStatusActive");break;case this.Constants.CARD_STATE_LOCKED:r=this.hasStyleClass("sapMRPSCStatusLocked");break;case this.Constants.CARD_STATE_CLICKED:r=this.hasStyleClass("sapMRPSCStatusClicked");break;case this.Constants.CARD_STATE_HIDDEN:r=this.hasStyleClass("sapMRPSCStatusHidden");break;default:r=false;break}return r},setState:function(s){switch(s){case this.Constants.CARD_STATE_ENABLED:if(this.hasStyleClass("sapMRPSCStatusHidden")){this.removeStyleClass("sapMRPSCStatusHidden")}if(this.hasStyleClass("sapMRPSCStatusDisabled")){this.removeStyleClass("sapMRPSCStatusDisabled")}if(this.hasStyleClass("sapMRPSCStatusActive")){this.removeStyleClass("sapMRPSCStatusActive")}if(this.hasStyleClass("sapMRPSCStatusLocked")){this.removeStyleClass("sapMRPSCStatusLocked")}if(this.hasStyleClass("sapMRPSCStatusClicked")){this.removeStyleClass("sapMRPSCStatusClicked")}if(!this.hasStyleClass("sapMRPSCStatusEnabled")){this.addStyleClass("sapMRPSCStatusEnabled")}break;case this.Constants.CARD_STATE_DISABLED:if(!this.hasStyleClass("sapMRPSCStatusDisabled")){this.addStyleClass("sapMRPSCStatusDisabled")}if(this.hasStyleClass("sapMRPSCStatusEnabled")){this.removeStyleClass("sapMRPSCStatusEnabled")}if(this.hasStyleClass("sapMRPSCStatusActive")){this.removeStyleClass("sapMRPSCStatusActive")}if(this.hasStyleClass("sapMRPSCStatusLocked")){this.removeStyleClass("sapMRPSCStatusLocked")}if(this.hasStyleClass("sapMRPSCStatusClicked")){this.removeStyleClass("sapMRPSCStatusClicked")}break;case this.Constants.CARD_STATE_ACTIVE:if(!this.hasStyleClass("sapMRPSCStatusActive")){this.addStyleClass("sapMRPSCStatusActive")}if(this.hasStyleClass("sapMRPSCStatusEnabled")){this.removeStyleClass("sapMRPSCStatusEnabled")}if(this.hasStyleClass("sapMRPSCStatusDisabled")){this.removeStyleClass("sapMRPSCStatusDisabled")}if(this.hasStyleClass("sapMRPSCStatusLocked")){this.removeStyleClass("sapMRPSCStatusLocked")}if(this.hasStyleClass("sapMRPSCStatusClicked")){this.removeStyleClass("sapMRPSCStatusClicked")}break;case this.Constants.CARD_STATE_LOCKED:if(this.hasStyleClass("sapMRPSCStatusEnabled")){this.removeStyleClass("sapMRPSCStatusEnabled")}if(this.hasStyleClass("sapMRPSCStatusDisabled")){this.removeStyleClass("sapMRPSCStatusDisabled")}if(this.hasStyleClass("sapMRPSCStatusClicked")){this.removeStyleClass("sapMRPSCStatusClicked")}if(this.hasStyleClass("sapMRPSCStatusActive")){this.removeStyleClass("sapMRPSCStatusActive")}if(!this.hasStyleClass("sapMRPSCStatusLocked")){this.addStyleClass("sapMRPSCStatusLocked")}break;case this.Constants.CARD_STATE_CLICKED:if(this.hasStyleClass("sapMRPSCStatusDisabled")){this.removeStyleClass("sapMRPSCStatusDisabled")}if(this.hasStyleClass("sapMRPSCStatusLocked")){this.removeStyleClass("sapMRPSCStatusLocked")}if(!this.hasStyleClass("sapMRPSCStatusClicked")){this.addStyleClass("sapMRPSCStatusClicked")}break;case this.Constants.CARD_STATE_HIDDEN:if(!this.hasStyleClass("sapMRPSCStatusHidden")){this.addStyleClass("sapMRPSCStatusHidden")}break}},initCard:function(){var b=this.getModel("Common_i18n").getResourceBundle();var t="";var s="";var a=b.getText("CARD_ACT_CHOOSE");var m=this.getMyCard();var i="";var I=b.getText("CARD_XTOL_PREVIEW");var r="";var A="";var c="";if(m.VendorName){c=m.VendorName}else{c=b.getText("CARD_SUB_UNSOURCED")}var d="";if(m.SupplyingPlant){d=b.getText("CARD_SUB_PLANT",m.SupplyingPlant)}else{d=b.getText("CARD_SUB_UNSOURCED")}if(m.VendorName&&m.SupplyingPlant){c=b.getText("PLANT_LONG",[m.SupplyingPlant,m.VendorName]);d=c}switch(m.MaterialShortageSolutionType){case this.Constants.SOLUTIONTYPE_ACCEPT:t=b.getText("CARD_TIT_ACCEPT");s="";i=this.Constants.CARD_ICON_ACCEPT;I="";a=b.getText("CARD_ACT_CHOOSE");A=b.getText("XTOL_ACCEPT_SOL_CARD");break;case this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE:t=b.getText("CARD_TIT_ACCEPT_REMOVE");s="";i=this.Constants.CARD_ICON_ACCEPT_REMOVE;I="";a=b.getText("CARD_ACT_CANCEL");A=b.getText("XTOL_ACCEPTED_SOL_CARD");break;case this.Constants.SOLUTIONTYPE_PO_CREATE:t=b.getText("CARD_TIT_CREATEPO");s=c;i=this.Constants.CARD_ICON_PROCURE;A=b.getText("SOLUTION_DIALOG_PO_CREATE_TITLE");break;case this.Constants.SOLUTIONTYPE_PO_INCREASE:t=b.getText("CARD_TIT_INCREASE");s=c;i=this.Constants.CARD_ICON_INCREASE;A=b.getText("SOLUTION_DIALOG_PO_INCREASE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PO_RESCHEDULE:t=b.getText("CARD_TIT_RESCHEDULE");s=c;i=this.Constants.CARD_ICON_RESCHEDULE;A=b.getText("SOLUTION_DIALOG_PO_RESCHEDULE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PR_CREATE:t=b.getText("CARD_TIT_CREATEPO");s=c;i=this.Constants.CARD_ICON_PROCURE;A=b.getText("SOLUTION_DIALOG_PO_CREATE_TITLE");break;case this.Constants.SOLUTIONTYPE_PR_INCREASE:t=b.getText("CARD_TIT_INCREASE");s=c;i=this.Constants.CARD_ICON_INCREASE;A=b.getText("SOLUTION_DIALOG_PR_INCREASE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:t=b.getText("CARD_TIT_RESCHEDULE");s=c;i=this.Constants.CARD_ICON_RESCHEDULE;A=b.getText("SOLUTION_DIALOG_PR_RESCHEDULE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TO_CREATE:t=b.getText("CARD_TIT_CREATETO");s=d;i=this.Constants.CARD_ICON_TRANSFER;A=b.getText("SOLUTION_DIALOG_TO_CREATE_TITLE");break;case this.Constants.SOLUTIONTYPE_TO_INCREASE:t=b.getText("CARD_TIT_INCREASE");s=d;i=this.Constants.CARD_ICON_INCREASE;A=b.getText("SOLUTION_DIALOG_TO_INCREASE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TO_RESCHEDULE:t=b.getText("CARD_TIT_RESCHEDULE");s=d;i=this.Constants.CARD_ICON_RESCHEDULE;A=b.getText("SOLUTION_DIALOG_TO_RESCHEDULE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TOR_CREATE:t=b.getText("CARD_TIT_CREATETO");s=d;i=this.Constants.CARD_ICON_TRANSFER;A=b.getText("SOLUTION_DIALOG_TO_CREATE_TITLE");break;case this.Constants.SOLUTIONTYPE_TOR_INCREASE:t=b.getText("CARD_TIT_INCREASE");s=d;i=this.Constants.CARD_ICON_INCREASE;A=b.getText("SOLUTION_DIALOG_TOR_INCREASE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:t=b.getText("CARD_TIT_RESCHEDULE");s=d;i=this.Constants.CARD_ICON_RESCHEDULE;A=b.getText("SOLUTION_DIALOG_TOR_RESCHEDULE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PO_CHANGE:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PO_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PR_CHANGE:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PR_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TO_CHANGE:t=b.getText("CARD_TIT_CHANGE");s=d;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_TO_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_TOR_CHANGE:t=b.getText("CARD_TIT_CHANGE");s=d;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_TOR_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PA_CHANGE:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PROD_CONVERT:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_PROC_CONVERT:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;case this.Constants.SOLUTIONTYPE_REQ_CONVERT:t=b.getText("CARD_TIT_CHANGE");s=c;i=this.Constants.CARD_ICON_CHANGE;A=b.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.MRPElementExternalID,m.MRPElementItemExternalID]);break;default:t=b.getText("CARD_TIT_UNKNOWN");s=m.MaterialShortageSolutionType;break}switch(m.ProposalPriority){case"0":r=b.getText("CARD_XTOL_RATING_0");break;case"1":r=b.getText("CARD_XTOL_RATING_1");break;case"2":r=b.getText("CARD_XTOL_RATING_2");break;default:r="";break}this.setTitle(t);this.setSubTitle(s);this.setActionText(a);this.setTooltipAction(A);this.setTooltipRating(r);this.setMaterialShortageSolutionType(m.MaterialShortageSolutionType);this.setProposalPriority(m.ProposalPriority);var C=new sap.ui.core.Icon({src:i,tooltip:I});this.setCtrlIcon(C);this.addStyleClass("sapMRPSC");if(m.MaterialShortageSolutionType===this.Constants.SOLUTIONTYPE_ACCEPT||m.MaterialShortageSolutionType===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){this.addStyleClass("sapMRPSCTypeAccept")}},renderer:function(r,c){r.write('<div ');r.writeControlData(c);r.writeClasses();r.write(">");r.write('<div ');r.addClass("sapMRPSCIcon");r.writeClasses();r.write(">");r.renderControl(c.getCtrlIcon());r.write("</div>");r.write('<div ');r.addClass("sapMRPSCTitle");r.writeClasses();r.write(">");r.writeEscaped(c.getTitle());r.write("</div>");r.write('<div ');if(c.getMaterialShortageSolutionType()!==c.Constants.SOLUTIONTYPE_ACCEPT){r.addClass("sapMRPSCSubtitle");r.writeClasses()}r.write(">");r.writeEscaped(c.getSubTitle());r.write("</div>");r.write('<div ');r.writeAttributeEscaped("title",c.getTooltipRating());r.addClass("sapMRPSCRating");r.writeClasses();r.write(">");var s=c.getCtrlStars();var p=c.getProposalPriority();var P=parseFloat(p);s.setValue(P);r.renderControl(s);r.write("</div>");r.write("<div ");r.writeAttributeEscaped("title",c.getTooltipAction());r.addClass("sapMRPSCAction");r.writeClasses();r.write(">");r.write('<span ');r.addClass("text");r.writeClasses();r.write(">");r.writeEscaped(c.getActionText());r.write("</span>");r.write("</div>");r.write("</div>")},onBeforeRendering:function(e){},onAfterRendering:function(e){}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.controls.SolutionCardContainer')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.controls.SolutionCardContainer');sap.ui.core.Control.extend("i2d.pp.mrpcockpit.reuse.controls.SolutionCardContainer",{metadata:{properties:{scrollStep:"int",animationSpeed:"int",cardWidth:"int",registrationID:"string",materialShortageHasNoSolution:"boolean"},defaultAggregation:"cards",aggregations:{"cards":{type:"i2d.pp.mrpcockpit.reuse.controls.SolutionCard",multiple:true,singularName:"card"},"ctrlScrollLeft":{type:"sap.ui.core.Icon",multiple:false},"ctrlScrollRight":{type:"sap.ui.core.Icon",multiple:false}},associations:{"activeCard":{type:"i2d.pp.mrpcockpit.reuse.controls.SolutionCard",multiple:false}}},init:function(){this.setAnimationSpeed(750);this.setCardWidth(148);this.setScrollStep(0);this.setMaterialShortageHasNoSolution(false);this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var c=new sap.ui.core.Icon({id:"mrpScrollLeft",src:"sap-icon://navigation-left-arrow"});this.setCtrlScrollLeft(c);var C=new sap.ui.core.Icon({id:"mrpScrollRight",src:"sap-icon://navigation-right-arrow"});this.setCtrlScrollRight(C);var b=sap.ui.getCore().getEventBus();b.subscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_DIALOG_START,this.onODataSent,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_DIALOG_CANCEL,this.unlockAllCards,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,this.onODataError,this)},exit:function(){sap.ui.core.ResizeHandler.deregister(this.getRegistrationID);var b=sap.ui.getCore().getEventBus();b.unsubscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_DIALOG_START,this.onODataSent,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_DIALOG_CANCEL,this.onODataSent,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,this.onODataError,this)},onODataError:function(){this.enableAllCards()},onODataSent:function(){this.lockAllCards()},enableAllCards:function(){var c=this.getCards();var i;for(i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_ENABLED)}},enableCard:function(c){var C=this.getCards();var i;for(i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ENABLED)}}},lockCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_LOCKED)}}},lockAllCards:function(){var c=this.getCards();for(var i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_LOCKED)}},unlockCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ENABLED)}}},unlockAllCards:function(){this.enableAllCards()},deactivateCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_DISABLED)}}},activateCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_ACTIVE)}}},hideCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_HIDDEN)}}},disableAllCards:function(){var c=this.getCards();for(var i=0;i<c.length;i++){c[i].setState(this.Constants.CARD_STATE_DISABLED)}},disableCard:function(c){var C=this.getCards();for(var i=0;i<C.length;i++){if(c===C[i]){c.setState(this.Constants.CARD_STATE_DISABLED)}}},addSolutionCards:function(c,M){this.removeAllCards();if(M){this.setMaterialShortageHasNoSolution(true)}else{this.setMaterialShortageHasNoSolution(false);for(var i=0;i<c.length;i++){var C=new i2d.pp.mrpcockpit.reuse.controls.SolutionCard({myCard:c[i]});C.setModel(this.getModel("Common_i18n"),"Common_i18n");C.initCard();C.setState(this.Constants.CARD_STATE_ENABLED);this.addCard(C)}this.updateStatusOfSolutionCards();var b=this.getModel("Common_i18n").getResourceBundle();var o=this.getCtrlScrollLeft();o.setTooltip(b.getText("CARD_XTOL_ARROW"));var a=this.getCtrlScrollRight();a.setTooltip(b.getText("CARD_XTOL_ARROW"))}},updateStatusOfSolutionCards:function(c){var i;var C=this.getCards();var e=this.existsSolutionCardOfType(this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE);if(e){for(i=0;i<C.length;i++){var o=C[i];if(o.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){this.enableCard(o)}else if(o.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT){this.hideCard(o)}else{this.lockCard(o)}}}else{for(i=0;i<C.length;i++){var o=C[i];if(o!==c){if(c&&c.isSolutionCardActive()){this.disableCard(o)}else{this.enableCard(o)}}}}},existsSolutionCardOfType:function(s){var c=this.getCards();var e=false;for(var i=0;i<c.length;i++){if(c[i].getMaterialShortageSolutionType()===s){e=true}}return e},existsSolutionCardOfState:function(s){var c=this.getCards();for(var i=0;i<c.length;i++){if(c[i].hasState(s)){return true}}return false},addSolutionCard:function(c){var s=new i2d.pp.mrpcockpit.reuse.controls.SolutionCard({myCard:c});s.setModel(this.getModel("Common_i18n"),"Common_i18n");s.initCard();s.setState(this.Constants.CARD_STATE_ENABLED);this.addCard(s);this.updateStatusOfSolutionCards()},removeCards:function(){this.removeAllCards()},renderer:function(r,c){r.write('<div');r.addClass("sapMRPSolutions");r.writeClasses();r.writeControlData(c);r.write(">");if(c.getMaterialShortageHasNoSolution()){var m=new sap.m.TextArea({value:c.getModel("Common_i18n").getResourceBundle().getText("MATERIAL_SHORTAGE_HAS_NO_SOLUTION_MSG"),valueState:sap.ui.core.ValueState.Warning,rows:8,cols:100,editable:false});m.addStyleClass("sapMRPMaterialShortageHasNoSolutionDescription");r.renderControl(m)}else{r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardNavLeft");r.addClass("sapMRPSCLeft");r.addClass("sapMRPSCNav");r.writeClasses();r.write(">");r.renderControl(c.getCtrlScrollLeft());r.write("</div>");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardNavRight");r.addClass("sapMRPSCRight");r.addClass("sapMRPSCNav");r.writeClasses();r.write(">");r.renderControl(c.getCtrlScrollRight());r.write("</div>");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardMiddle");r.addClass("sapMRPSCMiddle");r.writeClasses();r.write(">");r.write('<div ');r.writeAttributeEscaped("id","mrpSolCardContainer");r.write(">");var C=c.getCards();for(var i=0;i<C.length;i++){r.renderControl(C[i])}}r.write("</div>")},onBeforeRendering:function(e){},onAfterRendering:function(e){this.updateSolutionCardContainerSize()},_getTapLocation:function(e){var t="";var l=jQuery("#"+this.getId());var c=l.children();var C=null;for(var i=0;i<c.length;i++){C=c[i];if(C.contains(e.target)){switch(e.target.id){case"mrpScrollLeft":t=this.Constants.CARD_AREA_SCROLLLEFT;break;case"mrpScrollRight":t=this.Constants.CARD_AREA_SCROLLRIGHT;break;case"mrpSolCardMiddle":t=this.Constants.CARD_AREA_OUTSIDE;break;default:t=this.Constants.CARD_AREA_INSIDE;break}}}return t},_getTapedSolutionCard:function(c){for(var i=0;i<7;i++){if(!c.getMaterialShortageSolutionType){c=c.getParent()}}if(c.getMaterialShortageSolutionType){return c}else{return null}},ontap:function(e){var c=null;var t=this._getTapLocation(e);switch(t){case this.Constants.CARD_AREA_SCROLLLEFT:this.moveToLeft(this.getScrollStep());break;case this.Constants.CARD_AREA_SCROLLRIGHT:this.moveToRight(this.getScrollStep());break;case this.Constants.CARD_AREA_INSIDE:case this.Constants.CARD_AREA_ICON:c=e.srcControl;c=this._getTapedSolutionCard(c);if(!c){return}if(c.isSolutionCardLocked()){return}if(c.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT){this.enableAllCards();return}if(c.getMaterialShortageSolutionType()===this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE){return}this.updateStatusOfSolutionCards(c);break;case this.Constants.CARD_AREA_OUTSIDE:if(this.existsSolutionCardOfState(this.Constants.CARD_STATE_LOCKED)){return}this._triggerSolutionCardCancelPreview();this.enableAllCards();this.setActiveCard(null);break}},onswipeleft:function(e){this.moveToRight((this.getScrollStep()/2))},onswiperight:function(e){this.moveToLeft((this.getScrollStep()/2))},moveToLeft:function(p){$("#mrpSolCardMiddle").animate({scrollLeft:"-="+(p).toString()+"px"},this.getAnimationSpeed())},moveToRight:function(p){$("#mrpSolCardMiddle").animate({scrollLeft:"+="+(p).toString()+"px"},this.getAnimationSpeed())},updateSolutionCardContainerSize:function(){var c=this.getContainerWidth();$("#mrpSolCardContainer").width(c);var s=$(".sapMRPSolutions").parent().width();$(".sapMRPSolutions").width("100%");var S=32;var i=s-S;if(c<i){this._hideScrollArrows();this.setScrollStep(0)}else{this._showScrollArrows();var a=this.calculateScrollStep();this.setScrollStep(a)}},getContainerWidth:function(){var a=this.getCards().length;var c=$(".sapMRPSC").outerWidth(true);var s=10;return(a*c+s)},getContainerHeight:function(){var s=$(".sapMRPSolutions").height();return s},calculateScrollStep:function(){var a=0;var c=0;var C=$("#mrpSolCardMiddle").width();c=$(".sapMRPSC").outerWidth(true);if(c&&(c>0)){a=Math.floor(C/c)}return c*a},_hideScrollArrows:function(){$("#mrpScrollLeft").addClass("sapMRPScrollHidden");$("#mrpScrollRight").addClass("sapMRPScrollHidden")},_showScrollArrows:function(){$("#mrpScrollLeft").removeClass("sapMRPScrollHidden");$("#mrpScrollRight").removeClass("sapMRPScrollHidden")},_triggerSolutionCardCancelPreview:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_CANCEL,{model:null})},_getCountVisibleSolutionCards:function(){var c=0;var C=this.getCards();for(var i=0;i<C.length;i++){if(!C[i].hasState(this.Constants.CARD_STATE_HIDDEN)){c++}}return c}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogRoot')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogRoot');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Number');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.ui.core.format.NumberFormat');jQuery.sap.require('sap.ui.core.Configuration');sap.ca.scfld.md.controller.BaseDetailController.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogRoot",{beforeOpen:function(c){this.dialogAction="";this.oDialog=c.getSource();this.Common_i18n=this.oDialog.getModel('Common_i18n').getResourceBundle();this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;this.bDateValid=true;this.bAmountValid=true;var m=this.oDialog.getModel();m.setProperty("/MRPElementOriginalTotalQty",Number(m.getProperty("/MRPElementOriginalTotalQty")));m.setProperty("/MRPElementChangedTotalQuantity",Number(m.getProperty("/MRPElementChangedTotalQuantity")));m.setProperty("/OrderedChangedQuantity",Number(m.getProperty("/OrderedChangedQuantity")));var h={};h.fnSuccess=function(d,r,e){this._onOdataOrderSuccess(d,r,e)}.bind(this);h.fnError=function(e){this._onOdataOrderError(e)}.bind(this);var H={};H.fnSuccess=function(d,r,e){this._onOdataCRSuccess(d,r,e)}.bind(this);H.fnError=function(e){this._onOdataCRError(e)}.bind(this);this._oHandlerOrder=h;this._oHandlerCR=H;this._initializeDialog()},_initializeDialog:function(){},_fireEventODataSuccess:function(m,r){var M=this.oDialog.getModel();M.setProperty("/msg",m);var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,{model:{cardModel:M,responseModel:r}})},_onOdataOrderSuccess:function(d,r,e){sap.ca.ui.utils.busydialog.releaseBusyDialog();if(e.length>0){var E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromBatchResponse(this.Common_i18n,e);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:E});this._fireEventODataError()}else{this._fireEventODataSuccess(this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_SUCCESS"),d)}},_onOdataOrderError:function(e){var E="";sap.ca.ui.utils.busydialog.releaseBusyDialog();if(e&&e.response&&e.response.body){E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(this.Common_i18n,e.response.body)}else{E=this.Common_i18n.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:E});this._fireEventODataError()},_onOdataCRSuccess:function(d,r,e){sap.ca.ui.utils.busydialog.releaseBusyDialog();var D=this.oDialog.getModel().getData();if(e.length>0){var E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromBatchResponse(this.Common_i18n,e);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_REQUEST_SAVE_FAILED",[D.MRPElementExternalID,D.MRPElementItemExternalID]),details:E});this._fireEventODataError()}else{var R=this.Common_i18n.getText("SOLUTION_DIALOG_MSG_REQUEST_SAVED",[D.MRPElementExternalID,D.MRPElementItemExternalID]);this._fireEventODataSuccess(R,d)}},_onOdataCRError:function(e){var E="";sap.ca.ui.utils.busydialog.releaseBusyDialog();var d=this.oDialog.getModel().getData();if(e&&e.response&&e.response.body){E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(this.Common_i18n,e.response.body)}else{E=this.Common_i18n.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_REQUEST_SAVE_FAILED",[d.MRPElementExternalID,d.MRPElementItemExternalID]),details:E});this._fireEventODataError()},onOk:function(e){},onCancel:function(e){e.getSource().getParent().close();this.oDialog.close();this.oDialog.destroy();this._fireEventDialogCancel()},_onChangeDatePicker:function(e){if(!e.getParameter("valid")){this._setStatusDate(false,e.getSource(),true);return}var p=e.getSource().getDateValue();var t=new Date();t.setHours(0,0,0,0);if(p<t){this._setStatusDate(false,e.getSource())}else{this._setStatusDate(true,e.getSource())}},_onLiveChangeInput:function(e){var q=e.getParameter("newValue");var c=sap.ui.getCore().getConfiguration().getLocale();var n=sap.ui.core.format.NumberFormat.getInstance({style:"full"},c);var d=n.oFormatOptions.decimalSeparator;var g=n.oFormatOptions.groupingSeparator;var p=q.indexOf(g);var a=q.indexOf(d);var D="["+d+"]";var r=new RegExp(D,'g');var m=this.oDialog.getModel();if((q.charAt(q.length-1)==d)&&(p<a)&&(q.charAt(q.match(r).length)==1)){this._setStatusAmount(true,e.getSource())}else{var Q=n.parse(q);if(isNaN(Q)||(Q<=0)){this._setStatusAmount(false,e.getSource());e.getSource().setValue(e.getParameter("newValue"))}else{var i=q.lastIndexOf(d);if(i>0){var s=q.slice(i+1);var l=s.length;if(l<=m.getProperty("/TargetQuantityUnitDcmls")){this._setStatusAmount(true,e.getSource())}else{this._setStatusAmount(false,e.getSource());e.getSource().setValue(e.getParameter("newValue"))}}else{this._setStatusAmount(true,e.getSource())}}}},_setStatusAmount:function(v,c){this.bAmountValid=v;if(v){c.setValueState(sap.ui.core.ValueState.Info)}else{c.setValueState(sap.ui.core.ValueState.Error)}},_setStatusDate:function(v,c,i){this.bDateValid=v;this.bInvalidDateFormat=i;if(v){c.setValueState(sap.ui.core.ValueState.Info)}else{c.setValueState(sap.ui.core.ValueState.Error)}},_isScreenDataValid:function(){return(this.bDateValid&&this.bAmountValid)},_fireEventODataSent:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_EXECUTE,null)},_fireEventODataError:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,null)},_fireEventDialogCancel:function(){var b=sap.ui.getCore().getEventBus();b.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_DIALOG_CANCEL,null)}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.CalculationEngine')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.CalculationEngine");jQuery.sap.require('sap.ca.ui.message.message');i2d.pp.mrpcockpit.reuse.util.CalculationEngine=function(m){this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;this.oModelI18N=m};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.previewTable=function(m,c,s,S,d){this._dShortageStartDate=s;this._dShortageEndDate=S;this._aSupDemItems=[];if(!c){return[-1,this._aSupDemItems]}if(!this.isInputDataValid(d,c.ChangedAvailabilityDate)){return[-2,this._aSupDemItems]}this._aSupDemItems=m;this.initSupDemItems();var o=this.getActiveSupplyDemandItem(c);if(!o&&c.MaterialShortageSolutionType!==this.Constants.SOLUTIONTYPE_ACCEPT){o=this.createActiveSupplyDemandItem(c)}var C=this.getSupDemItemCategory(o,c);switch(C){case this.Constants.CARD_CATEGORY_INCREASE:this.runPreviewTypeIncrease(c,o);break;case this.Constants.CARD_CATEGORY_RESCHEDULE:this.runPreviewTypeReschedule(c,o);break;case this.Constants.CARD_CATEGORY_CHANGE:this.runPreviewTypeChange(c,o);break;case this.Constants.CARD_CATEGORY_ACCEPT:break}return[0,this._aSupDemItems]};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isInputDataValid=function(t,T){var d=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());var a=new Date(T.getUTCFullYear(),T.getUTCMonth(),T.getUTCDate());var v=true;if(a.getTime()<d.getTime()){v=false}else if(this._dShortageStartDate&&this._dShortageEndDate){if(!(this._dShortageStartDate instanceof Date)||!(this._dShortageEndDate instanceof Date)){v=false}else if(this._dShortageStartDate>this._dShortageEndDate){v=false}}return v};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.initSupDemItems=function(){for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.MRPElementOpenQuantity=parseFloat(o.MRPElementOpenQuantity);o.MRPAvailableQuantity=parseFloat(o.MRPAvailableQuantity);o.ChangedMrpElement=false;if(o.MRPAvailableQuantity<o.MaterialShortageCriticalQty){o.InitialShortage=true}}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.getSupDemItemCategory=function(s,c){var C="";switch(c.MaterialShortageSolutionType){case this.Constants.SOLUTIONTYPE_ACCEPT:C=this.Constants.CARD_CATEGORY_ACCEPT;break;case this.Constants.SOLUTIONTYPE_PO_CREATE:case this.Constants.SOLUTIONTYPE_TO_CREATE:C=this.Constants.CARD_CATEGORY_RESCHEDULE;break;default:var S=s.MRPElementAvailyOrRqmtDate;var d=c.ChangedAvailabilityDate;var i=s.MRPElementOpenQuantity;var a=parseFloat(c.MRPElementChangeOpenQuantity);if(d&&S){if(S.getTime()===d.getTime()&&i!==a){C=this.Constants.CARD_CATEGORY_INCREASE}if(S.getTime()!==d.getTime()&&i===a){C=this.Constants.CARD_CATEGORY_RESCHEDULE}if(S.getTime()!==d.getTime()&&i!==a){C=this.Constants.CARD_CATEGORY_CHANGE}}break}return C};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.getActiveSupplyDemandItem=function(c){var s=null;switch(c.MaterialShortageSolutionType){case this.Constants.SOLUTIONTYPE_PO_CREATE:case this.Constants.SOLUTIONTYPE_TO_CREATE:break;default:for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];if(o.MRPElement===c.MRPElementExternalID&&o.MRPElementCategory===c.MRPElementCategory&&o.MRPElementItem===c.MRPElementItemExternalID&&o.MRPElementScheduleLine===c.MRPElementScheduleLineExtID){s=o}}break}return s};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.createActiveSupplyDemandItem=function(c){var d=new Date("3333","03","03");c.MRPElementExternalID="";if(this.oModelI18N){var b=this.oModelI18N.getResourceBundle();c.MRPElementExternalID="["+b.getText("NEW")+"]"}var s=new Object();s.Index=this._aSupDemItems.length+1;s.MRPElement=c.MRPElementExternalID;s.MRPElementAvailyOrRqmtDate=d;s.MRPElementOpenQuantity=parseFloat(c.MRPElementChangeOpenQuantity);s.UnitOfMeasureTechnicalName=c.UnitOfMeasureTechnicalName;s.MaterialID=c.MaterialID;s.ChangedMrpElement=true;s.MRPElementCategoryShortName=c.MRPElementCategoryShortName;switch(c.MaterialShortageSolutionType){case this.Constants.SOLUTIONTYPE_PO_CREATE:s.Vendor=c.Vendor;s.VendorName=c.VendorName;s.MRPElementCategory=this.Constants.MRP_ELEMENT_CATEGORY_POITEM;s.MRPElementBusinessPartnerType=this.Constants.MRP_ELEMENT_BUSINESSPARTNERTYPE_SUPPLIER;s.MRPElementBusinessPartnerID=c.Vendor;s.MRPElementBusinessPartnerName=c.VendorName;break;case this.Constants.SOLUTIONTYPE_TO_CREATE:s.MRPElementCategory=this.Constants.MRP_ELEMENT_CATEGORY_RELORD;s.MRPElementBusinessPartnerType=this.Constants.MRP_ELEMENT_BUSINESSPARTNERTYPE_ISSUINGLOC;s.MRPElementBusinessPartnerID=c.SupplyingPlant;s.MRPElementBusinessPartnerName=c.VendorName;break}this._aSupDemItems.push(s);return s};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.setActiveSupDemItem=function(c,s){s.MRPElementAvailyOrRqmtDate=c.ChangedAvailabilityDate;s.MRPElementOpenQuantity=parseFloat(c.MRPElementChangeOpenQuantity);s.ChangedMrpElement=true};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.runPreviewTypeIncrease=function(c,s){var d=0;var S=s.MRPElementAvailyOrRqmtDate;var a=s.MRPElementOpenQuantity;var b=parseFloat(c.MRPElementChangeOpenQuantity);this.setActiveSupDemItem(c,s);this.adaptAvailableQuantities();d=b-a;for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.Index=i+1;if(!this.isItemStockLine(o)){if(!this.isShortageIntervalDefined()||this.isItemInShortageInterval(o)){if(o.MRPElementAvailyOrRqmtDate>=S){o.MRPAvailableQuantity+=d}}}}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.findSourcePosition=function(s){var p=0;for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];if(o.MRPElement===s.MRPElement&&o.MRPElementCategory===s.MRPElementCategory&&o.MRPElementItem===s.MRPElementItem&&o.MRPElementScheduleLine===s.MRPElementScheduleLine){p=i;break}}return p};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.findTargetPosition=function(c,s){var S=c.ChangedAvailabilityDate;var t=this._aSupDemItems.length;for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];if(!this.isItemStockLine(o)){if(S.getTime()<o.MRPElementAvailyOrRqmtDate.getTime()){t=i;break}else if(o.MRPElementAvailyOrRqmtDate.getTime()===S.getTime()){if(o.MRPElementOpenQuantity<0){t=i;break}else if(o.MRPElementCategoryShortName>s.MRPElementCategoryShortName){t=i;break}else if(o.MRPElementCategoryShortName===s.MRPElementCategoryShortName){if(o.MRPElement>s.MRPElement){t=i;break}}}}}return t};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isItemStockLine=function(o){if(o.MRPElementCategory===this.Constants.MRP_ELEMENT_CATEGORY_STOCK){return true}else{return false}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isItemSupply=function(o){if(o.MRPElementOpenQuantity<0){return false}else{return true}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isItemInShortageInterval=function(o){var d=o.MRPElementAvailyOrRqmtDate;if((this._dShortageStartDate<=d)&&(d<=this._dShortageEndDate)){return true}else{return false}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isShortageIntervalDefined=function(){if(this._dShortageStartDate===null||this._dShortageEndDate===null){return false}else{return true}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.isItemStockLine=function(o){if(o.MRPElementCategory===this.Constants.MRP_ELEMENT_CATEGORY_STOCK){return true}else{return false}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.setActiveSupDemItemQuantity=function(c,s,t){var S=c.ChangedAvailabilityDate;var q=c.MRPElementChangeOpenQuantity;var Q="";if(this._aSupDemItems.length===1){Q=0}else if((t>0)&&t===this._aSupDemItems.length-1){Q=this._aSupDemItems[t-1].MRPAvailableQuantity}else if((t>0)&&this._aSupDemItems[t-1].MRPElementAvailyOrRqmtDate.getTime()===S.getTime()&&!this.isItemStockLine(this._aSupDemItems[t-1])){Q=this._aSupDemItems[t-1].MRPAvailableQuantity}else if(this._aSupDemItems[t+1].MRPElementAvailyOrRqmtDate.getTime()===S.getTime()){if(this.isItemSupply(this._aSupDemItems[t+1])===true){Q=this._aSupDemItems[t+1].MRPAvailableQuantity}else if(t===0){Q=this._aSupDemItems[t+1].MRPAvailableQuantity-this._aSupDemItems[t+1].MRPElementOpenQuantity}else{Q=this._aSupDemItems[t-1].MRPAvailableQuantity}}else if(this._aSupDemItems[t+1].MRPElementAvailyOrRqmtDate.getTime()!==S.getTime()&&t===0){Q=this._aSupDemItems[t+1].MRPAvailableQuantity-q}else if(this._aSupDemItems[t+1].MRPElementAvailyOrRqmtDate.getTime()!==S.getTime()&&(t>0)){Q=this._aSupDemItems[t-1].MRPAvailableQuantity}this._aSupDemItems[t].MRPAvailableQuantity=Q};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.adaptAvailableQuantities=function(){var I=null;if(this._dShortageStartDate===null||this._dShortageEndDate===null){return}for(var i=0;i<this._aSupDemItems.length;i++){I=this._aSupDemItems[i];if(!this.isItemInShortageInterval(I)){I.MRPAvailableQuantity=""}}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.runPreviewTypeReschedule=function(c,s){var S=s.MRPElementAvailyOrRqmtDate;var d=c.ChangedAvailabilityDate;var a=parseFloat(c.MRPElementChangeOpenQuantity);var b=parseFloat(c.MRPElementOpenQuantity);this.setActiveSupDemItem(c,s);var p=this.findSourcePosition(s);var I=this._aSupDemItems.splice(p,1);var P=this.findTargetPosition(c,s);this._aSupDemItems.splice(P,0,I[0]);this.setActiveSupDemItemQuantity(c,s,P);this.adaptAvailableQuantities();if(d<S){for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.Index=i+1;if(!this.isItemStockLine(o)){if(!this.isShortageIntervalDefined()||this.isItemInShortageInterval(o)){if(((o.MRPElementAvailyOrRqmtDate>=d))&&((o.MRPElementAvailyOrRqmtDate<S))){o.MRPAvailableQuantity+=a}}}}}else{for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.Index=i+1;if(!this.isItemStockLine(o)){if(!this.isShortageIntervalDefined()||this.isItemInShortageInterval(o)){if(((o.MRPElementAvailyOrRqmtDate>=S))&&((o.MRPElementAvailyOrRqmtDate<d))){o.MRPAvailableQuantity-=b}}}}}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.runPreviewTypeChange=function(c,s){var d=0;var S=s.MRPElementAvailyOrRqmtDate;var a=c.ChangedAvailabilityDate;var b=s.MRPElementOpenQuantity;var e=parseFloat(c.MRPElementChangeOpenQuantity);this.runPreviewTypeReschedule(c,s);d=e-b;if(S<a){for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.Index=i+1;if(!this.isItemStockLine(o)){if(!this.isShortageIntervalDefined()||this.isItemInShortageInterval(o)){if(o.MRPElementAvailyOrRqmtDate>=a){o.MRPAvailableQuantity+=d}}}}}else{for(var i=0;i<this._aSupDemItems.length;i++){var o=this._aSupDemItems[i];o.Index=i+1;if(!this.isItemStockLine(o)){if(!this.isShortageIntervalDefined()||this.isItemInShortageInterval(o)){if(o.MRPElementAvailyOrRqmtDate>=S){o.MRPAvailableQuantity+=d}}}}}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.getSDItemsForShortage=function(s,m){var S={};var a=[];for(var k in m){if(m.hasOwnProperty(k)){if(k.substr(0,17)=="SupplyDemandItems"){S=m[k];if((S.MRPPlant===s.MRPPlant)&&(S.MaterialID===s.MaterialID)&&(S.MRPArea===s.MRPArea)&&(S.MRPPlant===s.MRPPlant)&&(S.MRPPlanningSegmentType===s.MRPPlanningSegmentType)&&(S.MRPPlanningSegmentNumber===s.MRPPlanningSegmentNumber)){a.push(S)}}}}return a};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.formatChartDate=function(d){var D=d.toString();if(D==="Invalid Date"){return D}else{return d.toISOString()}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.initialChartData=function(s,d,D,c){var o=new Date(d);var a=new Date(D);a=new Date(a.getTime()+24*3600*1000);var m={shiftLeft:c,decimals:0,startBalance:0,minStock:0,safetyStock:0,minDate:this.formatChartDate(o),maxDate:this.formatChartDate(a),minDateOld:"",maxDateOld:"",oMinDate:o,oMaxDate:a,chartData:[],deltas:[]};var l=(s&&s.length)?s.length:0;var S;var f={};var b="";var e;var M=null;var g=null;var v=0;var h=null;var j=null;var k=null;var n=null;for(var i=0;i<l;i++){S=s[i];v=(i===0)?parseFloat(S.MRPAvailableQuantity):parseFloat(S.MRPElementOpenQuantity);e=S.MRPElementAvailyOrRqmtDate;b=this.formatChartDate(e);if(!g&&S.MRPEvaluationHorizonInDays){var E=parseInt(S.MRPEvaluationHorizonInDays);g=new Date(e.getTime()+E*24*3600*1000)}if(!M||(e<M)){M=e}if(!g||(e>g)){g=e}if(i===0){m.decimals=parseInt(S.TargetQuantityUnitDcmls);m.startBalance=v;m.minStock=parseFloat(S.MaterialShortageThresholdQty);m.safetyStock=parseFloat(S.MaterialShortageCriticalQty)}else{if(!f[b]){f[b]={date:b,demand:0,supply:0,shortageAccepted:S.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED,shortageDefId:S.MaterialShortageDefinitionID}}if(v<0){f[b].demand+=v}else{f[b].supply+=v}}}if(M&&g){var L={shortageAccepted:false,defId:""};for(var e=M;e<=g;e=new Date(e.getTime()+24*3600*1000)){var b=this.formatChartDate(e);if(f[b]){L={shortageAccepted:f[b].shortageAccepted,defId:f[b].shortageDefId};m.chartData.push({date:e,demand:f[b].demand,supply:f[b].supply,shortageAccepted:f[b].shortageAccepted,shortageDefId:f[b].shortageDefId})}else{m.chartData.push({date:e,demand:0,supply:0,shortageAccepted:L.shortageAccepted,shortageDefId:L.defId})}}}return m};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.previewChartData=function(c){var d=(c.AvailabilityDate)?c.AvailabilityDate:c.ChangedAvailabilityDate;var D=c.ChangedAvailabilityDate;var s=this.formatChartDate(d);var v=parseFloat(c.MRPElementOpenQuantity);var a=this.formatChartDate(D);var V=parseFloat(c.MRPElementChangeOpenQuantity);var b=[];if(s===a){b=[{date:d,demand:(V<0)?-v+V:0,supply:(V>0)?-v+V:0}]}else{b=[{date:d,demand:(v<0)?-v:0,supply:(v>0)?-v:0},{date:D,demand:(V<0)?V:0,supply:(V>0)?V:0}]}return{oPreviewDate:D,sPreviewDate:a,deltas:b}};i2d.pp.mrpcockpit.reuse.util.CalculationEngine.prototype.previewChart=function(){}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.util.CollaborationHelper')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.CollaborationHelper");jQuery.sap.require('sap.ca.ui.message.message');i2d.pp.mrpcockpit.reuse.util.CollaborationHelper={setODataModel:function(m,b){this.oModelGlobal=m;this.backendVersion=b},readRequest:function(m){var d=this.oModelGlobal;var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUESTVENDOR;var c=null;var f="MRPElement eq '";f+=m.PurchaseOrderID;f+="' and MRPElementItem eq '";f+=m.ItemID;f+="' and MRPElementScheduleLine eq '";f+=m.ScheduleLineID;f+="' and Type eq '";f+=m.Type;f+="'";var U=new Array();var t="$filter="+f;U.push(t);d.read(u,null,U,false,function(D,r){c=r.data.results[0]},function(e){c=null});return c},updateRequestBatch:function(d,h,c){var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=new Array();var o=this.oModelGlobal;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;o.setUseBatch(true);o.clearBatch();var a={};a.SolutionRequestStatus=d.SolutionRequestStatus;a.SolutionRequestNote=d.SolutionRequestNote;a.VendorResponse=d.VendorResponse;if(c==="x30"){a.MRPElementChgAvailyOrRqmtDate=D.format(d.MRPElementChgAvailyOrRqmtDate)+"T00:00:00";a.MRPElementChangedTotalQuantity=(d.MRPElementChangedTotalQuantity).toString();a.MRPElementChgAvailyOrRqmtDate=D.format(d.MRPElementChgAvailyOrRqmtDate)+"T00:00:00"}else{if(d.MRPElementChangedTotalQuantity){a.MRPElementChangedTotalQuantity=(d.MRPElementChangedTotalQuantity).toString()}if(d.MRPElementChgAvailyOrRqmtDate){a.MRPElementChgAvailyOrRqmtDate=D.format(d.MRPElementChgAvailyOrRqmtDate)+"T00:00:00"}if(d.VendorResponse===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED&&d.MaterialShortageSolnRequestLine===null){var b={};b.MRPElementProposedTotalQty=(d.MRPElementProposedQuantity).toString();if(d.MRPElementProposedDate){var e=d.MRPElementProposedDate;b.MRPElementProposedDate=D.format(e)+"T00:00:00";b.MRPElementScheduleLine=d.MRPElementScheduleLine;b.MaterialShortageSolnRequest=d.MaterialShortageSolnRequest;var s=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUESTPROPOSAL}}else if(d.VendorResponse!==i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED&&d.MaterialShortageSolnRequestLine!==null){var b={};var u="/"+d.ChRequest_To_ChRequestProposal.__list[0];var s=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_DELETE}}C.push(o.createBatchOperation(this._buildUrlForChangeRequestUpdate(d),O,a,null));if(s){C.push(o.createBatchOperation(u,s,b,null))}o.addBatchChangeOperations(C);o.submitBatch(h.fnSuccess,h.fnError,false);return""},createRequestBatch:function(d,h){var c=new Array();var D=this.oModelGlobal;var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUEST;var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;D.setUseBatch(true);D.clearBatch();var a=this._buildODataForChangeRequestCreation(d);var C=D.createBatchOperation(u,o,a,null);c.push(C);D.addBatchChangeOperations(c);D.submitBatch(h.fnSuccess,h.fnError,false);return""},deleteShortageAcceptBatch:function(m,h){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.deleteShortageAcceptBatch(m,h)}var d=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var c=[];var D={};var a=d.format(m.MaterialShortageStartDate)+"T00:00:00";var b=d.format(m.MaterialShortageEndDate)+"T00:00:00";var o=this.oModelGlobal;var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_ACCEPTSHORTAGE+"(MaterialShortageProfile='"+m.MaterialShortageProfile+"',MaterialShortageProfileCount='"+m.MaterialShortageProfileCount+"',MaterialID='"+m.MaterialID+"',MRPPlant='"+m.MRPPlant+"',MRPArea='"+encodeURIComponent(m.MRPArea)+"',MRPPlanningSegmentType='"+m.MRPPlanningSegmentType+"',MRPPlanningSegmentNumber='"+m.MRPPlanningSegmentNumber+"',MaterialShortageStartDate=datetime'"+encodeURIComponent(a)+"',MaterialShortageEndDate=datetime'"+encodeURIComponent(b)+"')";var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_DELETE;var C=o.createBatchOperation(u,O,D,null);c.push(C);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,true);return""},createShortageAcceptBatch:function(d,h){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.createShortageAcceptBatch(d,h)}var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_ACCEPTSHORTAGE;var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var a=this.oModelGlobal;a.setUseBatch(true);a.clearBatch();if(!d.MaterialShortageProfile||!d.MaterialShortageProfileCount||!d.MaterialID||!d.MRPPlant||!d.MRPArea||!d.MRPPlanningSegmentType||!d.MaterialShortageStartDate||!d.MaterialShortageEndDate){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}var b={};b.MaterialShortageProfile=d.MaterialShortageProfile;b.MaterialShortageProfileCount=d.MaterialShortageProfileCount;b.MaterialID=d.MaterialID;b.MRPPlant=d.MRPPlant;b.MRPArea=d.MRPArea;b.MRPPlanningSegmentType=d.MRPPlanningSegmentType;b.MRPPlanningSegmentNumber=d.MRPPlanningSegmentNumber;b.MaterialShortageStartDate=D.format(d.MaterialShortageStartDate)+"T00:00:00";b.MaterialShortageEndDate=D.format(d.MaterialShortageEndDate)+"T00:00:00";b.MaterialShortageQuantity=(d.MaterialShortageQuantity).toString();b.AcceptShortageNote=d.SolutionRequestNote;var C=a.createBatchOperation(u,o,b,null);c.push(C);a.addBatchChangeOperations(c);a.submitBatch(h.fnSuccess,h.fnError,true);return""},updatePurchaseOrderBatch:function(d,h,c,C){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.writePurchaseOrderBatch(d,null,h)}var a=new Array();var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var D=this.oModelGlobal;D.setUseBatch(true);D.clearBatch();if(!d.MRPElement||!d.MRPElementItem||!d.MRPElementScheduleLine||!d.MaterialID){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if(C==="x30"){if(!d.MaterialShortageSolutionType||!d.MRPElementChgAvailyOrRqmtDate||!d.MRPElementAvailyOrRqmtDate||!d.OrderedQuantity||!d.OrderedChangedQuantity){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}}var i=this._adaptItemIdForMM(d.MRPElementItem);var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PO_SCHEDLINE;u+="(PurchaseOrderID='";u+=d.MRPElement;u+="',ItemID='";u+=i;u+="',ScheduleLineID='";u+=d.MRPElementScheduleLine;u+="')";var e=this._buildODataForPurchaseOrderUpdate(d,C);var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";var b=D.createBatchOperation(u,o,e,p);a.push(b);if(c===true){o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var m="";var f=this._buildODataForChangeRequestUpdate(d,C,m);u=this._buildUrlForChangeRequestUpdate(d);var B=D.createBatchOperation(u,o,f,null);a.push(B)}D.addBatchChangeOperations(a);D.submitBatch(h.fnSuccess,h.fnError,false);return""},_buildODataForPurchaseOrderUpdate:function(d,c){var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e={};switch(c){case"x30":var o=d.MRPElementChgAvailyOrRqmtDate;e.DeliveryDate=D.format(o)+"T00:00:00";e.PurchasingDocumentOrderQty=(d.OrderedChangedQuantity).toString();break;case"540":if(d.VendorResponse===i2d.pp.mrpcockpit.reuse.util.CommonConstants.VENDOR_RESPONSE_PROPOSED){e.DeliveryDate=d.MRPElementProposedDate;e.PurchasingDocumentOrderQty=d.MRPElementProposedQuantity}else{e.DeliveryDate=d.MRPElementChgAvailyOrRqmtDate;e.PurchasingDocumentOrderQty=d.MRPElementChangedTotalQuantity}break;default:jQuery.sap.log.error("CollaborationHelper:_buildODataForPurchaseOrderUpdate - unknown client app: "+c)}return e},_buildODataForChangeRequestUpdate:function(d,c,m){var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e={};e.SolutionRequestStatus=d.SolutionRequestStatus;switch(c){case"x30":m=d.MaterialShortageProfile+d.MaterialShortageProfileCount;e.MRPElementChgAvailyOrRqmtDate=D.format(d.MRPElementChgAvailyOrRqmtDate)+"T00:00:00";e.MRPElementOriginalTotalQty=(d.MRPElementOriginalTotalQty).toString();e.MRPElementChangedTotalQuantity=(d.MRPElementChangedTotalQuantity).toString();break;case"540":m=d.MaterialShortageDefinitionID;e.SolutionRequestNote=d.SolutionRequestNote;e.MRPElementOriginalTotalQty=d.MRPElementOriginalTotalQty;e.MRPElementChangedTotalQuantity=d.MRPElementChangedTotalQuantity;e.MRPElementChgAvailyOrRqmtDate=d.MRPElementChgAvailyOrRqmtDate;break;default:jQuery.sap.log.error("CollaborationHelper:_buildODataForChangeRequestUpdate - unknown client app: "+c)}return e},_buildODataForChangeRequestCreation:function(d){var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e={};e.MRPElement=d.MRPElement;e.MRPElementItem=this._adaptItemIdForMM(d.MRPElementItem);e.MRPElementScheduleLine=d.MRPElementScheduleLine;e.Vendor=d.Vendor;e.SupplyingPlant=d.SupplyingPlant;e.SolutionRequestStatus=d.SolutionRequestStatus;e.MaterialID=d.MaterialID;e.SolutionRequestNote=d.SolutionRequestNote;e.MRPPlant=d.MRPPlant;e.MRPArea=d.MRPArea;e.MRPPlanningSegmentType=d.MRPPlanningSegmentType;e.MRPPlanningSegmentNumber=d.MRPPlanningSegmentNumber;e.MRPElementCategory=d.MRPElementCategory;e.MaterialGoodsReceiptDuration=d.MaterialGoodsReceiptDuration;e.MRPElementOpenQuantity=(d.MRPElementOpenQuantity).toString();e.MRPElementChgAvailyOrRqmtDate=D.format(d.MRPElementChgAvailyOrRqmtDate)+"T00:00:00";e.MRPElementAvailyOrRqmtDate=D.format(d.MRPElementAvailyOrRqmtDate)+"T00:00:00";e.MRPElementOriginalTotalQty=(d.MRPElementOriginalTotalQty).toString();e.MRPElementChangedTotalQuantity=(d.OrderedChangedQuantity).toString();e.AvailabilityDate=D.format(d.AvailabilityDate)+"T00:00:00";return e},updatePurchaseRequisitionBatch:function(d,h){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.writePurchaseRequisitionBatch(d,null,h)}var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var o=this.oModelGlobal;o.setUseBatch(true);o.clearBatch();if(!d.MRPElement||!d.MRPElementItem||!d.MaterialShortageSolutionType||!d.MaterialID||!d.MRPElementChgAvailyOrRqmtDate||!d.MRPElementAvailyOrRqmtDate||!d.MRPElementOriginalTotalQty||!d.MRPElementChangedTotalQuantity){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}var i=this._adaptItemIdForMM(d.MRPElementItem);var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PR_ITEM;u+="(PurchaseRequisitionID='";u+=d.MRPElement;u+="',ItemID='";u+=i;u+="')";var e={};var a=d.MRPElementChgAvailyOrRqmtDate;e.DeliveryDate=D.format(a)+"T00:00:00";e.RequestedQuantity=(d.MRPElementChangedTotalQuantity).toString();e.PurchaseRequisitionIsFixed=true;var p={};p.sETag="W/\"'"+d.ChangeStateID+"'\"";var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var C=o.createBatchOperation(u,O,e,p);c.push(C);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,false);return""},createPurchaseOrderBatch:function(d,h){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.createPurchaseOrderBatch(d,null,h)}var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var f="0001";var A="01";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!f||!d.PurchasingOrganisation||!d.MRPElementChangedTotalQuantity||!d.ReceivingPlant||!d.MaterialID||!d.MaterialBaseUnit||!A){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PO_CREATE&&!d.Vendor){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(this.getModel('ServiceVersions')){return i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForFieldInt({sI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO",sSoHI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_POSoH",sModSI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_POModS",iServiceVersion:this.getModel('ServiceVersions').getData().iServiceSchemaVersion})}}return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TO"}var o=this.oModelGlobal;var s={};var g=d.MRPElementChgAvailyOrRqmtDate;s.ItemID=M;s.ScheduleLineID=f;if(!g){s.DeliveryDate=" "}else{s.DeliveryDate=D.format(g)+"T00:00:00"}s.PurchasingDocumentOrderQty=this.replaceEmptyValues((d.MRPElementChangedTotalQuantity).toString());var a=new Array();a.push(s);var i={};i.ItemID=M;i.AccountAssignmentID=A;i.SalesOrder=this.replaceEmptyValues(d.SalesOrder);i.SalesOrderItem=this.replaceEmptyValues(d.SalesOrderItem);i.WBSElement=this.replaceEmptyValues(d.WBSElement);var e=new Array();e.push(i);var I={};I.ItemID=M;I.AcctAssignmentCategory=this.replaceEmptyValues(d.AcctAssignmentCategory);I.Material=this.replaceEmptyValues(d.MaterialID);I.PurchasingDocumentOrderQty=this.replaceEmptyValues((d.MRPElementChangedTotalQuantity).toString());I.PurgDocOrderQuantityUnit=this.replaceEmptyValues(d.MaterialBaseUnit);I.ReceivingPlant=this.replaceEmptyValues(d.ReceivingPlant);I.SupplyingStorageLocation=this.replaceEmptyValues(d.SupplyingStorageLocation);I.ReceivingStorageLocation=this.replaceEmptyValues(d.ReceivingStorageLocation);I.PurchasingInfoRecord=this.replaceEmptyValues(d.PurchasingInfoRecord);I.PurchaseContract=this.replaceEmptyValues(d.PurchaseContract);I.PurchaseContractItem=this.replaceEmptyValues(d.PurchaseContractItem);I.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);I.MMPurchaseOrderScheduleLines=a;I.MMPurchaseOrderAccAssignments=e;var b=new Array();b.push(I);var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PO_HEADER;var H={};H.PurchasingOrganisation=d.PurchasingOrganisation;H.PurchasingGroup=d.PurchasingGroup;H.CompanyCode=d.CompanyCode;H.Vendor=this.replaceEmptyValues(d.Vendor);H.SupplyingPlant=this.replaceEmptyValues(d.SupplyingPlant);if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE){H.StockTransportOrderIndicator=true}else{H.StockTransportOrderIndicator=false}H.MMPurchaseOrderItems=b;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var j=o.createBatchOperation(u,O,H,null);c.push(j);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,false);return""},replaceEmptyValues:function(v){if(!v){return" "}else{return v}},createPurchaseRequisitionBatch:function(d,h){if(this.backendVersion===1){return i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.createPurchaseRequisitionBatch(d,null,h)}var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var C=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var A="01";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!d.MRPElementChangedTotalQuantity||!d.MaterialID||!d.MaterialBaseUnit||!A){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_PO_CREATE&&!d.Vendor){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(this.getModel('ServiceVersions')){return i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForFieldInt({sI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PR",sSoHI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PRSoH",sModSI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PRModS",iServiceVersion:this.getModel('ServiceVersions').getData().iServiceSchemaVersion})}}return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PR"}if(d.MaterialShortageSolutionType===C.SOLUTIONTYPE_TO_CREATE&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TR"}if(d.Vendor&&!d.PurchasingOrganisation){return"SOLUTION_DIALOG_MSG_PURCHASING_ORGANIZATION_MISSING_PR"}var o=this.oModelGlobal;var a={};a.ItemID=M;a.AccountAssignmentID=A;a.SalesOrder=this.replaceEmptyValues(d.SalesOrder);a.SalesOrderItem=this.replaceEmptyValues(d.SalesOrderItem);a.WBSElement=this.replaceEmptyValues(d.WBSElement);var e=new Array();e.push(a);var i={};var f=d.MRPElementChgAvailyOrRqmtDate;i.ItemID=M;i.PurchasingOrganisation=this.replaceEmptyValues(d.PurchasingOrganisation);i.PurchasingGroup=this.replaceEmptyValues(d.PurchasingGroup);i.PurchasingDocumentItemCategory=this.replaceEmptyValues(d.MaterialProcurementType);i.SupplyingPlant=this.replaceEmptyValues(d.SupplyingPlant);i.AcctAssignmentCategory=this.replaceEmptyValues(d.AcctAssignmentCategory);i.Material=this.replaceEmptyValues(d.MaterialID);i.PurReqQuantityUnit=this.replaceEmptyValues(d.MaterialBaseUnit);i.ReceivingPlant=this.replaceEmptyValues(d.ReceivingPlant);i.SupplyingStorageLocation=this.replaceEmptyValues(d.SupplyingStorageLocation);i.ReceivingStorageLocation=this.replaceEmptyValues(d.ReceivingStorageLocation);i.PurchasingInfoRecord=this.replaceEmptyValues(d.PurchasingInfoRecord);i.PurchaseContract=this.replaceEmptyValues(d.PurchaseContract);i.PurchaseContractItem=this.replaceEmptyValues(d.PurchaseContractItem);i.RequestedQuantity=this.replaceEmptyValues((d.MRPElementChangedTotalQuantity).toString());i.FixedVendor=this.replaceEmptyValues(d.Vendor);if(!f){i.DeliveryDate=" "}else{i.DeliveryDate=D.format(f)+"T00:00:00"}i.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);i.MMPurchaseReqAccAssignments=e;i.PurchaseRequisitionIsFixed=true;var b=new Array();b.push(i);var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PR_HEADER;var H={};H.MMPurchaseRequisitionItems=b;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var g=o.createBatchOperation(u,O,H,null);c.push(g);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,false);return""},convertPurchaseRequisitionBatch:function(d,h){if((d.MRPElementChgAvailyOrRqmtDate!==d.MRPElementAvailyOrRqmtDate)||(d.MRPElementChangedTotalQuantity!==d.MRPElementOriginalTotalQty)){this.updatePurchaseRequisitionBatch(d,h)};var n=(parseInt(d.MRPElementOpenQuantity));var c=n+d.MRPElementChangedTotalQuantity-d.MRPElementOriginalTotalQty;if(c<1){return""}var C=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var e=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var M="00010";var f="0001";if(!d.MRPElementChgAvailyOrRqmtDate||!M||!f||!d.MRPElementChangedTotalQuantity||!d.MRPElement){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}if((d.MaterialShortageSolutionType===e.SOLUTIONTYPE_PR_CHANGE||d.MaterialShortageSolutionType===e.SOLUTIONTYPE_PR_INCREASE||d.MaterialShortageSolutionType===e.SSOLUTIONTYPE_PR_RESCHEDULE)&&!d.Vendor){if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){if(this.getModel('ServiceVersions')){return i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForFieldInt({sI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO",sSoHI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_POSoH",sModSI18nID:"SOLUTION_DIALOG_MSG_VENDOR_MISSING_POModS",iServiceVersion:this.getModel('ServiceVersions').getData().iServiceSchemaVersion})}}return"SOLUTION_DIALOG_MSG_VENDOR_MISSING_PO"}if((d.MaterialShortageSolutionType===e.SOLUTIONTYPE_TOR_CHANGE||d.MaterialShortageSolutionType===e.SOLUTIONTYPE_TOR_INCREASE||d.MaterialShortageSolutionType===e.SOLUTIONTYPE_TOR_RESCHEDULE)&&!d.SupplyingPlant){return"SOLUTION_DIALOG_MSG_SUPPLYING_PLANT_MISSING_TO"}var o=this.oModelGlobal;var s={};var g=d.MRPElementChgAvailyOrRqmtDate;s.ItemID=M;s.ScheduleLineID=f;if(!g){s.DeliveryDate=" "}else{s.DeliveryDate=D.format(g)+"T00:00:00"}s.PurchasingDocumentOrderQty=this.replaceEmptyValues((c).toString());var a=new Array();a.push(s);var i={};i.ItemID=M;i.MaterialGoodsReceiptDuration=this.replaceEmptyValues(d.MaterialGoodsReceiptDuration);i.PurchaseRequisition=this.replaceEmptyValues(d.MRPElement);i.PurchaseRequisitionItem=M;i.MMPurchaseOrderScheduleLines=a;var b=new Array();b.push(i);var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_MM_PO_HEADER;var H={};if(d.MaterialShortageSolutionType===e.SOLUTIONTYPE_TOR_CHANGE||d.SolutionTyp===e.SOLUTIONTYPE_TOR_INCREASE||d.SolutionTyp===e.SOLUTIONTYPE_TOR_RESCHEDULE){H.StockTransportOrderIndicator=true}else{H.StockTransportOrderIndicator=false}H.MMPurchaseOrderItems=b;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_CREATE;var j=o.createBatchOperation(u,O,H,null);C.push(j);o.addBatchChangeOperations(C);o.submitBatch(h.fnSuccess,h.fnError,false);return""},onCRPressed:function(e){var s=e.getSource();var c=s.getBindingContext();var S=c.getObject();return this.navToCRApp(S)},navToCRApp:function(c){var e="";var d="";var p=({"MaterialID":c.Material,"SupplyingPlant":c.BusinessPartnerPlant,"MRPElementCategory":c.MRPElementCategory,"MRPElement":c.MRPElement,"MRPElementItem":c.MRPElementItem,"MRPElementScheduleLine":c.MRPElementScheduleLine,"SolutionRequestStatus":c.SolutionRequestStatus,"Vendor":c.Vendor});var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var C=f&&f("CrossApplicationNavigation");if(C){var h=i2d.pp.mrpcockpit.reuse.util.CommonConstants.NavToCR;var P=sap.ushell.Container.getService("Personalization");var s=h;if(P.getContainer){P.getContainer(s,{validity:i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME}).fail(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();jQuery.sap.log.error("Loading personalization data failed.")}).done(function(o){o.setItemValue("Navigation",p);o.save().done(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();C.toExternal({target:{semanticObject:"MRPChangeRequest",action:"manage"},params:{"navigationID":h}})}.bind(this))}.bind(this))}else{e=this.oResourceBundle.getText("messNoLaunchpad");return e}}},navToPOApp:function(p){if(p){var P=p.MRPElement;var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var c=f&&f("CrossApplicationNavigation");if(c){c.toExternal({target:{shellHash:"PurchaseOrder-manage&/managePO/DISPLAY_PO/"+P}})}}},navToSOApp:function(s){var p={FPM_START_PAGE_ID:"START",MODE:3,BO_KEY:s.MRPElement};if(s){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var c=f&&f("CrossApplicationNavigation");if(c){c.toExternal({target:{semanticObject:"SalesOrder",action:"maintainSFSWebClient"},params:p})}}},_keyGen:function(){return jQuery.sap.uid()},_buildUrlForChangeRequestUpdate:function(d){var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUEST;u+="(guid'";u+=d.MaterialShortageSolnRequest;u+="')";return u},_adaptItemIdForMM:function(i){var I=i;if(I.length>5){I=I.substring(1)}return I},updateChangeRequestDocumentsBatch:function(c,h){var C=new Array();var o=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var d=this.oModelGlobal;d.setUseBatch(true);d.clearBatch();for(var i=0;i<c.length;i++){var I=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_CHANGEREQUEST;I+="(guid'";I+=c[i].MaterialShortageSolnRequest;I+="')";var e={};e.SolutionRequestStatus=i2d.pp.mrpcockpit.reuse.util.CommonConstants.REQUEST_STATUS_REQUESTED;var p={};p.sETag="W/\"'"+c[i].ChangeStateID+"'\"";var b=d.createBatchOperation(I,o,e,p);d.addBatchChangeOperations([b])}d.submitBatch(h.fnSuccess,h.fnError,false);return""},updatePlannedOrderBatch:function(d,h){var c=new Array();var D=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd"});var o=this.oModelGlobal;o.setUseBatch(true);o.clearBatch();if(!d.MRPElement||!d.MRPElementItem||!d.MaterialShortageSolutionType||!d.MaterialID||!d.OrderFinishDate||!d.ChangedOrderFinishDate||!d.MRPElementOriginalTotalQty||!d.MRPElementChangedTotalQuantity){return"SOLUTION_DIALOG_MSG_MANDATORY_KEY_DATA_MISSING"}var i=this._adaptItemIdForMM(d.MRPElementItem);var p=false;var P=false;if((d.OrderFinishDate===d.ChangedOrderFinishDate)&&(d.MRPElementOriginalTotalQty===d.MRPElementChangedTotalQuantity)){p=false}else{p=true};if(d.DialogActivity===i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_EXECUTE){P=false}else{P=true};var u=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ODATA_ENTITYSET_QUICKVIEWS;u+="(MRPElement='";u+=d.MRPElement;u+="',MRPElementItem='";u+=i;u+="',MRPElementScheduleLine='";u+=d.MRPElementScheduleLine;u+="',MRPElementCategory='";u+=d.MRPElementCategory;u+="')";if(p===true){d.QuickviewCategory=i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.CHANGE_PLANORD;var e={};e.MRPElement=d.MRPElement;var a=d.ChangedOrderFinishDate;e.OrderFinishDate=D.format(a)+"T12:00:00";e.TotalQuantity=(d.MRPElementChangedTotalQuantity).toString();e.QuickviewCategory=d.QuickviewCategory;e.PlannedOrder=d.PlannedOrder;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var C=o.createBatchOperation(u,O,e,null);c.push(C);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,false)};var c=[];o.clearBatch();if(P===true){switch(d.DialogActivity){case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_EXECUTE:d.QuickviewCategory=i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.CHANGE_PLANORD;break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_REQ_CONVERT:d.QuickviewCategory=i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.CONV_REQ;break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_PROC_CONVERT:d.QuickviewCategory=i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.CONV_PROC;break;case i2d.pp.mrpcockpit.reuse.util.CommonConstants.SolutionDialogActivity_PROD_CONVERT:d.QuickviewCategory=i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT.CONV_PROD;break};var e={};e.MRPElement=d.MRPElement;var a=d.ChangedOrderFinishDate;e.OrderFinishDate=D.format(a)+"T12:00:00";e.TotalQuantity=(d.MRPElementChangedTotalQuantity).toString();e.QuickviewCategory=d.QuickviewCategory;e.PlannedOrder=d.PlannedOrder;var O=i2d.pp.mrpcockpit.reuse.util.CommonConstants.CRUD_UPDATE;var C=o.createBatchOperation(u,O,e,null);c.push(C);o.addBatchChangeOperations(c);o.submitBatch(h.fnSuccess,h.fnError,false)};return""}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.AoRHandler')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.AoRHandler");i2d.pp.mrpcockpit.reuse.view.AoRHandler={i18NCommonReuseModel:new sap.ui.model.resource.ResourceModel({bundleUrl:jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties"}),openOnboardingDialog:function(e,s,c,C){this.openAoRMainDialog(e,true,s,c,null,false,C)},openFirstOnboardingDialog:function(s,c,C){this.openAoRWelcomeDialog(null,s,c,C)},openAoRAddDialog:function(e,s,c,a,C,o){var b=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var B=new sap.ui.model.resource.ResourceModel({bundleUrl:b});var S=function(E){var v=E.getParameter("value");var F=new sap.ui.model.Filter("MRPControllerName",sap.ui.model.FilterOperator.Contains,v);var h=E.getSource().getBinding("items");h.filter([F])};var t=this;var f=function(E){if(E){this.openAoRMainDialog(E,false,s,c,a,C,o)}}.bind(this);var d=function(E){if(E){if(C){var h=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNav=h&&h("CrossApplicationNavigation");var j=(this.oCrossAppNav&&this.oCrossAppNav.toExternal({target:{shellHash:"#"}}))||""}else{if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED)}}}}.bind(this);this.oMRPSDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRAddDialog",type:sap.ui.core.mvc.ViewType.XML});var D=this.oMRPSDialogView.byId("DLG_SELECT");var g={closeFunction:d,confirmFunction:f};D._list.setShowNoData(false);D._list.removeSelections(true);o.getView().addDependent(D);D.open();var m=new sap.ui.model.json.JSONModel(g);D.setModel(m);D.setModel(B,"commondialogs_i18n");D.setTitle(D.getModel('commondialogs_i18n').getResourceBundle().getText("DIALOG_SELECT"));D.setModel(s,"items");var i=D.getBinding("items");if(i.aFilters.length!=0){D.getBinding("items").filter([])}},openAoRMainDialog:function(e,r,s,c,a,C,o){var b=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var B=new sap.ui.model.resource.ResourceModel({bundleUrl:b});var t=this;if(!a){a=[]}this.oSelModel=s;this.oSelectedItemsJSON=new sap.ui.model.json.JSONModel();jQuery.sap.require("sap.m.MessageToast");if(r){s.read("/MRPControllers",null,{"$filter":"(AreaOfResponsibility eq true)"},true,function(p,R){t.oSelectedItemsJSON.setData({data:p.results});a=p.results})}else{this.oSelectedItems=[];this.oSelectedItems=e.getParameter("selectedContexts");if(this.oSelectedItems){for(var i=0;i<this.oSelectedItems.length;i++){var f=false;for(var j=0;j<a.length;j++){var T=this.oSelectedItems[i].getObject();if(a[j].MRPControllerID===T.MRPControllerID&&a[j].MRPPlant===T.MRPPlant){f=true;break}}if(!f){a.push(this.oSelectedItems[i].getObject())}}this.oSelectedItemsJSON.setData({data:a})}}var d=function(R){if(C){var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNav=p&&p("CrossApplicationNavigation");var q=(this.oCrossAppNav&&this.oCrossAppNav.toExternal({target:{shellHash:"#"}}))||""}else{if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED)}}n()}.bind(this);var O=function(e){if(e){t.openAoRAddDialog(e,t.oSelModel,c,a,C,o)}};var g=function(e){if(e){t.sendAoRtoBackend(e,t.oSelectedItemsJSON,c,t.sSuccessMessage,s);n()}};this.oMRPAORDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRMainDialog",type:sap.ui.core.mvc.ViewType.XML});var D={closeFunction:d,addFunction:O,confirmFunction:g};var h=new sap.m.Button({press:g,text:""});var k=new sap.m.Button({press:d,text:""});var l=sap.ui.getCore().byId("DLG_AOR_ID");if(l!==undefined){l.removeAllContent();l.destroy()}l=new sap.m.Dialog("DLG_AOR_ID",{content:[this.oMRPAORDialogView],title:"",beginButton:h,endButton:k});var m=new sap.ui.model.json.JSONModel(D);l.setModel(m);l.setModel(this.oSelectedItemsJSON,"items");l.setModel(B,"commondialogs_i18n");l.getBeginButton().setText(l.getModel('commondialogs_i18n').getResourceBundle().getText("BUTTON_OK"));l.getEndButton().setText(l.getModel('commondialogs_i18n').getResourceBundle().getText("BUTTON_CANCEL"));l.setTitle(l.getModel('commondialogs_i18n').getResourceBundle().getText("DIALOG_AOR"));var n=function(e){l.close()};this.sSuccessMessage=l.getModel('commondialogs_i18n').getResourceBundle().getText("SEND_AOR_SUCCESS_MSG");o.getView().addDependent(l);l.open()},openAoRWelcomeDialog:function(e,s,c,C){var a=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:a});var f=function(r){};var t=this;var o=function(E){if(E){t.openAoRAddDialog(E,s,c,null,true,C)}};this.oMRPWLCDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPWLCDialogView.byId("DLG_WLC");var D={title:b.getResourceBundle().getText("DIALOG_WELCOME"),text:b.getResourceBundle().getText("DIALOG_WELCOME_TEXT"),closeFunction:f,fnOpenAoRAddDialog:o};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);d.setModel(b,"commondialogs_i18n");C.getView().addDependent(d);d.open()},sendAoRtoBackend:function(e,s,c,a,m){var M=[];if(s){for(var i=0;i<s.oData.data.length;i++){var o={};o.MRPPlant=s.oData.data[i].MRPPlant;o.MRPControllerID=s.oData.data[i].MRPControllerID;M.push(o)}}var A={};A.AreaOfResponsibility_To_MRPControllers=M;m.create('/AreasOfResponsibility',A,null,function(){jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(a);if(c){c()}},function(){if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_FAILED)}})}}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.S3parent')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.S3parent');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseDetailController.extend("i2d.pp.mrpcockpit.reuse.view.S3parent",{constructor:function(){sap.ca.scfld.md.controller.BaseDetailController.apply(this,arguments);var o=this.onInit;this.onInit=function(){var b=new sap.ui.model.resource.ResourceModel({bundleName:"i2d.pp.mrpcockpit.reuse.i18n.i18n"});var v=this.oApplicationImplementation.getApplicationModel("ServiceVersions");this.getView().setModel(v,"ServiceVersions");this.getView().setModel(b,"Common_i18n");o.apply(this,arguments)}},onInit:function(){var s=this.getView().byId("SDItems");var t=s.getItems()[0];s.removeItem(t);s.bindAggregation("items",this.getDetailListNavProperty(),function(i,C){var o=t.clone(i);var v=parseFloat(C.getProperty("MRPAvailableQuantity"));var a=parseFloat(C.getProperty("MaterialShortageCriticalQty"));var b=parseFloat(C.getProperty("MaterialShortageThresholdQty"));var O=C.getObject();o.removeStyleClass("sapMRPShortage");o.removeStyleClass("sapMRPShortageSolved");o.removeStyleClass("sapMRPElementChanged");o.removeStyleClass("sapMRPShortageAccepted");o.removeStyleClass("sapMRPShortageSafetyStock");if(O.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED){o.addStyleClass("sapMRPShortageAccepted")}else{if(O.ChangedMrpElement&&O.ChangedMrpElement===true){o.addStyleClass("sapMRPElementChanged")}else if((v<b)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){o.addStyleClass("sapMRPShortage")}else if((v<a)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){o.addStyleClass("sapMRPShortageSafetyStock")}else if((v>=a)&&(O.InitialShortage&&O.InitialShortage===true)){o.addStyleClass("sapMRPShortageSolved")}}return o});var p=this.getView().getContent()[0];p.setShowNavButton(jQuery.device.is.phone);this.oRouter.attachRoutePatternMatched(this._onRoutePatternMatched,this);this.initChart();this.resizeHandlerParent=[];this.resizeHandlerPage=[];this.resizeTimer=[];this.isChartVisible=false;this.oApplicationFacade.registerOnMasterListRefresh(this.onMasterRefresh,this);if(!sap.ui.Device.system.desktop){var f=this.getView().byId("factSheetButton");if(f!==undefined){f.setVisible(false)}}var c=null;c=this.oApplicationFacade.getApplicationModel("changedItems");if(!c){c=new sap.ui.model.json.JSONModel();this.oApplicationFacade.setApplicationModel("changedItems",c)}},_subscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.subscribe(i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_OK,this._onDataChanged,this)},_unsubscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.unsubscribe(i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_OK,this._onDataChanged,this)},_onDataChanged:function(c,e,d){if(d&&d.model.cardModel){var m;if(d.model.cardModel.oData.msg){m=d.model.cardModel.oData.msg}else{m="Data has been saved."}sap.ca.ui.message.showMessageToast(m);this.refreshSDList()}},onMasterRefresh:function(e){if(e.getParameter("bManualRefresh")===true){if(e.getParameter("bAutoNavigation")===true){}else{this.refreshSDList();this._changeModel()}}else{}if(this.sdItemHighlightingNeeded){this._highlightSdItemTableRecord.call(this)}},_highlightSdItemTableRecord:function(){var s=this.getView().byId("SDItems");var b=s.getBindingContext();var o=b.getObject();if(o!==undefined){var I=s.getItems();var a=null;var i;for(i=0;i<I.length;i++){a=I[i].getBindingContext().getObject();if(this.compareKeys(a,o)){I[i].addStyleClass("sapMRPSDItemSelected")}else{I[i].removeStyleClass("sapMRPSDItemSelected")}}}},_onRoutePatternMatched:function(e){var v=this.getView();if(e.getParameter("name")===i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL){v.getModel().detachRequestCompleted(this._onModelLoaded,this);v.getModel().attachRequestCompleted(this._onModelLoaded,this);this._unsubscribeEvents();this._subscribeEvents();var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c);var m=this.getView().byId("infoTabContainer");if(m!==undefined){m.bindElement('/'+e.getParameter("arguments").contextPath+'/'+this.getInfoTabNavProperty())}this.navParameter=e.getParameter("arguments");for(var i in this.navParameter){this.navParameter[i]=decodeURIComponent(this.navParameter[i])}this._changeModel()}else{this._unsubscribeEvents();v.getModel().detachRequestCompleted(this._onModelLoaded,this);i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.destroyQuickViews(this)}},navToSolutionView:function(d){var b=this.getView().getBindingContext().getObject();var n={};var m=this.oApplicationFacade.oApplicationImplementation.aMasterKeys;for(var i in m){if(b[m[i]]!==""){if(!(b[m[i]]instanceof Date)){n[m[i]]=b[m[i]]}else{n[m[i]]=b[m[i]].toISOString().slice(0,-5)}}else{n[m[i]]=" "}}var c=this.getView().byId("chart");n.ChartScrollPos=(c)?c.getShiftLeft():0;var C=this.getView().byId("chartContainer");n.DisplayInChart=(C.getVisible())?true:false;n.stateID=this.navParameter.stateID;n.DetailListNavProperty=this.getDetailListNavProperty();var r;var a=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(a===1){r=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.SUB_DETAIL_WAVE3;var s=i2d.pp.mrpcockpit.reuse.util.Wave3Helper.calcShortagePeriod.call(this,d);if(!s.firstDate||!s.lastDate||!s.shortageItem){return}n.MaterialShortageStartDate=s.firstDate.toISOString().slice(0,-5);n.MaterialShortageEndDate=s.lastDate.toISOString().slice(0,-5)}else{r=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.SUB_DETAIL;n.SelectedSupDemItemDate=d.toISOString().slice(0,-5)}for(var e in n){n[e]=encodeURIComponent(n[e])}var R=!jQuery.device.is.phone;this.oRouter.navTo(r,n,R)},selectShortage:function(e){var t=e.getSource();var c=t.getBindingContext();var s=c.getObject();var d=s.MRPElementAvailyOrRqmtDate;if(d){this.navToSolutionView(d)}},selectShortageInChart:function(e){var E=e.getParameter("date");if(E){this.navToSolutionView(E)}},_onModelLoaded:function(e){var u=e.getParameter("url");var i=u.indexOf("QuickViews");if(i>=0){var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var E=e.getParameter("errorobject");if(E){var b=this.getView().getModel("Common_i18n").getResourceBundle();var s=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,E.responseText);s=s.replace("@QuickView@","");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:s});return}else{var q=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewFragment(m.MRPElementCategory);var a=this._oQuickViewContainer[q];var c=a.getBindingContext().getObject();var d=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility(c.SolutionRequestStatus);var f=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.isEditAllowed(c.QuickviewCategory);var g=a.getBeginButton();if(g){if(d){if(this._isNavToCrAppAllowed()){g.setProperty("icon","sap-icon://request");g.setProperty("visible",f)}else{g.setProperty("visible",false)}}else{g.setProperty("icon","sap-icon://edit");g.setProperty("visible",f)}}else{if(f&&this.getView().sViewName!=="i2d.pp.changerequest.details.view.S4"){a.getFooter().getContent()[0].setVisible(true)}}a.openBy(this._oSelectedMRPElementItem);return}}var S=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(S===1){i2d.pp.mrpcockpit.reuse.util.Wave3Helper.determineAndWriteSafetyStock(this.getView())}this.writeDetailListTitle();var D=false;var h=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);var o=this.getView().byId("SDItems");if(o){var j=o.getItems();for(var k=0 in j){var l=j[k].getBindingContext().getObject();if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.allowSolutionNavigation(l.MRPAvailability,l.MRPElementCategory,l.DecisionSupport,h)===true){D=true;break}}}var C=this.getView().byId("chart");C.setProperty("allowNavigation",D,true);this.setChartData();if(this.sdItemHighlightingNeeded){this._highlightSdItemTableRecord.call(this)}},writeDetailListTitle:function(){var t;var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(b===1){if(this.getDetailListTitle){t=this.getDetailListTitle()}else{return}}else{var s=0;var l=0;var I=[];var o;var S=this.getView().byId("SDItems");if(S){I=S.getItems();if(I&&I.length){l=I.length}}var i;for(i=0;i<l;i++){o=I[i].getBindingContext().getObject();if(o.ShortageCount>s){s=o.ShortageCount}}var B=this.getView().getModel("Common_i18n").getResourceBundle();t=B.getText("DETAIL_LIST_TITLE",[s])}var T=this.getView().byId("panel").getHeaderToolbar();if(T){T.getContent()[0].setTitle(t)}},switchToChart:function(){this.isChartVisible=true;this.getView().byId("chartContainer").setVisible(true);this.getView().byId("SDItems").setVisible(false)},switchToTable:function(){this.isChartVisible=false;this.getView().byId("chartContainer").setVisible(false);this.getView().byId("SDItems").setVisible(true)},onToolbarIconSelect:function(e){var s=e.getSource();var b=s.getSelectedButton();if(b.match("btnChart")){this.switchToChart()}else{this.switchToTable()}},initChart:function(){var c=this.getView().byId("chart");c.attachSelected(this.selectShortageInChart,this);this.oChartModel=new sap.ui.model.json.JSONModel();this.oChartModel.setSizeLimit(10000);c.setModel(this.oChartModel);var C=new i2d.pp.mrpcockpit.reuse.controls.ChartValue({date:"{date}",demand:"{demand}",supply:"{supply}",shortageAccepted:"{shortageAccepted}"});c.setProperty("height","300px",true);c.setProperty("width","100%",true);var n=this.getView().getModel("Common_i18n").getResourceBundle().getText("NO_NAVIGATION_TO_SOLUTION");c.setProperty("noNavigationText",n,true);var b=this.getView().getModel("Common_i18n").getResourceBundle().getText("XTOL_BAL_DOT");c.setProperty("balanceDotTooltip",b);c.bindProperty("shiftLeft","/shiftLeft");c.bindProperty("unitDecimals","/decimals");c.bindProperty("startBalance","/startBalance");c.bindProperty("minStock","/minStock");c.bindProperty("safetyStock","/safetyStock");c.bindValues("/chartData",C)},setChartData:function(){var v=this.getView();var d=v.getModel().oData;var c=new i2d.pp.mrpcockpit.reuse.util.CalculationEngine(v.getModel("Common_i18n"));var r=[];var t=this.byId("SDItems");var I=(t)?t.getItems():[];var l=(I&&I.length)?I.length:0;for(var i=0;i<l;i++){var o=d[I[i].getBindingContext().getPath().slice(1)];r.push(o)}var m=c.initialChartData(r,this.dateStart,this.dateEnd,0);this.oChartModel.setData(m)},navToMM02:function(c){var m=this.getView().getBindingContext().getObject().MaterialID;var s="MRPMaterial";var a="changeMaterial";var p={"Material":m};i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToMD04:function(c){var m=this.getView().getBindingContext().getObject();var a=m.MaterialID;var b=m.MRPArea;var p=m.MRPPlant;var s="MRPMaterial";var d="showStockRequirementsList";var e={"Material":a,"MRPPlant":b,"MRPArea":p};i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,d,e)},navToTransaction:function(e){var d=e.getSource().getBindingContext().getObject();var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSemanticObject(d.QuickviewCategory);var a=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getTransactionAction(d.QuickviewCategory);var p=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getNavigationParameter(d.QuickviewCategory,d.MRPElement,' ',d.PlannedOrder);i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToFactsheet:function(e){var d=e.getSource().getBindingContext().getObject();var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSemanticObject(d.QuickviewCategory);var a=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getFactsheetAction(d.QuickviewCategory);var p=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getNavigationParameter(d.QuickviewCategory,d.MRPElement,d.MRPElementItem,d.PlannedOrder);i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToPODestination:function(e){var p=e.getSource().getBindingContext().getObject();var v=this.getView().getModel('ServiceVersions').getData().iServiceSchemaVersion;if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToPOApp(p)}else{this.navToTransaction(e)}},navToSODestination:function(e){var s=e.getSource().getBindingContext().getObject();var v=this.getView().getModel('ServiceVersions').getData().iServiceSchemaVersion;if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToSOApp(s)}else{this.navToTransaction(e)}},openFactSheetActionSheet:function(e){if(!this._actionSheet){this._actionSheet=new sap.m.ActionSheet({title:"",showCancelButton:false,placement:sap.m.PlacementType.Top,buttons:[new sap.m.Button({icon:"sap-icon://popup-window",text:"{Common_i18n>MD04}",press:jQuery.proxy(this.navToMD04,this)}),new sap.m.Button({icon:"sap-icon://popup-window",text:"{Common_i18n>MM02}",press:jQuery.proxy(this.navToMM02,this)})]});this._actionSheet.setModel(this.getView().getModel("Common_i18n"),"Common_i18n")}this._actionSheet.openBy(e.getSource())},onExit:function(){if(this._actionSheet){this._actionSheet.destroy()}this._unsubscribeEvents();this.removeHandler();this.oApplicationFacade.deRegisterOnMasterListRefresh(this.onMasterRefresh,this);this.getView().getModel().detachRequestCompleted(this._onModelLoaded,this);this.oRouter.detachRoutePatternMatched(this._onRoutePatternMatched,this);i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.destroyQuickViews(this)},removeHandler:function(){if(this.resizeHandlerParent.length>=0){for(var i in this.resizeHandlerParent){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerParent[i])}this.resizeHandlerParent=[]}if(jQuery.device.is.desktop){if(this.resizeHandlerPage.length>=0){for(var j in this.resizeHandlerPage){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerPage[j])}this.resizeHandlerPage=[]}}else{sap.ui.Device.orientation.detachHandler(this.onResize,this);sap.ui.Device.resize.detachHandler(this.onResize,this)}if(this.resizeTimer.length>=0){for(var k in this.resizeTimer){jQuery.sap.clearDelayedCall(this.resizeTimer[k])}this.resizeTimer=[]}},resize:function(r){i2d.pp.mrpcockpit.reuse.util.Helper.resizeUiControls(this,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S3)},onResize:function(r){if(this.resizeTimer[r]){jQuery.sap.clearDelayedCall(this.resizeTimer[r])}this.resizeTimer[r]=jQuery.sap.delayedCall(200,this,jQuery.proxy(this.resize,this,r))},onBeforeRendering:function(){this.removeHandler()},onAfterRendering:function(){this._registerResizeHandler("mainPage-cont")},selectIconTabBarSelect:function(e){var r=e.getParameter("key");if("supDemItemsTab"==r){this.onResize()}},_registerResizeHandler:function(r){var p=null;var a=null;this.onResize();var n=jQuery("#"+this.getView().getId()+"--"+r);if(n&&n.length){if(r=='mainPage-cont'){p=n}else{p=n.parent()}a=p;while((a.length!=0)&&!(a.attr('id')==this.getView().getId()+"--"+"mainPage-cont")){a=a.parent()}if(p){this.resizeHandlerParent[r]=sap.ui.core.ResizeHandler.register(p[0],jQuery.proxy(this.onResize,this,r))}if(jQuery.device.is.desktop){if(a){this.resizeHandlerPage[r]=sap.ui.core.ResizeHandler.register(a[0],jQuery.proxy(this.onResize,this,r))}}else{sap.ui.Device.orientation.attachHandler(this.onResize,this,r);sap.ui.Device.resize.attachHandler(this.onResize,this,r)}}},onItemsUpdateStarted:function(e){var s=this.getView().byId("SDItems");var i=this.getView().getModel("Common_i18n");if(i&&s){s.setNoDataText(i.getResourceBundle().getText("tableUpdateStarted"))}},onItemsUpdateFinished:function(e){var s=e.getSource();var i=s.getItems();if(!i||i.length===0){var a=this.getView().byId("SDItems");var b=this.getView().getModel("Common_i18n");if(b&&a){a.setNoDataText(b.getResourceBundle().getText("tableUpdateFinished"))}}},onClickChangeRequest:function(e){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.onCRPressed(e);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}},handlePressDispoElementQuickView:function(e){i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.handlePressDispoElementQuickView(e,this)},handleCloseButton:function(e){var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var q=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewFragment(m.MRPElementCategory);var a=this._oQuickViewContainer[q];a.close()},_isNavToCrAppAllowed:function(){return true},handleEditButton:function(e){var q=e.getSource().getBindingContext().getObject();var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var c=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility(q.SolutionRequestStatus);if(this._isNavToCrAppAllowed()&&c){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToCRApp(q,m);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}}else{var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSolutionType(q.QuickviewCategory);var v=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getEditFragment(q.QuickviewCategory);var Q=new sap.ui.model.json.JSONModel({ContactPersonName:q.ContactPersonName,ContactPersonEmailAddress:q.ContactPersonEmailAddress,ContactPersonPhoneNumber:q.ContactPersonPhoneNumber,IntContactPersonName:q.IntContactPersonName,IntContactPersonEmailAddress:q.IntContactPersonEmailAddress,IntContactPersonTelephone:q.IntContactPersonTelephone,MaterialShortageSolutionType:s,MRPElementAvailyOrRqmtDate:q.MRPElementPlndDeliveryDate,MRPElementChgAvailyOrRqmtDate:q.MRPElementPlndDeliveryDate,MRPElementOpenQuantity:m.MRPElementOpenQuantity,MRPElementChangeOpenQuantity:m.MRPElementOpenQuantity,MaterialGoodsReceiptDuration:q.MaterialGoodsReceiptDuration,AvailabilityDate:q.MRPElementPlndDeliveryDate,ChangedAvailabilityDate:q.MRPElementPlndDeliveryDate,OrderFinishDate:q.OrderFinishDate,ChangedOrderFinishDate:q.OrderFinishDate,MRPElementOriginalTotalQty:q.TotalQuantity,MRPElementChangedTotalQuantity:q.TotalQuantity,OrderedQuantity:q.OrderedQuantity,OrderedChangedQuantity:q.OrderedQuantity,SupplyingPlant:q.BusinessPartnerPlant,Vendor:q.Vendor,VendorName:q.VendorName,TargetQuantityUnitDcmls:q.TargetQuantityUnitDcmls,OrderUnitOfMeasureTechnicalName:q.UnitOfMeasureTechnicalName,MaterialID:m.MaterialID,MRPPlant:q.MRPPlant,MRPArea:m.MRPArea,MRPPlanningSegmentType:m.MRPPlanningSegmentType,MRPPlanningSegmentNumber:m.MRPPlanningSegmentNumber,MRPElement:q.MRPElement,MRPElementCategory:q.MRPElementCategory,MRPElementExternalID:q.MRPElementExternalID,MRPElementItem:q.MRPElementItem,MRPElementItemExternalID:q.MRPElementItemExternalID,MRPElementScheduleLine:q.MRPElementScheduleLine,MRPController:q.MRPController,MRPControllerName:q.MRPControllerName,SolutionRequestNote:q.SolutionRequestNote,SolutionRequestStatus:q.SolutionRequestStatus,VendorResponse:"",MaterialShortageProfile:m.MaterialShortageDefinitionID.substring(0,12),MaterialShortageProfileCount:m.MaterialShortageDefinitionID.substring(12,15),MaterialShortageDefinitionID:m.MaterialShortageDefinitionID,ChangeStateID:q.ChangeStateID,QuickviewCategory:q.QuickviewCategory,PlannedOrder:q.PlannedOrder,ProductionSupervisor:q.ProductionSupervisor,ProductionSupervisorDesc:q.ProductionSupervisorDesc,BusinessPartnerPlant:q.BusinessPartnerPlant,BusinessPartnerPlantName:q.BusinessPartnerPlantName,VendorIsFixed:q.VendorIsFixed});var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.setODataModel(this.getView().getModel(),b);i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.setODataModel(this.getView().getModel(),b);var a=sap.ui.controller(v);var d=sap.ui.xmlfragment(v,a);d.setModel(this.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");d.setModel(this.getView().getModel("Common_i18n"),"Common_i18n");var o=new sap.ui.model.json.JSONModel(i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT);d.setModel(o,"QuickEditConstantsModel");d.setModel(Q);d.open()}},refreshSDList:function(){var c=this.getView().getBindingContext();this.getView().setBindingContext(null);this.getView().setBindingContext(c)},_changeModel:function(){var v=this.getView();var c=this.oApplicationFacade.getApplicationModel("changedItems");if(!c){return}var u=new Array();u=this._changeModelAppSpecific();for(var i=0;i<u.length;i++){var U=v.byId(u[i]);if(!U){continue}var C=null;if(v&&v.getBindingContext()){C=v.getBindingContext().getPath()}if(c.getProperty(C)){U.setModel(c);U.bindElement(C)}else{U.setModel();U.unbindElement()}}},_changeModelAppSpecific:function(){return["objectHeader"]},runMRP:function(){var d=this.getView().getModel();d.setUseBatch(true);d.clearBatch();var m=this.getView().getModel("Common_i18n");var b=m.getResourceBundle();var o=this.getView().byId("objectHeader");var B=o.getBindingContext();var o=B.getObject();var u="/RunMRP?MaterialID='";u+=o.MaterialID;u+="'&MRPPlant='";u+=o.MRPPlant;u+="'";d.addBatchChangeOperations([d.createBatchOperation(u,"POST")]);d.submitBatch(function(r,R,e){if(e.length>0){var E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromBatchResponse(b,e);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("MRP_RUN_ERRORS"),details:E})}else{d.refresh();sap.m.MessageToast.show(b.getText("MRP_RUN_COMPLETED"))}},function(e){var E="";if(e&&e.response&&e.response.body){E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,e.response.body)}else{E=""}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("MRP_RUN_ERRORS"),details:E})},false)}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.S4parent')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.S4parent');jQuery.sap.require('sap.ca.scfld.md.controller.BaseDetailController');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Date');sap.ca.scfld.md.controller.BaseDetailController.extend("i2d.pp.mrpcockpit.reuse.view.S4parent",{constructor:function(){sap.ca.scfld.md.controller.BaseDetailController.apply(this,arguments);var o=this.onInit;this.onInit=function(){var b=new sap.ui.model.resource.ResourceModel({bundleName:"i2d.pp.mrpcockpit.reuse.i18n.i18n"});this.getView().setModel(b,"Common_i18n");var v=this.oApplicationImplementation.getApplicationModel("ServiceVersions");this.getView().setModel(v,"ServiceVersions");o.apply(this,arguments)}},onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);var p=this.getView().getContent()[0];p.setShowNavButton(true);this.initChart();this.resizeHandler=null;this.resizeTimer=null;this.isChartVisible=false;this._initialOffset=67;this.view=this.getView();this.oModel=this.view.getModel();this.oCollaborationDialog=null;this.oModel.setRefreshAfterChange(false);var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.setODataModel(this.oModel,b);i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.setODataModel(this.oModel,b);this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;this._setCrIconClickStatus();var c=this.getView().byId("shortages");var B=new Object();B.path="SupDemItem";if(b===1){B.factory=i2d.pp.mrpcockpit.reuse.util.Wave3Helper._getListTemplate}else{B.factory=this._getListTemplate}c.bindAggregation("items",B);this.oTableModel=new sap.ui.model.json.JSONModel();c.setModel(this.oTableModel);this.oRouter.attachRoutePatternMatched(this._onRoutePatternMatched,this);var l=this.getView().byId("oDataBindingServantItem");this.oTemplate=jQuery.extend({},l);this.oApplicationFacade.registerOnMasterListRefresh(this.onMasterRefresh,this);this.oNullModel=null},_setCrIconClickStatus:function(){this._bCrIconClickable=false},_onModelLoaded:function(e){if(e.getParameter("url").indexOf("PPMRPSolHeaders")===0){jQuery.sap.log.info("S4: Model loaded");var v=this.getView();var b=null;var i=v.byId("oDataBindingServant").getItems()[0];if(i){b=i.getBindingContext()}if(b){v.setBindingContext(b);var a=b.getObject();this.dateStart=a.MaterialShortageStartDate.toISOString().slice(0,-5);this.dateEnd=a.MaterialShortageEndDate.toISOString().slice(0,-5)}if(this.isChartVisible){this.switchToChart(false)}else{this.switchToTable(false)}this._displayChangeRequestWarning(a.ChangeRequestExists);this._updateSolutionCards(v)}},_subscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,this.onDialogOk,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_RUN,this._previewRun,this);b.subscribe(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_CANCEL,this._previewCancel,this);b.subscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_EXECUTE,this.onSolutionCardExecute,this)},_unsubscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,this.onDialogOk,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_RUN,this._previewRun,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_PREVIEW,this.Constants.EVENT_EVENTID_CANCEL,this._previewCancel,this);b.unsubscribe(this.Constants.EVENT_CHANNELID_SOLCARD,this.Constants.EVENT_EVENTID_EXECUTE,this.onSolutionCardExecute,this)},_onRoutePatternMatched:function(e){if(e.getParameter("name")===this.Constants.ROUTING.SUB_DETAIL||e.getParameter("name")===this.Constants.ROUTING.SUB_DETAIL_WAVE3){this.oModel.attachRequestCompleted(this._onModelLoaded,this);this._unsubscribeEvents();this._subscribeEvents();var c=this.getView().byId("cards");c.setMaterialShortageHasNoSolution(false);c.removeCards();var a=this.getView().byId("shortages");var m=a.getModel();m.setData(null);this._oCard=null;this.navParameter=e.getParameter("arguments");for(var i in this.navParameter){this.navParameter[i]=decodeURIComponent(this.navParameter[i])}if(e.getParameter("name")===this.Constants.ROUTING.SUB_DETAIL_WAVE3){this.dateStart=this.navParameter.MaterialShortageStartDate;this.dateEnd=this.navParameter.MaterialShortageEndDate}else{this.dateStart=this.navParameter.SelectedSupDemItemDate;this.dateEnd=null}this.chartScrollPos=parseInt(this.navParameter.ChartScrollPos);this._readSolutionViewData(false,null);this.requestChartData();var s=this.getView().byId("sapMrpS4ToolbarIcons");var d=this.navParameter.DisplayInChart;if(d==="true"){this.isChartVisible=true;s.setSelectedButton(this.getView().byId("btnChart"))}else{this.isChartVisible=false;s.setSelectedButton(this.getView().byId("btnTable"))}}else{this._unsubscribeEvents();this.oModel.detachRequestCompleted(this._onModelLoaded,this);this._hideChartContainer();var v=this.getView();v.setBindingContext(this.oNullModel);var I=this.getView().byId("infoToolBarCR");if(I){I.setVisible(false)}}},_getPathDetailView:function(){var m="";var s="";var a=this.oApplicationFacade.oApplicationImplementation.oConfiguration.getServiceList();for(var i in a){if(a[i].isDefault===true){m=a[i].masterCollection;s=a[i].serviceUrl}}var b=this.oApplicationFacade.oApplicationImplementation.aMasterKeys;var c=this.getView().getModel().getServiceMetadata().dataServices.schema;var d=new Array();for(var e in c){if(s.indexOf(c[e].namespace)>=0){var f=c[e].entityType;for(var g in f){if(f[g].name===m.substring(0,m.length-1)){for(var k in f[g].property){d.push(f[g].property[k].name)}}}}}b=d.filter(function(j){var l=0;for(l in b){var t=b[l];if(t===j){return true}}return false});var p="/"+m+"(";for(var h in b){if(this.navParameter[b[h]]!==" "){var r=/^[0-9][0-9][0-9][0-9]-[0-1][0-9]-[0-3][0-9]T[0-2][0-9]:[0-5][0-9]:[0-5][0-9]/;if(r.test(this.navParameter[b[h]])){p+=b[h]+"=datetime'"+encodeURIComponent(this.navParameter[b[h]])+"',"}else{p+=b[h]+"='"+encodeURIComponent(this.navParameter[b[h]])+"',"}}else{p+=b[h]+"='"+""+"',"}}p=p.substring(0,p.length-1);p+=")";return p},_displayChangeRequestWarning:function(c){if(c){this.getView().byId("infoToolBarCR").setVisible(true)}else{this.getView().byId("infoToolBarCR").setVisible(false)}},onDisplayChangeRequests:function(e){if(!this._oChangeRequestList){this._oChangeRequestList=sap.ui.xmlfragment("i2d.pp.mrpcockpit.reuse.fragments.ChangeRequestList",this);this.getView().addDependent(this._oChangeRequestList)}var o=this.dMaterialID;var c=this.getView().getBindingContext();var O=c.getObject();this.dMaterialID=O.MaterialID;if(o!==this.dMaterialID){var a=new Array();a.push(new sap.ui.model.Filter("SolutionRequestStatus","EQ",this.Constants.REQUEST_STATUS_REQUESTED));a.push(new sap.ui.model.Filter("SolutionRequestStatus","EQ",this.Constants.REQUEST_STATUS_ANSWERED));a.push(new sap.ui.model.Filter("SolutionRequestStatus","EQ",this.Constants.REQUEST_STATUS_COLLECTED));a.push(new sap.ui.model.Filter("SolutionRequestStatus","NE",null));var b=new sap.ui.model.Filter(a,false);var d=new sap.ui.model.Filter("MaterialID","EQ",this.dMaterialID);var A=new Array();A.push(b);A.push(d);var f=new Array();f.push(new sap.ui.model.Filter(A,true));var l=sap.ui.getCore().byId("idChangeRequestTable");var L=l.getItems()[0];l.removeItem(L);this._oChangeRequestModel=this.oApplicationFacade.getODataModel();l.setModel(this._oChangeRequestModel,"ChangeRequests");var u='/ChangeRequests';l.bindAggregation("items",{path:u,filters:f,template:L})}var i=e.getSource();jQuery.sap.delayedCall(0,this,function(){this._oChangeRequestList.openBy(i)})},_updateSolutionCards:function(v){var c=v.byId("cards");var C=v.getBindingContext();if(!C){return}var s=C.getObject();var S=s.SolCard;var m=v.getModel();var a=new Array();for(var i=0;i<S.__list.length;i++){var k=S.__list[i];var o=m.oData[k];a.push(o)}var M=v.getModel("Common_i18n");c.setModel(M,"Common_i18n");c.addSolutionCards(a,s.MaterialShortageHasNoSolution);c.rerender()},_updateTableSupplyDemandItems:function(f,I){var c=this.getView().byId("shortages");var C=this.getView().getBindingContext();if(!C){return}var s=C.getObject();if(!I){I=this._readOriginSupDemItems()}var S=s.MaterialShortageStartDate;var d=s.MaterialShortageEndDate;for(var i=0;i<I.length;i++){if((I[i].MRPElementAvailyOrRqmtDate>=S)&&(I[i].MRPElementAvailyOrRqmtDate<=d)){I[i].StockQuantityVisible=true}else{I[i].StockQuantityVisible=false}}var p=C.getPath().substring(1);var D={};D[""+p]={SupDemItem:I};if(f){$(c.getDomRef()).fadeOut(function(){var m=c.getModel();m.setData(D);c.bindElement(C.getPath());c.updateAggregation("items");$(c.getDomRef()).fadeIn();c.setNoDataText(c.getModel('Common_i18n').getResourceBundle().getText("tableUpdateFinished"))})}else{var m=c.getModel();m.setData(D);c.bindElement(C.getPath());c.updateAggregation("items");c.setNoDataText(c.getModel('Common_i18n').getResourceBundle().getText("tableUpdateFinished"))}},_readOriginSupDemItems:function(){var c=this.getView().getBindingContext();if(!c){return}var s=c.getObject();var S=s.SupDemItem;var m=this.getView().getModel();var I=new Array();for(var i=0;i<S.__list.length;i++){var k=S.__list[i];var o=m.oData[k];I.push(o)}return I},_navBack:function(e){if(this._getPathDetailView!==undefined){var p=this._getPathDetailView().substring(1);var r=!jQuery.device.is.phone;this.oRouter.navTo(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL,{contextPath:p,stateID:this.navParameter.stateID},r)}},onDialogOk:function(c,e,d){if(d&&d.model&&d.model.cardModel){this._oCard=null;var m="";if(d.model.cardModel.oData.msg){m=d.model.cardModel.oData.msg}else{var M=this.getView().getModel("Common_i18n");var b=M.getResourceBundle();m=b.getText("SOLUTION_DIALOG_OK")}sap.ca.ui.message.showMessageToast(m);this.requestChartData();var C=null;if(d.model.responseModel){C=this._readCreatedSupDemItemKey(d.model.responseModel,d.model.cardModel.oData.MaterialShortageSolutionType)}this._readSolutionViewData(true,C)}},_readCreatedSupDemItemKey:function(d,s){var D=null;var r=null;var o=null;try{D=d.__batchResponses[0].__changeResponses[0].data}catch(e){return null}switch(s){case this.Constants.SOLUTIONTYPE_PR_CREATE:r=D.MMPurchaseRequisitionItems.results[0];return{MRPElementCategory:this.Constants.MRP_ELEMENT_CATEGORY_PURRQS,MRPElement_Int:r.PurchaseRequisitionID,MRPElementItem_Int:r.ItemID,MRPElementScheduleLine_Int:""};case this.Constants.SOLUTIONTYPE_TOR_CREATE:r=D.MMPurchaseRequisitionItems.results[0];return{MRPElementCategory:this.Constants.MRP_ELEMENT_CATEGORY_PRQREL,MRPElement_Int:r.PurchaseRequisitionID,MRPElementItem_Int:r.ItemID,MRPElementScheduleLine_Int:""};case this.Constants.SOLUTIONTYPE_PO_CREATE:o=D.MMPurchaseOrderItems.results[0].MMPurchaseOrderScheduleLines.results[0];return{MRPElementCategory:this.Constants.MRP_ELEMENT_CATEGORY_POITEM,MRPElement_Int:o.PurchaseOrderID,MRPElementItem_Int:o.ItemID,MRPElementScheduleLine_Int:o.ScheduleLineID};case this.Constants.SOLUTIONTYPE_TO_CREATE:o=D.MMPurchaseOrderItems.results[0].MMPurchaseOrderScheduleLines.results[0];return{MRPElementCategory:this.Constants.MRP_ELEMENT_CATEGORY_RELORD,MRPElement_Int:o.PurchaseOrderID,MRPElementItem_Int:o.ItemID,MRPElementScheduleLine_Int:o.ScheduleLineID};default:return null}},_readSolutionViewData:function(w,n){var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(b===1){this.path=i2d.pp.mrpcockpit.reuse.util.Wave3Helper.getPathSolutionView.call(this);this.view.bindElement(this.path,{"expand":'SolCard,SupDemItem'})}else{this.view.byId("oDataBindingServant").bindAggregation("items",{path:"/PPMRPSolHeaders",filters:this._createSolHeaderFilter(w,n,this.navParameter,this.dateStart,this.dateEnd),parameters:{expand:'SolCard,SupDemItem'},template:this.oTemplate})}},_createSolHeaderFilter:function(w,n,N,d,a){var f=new Array();f.push(new sap.ui.model.Filter('MaterialID',sap.ui.model.FilterOperator.EQ,N.MaterialID));f.push(new sap.ui.model.Filter('MRPPlant',sap.ui.model.FilterOperator.EQ,N.MRPPlant));f.push(new sap.ui.model.Filter('MRPArea',sap.ui.model.FilterOperator.EQ,N.MRPArea));f.push(new sap.ui.model.Filter('MRPPlanningSegmentType',sap.ui.model.FilterOperator.EQ,N.MRPPlanningSegmentType));f.push(new sap.ui.model.Filter('MRPPlanningSegmentNumber',sap.ui.model.FilterOperator.EQ,N.MRPPlanningSegmentNumber));f.push(new sap.ui.model.Filter('MaterialShortageDefinitionID',sap.ui.model.FilterOperator.EQ,N.MaterialShortageDefinitionID));f.push(new sap.ui.model.Filter('MaterialShortageStartDate',sap.ui.model.FilterOperator.EQ,d));if(a!==null){f.push(new sap.ui.model.Filter('MaterialShortageEndDate',sap.ui.model.FilterOperator.EQ,a))}else{f.push(new sap.ui.model.Filter('MaterialShortageEndDate',sap.ui.model.FilterOperator.EQ,"1753-01-01T12:00:00"))}if(w){var s=this._readOriginSupDemItems();if(n){s.push(n)}var F=new Array();var b=new Array();var c=new Array();var e=new Array();for(var i in s){F.push(s[i].MRPElementCategory);b.push(s[i].MRPElement_Int);c.push(s[i].MRPElementItem_Int);e.push(s[i].MRPElementScheduleLine_Int)}var A=new Array();A.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPElementCategory',F));A.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPElement',b));A.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPElementItem',c));A.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPElementScheduleLine',e));f.push(new sap.ui.model.Filter(A,true))}return f},_previewRun:function(c,e,d,f){if(f===null||f===undefined){f=true}if(d&&d.model){this._oCard=d.model}if(!this._oCard){return}var v=this.getView();var m=v.getModel();var a=v.getBindingContext();if(!a){return}var s=a.getObject();var S=s.SupDemItem;if(S.__list.length===0){return}var M=[];for(var i=0;i<S.__list.length;i++){var k=S.__list[i];var C=jQuery.extend({},m.oData[k]);M.push(C)}var b=[];var g=[];var E="";var o=this.getView().getModel("Common_i18n");var B=o.getResourceBundle();var h=new i2d.pp.mrpcockpit.reuse.util.CalculationEngine(o);if(!this.isChartVisible){b=h.previewTable(M,this._oCard,s.MaterialShortageStartDate,s.MaterialShortageEndDate,new Date());switch(b[0]){case 0:g=b[1];E="";break;case-1:g=[];E=B.getText("PREVIEW_ERROR_NO_CARD");break;case-2:g=[];E=B.getText("PREVIEW_ERROR_DATE_INVALID");break;default:g=[];E=B.getText("PREVIEW_ERROR_UNKNOWN")}this._updateTableSupplyDemandItems(f,g);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:B.getText("PREVIEW_ERROR_SHORT"),details:E})}}else{if(this._oCard.MaterialShortageSolutionType!==this.Constants.SOLUTIONTYPE_ACCEPT){this.addChartDelta(this._oCard)}var r=h.previewChart(this._oCard)}},_previewCancel:function(c,e,d){if(!this._oCard){return}this._oCard=null;if(!this.isChartVisible){this._updateTableSupplyDemandItems(true)}this.removeChartDelta()},onExit:function(){if(this.oCollaborationDialog&&this.oCollaborationDialog.isOpen()){this.oCollaborationDialog.close();this.oCollaborationDialog.destroy()}this._oCard=null;this._unsubscribeEvents();this.removeHandler();this.oApplicationFacade.deRegisterOnMasterListRefresh(this.onMasterRefresh,this);this.oRouter.detachRoutePatternMatched(this._onRoutePatternMatched,this);if(this._oChangeRequestList){var l=sap.ui.getCore().byId("idChangeRequestlistItem");if(l){l.destroy()}var L=sap.ui.getCore().byId("idChangeRequestTable");if(L){L.destroy()}var p=sap.ui.getCore().byId("idChangeRequestPopover");if(p){p.destroy()}this._oChangeRequestList.removeAllContent();this._oChangeRequestList.destroy()}},_getListTemplate:function(i,c){var C=true;var o=sap.ui.getCore();var a=i.split("--")[0];var v=o.getElementById(a);if(v){C=v.getController()._bCrIconClickable}var I=new sap.ui.core.Icon({visible:"{parts: [{path:'SolutionRequestStatus'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility'}",src:"sap-icon://BusinessSuiteInAppSymbols/icon-change-request",tooltip:"{parts: [{path:'SolutionRequestStatus'}, {path:'VendorResponse'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestTooltip'}"});if(C===true){I.attachPress(function(g){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.onCRPressed(g);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}})}var b=new sap.ui.core.Icon({visible:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewVisible'}",tooltip:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewTooltip'}",src:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolView'}"});var t=new sap.m.ColumnListItem({unread:false,cells:[new sap.m.Label({text:"{path: 'MRPElementAvailyOrRqmtDate', type:'sap.ca.ui.model.type.Date', formatOptions: {style:'short'}}",visible:"{path:'MRPElementCategory', formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isSupplyDemandItem'}",customData:[new sap.ui.core.CustomData({key:"hideStockDate",value:"{parts: [{path:'MRPElementCategory'},{path:'MRPElementAvailyOrRqmtDate'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hideStockDate'}"})]}),new sap.ui.layout.HorizontalLayout({content:[b,I]}),new sap.m.ObjectIdentifier({title:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementCategoryShortName'}, {path: 'MRPElement'}, {path: 'MRPElementItem'}, {path: 'MRPElementDocumentType'}, {path: 'SourceMRPElementCategory'}, {path: 'SourceMRPElement'}, {path: 'SourceMRPElementItem'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getRequirements'}",text:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementBusinessPartnerName'}, {path: 'MRPElementBusinessPartnerType'}, {path: 'MRPElementBusinessPartnerID'}, {path: 'MRPElementDocumentType'}, {path: 'Assembly'}, {path: 'MaterialSafetyStockQty'}, {path: 'TargetQuantityUnitDcmls'}, {path: 'UnitOfMeasureTechnicalName'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.vendorOrReq'}"}),new sap.ui.layout.HorizontalLayout({content:[new sap.m.ObjectStatus({icon:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemicon'}",state:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sdIconState'}",tooltip:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemtooltip'}"}),new sap.m.Text({width:"0.5rem"}),new sap.m.ObjectNumber({number:"{parts:[ {path: 'MRPElementOpenQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.quantity'}",numberUnit:"{UnitOfMeasureTechnicalName}",emphasized:false})]}).addStyleClass("sapMRPStockQty"),new sap.m.ObjectNumber({number:"{parts:[{path: 'MRPAvailableQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.numberFormat'}",numberUnit:"{UnitOfMeasureTechnicalName}",visible:"{path: 'StockQuantityVisible'}",customData:{Type:"sap.ui.core.CustomData",key:"getMergingKey",value:"{parts:[{path:'MRPElementCategory'}, {path: 'MRPElementAvailyOrRqmtDate'}, {path: 'MRPAvailableQuantity'}], formatter: 'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.availableQuantityMergingKey'}"}}).addStyleClass("sapMRPAvailableQuantity")]});var d=parseFloat(c.getProperty("MRPAvailableQuantity"));var e=parseFloat(c.getProperty("MaterialShortageCriticalQty"));var f=parseFloat(c.getProperty("MaterialShortageThresholdQty"));var O=c.getObject();t.removeStyleClass("sapMRPShortage");t.removeStyleClass("sapMRPShortageSolved");t.removeStyleClass("sapMRPElementChanged");t.removeStyleClass("sapMRPShortageAccepted");t.removeStyleClass("sapMRPShortageSafetyStock");if(O.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED){t.addStyleClass("sapMRPShortageAccepted")}else{if(O.ChangedMrpElement&&O.ChangedMrpElement===true){t.addStyleClass("sapMRPElementChanged")}else if((d<f)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){t.addStyleClass("sapMRPShortage")}else if((d<e)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){t.addStyleClass("sapMRPShortageSafetyStock")}else if((d>=e)&&(O.InitialShortage&&O.InitialShortage===true)){t.addStyleClass("sapMRPShortageSolved")}}return t},switchView:function(){this._previewRun(null,null,null,false)},switchToChart:function(f){this.isChartVisible=true;var c=this.getView().byId("shortages");var t=this;if(f){$(c.getDomRef()).fadeOut(function(){var a=t.getView().byId("solChartContainer");t._showChartContainer();$(a.getDomRef()).fadeIn(function(){if(t._oCard){t._previewRun(null,null,null,f)}else{t.removeChartDelta()}})})}else{t._showChartContainer();t._hideTable();this.removeChartDelta();if(t._oCard){t._previewRun(null,null,null,f)}}},switchToTable:function(f){this.isChartVisible=false;var c=this.getView().byId("solChartContainer");var t=this;if(f){$(c.getDomRef()).fadeOut(function(){if(t._oCard){t._previewRun(null,null,null,f)}else{t._updateTableSupplyDemandItems(f)}})}else{this._hideChartContainer();this._showTable();if(t._oCard){t._previewRun(null,null,null,f)}else{t._updateTableSupplyDemandItems(f)}}},_showTable:function(){var c=this.byId('shortages');c.setVisible(true)},_hideTable:function(){var c=this.byId('shortages');c.setVisible(false)},onToolbarIconSelect:function(e){var s=e.getSource();var b=s.getSelectedButton();if(b.match("btnChart")){this.switchToChart(false)}else{this.switchToTable(false)}},initChart:function(){var c=this.getView().byId("chart");this.oChartModel=new sap.ui.model.json.JSONModel();this.oChartModel.setSizeLimit(10000);c.setModel(this.oChartModel);var C=new i2d.pp.mrpcockpit.reuse.controls.ChartValue({date:"{date}",demand:"{demand}",supply:"{supply}",shortageAccepted:"{shortageAccepted}"});var b=this.getView().getModel("Common_i18n").getResourceBundle().getText("XTOL_BAL_DOT");c.setProperty("showOverview",true,true);c.setProperty("fixOverviewHeight",16,true);c.setProperty("minOverviewBarSize",0,true);c.setProperty("shiftLeft",-10,true);c.setProperty("height","300px",true);c.setProperty("width","100%",true);c.setProperty("minChartHeight","180px",true);c.setProperty("allowNavigation",false,true);c.setProperty("balanceDotTooltip",b);c.bindProperty("shiftLeft","/shiftLeft");c.bindProperty("unitDecimals","/decimals");c.bindProperty("startBalance","/startBalance");c.bindProperty("minStock","/minStock");c.bindProperty("safetyStock","/safetyStock");c.bindValues("/chartData",C)},requestChartData:function(){var p=this._getPathDetailView()+"/"+this.navParameter.DetailListNavProperty;this.getView().getModel().read(p,null,null,true,jQuery.proxy(this.processChartData,this),function(e){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:"Chart cannot be displayed because the required data could not be retrieved",details:"Chart cannot be displayed because the required data could not be retrieved"})})},processChartData:function(d,r){var v=this.getView();var c=new i2d.pp.mrpcockpit.reuse.util.CalculationEngine(v.getModel("Common_i18n"));var m=c.initialChartData(r.data.__batchResponses[0].data.results,this.dateStart,this.dateEnd,this.chartScrollPos);this.oChartModel.setData(m);this.removeChartDelta(true)},addChartDelta:function(c){var C=new i2d.pp.mrpcockpit.reuse.util.CalculationEngine(this.getView().getModel("Common_i18n"));var p=C.previewChartData(c);var o=this.getView().byId("chart");o.setDeltas(p.deltas)},removeChartDelta:function(n){var c=this.getView().byId("chart");c.setDeltas([],n)},_revokeAcceptedShortage:function(m){var M=this.getView().getModel("Common_i18n");var b=M.getResourceBundle();var h={};h.fnSuccess=function(d,r,E){sap.ca.ui.utils.busydialog.releaseBusyDialog();if(E.length>0){var e=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromBatchResponse(b,E);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("CARD_CANCEL_ACCEPTED_FAIL"),details:e});var a=sap.ui.getCore().getEventBus();a.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,null)}else{this._readSolutionViewData(true,null);var s=b.getText("CARD_CANCEL_ACCEPTED");sap.ca.ui.message.showMessageToast(s);var a=sap.ui.getCore().getEventBus();a.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,null)}}.bind(this);h.fnError=function(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();var e="";if(E&&E.response&&E.response.body){e=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,E.response.body)}else{e=b.getText("SOLUTION_DIALOG_ERROR_UNKNOWN")}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("CARD_CANCEL_ACCEPTED_FAIL"),details:e});var a=sap.ui.getCore().getEventBus();a.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_ERROR,null)}.bind(this);sap.ca.ui.utils.busydialog.requireBusyDialog({text:b.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var e=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.deleteShortageAcceptBatch(m,h);if(e){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText(e)})}else{var a=sap.ui.getCore().getEventBus();a.publish(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_EXECUTE,null)}},onSolutionCardExecute:function(c,e,d){var v="";var o=d.model;var m=jQuery.extend({},o);var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(b===1){i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper._mapOData3ToOdata5(m)}switch(m.MaterialShortageSolutionType){case this.Constants.SOLUTIONTYPE_ACCEPT:if(m.MaterialShortageEndDate.getTime()===new Date(9999,11,31,13).getTime()){var M=this.getView().getModel("Common_i18n");var B=M.getResourceBundle();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:B.getText("CARD_ACCEPT_INFINITY")})}else{v="i2d.pp.mrpcockpit.reuse.fragments.DialogShortageAccept"}break;case this.Constants.SOLUTIONTYPE_ACCEPT_REMOVE:this._revokeAcceptedShortage(m);break;case this.Constants.SOLUTIONTYPE_PO_RESCHEDULE:case this.Constants.SOLUTIONTYPE_PO_INCREASE:case this.Constants.SOLUTIONTYPE_TO_RESCHEDULE:case this.Constants.SOLUTIONTYPE_TO_INCREASE:case this.Constants.SOLUTIONTYPE_PO_CHANGE:case this.Constants.SOLUTIONTYPE_TO_CHANGE:v="i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange";this.dMaterialID=null;break;case this.Constants.SOLUTIONTYPE_PO_CREATE:case this.Constants.SOLUTIONTYPE_TO_CREATE:case this.Constants.SOLUTIONTYPE_PR_CREATE:case this.Constants.SOLUTIONTYPE_TOR_CREATE:v="i2d.pp.mrpcockpit.reuse.fragments.DialogOrderCreate";break;case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_PR_INCREASE:case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_TOR_INCREASE:case this.Constants.SOLUTIONTYPE_PR_CHANGE:case this.Constants.SOLUTIONTYPE_TOR_CHANGE:v="i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange";break;case this.Constants.SOLUTIONTYPE_PA_STOCK_CHANGE:case this.Constants.SOLUTIONTYPE_PA_VENDOR_CHANGE:case this.Constants.SOLUTIONTYPE_PA_UNSRC_CHANGE:case this.Constants.SOLUTIONTYPE_PA_PLANT_CHANGE:case this.Constants.SOLUTIONTYPE_PA_PROD_CHANGE:case this.Constants.SOLUTIONTYPE_PA_REPLANT_CHANGE:v="i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange";break}if(v){var a=sap.ui.controller(v);this.oCollaborationDialog=sap.ui.xmlfragment(v,a);this.oCollaborationDialog.setModel(this.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");this.oCollaborationDialog.setModel(this.getView().getModel("Common_i18n"),"Common_i18n");this.oCollaborationDialog.setModel(new sap.ui.model.json.JSONModel(m));this.oCollaborationDialog.open()}},removeHandler:function(){if(jQuery.device.is.desktop){if(this.resizeHandler){sap.ui.core.ResizeHandler.deregister(this.resizeHandler);this.resizeHandler=null}}else{sap.ui.Device.orientation.detachHandler(this.onResize,this);sap.ui.Device.resize.detachHandler(this.onResize,this)}if(this.resizeTimer){jQuery.sap.clearDelayedCall(this.resizeTimer);this.resizeTimer=null}if(this.resizeFixHandler){jQuery.sap.clearDelayedCall(this.resizeFixHandler);this.resizeFixHandler=null}},resize:function(i){i2d.pp.mrpcockpit.reuse.util.Helper.resizeUiControls(this,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S4,i)},resizeFix:function(){jQuery.sap.log.debug("resize chart to ensure proper sizing");this.resize();this.resizeFixHandler=null},onResize:function(e){if(this.resizeTimer){jQuery.sap.clearDelayedCall(this.resizeTimer)}this.resizeTimer=jQuery.sap.delayedCall(200,this,jQuery.proxy(this.resize,this));var c=this.getView().byId("cards");c.updateSolutionCardContainerSize()},onBeforeRendering:function(){this.removeHandler()},onAfterRendering:function(){this.resize(this._initialOffset);this._initialOffset=0;jQuery.sap.delayedCall(500,this,jQuery.proxy(this._registerOnResize,this))},_registerOnResize:function(){var p=null;if(jQuery.device.is.desktop){var n=jQuery("#"+this.getView().getId()+"--"+"mainPage-cont");if(n&&n.length){p=n;if(p){this.resizeHandler=sap.ui.core.ResizeHandler.register(p[0],jQuery.proxy(this.onResize,this))}}}else{sap.ui.Device.orientation.attachHandler(this.onResize,this);sap.ui.Device.resize.attachHandler(this.onResize,this)}},onItemsUpdateStarted:function(e){var s=this.getView().byId("shortages");s.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("tableUpdateStarted"))},_hideChartContainer:function(){var c=this.byId('solChartContainer');c.setVisible(false)},_showChartContainer:function(){var c=this.byId('solChartContainer');c.setVisible(true)},onMasterRefresh:function(e){if(e.getParameter("bManualRefresh")===true){this._navBack(e)}}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.VariantHandler')){jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.VariantHandler");i2d.pp.mrpcockpit.reuse.view.VariantHandler={i18NCommonReuseModel:new sap.ui.model.resource.ResourceModel({bundleUrl:jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties"}),openVariantDialog:function(c,C,v,V,s,a,n,l,L,o,b,d,e,f){this.sContainerPrefix=C;this.oVariantData=v;this.sServiceUrl=s;this.sAppURL=a;this.fCallbackFunction=c;this.aVariantNames=V;this.sNumberUnit=n;this.sLPIconMonitor=l;this.sLPIconManage=L;this.sOldVariantName=o;this.b2MonitorTile=b;this.b2ManageTile=d;this.bChangeVariant=e;var D=f.getView().getModel("Common_i18n").getResourceBundle().getText("DefaultLayout");var g=f.getObjectHeaderTitle();if(this.b2MonitorTile===undefined){this.b2MonitorTile=false}if(this.b2ManageTile===undefined){this.b2ManageTile=false}if(this.bChangeVariant===undefined){this.bChangeVariant=false}var h=function(r){};var i=function(p,A,q){this.onVariantSave(this.fCallbackFunction,this.sContainerPrefix,p,this.oVariantData,A,q,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,this.sOldVariantName,e,f)}.bind(this);var j=function(p,A,q){this.openVariantChangeConfirmationDialog(this.fCallbackFunction,this.sContainerPrefix,p,this.oVariantData,A,q,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,f)}.bind(this);this.oMRPDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog",type:sap.ui.core.mvc.ViewType.XML});var k=this.oMRPDialogView.byId("DLG_VARIANT_SAVE");var t=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("CreateVariant");if(e){t=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("ChangeVariant")}var m={title:t,closeFunction:h,saveFunction:i,variantList:this.aVariantNames,changeVariantFunction:j,oldVariantName:this.sOldVariantName,b2MonitorTile:b,b2ManageTile:d,sDefaultLayoutName:D,sListName:g,forcasteDemandApp:f.ForecastDemandManageApp};var M=new sap.ui.model.json.JSONModel(m);k.setModel(M);f.getView().addDependent(k);k.open()},openVariantSaveDialog:function(c,C,v,V,s,a,n,l,L,o,b,d,e,f){var b=false;var d=false;this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var g="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(g);p.fail(function(){if(c){c(false)}});p.done(function(h){this.oPersonalizationContainer=h;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var i={};this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(o);var S=sap.ushell.Container.getService("Bookmark");if(f.sOrderCategory===undefined){var j=a+"-monitor"+"?VariantID="+this.sVariantKey}else{var j=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+f.sOrderCategory}S.countBookmarks(j).fail(function(){this.openVariantDialog(c,C,v,V,s,a,n,l,L,o,b,d,false,f)}.bind(this)).done(function(k){if(k>0){b=true}if(f.sOrderCategory===undefined){var m=a+"-manage"+"?VariantID="+this.sVariantKey}else{var m=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+f.sOrderCategory}S.countBookmarks(m).fail().done(function(k){if(k>0){d=true}this.openVariantDialog(c,C,v,V,s,a,n,l,L,o,b,d,false,f)}.bind(this))}.bind(this))}.bind(this))},openVariantChangeConfirmationDialog:function(c,C,v,V,a,A,s,S,n,l,L,o){this.sContainerPrefix=C;this.oVariantData=V;this.sServiceUrl=S;this.sAppURL=s;this.fCallbackFunction=c;this.sNumberUnit=n;this.sLPIconMonitor=l;this.sLPIconManage=L;this.sVariantName=v;this.bAddBookmarkMonitor=a;this.bAddBookmarkManage=A;var f=function(r){};var b=function(){this.onVariantSave(this.fCallbackFunction,this.sContainerPrefix,this.sVariantName,this.oVariantData,this.bAddBookmarkMonitor,this.bAddBookmarkManage,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,this.sVariantName,true,o)}.bind(this);this.oMRPChangeVariantDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPChangeVariantDialogView.byId("DLG_CHANGE_VARIANT_CONFIRMATION");var D={title:"{i18n>DIALOG_CHANGE_VARIANT_TITLE}",closeFunction:f,saveFunction:b,text:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("ChangeVariantConfirmationText",this.sVariantName),};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);o.getView().addDependent(d);d.open()},openVariantDeleteDialog:function(c,C,v,a,o){this.sContainerPrefix=C;this.sVariantName=v;this.fCallbackFunction=c;var f=function(r){};var b=function(r){this.onVariantDelete(this.fCallbackFunction,this.sContainerPrefix,this.sVariantName,a,i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText(("DeleteVariantConfirmation",v)),o)}.bind(this);this.oMRPDELDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantDeleteDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPDELDialogView.byId("DLG_VARIANT_DELETE");d.getBeginButton().setType(sap.m.ButtonType.Reject);var D={title:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariantTitle"),text:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariant",v),closeFunction:f,confirmFunction:b};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);o.getView().addDependent(d);d.open()},openVariantPropertiesDialog:function(c,C,s,a,n,l,L,o,b){var d=false;var e=false;this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var f="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(f);p.fail(function(){if(c){c(false)}});p.done(function(g){this.oPersonalizationContainer=g;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var v={};this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(o);var S=sap.ushell.Container.getService("Bookmark");if(b.sOrderCategory===undefined){var h=a+"-monitor"+"?VariantID="+this.sVariantKey}else{var h=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+b.sOrderCategory}S.countBookmarks(h).fail(function(){}.bind(this)).done(function(i){if(i>0){d=true}if(b.sOrderCategory===undefined){var j=a+"-manage"+"?VariantID="+this.sVariantKey}else{var j=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+b.sOrderCategory}S.countBookmarks(j).fail().done(function(i){if(i>0){e=true}this.openVariantDialog(c,C,null,null,s,a,n,l,L,o,d,e,true,b)}.bind(this))}.bind(this))}.bind(this))},onVariantSave:function(c,C,v,V,a,A,s,S,n,l,L,o,b,d){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var e="MRPCockpit."+C;var N=JSON.parse(JSON.stringify(V));this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(e);p.fail(function(){if(c){c(false)}});p.done(function(f){this.oPersonalizationContainer=f;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var g={};var h=this.oPersonalizationVariantSet.getVariantKeyByName(o);if(((o!==v&&o!=="")&&b)){if(h){N=JSON.parse(JSON.stringify(this.oPersonalizationVariantSet.getVariant(h).getItemValue("Filter")));this.oPersonalizationVariantSet.delVariant(h)}}this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(this.sVariantKey){g=this.oPersonalizationVariantSet.getVariant(this.sVariantKey)}else{g=this.oPersonalizationVariantSet.addVariant(v)}if(N){g.setItemValue("Filter",N);if(N.ViewChanged){N.ViewChanged=false}}this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(b){var B=sap.ushell.Container.getService("Bookmark");if(h){if(B){if(d.sOrderCategory===undefined){this.sTargetUrlMonitor=s+"-monitor"+"?VariantID="+h}else{this.sTargetUrlMonitor=s+"-monitor"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlMonitor).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlMonitor).fail().done(function(){if(d.sOrderCategory===undefined){this.sTargetUrlManage=s+"-manage"+"?VariantID="+h}else{this.sTargetUrlManage=s+"-manage"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}.bind(this))}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}.bind(this))}else{if(d.sOrderCategory===undefined){this.sTargetUrlManage=s+"-manage"+"?VariantID="+h}else{this.sTargetUrlManage=s+"-manage"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}.bind(this))}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}}.bind(this))}}}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}.bind(this))},createBookmarks:function(v,V,a,A,b,l,L,n,s,c,C){this.sVariantKey=V;var B=false;this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);var S=sap.ushell.Container.getService("Bookmark");if(C.sOrderCategory===undefined){this.sComplteAppUrlMonitor=a+"-monitor"+"?VariantID="+this.sVariantKey}else{this.sComplteAppUrlMonitor=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+C.sOrderCategory}S.countBookmarks(this.sComplteAppUrlMonitor).fail().done(function(i){if(A){if(i===0){B=true;S.addBookmark({title:v,subtitle:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("MONITOR"),url:this.sComplteAppUrlMonitor,icon:l,numberUnit:n,serviceRefreshInterval:10,serviceUrl:s}).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessageBookmark",v))})}}else{if(i>0){S.deleteBookmarks(this.sComplteAppUrlMonitor).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText(("DeleteVariantConfirmation",v)))})}}}.bind(this));if(C.sOrderCategory===undefined){this.sComplteAppUrlManage=a+"-manage"+"?VariantID="+this.sVariantKey}else{this.sComplteAppUrlManage=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+C.sOrderCategory}S.countBookmarks(this.sComplteAppUrlManage).fail().done(function(i){if(b){if(i===0){B=true;var d=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("MANAGE");if(C.ForecastDemandManageApp){d=C.ForecastDemandManageAppSubtitle}S.addBookmark({title:v,subtitle:d,url:this.sComplteAppUrlManage,icon:L,numberUnit:n,serviceRefreshInterval:10,serviceUrl:s}).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessageBookmark",v))})}}else{if(i>0){S.deleteBookmarks(this.sComplteAppUrlManage).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",v))})}}}.bind(this));if(!B){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessage",v))}if(c){c(true,v)}},getVariantByName:function(c,C,v){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var V="DefaultVariant";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var a={};var b=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(b){a=this.oPersonalizationVariantSet.getVariant(b);if(c&&a){if(a.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(a.getItemValue("Filter"))),a.getVariantName(),v)}else{c(false)}}}else{if(this.oPersonalizationContainer.containsVariantSet(V)){var P=this.oPersonalizationContainer.getVariantSet(V);b=P.getVariantKeyByName(v);a=P.getVariant(b);if(c&&a){if(a.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(a.getItemValue("Filter"))),a.getVariantName(),v)}else{c(false)}}else{if(c){c(false)}}}}}.bind(this))},getVariantByID:function(c,C,v){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V={};var a=v.toString();if(a){V=this.oPersonalizationVariantSet.getVariant(a);if(c&&V){if(V.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(V.getItemValue("Filter"))),V.getVariantName())}else{c(false)}}else{c(false)}}else{if(c){c(false)}}}.bind(this))},getAllVariants:function(c,C){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var v="DefaultVariant";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V=this.oPersonalizationVariantSet.getVariantNamesAndKeys();if(V){var d=[];for(var k in V){if(V.hasOwnProperty(k)){d.push(k)}}if(c){var P=this.oPersonalizationContainer.getVariantSet(v);var D=P.getVariantNamesAndKeys();if(D){var S=d.sort(function(a,b){a=a.toLowerCase();b=b.toLowerCase();if(a==b)return 0;if(a>b)return 1;return-1});for(var k in D){if(D.hasOwnProperty(k)){S.push(k)}}c(true,S)}}}else{if(c){c(false)}}}.bind(this))},onVariantDelete:function(c,C,v,a,s,o){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var b="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(b);p.fail(function(){if(c){c(false)}});p.done(function(d){this.oPersonalizationContainer=d;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(V){this.oPersonalizationVariantSet.delVariant(V);this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){var B=false;jQuery.sap.require("sap.m.MessageToast");var e=sap.ushell.Container.getService("Bookmark");if(e){if(o.sOrderCategory===undefined){this.sTargetUrlMonitor=a+"-monitor"+"?VariantID="+V}else{this.sTargetUrlMonitor=a+"-monitor"+"?VariantID="+V+"&OrderCategory="+o.sOrderCategory}e.countBookmarks(this.sTargetUrlMonitor).fail().done(function(i){if(i>0){B=true;e.deleteBookmarks(this.sTargetUrlMonitor).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",s))})}}.bind(this));if(o.sOrderCategory===undefined){this.sTargetUrlManage=a+"-manage"+"?VariantID="+V}else{this.sTargetUrlManage=a+"-manage"+"?VariantID="+V+"&OrderCategory="+o.sOrderCategory}e.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B=true;e.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",s))})}}.bind(this))}if(!B){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariantConfirmation",s))}if(c){c(true)}}.bind(this))}else{if(c){c(false)}}}.bind(this))},saveDefaultVariant:function(c,C,v,V){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};var P={};var d="DefaultVariant";var s="MRPCockpit."+C;var n=JSON.parse(JSON.stringify(V));this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(this.oPersonalizationContainer.containsVariantSet(d)){this.oPersonalizationContainer.delVariantSet(d)};this.oPersonalizationContainer.addVariantSet(d);P=this.oPersonalizationContainer.getVariantSet(d);var a={};var D=P.getVariantKeyByName(v);if(D){a=P.getVariant(D)}else{a=P.addVariant(v)}if(n){a.setItemValue("Filter",n)}this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){if(c){c(true,v)}}.bind(this))}.bind(this))},}};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange.controller')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange.controller');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Number');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogOrderChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE);m.setProperty("/DialogRequestActive",this.Constants.REQUEST_ACTIVE);if(this.oDialog.getModel('ServiceVersions').getData().iServiceSchemaVersion<3){m.setProperty("/DialogRequestActive",this.Constants.REQUEST_INACTIVE)}switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PO_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_PO_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_PO_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break;case this.Constants.SOLUTIONTYPE_TO_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TO_CHANGE;break}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var c=false;switch(d.SolutionRequestStatus){case this.Constants.REQUEST_STATUS_REQUESTED:case this.Constants.REQUEST_STATUS_ANSWERED:c=true;break;default:c=false}var E="";switch(d.DialogActivity){case this.Constants.SolutionDialogActivity_EXECUTE:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_APPLIED;E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePurchaseOrderBatch(d,this._oHandlerOrder,c,"x30");break;case this.Constants.SolutionDialogActivity_CR_REQUEST:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_REQUESTED;if(c===false){E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createRequestBatch(d,this._oHandlerCR)}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updateRequestBatch(d,this._oHandlerCR,"x30")}break;case this.Constants.SolutionDialogActivity_CR_COLLECT:d.SolutionRequestStatus=this.Constants.REQUEST_STATUS_COLLECTED;if(c===false){E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createRequestBatch(d,this._oHandlerCR)}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updateRequestBatch(d,this._oHandlerCR,"x30")}break;default:jQuery.sap.log.error("Dialog activity "+d.DialogActivity+" is unknown.")}if(E){var m="";sap.ca.ui.utils.busydialog.releaseBusyDialog();if(d.DialogActivity===this.Constants.SolutionDialogActivity_EXECUTE){m=this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR")}else{m=this.Common_i18n.getText("SOLUTION_DIALOG_MSG_REQUEST_SAVE_FAILED",[d.MRPElementExternalID,d.MRPElementItemExternalID])}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m,details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},_onSelectRadioButton1:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE)},_onSelectRadioButton2:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_CR_COLLECT)},_onSelectRadioButton3:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_CR_REQUEST)}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderCreate.controller')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderCreate.controller');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Number');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogOrderCreate",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogConfigCtrlOptionCreateReq",false);m.setProperty("/DialogConfigCtrlOptionCreateOrd",true);switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PO_CREATE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PO_CREATE_TITLE"));this.dialogAction=this.Constants.SolutionDialogAction_PO_CREATE;break;case this.Constants.SOLUTIONTYPE_TO_CREATE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TO_CREATE_TITLE"));this.dialogAction=this.Constants.SolutionDialogAction_TO_CREATE;break}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";switch(this.dialogAction){case this.Constants.SolutionDialogAction_PO_CREATE:case this.Constants.SolutionDialogAction_TO_CREATE:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createPurchaseOrderBatch(d,this._oHandlerOrder);break;case this.Constants.SolutionDialogAction_PR_CREATE:case this.Constants.SolutionDialogAction_TOR_CREATE:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createPurchaseRequisitionBatch(d,this._oHandlerOrder);break;default:jQuery.sap.log.error("Dialog action "+this.dialogAction+" is unknown.")}if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},onSelectOptionCreateOrd:function(e){var m=e.getSource().getParent().getModel();var M=m.getProperty("/MaterialShortageSolutionType");switch(M){case this.Constants.SOLUTIONTYPE_PO_CREATE:case this.Constants.SOLUTIONTYPE_PR_CREATE:if(e.getParameter("selected")){M=this.Constants.SOLUTIONTYPE_PO_CREATE;this.dialogAction=this.Constants.SolutionDialogAction_PO_CREATE}else{M=this.Constants.SOLUTIONTYPE_PR_CREATE;this.dialogAction=this.Constants.SolutionDialogAction_PR_CREATE}break;case this.Constants.SOLUTIONTYPE_TO_CREATE:case this.Constants.SOLUTIONTYPE_TOR_CREATE:if(e.getParameter("selected")){M=this.Constants.SOLUTIONTYPE_TO_CREATE;this.dialogAction=this.Constants.SolutionDialogAction_TO_CREATE}else{M=this.Constants.SOLUTIONTYPE_TOR_CREATE;this.dialogAction=this.Constants.SolutionDialogAction_TOR_CREATE}break}m.setProperty("/MaterialShortageSolutionType",M)}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange.controller')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange.controller');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Number');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogOrderReqChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogConfigSourceDefined",true);m.setProperty("/DialogConfigCtrlOptionConvToOrd",false);m.setProperty("/DialogConfigCtrlOptionChangeReq",true);switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_PR_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_PR_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PR_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_RESCHEDULE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_INCREASE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_INCREASE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break;case this.Constants.SOLUTIONTYPE_TOR_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_TOR_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE;break}if(this.dialogAction===this.Constants.SolutionDialogAction_PR_CHANGE&&!m.getProperty("/Vendor")){m.setProperty("/DialogConfigSourceDefined",false)}else if(this.dialogAction===this.Constants.SolutionDialogAction_TOR_CHANGE&&!m.getProperty("/SupplyingPlant")){m.setProperty("/DialogConfigSourceDefined",false)}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";switch(this.dialogAction){case this.Constants.SolutionDialogAction_PR_CHANGE:case this.Constants.SolutionDialogAction_TOR_CHANGE:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePurchaseRequisitionBatch(d,this._oHandlerOrder);break;case this.Constants.SolutionDialogAction_PR_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.convertPurchaseRequisitionBatch(d,this._oHandlerOrder);d.MaterialShortageSolutionType=this.Constants.SOLUTIONTYPE_PO_CREATE;break;case this.Constants.SolutionDialogAction_TOR_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.convertPurchaseRequisitionBatch(d,this._oHandlerOrder);d.MaterialShortageSolutionType=this.Constants.SOLUTIONTYPE_TO_CREATE;break;default:jQuery.sap.log.error("Dialog action "+this.dialogAction+" is unknown.")}if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},onSelectOptionChangeReq:function(e){var m=e.getSource().getParent().getModel();var M=m.getProperty("/MaterialShortageSolutionType");switch(M){case this.Constants.SOLUTIONTYPE_PR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_PR_INCREASE:case this.Constants.SOLUTIONTYPE_PR_CHANGE:if(e.getParameter("selected")){this.dialogAction=this.Constants.SolutionDialogAction_PR_CHANGE}else{this.dialogAction=this.Constants.SolutionDialogAction_PR_CONVERT}break;case this.Constants.SOLUTIONTYPE_TOR_RESCHEDULE:case this.Constants.SOLUTIONTYPE_TOR_INCREASE:case this.Constants.SOLUTIONTYPE_TOR_CHANGE:if(e.getParameter("selected")){this.dialogAction=this.Constants.SolutionDialogAction_TOR_CHANGE}else{this.dialogAction=this.Constants.SolutionDialogAction_TOR_CONVERT}break}}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange.controller')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange.controller');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.type.Number');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogPlanOrderChange",{_initializeDialog:function(){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE);m.setProperty("/DialogConfigSourceDefined",true);m.setProperty("/DialogConfigCtrlOptionConvToProdOrd",true);m.setProperty("/DialogConfigCtrlOptionConvToProcOrd",true);m.setProperty("/DialogConfigCtrlOptionConvToReq",true);switch(m.getProperty("/MaterialShortageSolutionType")){case this.Constants.SOLUTIONTYPE_PA_STOCK_CHANGE:case this.Constants.SOLUTIONTYPE_PA_VENDOR_CHANGE:case this.Constants.SOLUTIONTYPE_PA_UNSRC_CHANGE:case this.Constants.SOLUTIONTYPE_PA_PLANT_CHANGE:case this.Constants.SOLUTIONTYPE_PA_REPLANT_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.getProperty("/MRPElementExternalID"),m.getProperty("/MRPElementItemExternalID")]));this.dialogAction=this.Constants.SolutionDialogAction_PA_CHANGE;break;case this.Constants.SOLUTIONTYPE_PA_PROD_CHANGE:this.oDialog.setTitle(this.Common_i18n.getText("SOLUTION_DIALOG_PA_CHANGE_TITLE",[m.getProperty("/PlannedOrder"),m.getProperty("/PlannedOrder")]));this.dialogAction=this.Constants.SolutionDialogAction_PA_CHANGE;break}},onOk:function(e){var d=this.oDialog.getModel().getData();if(!this._isScreenDataValid()){if(!this.bDateValid){if(this.bInvalidDateFormat){return}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_DATE")})}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_WRONG_QUANTITY_NUMBER")})}return}this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";switch(d.DialogActivity){case this.Constants.SolutionDialogActivity_EXECUTE:if((d.OrderFinishDate===d.ChangedOrderFinishDate)&&(d.MRPElementOriginalTotalQty===d.MRPElementChangedTotalQuantity)){E=this.Common_i18n.getText("SOLUTION_NO_CHANGES_MADE")}else{E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePlannedOrderBatch(d,this._oHandlerOrder)}break;case this.Constants.SolutionDialogActivity_PROC_CONVERT:case this.Constants.SolutionDialogActivity_PROD_CONVERT:case this.Constants.SolutionDialogActivity_REQ_CONVERT:E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.updatePlannedOrderBatch(d,this._oHandlerOrder);break;default:jQuery.sap.log.error("Dialog action "+this.dialogAction+" is unknown.")}if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()},_onSelectRadioButton1:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_EXECUTE)},_onSelectRadioButton2:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_PROD_CONVERT)},_onSelectRadioButton3:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_PROC_CONVERT)},_onSelectRadioButton4:function(e){var m=this.oDialog.getModel();m.setProperty("/DialogActivity",this.Constants.SolutionDialogActivity_REQ_CONVERT)}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.fragments.DialogShortageAccept.controller')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.fragments.DialogShortageAccept.controller');jQuery.sap.require('sap.ca.ui.utils.busydialog');jQuery.sap.require('sap.ca.ui.message.message');jQuery.sap.require('sap.ca.ui.model.format.QuantityFormat');i2d.pp.mrpcockpit.reuse.fragments.DialogRoot.extend("i2d.pp.mrpcockpit.reuse.fragments.DialogShortageAccept",{_initializeDialog:function(){this.dialogAction=this.Constants.SolutionDialogAction_ACCEPT},onOk:function(e){var d=this.oDialog.getModel().getData();this.oDialog.close();sap.ca.ui.utils.busydialog.requireBusyDialog({text:this.Common_i18n.getText("SOLUTION_DIALOG_MSG_SAVE_WAITING")});var E="";E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.createShortageAcceptBatch(d,this._oHandlerOrder);if(E){sap.ca.ui.utils.busydialog.releaseBusyDialog();sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.Common_i18n.getText("SOLUTION_DIALOG_"+this.dialogAction+"_MSG_ERROR"),details:this.Common_i18n.getText(E)})}else{this._fireEventODataSent()}this.oDialog.destroy()}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.S1parent')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.S1parent');jQuery.sap.require('sap.ca.scfld.md.controller.BaseFullscreenController');jQuery.sap.require('sap.m.TablePersoController');jQuery.sap.require('sap.m.MessageBox');sap.ca.scfld.md.controller.BaseFullscreenController.extend("i2d.pp.mrpcockpit.reuse.view.S1parent",{constructor:function(){sap.ca.scfld.md.controller.BaseFullscreenController.apply(this,arguments);var o=this.onInit;this.onInit=function(){i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.initialize(this.getView().getModel(),this.getMasterServiceEntity(),this.oApplicationImplementation);var v=this.oApplicationImplementation.getApplicationModel("ServiceVersions");this.getView().setModel(v,"ServiceVersions");this.aDiffFieldText=[];if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){switch(v){case 1:break;default:this.aDiffFieldText=[["xtolTimeHorizonSelect",["xtolTimeHorizonSelectSoH","xtolTimeHorizonSelectModS"]],["xtolShortageDefinitionSelect",["xtolShortageDefinitionSelectSoH","xtolShortageDefinitionSelectModS"]]];break}}var b=new sap.ui.model.resource.ResourceModel({bundleName:"i2d.pp.mrpcockpit.reuse.i18n.i18n"});this.getView().setModel(b,"Common_i18n");o.apply(this,arguments)}},oPersoService:{init:function(p){this._sPersistenceId=p;this._oBundle={}},getPersData:function(){var d=new jQuery.Deferred();var b=this._oBundle;d.resolve(b);return d.promise()},setPersData:function(b){var d=new jQuery.Deferred();this._oBundle=b;d.resolve();return d.promise()},resetPersData:function(c){var d=new jQuery.Deferred();var i={_persoSchemaVersion:"1.0",aColumns:c};this._oBundle=i;d.resolve();return d.promise()}},onInit:function(){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this.oHeaderFooterOptions={oEditBtn:{sId:"manageButton",sI18nBtnTxt:"btnManageShortages",bDisabled:false,onBtnPressed:jQuery.proxy(this.onNavigationButtonPressed,this)},bSuppressBookmarkButton:true,aAdditionalSettingButtons:[{sI18nBtnTxt:"AreaOfResponsibility",onBtnPressed:function(e){this.aStoredFacetFilterState=this.oViewState.FacetFilterState;this.runStateMachine(this,this.oEvent.aORButtonPressed)}.bind(this)}]};this.setHeaderFooterOptions(this.oHeaderFooterOptions);this.oRouter.attachRoutePatternMatched(this.onRouteMatched,this);this.logger=jQuery.sap.log.getLogger(this.getVariantContainerPrefix());this.logger.setLevel(jQuery.sap.log.Level.INFO);this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.oObjectHeader=this.getView().byId("ObjectHeader");this.oShortageSelect=this.oView.byId("ShortageSelect");var s=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,s);this.oTimeHorizonSelect=this.getView().byId("TimeHorizonSelect");this.oFacetFilter=this.getView().byId("FacetFilter");this.aShortageDefinitionKeys=[];this.aFacetFilterFilters=[];this.oTable=this.getView().byId(this.getTableId());this.oView=this.getView();this.oTable.setEnableBusyIndicator(false);this.oTable.setGrowingThreshold(100);this.oTable.setGrowing(true);this.oTableItemTemplate=this.oTable.getItems()[0].clone();this.oTable.removeAllItems();this.oDataModel=this.oApplicationFacade.getODataModel();this.oDataModel.setSizeLimit(999);if(this.getMasterServiceEntity){this._iServiceSchemaVersion=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(this.oDataModel,this.getMasterServiceEntity());this._iServiceVersion=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceVersion(this.oDataModel,this.getMasterServiceEntity());i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.removeNeedlessColumnsFromTable(this.oDataModel,this.getMasterServiceEntity(),this.oTable,"mrpcoDataField")};this.oDataModel.attachRequestCompleted(this._onRequestComplete,this);this.oDataModel.attachRequestFailed(this.oDataModel,this._handleRequestFailed,this);this.oPersoService.init(this.getViewNumber()+"PersoService");this._initShortageSelect();if(this.oTimeHorizonSelect){this._initTimeHorizonSelect()}var c=sap.ui.core.Component.getOwnerIdFor(this.getView());this.myComponent=sap.ui.component(c);var C=this.myComponent.getComponentData();this.sVariantID="";this.sStateID=this.myComponent.sStateID;if(C&&C.startupParameters&&C.startupParameters.VariantID){if(C.startupParameters.VariantID[0]!==undefined){this.sVariantID=C.startupParameters.VariantID[0]}}if(C&&C.startupParameters&&C.startupParameters.OrderCategory){if(C.startupParameters.OrderCategory[0]!==undefined){this.sOrderCategory=C.startupParameters.OrderCategory[0];if(this._changeAppName){this._changeAppName(this.sOrderCategory)}}}if(this.getDemandType){this.demandType=this.getDemandType();this.oViewState={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DemandType:this.demandType,DefaultVariant:false,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}}else{this.oViewState={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DefaultVariant:false,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}};this.oVSDialog={};this.bNewVSDialogRequiredAfterTablePers=true;this.newVSDialog=true;this.oSorter=[];this.bSortPath=null;this.bsortDescending=null;this.aTableStateColumnsInitial=this._getInitialTableColumnsState();this.oTPC=new sap.m.TablePersoController({table:this.oTable,persoService:this.oPersoService,componentName:this.getComponentName()}).activate();this.oTPC.attachPersonalizationsDone(function(D){this._personalizationsDone(D)}.bind(this));this.oView.byId(this.getViewNumber()+"TablePersoButton").attachPress(function(){this.oTPC.openDialog()}.bind(this));this._initResultTable();this.sDefaultVariantName="";if(!this.oDefaultVariantData){this.oDefaultVariantData={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DefaultVariant:true,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}}var d=this.getView().getModel("Common_i18n").getResourceBundle().getText("DefaultLayout");i2d.pp.mrpcockpit.reuse.view.VariantHandler.saveDefaultVariant(null,this.getVariantContainerPrefix(),d,this.oDefaultVariantData);this.oFacetFilter.attachReset(function(){i2d.pp.mrpcockpit.reuse.view.FacetFilter._handleFacetFilterReset(this,this.oDefaultVariantData.FacetFilterState)}.bind(this));this.oVariantData=this.oDefaultVariantData;this.oVariantData.DefaultVariant=false;this.sCurrentVariantName="";this.sVariantContainerPrefix=this.getVariantContainerPrefix();this.bViewHasBeenChanged=false;this.oDisplayVariantPopover=i2d.pp.mrpcockpit.reuse.view.DisplayVariant.getDisplayVariantPopover(this);this.oObjectHeaderIconDomRef={};this.oState=i2d.pp.mrpcockpit.reuse.util.StateMachine.oState;this.oEvent=i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent;this.oAction=i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction;this.runStateMachine=i2d.pp.mrpcockpit.reuse.util.StateMachine.runStateMachine;this.sState=this.oState.initial;this.runStateMachine(this,this.oEvent.start)},onRouteMatched:function(e){var r=e.getParameter("name");if(r==="state"){var a=e.getParameter("arguments");if((a.stateID!="undefined")&&(a.stateID!=this.sStateID)){var m=/id-.*-.*/;var s=m.exec(a.stateID);if(s){this.sStateID=s[0]}}}else{return}},registerViewChanged:function(){if(this.bViewHasBeenChanged==false){this.bViewHasBeenChanged=true;if(this.sCurrentVariantName){this.oObjectHeader.setTitle(this.sCurrentVariantName+" *");this.oViewState.VariantName=this.sCurrentVariantName}else{this.oObjectHeader.setTitle(this.getObjectHeaderTitle()+" *")}this.oViewState.ViewChanged=true}i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.saveViewStateInContainer(null,this.oViewState,this.sStateID,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME)},_onRequestComplete:function(d){var u=d.getParameter("url");var s=this.oDataModel.getServiceMetadata().dataServices.schema[0].namespace+this.getMasterEntity();if(d.getSource().bUseBatch){}else if(u.match(this.getShortageEntitySetName())){this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,this.oVariantData.MaterialShortageDefinitionID);var I=this.oShortageSelect.getItems();for(var i=0;i<I.length;i++){var o=I[i];this.aShortageDefinitionKeys.push(o.getKey())};if(this.oVariantData.MaterialShortageDefinitionID!=""){if(this.aShortageDefinitionKeys.length>0){var S=false;for(var i=0;i<this.aShortageDefinitionKeys.length;i++){if(this.aShortageDefinitionKeys[i]==this.oVariantData.MaterialShortageDefinitionID){S=true;this.oShortageSelect.setSelectedKey(this.oVariantData.MaterialShortageDefinitionID);break}}if(S==false){this.oShortageSelect.setSelectedItem(I[0]);var a=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,a);this.oViewState.MaterialShortageDefinitionID=a;sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("SHORTDEF_MISSING_MSG"))}}else{sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("SHORTDEF_MISSING_MSG"))}}else{if(this.aShortageDefinitionKeys.length>0){this.oShortageSelect.setSelectedItem(I[0]);var a=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,a);this.oViewState.MaterialShortageDefinitionID=a}}}else if(u.match(s)){var b=d.getParameters("errorobject");var c=b&&b.errorobject&&b.errorobject.responseText;if(c){if(!c.match('@AOR@')){this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"));this.runStateMachine(this,this.oEvent.tableDataReceived)}}else{this.runStateMachine(this,this.oEvent.tableDataReceived)}}},_handleRequestFailed:function(e){var s=e.getParameter("responseText");if(s){if(s.match('@AOR@')){this.runStateMachine(this,this.oEvent.aORUndefined)}else if(s.match('@SHORTDEF@')){sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("NO_SHORTDEF_MSG"))}else{this.oApplicationFacade.oApplicationImplementation.oConnectionManager.handleRequestFailed(e)}}else{this.oApplicationFacade.oApplicationImplementation.oConnectionManager.handleRequestFailed(e)}},getServiceVersion:function(){return this._iServiceVersion},getServiceSchemaVersion:function(){return this._iServiceSchemaVersion},_rebindRefreshTable:function(){var f=[];if(this._iServiceSchemaVersion>1){f.push(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFilterFrontendVersion())}if(this.sOrderCategory!==undefined){var o=new sap.ui.model.Filter("MRPElementCategory",sap.ui.model.FilterOperator.EQ,this.sOrderCategory);f.push(o)}if(this.filterMaterialShortage.oValue1!=""){f.push(this.filterMaterialShortage)}if(this.oTimeHorizonSelect){f.push(this.filterTimeHorizon)}if(this.getSpecificAppFilter()){f.push(this.getSpecificAppFilter())}for(var F=0;F<this.aFacetFilterFilters.length;F++){f.push(this.aFacetFilterFilters[F])}if(this.sDataFieldSelect){this._setupMasterEntityCall(this.getMasterEntity(),this.oTableItemTemplate,this.oSorter,this.sDataFieldSelect,f)}else{this._setupMasterEntityCall(this.getMasterEntity(),this.oTableItemTemplate,this.oSorter,this.getInitialSelectFields(),f)}this.newVSDialog=true},_handleShortageChange:function(){var s=this.oShortageSelect.getSelectedKey();this.oViewState.MaterialShortageDefinitionID=s;this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,s);this.registerViewChanged();this.runStateMachine(this,this.oEvent.filterChanged)},_handleTimeHorizonChange:function(){var s=this.oTimeHorizonSelect.getSelectedKey();this.oViewState.TimeHorizon=s;this.filterTimeHorizon=new sap.ui.model.Filter("DynamicHorizonCode",sap.ui.model.FilterOperator.EQ,s);this.registerViewChanged();this.runStateMachine(this,this.oEvent.filterChanged)},_setFacetFilterState:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._setFacetFilterState(this,f)},_recreateFacetFilterFiltersFromVariant:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._recreateFacetFilterFiltersFromVariant(this,f)},_recreateFacetFilter:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._recreateFacetFilter(this,f)},_initShortageSelect:function(){var s=new sap.ui.core.Item({text:"{MaterialShortageDefinitionName}",key:"{MaterialShortageDefinitionID}"});var S=[new sap.ui.model.Filter("MaterialShortageDefinitionType",sap.ui.model.FilterOperator.EQ,this.getShortageDefintionType())];this.oShortageSelect.bindItems({path:"/MaterialShortageDefinitions",template:s,filters:S});this.oShortageSelect.attachChange(function(){this._handleShortageChange()}.bind(this))},_initTimeHorizonSelect:function(){this.oTimeHorizonSelect.setSelectedKey("7");var s=this.oTimeHorizonSelect.getSelectedKey();this.filterTimeHorizon=new sap.ui.model.Filter("DynamicHorizonCode",sap.ui.model.FilterOperator.EQ,s);this.oTimeHorizonSelect.attachChange(function(){this._handleTimeHorizonChange()}.bind(this))},_initResultTable:function(){this.oTable.attachUpdateFinished(function(e){if(this.bNewVSDialogRequiredAfterTablePers==true){this.bNewVSDialogRequiredAfterTablePers=false;this.newVSDialog=true;this.oVSDialog=i2d.pp.mrpcockpit.reuse.view.TableSorting._getVSDialogNEW(this);var s=this.oVSDialog.getSortItems();for(var i=0;i<s.length;i++){var S=s[i];if(S.getKey()==this.oViewState.SortKey){this.oVSDialog.setSelectedSortItem(S)}}this.oVSDialog.setSortDescending(this.oViewState.SortDescending)}this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"));var n=e.getParameter("total");jQuery.sap.delayedCall(0,this,function(){this.oObjectHeader.setNumber(n)})}.bind(this));this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateStarted"))},_setupMasterEntityCall:function(m,t,s,i,f){this.oTable.bindItems({path:m,template:t,sorter:s,parameters:{select:i},filters:f})},_setupFacetFilterCall:function(){var f=this.getFacetFilterDefaults();if(this.getDemandType){var F="$filter=((FacetFilterType eq '"+this.getFacetFilterType()+"')) and ((DemandType eq '"+this.getDemandType()+"')) and (((FacetFilterField eq '"+f[0]+"'))"}else{var F="$filter=((FacetFilterType eq '"+this.getFacetFilterType()+"')) and (((FacetFilterField eq '"+f[0]+"'))"}for(var i=1;i<f.length;i++){F=F+" or ((FacetFilterField eq '"+f[i]+"'))"}F=F+")";if(this._iServiceSchemaVersion>1){F=F+" and ((Version eq '"+i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFrontendVersion()+"'))"}if(this.sOrderCategory!==undefined){F=F+" and ((MRPElementCategory eq '"+this.sOrderCategory+"'))"}var e="$expand=To_FacetFilterValues";var j="$format=json";var u=[F,e,j];this.oDataModel.read('/FacetFilters',null,u,true,function(d,r){this._recreateFacetFilter(d.results);this.runStateMachine(this,this.oEvent.facetDataReceived)}.bind(this),function(E){this.oFacetFilter.setShowPersonalization(false);var b=E&&E.response&&E.response.body;if(b){if(b.match('@AOR@')){this.runStateMachine(this,this.oEvent.aORUndefined)}else{this.runStateMachine(this,this.oEvent.noFacetDataReceived)}}else{this.runStateMachine(this,this.oEvent.noFacetDataReceived)}}.bind(this))},_firstAORDialogFinished:function(){this.runStateMachine(this,this.oEvent.firstAORDialogFinished)},_aORDialogFinished:function(r){if(r==i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED){this.runStateMachine(this,this.oEvent.aORDialogCancelled)}else{this.runStateMachine(this,this.oEvent.aORDialogFinished)}},onItemsUpdateStarted:function(e){this.setBtnEnabled("manageButton",false);this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateStarted"))},onItemsUpdateFinished:function(){if(this.oTable.getSelectedItems().length>0){this.setBtnEnabled("manageButton",true)}this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"))},_getInitialTableColumnsState:function(){var c=[];var C=this.oTable.getColumns();for(var i=0;i<C.length;i++){var o=C[i];var I=o.getId();var O=i;var t=o.getHeader().getText();var v=o.getVisible();c.push({id:I,order:O,text:t,visible:v})}return c},_personalizationsDone:function(d){this.bNewVSDialogRequiredAfterTablePers=true;var m=this.oPersoService.getPersData();m.done(this._refilloDataSelectFields.bind(this));m.done(this._storeTableState.bind(this));m.done(this._triggerStateMachineEventTableChanged.bind(this));this.registerViewChanged()},_triggerStateMachineEventTableChanged:function(){this.runStateMachine(this,this.oEvent.tableChanged)},_refilloDataSelectFields:function(){var u=this._determineFieldsForVisibleColumns();this.sDataFieldSelect="";this.sDataFieldSelect+=this.getBaseSelectFields();for(var i=0;i<u.length;i++){this.sDataFieldSelect+=","+u[i]}},_determineFieldsForVisibleColumns:function(){var c=[];var C={};var t="";var a="";var A=[];var u=[];c=this.oTable.getColumns();for(var i=0;i<c.length;i++){C=c[i];if(C.getVisible()==true){t=C.data("mrpcoDataField");if(t){if(a==""){a=t}else{a=a+","+t}}}};if(a!=""){A=a.split(",");u=jQuery.sap.unique(A)}return u},_storeTableState:function(t){this.oViewState.TableState=t},_applyTableStateToTable:function(t){this.oPersoService.setPersData(t);this.oTPC.applyPersonalizations()},_resetTableStateToTable:function(t){this.oPersoService.resetPersData(this.aTableStateColumnsInitial);if(this.oTPC.refresh){this.oTPC.refresh()}},onViewSettingsDialogButtonPressed:function(e){this.oVSDialog.open()},onVariantSelectorPress:function(e){this.oObjectHeaderIconDomRef=e.getParameters().domRef;i2d.pp.mrpcockpit.reuse.view.DisplayVariant.readVariantList(this)},_keyGen:function(){return jQuery.sap.uid()},onNavigationButtonPressed:function(e){var l=this.getView().byId(this.getTableId());this.setBtnEnabled("manageButton",false);sap.ca.ui.utils.busydialog.requireBusyDialog();var s=l.getSelectedItems();if(s.length>0){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var c=f&&f("CrossApplicationNavigation");if(c){var h="MRPCockpitNavigation."+this.sViewNumber;var p=sap.ushell.Container.getService("Personalization");var C=h;if(p.getContainer){p.getContainer(C,{validity:i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME}).fail(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();jQuery.sap.log.error("Loading personalization data failed.")}).done(function(o){o.setItemValue("Navigation",this.getNavigationParams());o.save().done(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();var P={"navigationID":h};if(this.sOrderCategory!=undefined){P.OrderCategory=this.sOrderCategory}c.toExternal({target:this.getNavigationTarget(),params:P})}.bind(this))}.bind(this))}}else{var m=this.oResourceBundle.getText("messNoLaunchpad");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m})}}else{var m=this.oResourceBundle.getText("messNoItems");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m})}},onItemSelection:function(e){var l=this.oView.byId(this.getTableId());var s=[];s=l.getSelectedItems();if(s.length===0){this.setBtnEnabled("manageButton",false)}else{this.setBtnEnabled("manageButton",true)}},onItemsLoaded:function(e){this.setBtnEnabled("manageButton",false)},handlePressMaterialShortageQuickView:function(e){if(!this._oShortageQuickView){this._oShortageQuickView=sap.ui.xmlfragment("i2d.pp.mrpcockpit.reuse.fragments.MaterialShortageQuickView",this);this._oShortageQuickView.setModel(this.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");this._oShortageQuickView.setModel(this.getView().getModel("Common_i18n"),"Common_i18n");this._oShortageQuickView.setModel(this.getView().getModel())}var s=e.getSource();var d=s.getBindingContext().getObject();var q="/Materials(";q+="MaterialID='"+encodeURIComponent(d.MaterialID)+"',";q+="MaterialShortageDefinitionID='"+encodeURIComponent(d.MaterialShortageDefinitionID)+"',";q+="MRPArea='"+encodeURIComponent(d.MRPArea)+"',";q+="MRPPlanningSegmentNumber='"+encodeURIComponent(d.MRPPlanningSegmentNumber)+"',";q+="MRPPlanningSegmentType='"+encodeURIComponent(d.MRPPlanningSegmentType)+"',";q+="MRPPlant='"+encodeURIComponent(d.MRPPlant)+"'";q+=")";q+="?$select=";q+="MaterialExternalID,MaterialName,AvailabilityChart,MaterialShortageStartDate,MaterialShortageEndDate,DaysOfSupplyDuration,"+"MaterialShortageQuantity,MaterialABCClassification,MRPAvailableStockQuantity,MaterialSafetyStockQty,TargetQuantityUnitDcmls,"+"ManualPlanningHorizonEndDate,TotalReplenishmentLeadDuration,VendorName,MaterialProcurementCategory,UnitOfMeasureTechnicalName,MRPPlant,MRPArea";this._oShortageQuickView.bindElement(q);this._oShortageQuickView.getElementBinding().attachDataReceived(function(){this._oShortageQuickView.openBy(s)},this)},handleQuickViewCloseButton:function(e){this._oShortageQuickView.close()},onExit:function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();this.oDataModel.detachRequestCompleted(this._onRequestComplete,this);this.oDataModel.detachRequestFailed(this.oDataModel,this._handleRequestFailed,this);this.oTPC.detachPersonalizationsDone();this.oRouter.detachRoutePatternMatched(this.onRouteMatched,this);this.oView.byId(this.getViewNumber()+"TablePersoButton").detachPress();this.oFacetFilter.detachReset()}})};if(!jQuery.sap.isDeclared('i2d.pp.mrpcockpit.reuse.view.S2parent')){jQuery.sap.declare('i2d.pp.mrpcockpit.reuse.view.S2parent');jQuery.sap.require('sap.ca.scfld.md.controller.ScfldMasterController');sap.ca.scfld.md.controller.ScfldMasterController.extend("i2d.pp.mrpcockpit.reuse.view.S2parent",{onInit:function(){sap.ca.scfld.md.controller.ScfldMasterController.prototype.onInit.call(this);i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.initialize(this.getView().getModel(),this.getMasterServiceEntity(),this.oApplicationFacade);this.Constants=i2d.pp.mrpcockpit.reuse.util.CommonConstants;var e=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:e});this.getView().setModel(b,"Common_i18n");var l=this.getList();var i=l.getItems()[0];l.removeItem(i);this.oListItemTemplate=i;this.oViewState={items:null,variantID:null};this.sStateID=jQuery.sap.uid();var m=/id-.*-.*/;var s=m.exec(sap.ui.core.routing.HashChanger.getInstance().getHash());if(s){this.sStateID=s[0];i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.getViewStateFromContainer(jQuery.proxy(this._resetLastViewState,this),this.sStateID,this.Constants.VIEW_STATE_VALIDITY_TIME,this.oViewState)}else{var c=sap.ui.core.Component.getOwnerIdFor(this.getView());var a=sap.ui.component(c);var C=a.getComponentData();if(C&&C.startupParameters){if(C.startupParameters.OrderCategory){if(C.startupParameters.OrderCategory[0]!==undefined){this.sOrderCategory=C.startupParameters.OrderCategory[0]}}this._bindFilters(C.startupParameters);this.oViewState.variantID=C.startupParameters.VariantID;this.oStartParameters=C.startupParameters}else{if(this._directCall){this.getList().destroyItems();this._directCall()}else{jQuery.sap.log.error("Startup parameter missing. Only direct call use case of app 230 is allowed without startup parameter.");this.oApplicationFacade.oApplicationImplementation.oConnectionManager.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel('Common_i18n').getResourceBundle().getText("messURLIncorrect")})}}}var d=sap.ui.getCore().getEventBus();d.subscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,this._updateMasterListItem,this);this.getView().getModel().attachRequestFailed(null,this.handleRequestFailed,this);var f=null;f=this.oApplicationFacade.getApplicationModel("changedItems");if(!f){f=new sap.ui.model.json.JSONModel();this.oApplicationFacade.setApplicationModel("changedItems",f)}this.oApplicationFacade.registerOnMasterListRefresh(this.onMasterRefresh,this);this.oRouter.attachRoutePatternMatched(this._onRoutePatternMatched,this)},getDetailRouteName:function(){if(this.oStartParameters){if(this.oStartParameters.navigationID){if(this.oStartParameters.navigationID[0]==i2d.pp.mrpcockpit.reuse.util.CommonConstants.NavToCR){return i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.SUB_DETAIL}}}return i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL},getDetailNavigationParameters:function(l){return{contextPath:l.getBindingContext(this.sModelName).getPath().substr(1),stateID:this.sStateID}},_onRoutePatternMatched:function(e){var r=e.getParameter("name");if(r==="master"||r===i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL){var a=e.getParameter("arguments");if(a.stateID&&(a.stateID!==this.sStateID)){var m=/id-.*-.*/;var s=m.exec(a.stateID);if(s){this.sStateID=s[0]}}}},handleRequestFailed:function(e){var E=null;var c=function(){window.history.back()};if(e.getParameter("responseText").match('@AOR@')){i2d.pp.mrpcockpit.reuse.view.AoRHandler.openFirstOnboardingDialog(this.getView().getModel(),this._aorChange.bind(this),this)}else if(e.getParameter("responseText").match('@QuickView@')){}else if(e.getParameter("responseText").match('@NoAuthorization@')){E=this.getView().getModel("Common_i18n").getResourceBundle().getText("MISSING_AUTHORIZATIONS_ERROR");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E},c)}else if(e.getParameter("responseText").match('@TOO_MANY_MATERIALS@')){E=this.getView().getModel("Common_i18n").getResourceBundle().getText("TOO_MANY_MATERIALS_ERROR");var b=this.getView().getModel("Common_i18n").getResourceBundle();var a=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,e.getParameter("responseText"));var t=a.split("@TOO_MANY_MATERIALS@");t[1].replace(". ","");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:t[0],details:t[1]})}else{var T=this.getList();if(T){T.setBusy(false);T.setNoDataText(this.getView().getModel('Common_i18n').getResourceBundle().getText("tableUpdateFinished"));this.navToEmptyView()}this.oApplicationFacade.oApplicationImplementation.oConnectionManager.handleRequestFailed(e)}},_updateMasterListItem:function(c,e,d){var a=this.oApplicationFacade.getApplicationModel("changedItems");var s=null;if(this.getList()){s=this.getList().getSelectedItem();if(s){var C=s.getBindingContext();var E=null;E=a.getProperty(C.getPath());if(!E){E={};jQuery.extend(E,C.getObject())}E=this._updateMasterListItemAppSpecific(E,d);if(E){a.setProperty(C.getPath(),E);s.setModel(a);this.oApplicationFacade.setApplicationModel("changedItems",a)}}else{jQuery.sap.log.info("S2: Status Update not possible - No item selected")}}else{jQuery.sap.log.info("S2: Status Update not possible - No list available")}},_updateMasterListItemAppSpecific:function(e,d){e.MaterialShortageStatus=i2d.pp.mrpcockpit.reuse.util.Helper.convertStatusToMasterListStatus(d);return e},_readVariant:function(v,f){this.aFilters=f;this.sVariantContainerPrefix=this._getVariantContainerPrefix();i2d.pp.mrpcockpit.reuse.view.VariantHandler.getVariantByID(this._setFilters.bind(this),this.sVariantContainerPrefix,v)},_setFilters:function(r,o){var i;var j;i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.addFilterFrontendVersion(this.aFilters,this.getView().getModel(),this.getMasterServiceEntity());this.aSorter=[];if(o!==null){if(o.MaterialShortageDefinitionID!==undefined){this.aFilters.push(this._getSimpleFilter('MaterialShortageDefinitionID',o.MaterialShortageDefinitionID))}if(o.TimeHorizon!==undefined){this.aFilters.push(this._getSimpleFilter('DynamicHorizonCode',o.TimeHorizon))}if(o.DemandType!==undefined){this.aFilters.push(this._getSimpleFilter('DemandType',o.DemandType))}if(o.OrderCategory!==undefined){this.aFilters.push(this._getSimpleFilter('MRPElementCategory',o.OrderCategory))}if(o.FacetFilterState!==undefined){for(i=0;i<o.FacetFilterState.length;i++){for(j=0;j<o.FacetFilterState[i].selectedItemKeys.length;j++){this.aFilters.push(this._getSimpleFilter(o.FacetFilterState[i].listKey,o.FacetFilterState[i].selectedItemKeys[j][0]))}}}if(o.SortKey&&o.SortDescending!==undefined){this.aSorter.push(new sap.ui.model.Sorter(o.SortKey,o.SortDescending))}}this._handleVariantAppSpecific();this._setupViewBinding(this.aFilters,this.aSorter)},_setupViewBinding:function(f,s){var m=this.getView().byId("list");var M=this.oApplicationFacade.getODataModel();if(!this._isBatchModeActive()){M.setUseBatch(false)}else{M.setUseBatch(true)}M.setSizeLimit(999);m.setGrowingThreshold(50);m.setGrowing(true);m.bindAggregation("items",{path:"/"+this.getMasterListEntity(),template:this.oListItemTemplate,sorter:s,filters:f,parameters:{select:this._getSelectFields()}});this.registerMasterListBind(m)},_bindFilters:function(p){var f=[];var n=null;if(p.navigationID){n=p.navigationID[0]}if(n){var P=sap.ushell.Container.getService('Personalization');if(P.getContainer){P.getContainer(n,this.Constants.VIEW_STATE_VALIDITY_TIME).done(function(c){var i=c.getItemValue("Navigation");if(i){this._bindAppFilters(i,f);this._setupViewBinding(f);this.oViewState.items=i;this._storeViewState()}else{jQuery.sap.log.error("Invalid localBookmark")}}.bind(this))}}else if(p.VariantID){this._readVariant(p.VariantID,f);this.oViewState.variantID=p.VariantID;this._storeViewState()}else{jQuery.sap.log.error("Invalid scenario, either supply display variant or [material,plant,mrparea] combinations");this.oApplicationFacade.oApplicationImplementation.oConnectionManager.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:this.getView().getModel('Common_i18n').getResourceBundle().getText("messURLIncorrect")})}},_handleVariantAppSpecific:function(){},_resetLastViewState:function(r,v){this.oViewState=v;var f=[];if(this.oViewState.items){this._bindAppFilters(this.oViewState.items,f);this._setupViewBinding(f)}else if(this.oViewState.variantID){this._readVariant(this.oViewState.variantID,f)}},_storeViewState:function(){i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.saveViewStateInContainer(null,this.oViewState,this.sStateID,this.Constants.VIEW_STATE_VALIDITY_TIME,null)},_getLocalFilters:function(){var f=[];this._setTimeHorizonFilter(f);this._setShortageFilter(f);this._setControllerFilter(f);this._setPlantFilter(f);return f},_getSimpleFilter:function(f,a){var b=new sap.ui.model.Filter(f,sap.ui.model.FilterOperator.EQ,a);return b},_setTimeHorizonFilter:function(f){var h="";if(h===""){jQuery.sap.log.error("Mandatory url parameter 'timeHorizon' not set!")}f.push(this._getSimpleFilter('DynamicHorizonCode',h))},_setShortageFilter:function(f){var s="";if(s===""){jQuery.sap.log.error("Mandatory url parameter 'shortageDef' not set!")}f.push(this._getSimpleFilter('MaterialShortageDefinitionID',s))},_setPlantFilter:function(f){var p="";if(p!==null){f.push(this._getSimpleFilter('MRPPlant',p))}},_setControllerFilter:function(f){var c="";if(c!==null){f.push(this._getSimpleFilter('MRPController',c))}},_isBatchModeActive:function(){var n="";if(n==="X"){return false}return true},_bindGeneralKeyFilters:function(p,s,a){if((!p.DirectCall)&&(p.MRPArea.length!==p.MaterialID.length||p.MRPArea.length!==p.MRPPlant.length)){jQuery.sap.log.error("Same number of entries for MRPArea, MaterialID and MRPPlant expected")}else{s.push(this._getSimpleFilter('MaterialShortageDefinitionID',p.MaterialShortageDefinitionID));if(p.DirectCall){s.push(this._getSimpleFilter('DirectCall',p.DirectCall))}else{a.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPArea',p.MRPArea))}a.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MaterialID',p.MaterialID));a.push(i2d.pp.mrpcockpit.reuse.util.Helper.getORMultiFilter('MRPPlant',p.MRPPlant));i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.addFilterFrontendVersion(s,this.getView().getModel(),this.getMasterServiceEntity())}},onItemsUpdateFinished:function(e){var m=this.getView().byId("list");if(m.getItems().length){var i=m.getSelectedItem();if(i){var r=i.getDomRef();if(r&&e.getParameter("reason")!=="Growing"){r.focus()}}else{this.selectFirstItem()}}else{m.setNoDataText(this.getView().getModel('Common_i18n').getResourceBundle().getText("tableUpdateFinished"));this.navToEmptyView()}},getHeaderFooterOptions:function(){var h={aAdditionalSettingButtons:[{sBtnTxt:"AOR",sI18nBtnTxt:this.getView().getModel('Common_i18n').getResourceBundle().getText("AREA_OF_RESPONSIBILITY"),onBtnPressed:function(e){i2d.pp.mrpcockpit.reuse.view.AoRHandler.openOnboardingDialog(e,this.oApplicationFacade.getODataModel(),this._aorChange.bind(this),this)}.bind(this)}]};if(this.oViewState.variantID&&this.semanticObject&&this.semanticObjectAction){h.buttonList=[{sBtnTxt:"MONITORAPP",sI18nBtnTxt:"NAV_TO_MONITOR_APP",onBtnPressed:function(e){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNavigator=f&&f("CrossApplicationNavigation");if(this.oCrossAppNavigator){this.oCrossAppNavigator.toExternal({target:{semanticObject:this.semanticObject,action:this.semanticObjectAction},params:{"VariantID":this.oViewState.variantID}})}else{var m=this.oApplicationFacade.getResourceBundle().getText("messNoLaunchpad");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m})}}.bind(this)}]}return h},_aorChange:function(){if((arguments[0]==i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED)||(arguments[0]==i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_FAILED)){}else{if(this.aFilters){this._setupViewBinding(this.aFilters,this.aSorter)}}},clearFilters:function(){this.aFilters=undefined},clearSorter:function(){this.aSorter=undefined},onExit:function(){var b=sap.ui.getCore().getEventBus();b.unsubscribe(this.Constants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,this.Constants.EVENT_EVENTID_OK,this._updateMasterListItem,this);this.oApplicationFacade.deRegisterOnMasterListRefresh(this.onMasterRefresh,this);jQuery(window).unbind("beforeunload");this._storeViewState()},onMasterRefresh:function(e){if(e.getParameter("bManualRefresh")===true){var l=this.getList().getItems();var i;for(i=0;i<l.length;i++){l[i].setModel()}var c=new sap.ui.model.json.JSONModel();this.oApplicationFacade.setApplicationModel("changedItems",c)}else{}}})};
