/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper");i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper={initialize:function(m,e,a){var t=m;if(m===undefined||m===null){t=sap.ca.scfld.md.app.Application.getImpl().getODataModel()}var s=this._getServiceSchemaVersion(t,e);var S=this._getServiceVersion(t,e);var v={iServiceSchemaVersion:s,iServiceVersion:S};a.setApplicationModel("ServiceVersions",new sap.ui.model.json.JSONModel(v))},getInteroperabilityModel:function(m,e){return new sap.ui.model.json.JSONModel({backendVersion:i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(m,e),frontendVersion:i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFrontendVersion()})},getFilterFrontendVersion:function(){return new sap.ui.model.Filter("Version",sap.ui.model.FilterOperator.EQ,"3")},getFrontendVersion:function(){return"3"},addFilterFrontendVersion:function(f,m,e){if(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(m,e)>1){f.push(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFilterFrontendVersion())}},getServiceVersion:function(a){if(a.getApplicationModel("ServiceVersions")){return a.getApplicationModel("ServiceVersions").getData().iServiceVersion}else{return undefined}},getServiceSchemaVersion:function(a){if(a.getApplicationModel("ServiceVersions")){return a.getApplicationModel("ServiceVersions").getData().iServiceSchemaVersion}else{return undefined}},_getEntityAnnotation:function(m,a,e){var M=m.getServiceMetadata();if((M!=null)&&(M.dataServices!=null)&&(M.dataServices.schema!=null)&&(M.dataServices.schema.length>0)&&(M.dataServices.schema[0].entityType!=null)){var E=M.dataServices.schema[0].entityType;for(var i=0;i<E.length;i++){if(E[i].extensions!=null){for(var j=0;j<E[i].extensions.length;j++){if(((e===undefined)||(e===E[i].name))&&(E[i].extensions[j].name===a)){return E[i].extensions[j].value}}}}}return null},getEntityPropertyNames:function(m,e){var M=m.getServiceMetadata();if((M!=null)&&(M.dataServices!=null)&&(M.dataServices.schema!=null)&&(M.dataServices.schema.length>0)&&(M.dataServices.schema[0].entityType!=null)){var E=M.dataServices.schema[0].entityType;var a=[];for(var i=0;i<E.length;i++){if(e===E[i].name){for(var j=0;j<E[i].property.length;j++){a.push(E[i].property[j].name)}return a}}}return null},_getServiceSchemaVersion:function(m,e){var v=this._getEntityAnnotation(m,"service-schema-version",e);return(v!=null)?parseInt(v):1},_getServiceVersion:function(m,e){var v=this._getEntityAnnotation(m,"service-version",e);return(v!=null)?parseInt(v):1},removeNeedlessColumnsFromTable:function(m,e,t,d){var E=this.getEntityPropertyNames(m,e);if((E!=null)&&(E!=undefined)){var c=t.getColumns();for(var i=0;i<c.length;i++){var T=[];var s="";s=c[i].data(d);if(s!=""){T=s.split(",");var b=false;for(var j=0;j<T.length;j++){if((j>0)&&(b==false)){break}b=false;for(var k=0;k<E.length;k++){if(T[j]==E[k]){b=true;break}}}if(!b){t.removeColumn(c[i].sId)}}}}}};
