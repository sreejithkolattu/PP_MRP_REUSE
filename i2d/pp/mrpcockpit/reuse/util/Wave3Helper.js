/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.util.Wave3Helper");i2d.pp.mrpcockpit.reuse.util.Wave3Helper={calcShortagePeriod:function(d){var v=this.getView();var D=v.getModel().oData;var s=this.getView().byId("SDItems");var I=(s)?s.getItems():[];var l=(I&&I.length)?I.length:0;var o;var a;var f=null;var b=null;for(var i=1;i<l;i++){o=D[I[i].getBindingContext().getPath().slice(1)];if(o.MRPElementAvailyOrRqmtDate<d){if(i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){a=o;f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else if(!i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){f=null;a=null}}else if(o.MRPElementAvailyOrRqmtDate.getTime()==d.getTime()){a=o;f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else{if(i2d.pp.mrpcockpit.reuse.util.Wave3Helper.isShortage.call(this,o)){f=(!f)?o.MRPElementAvailyOrRqmtDate:f}else{b=new Date(o.MRPElementAvailyOrRqmtDate.getTime()-24*3600*1000);break}}}if(!f&&(l>0)){o=D[I[0].getBindingContext().getPath().slice(1)];a=o;f=o.MRPElementAvailyOrRqmtDate}if(!b){b=new Date();b.setUTCFullYear(9999);b.setUTCMonth(11);b.setUTCDate(31);b.setUTCHours(0)}return{shortageItem:a,firstDate:f,lastDate:b}},isShortage:function(i){return(i.MRPAvailability!==i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_NOSHORTAGE)},getPathSolutionView:function(){var p="/PPMRPSolHeaders(";p+="MaterialID='"+encodeURIComponent(this.navParameter.MaterialID);p+="',MRPPlant='"+encodeURIComponent(this.navParameter.MRPPlant);p+="',MRPArea='"+encodeURIComponent(this.navParameter.MRPArea);p+="',MRPPlanningSegmentType='"+encodeURIComponent(this.navParameter.MRPPlanningSegmentType);p+="',MRPPlanningSegmentNumber='"+encodeURIComponent(this.navParameter.MRPPlanningSegmentNumber);p+="',MaterialShortageDefinitionID='"+encodeURIComponent(this.navParameter.MaterialShortageDefinitionID);p+="',MaterialShortageStartDate=datetime'"+encodeURIComponent(this.dateStart);p+="',MaterialShortageEndDate=datetime'"+encodeURIComponent(this.dateEnd);p+="')";return p},_getListTemplate:function(i,c){var C=true;var o=sap.ui.getCore();var a=i.split("--")[0];var v=o.getElementById(a);if(v){C=v.getController()._bCrIconClickable}var I=new sap.ui.core.Icon({visible:"{parts: [{path:'SolutionRequestStatus'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility'}",src:"sap-icon://request",tooltip:"{parts: [{path:'SolutionRequestStatus'}, {path:'VendorResponse'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestTooltip'}"});if(C===true){I.attachPress(function(g){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.onCRPressed(g);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}})}var b=new sap.ui.core.Icon({visible:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewVisible'}",tooltip:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolViewTooltip'}",src:"{parts: [{path:'MRPElementQuantityIsFirm'}, {path:'MRPElementIsReleased'}, {path:'MRPElementIsPartiallyDelivered'}, {path:'MRPElementCategory'}, {path:'MRPElementOpenQuantity'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.flagIconSolView'}"});var t=new sap.m.ColumnListItem({unread:false,cells:[new sap.m.Label({text:"{path: 'MRPElementAvailyOrRqmtDate', type:'sap.ca.ui.model.type.Date', formatOptions: {style:'short'}}",visible:"{path:'MRPElementCategory', formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isSupplyDemandItem'}",customData:[new sap.ui.core.CustomData({key:"hideStockDate",value:"{parts: [{path:'MRPElementCategory'},{path:'MRPElementAvailyOrRqmtDate'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.hideStockDate'}"})]}),new sap.ui.layout.HorizontalLayout({content:[b,I]}),new sap.m.ObjectIdentifier({title:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementCategoryShortName'}, {path: 'MRPElement'}, {path: 'MRPElementItem'}, {path: 'MRPElementDocumentType'}, {path: 'SourceMRPElementCategory'}, {path: 'SourceMRPElement'}, {path: 'SourceMRPElementItem'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getRequirements'}",text:"{parts:[{path: 'NumberOfRequirements'}, {path: 'MRPElementCategory'}, {path: 'MRPElementBusinessPartnerName'}, {path: 'MRPElementBusinessPartnerType'}, {path: 'MRPElementBusinessPartnerID'}, {path: 'MRPElementDocumentType'}, {path: 'Assembly'}, {path: 'MaterialSafetyStockQty'}, {path: 'TargetQuantityUnitDcmls'}, {path: 'UnitOfMeasureTechnicalName'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.vendorOrReq'}"}),new sap.ui.layout.HorizontalLayout({content:[new sap.m.ObjectStatus({icon:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemicon'}",state:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sdIconState'}",tooltip:"{parts:[{path: 'MRPElementOpenQuantity'}, {path: 'MRPElementCategory'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.sditemtooltip'}"}),new sap.m.Text({width:"0.5rem"}),new sap.m.ObjectNumber({number:"{parts:[ {path: 'MRPElementOpenQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.quantity'}",numberUnit:"{UnitOfMeasureTechnicalName}",emphasized:false})]}).addStyleClass("sapMRPStockQty"),new sap.m.ObjectNumber({number:"{parts:[{path: 'MRPAvailableQuantity'}, {path: 'TargetQuantityUnitDcmls'}], formatter:'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.numberFormat'}",numberUnit:"{UnitOfMeasureTechnicalName}",visible:"{path: 'StockQuantityVisible'}",customData:{Type:"sap.ui.core.CustomData",key:"getMergingKey",value:"{parts:[{path:'MRPElementCategory'}, {path: 'MRPElementAvailyOrRqmtDate'}, {path: 'MRPAvailableQuantity'}], formatter: 'i2d.pp.mrpcockpit.reuse.util.CommonFormatter.availableQuantityMergingKey'}"}}).addStyleClass("sapMRPAvailableQuantity")]});var d=parseFloat(c.getProperty("MRPAvailableQuantity"));var e=parseFloat(c.getProperty("MaterialShortageCriticalQty"));var f=parseFloat(c.getProperty("MaterialShortageThresholdQty"));var O=c.getObject();t.removeStyleClass("sapMRPShortage");t.removeStyleClass("sapMRPShortageSolved");t.removeStyleClass("sapMRPElementChanged");t.removeStyleClass("sapMRPShortageAccepted");t.removeStyleClass("sapMRPShortageSafetyStock");if(O.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED){t.addStyleClass("sapMRPShortageAccepted")}else{if(O.ChangedMrpElement&&O.ChangedMrpElement===true){t.addStyleClass("sapMRPElementChanged")}else if((d<f)){t.addStyleClass("sapMRPShortage")}else if(d<e){t.addStyleClass("sapMRPShortageSafetyStock")}else if((d>=e)&&(O.InitialShortage&&O.InitialShortage===true)){t.addStyleClass("sapMRPShortageSolved")}}return t},_writeSafetyStock:function(c,s,a){for(var b=0;b<c.length;b++){if(c[b].getId().indexOf(a)!=-1){c[b].setText(s);return true}if(c[b].getContent&&this._writeSafetyStock(c[b].getContent(),s,a)){return true}}return false},determineAndWriteSafetyStock:function(v){var s=v.byId("SDItems");var a=s.getItems();var b;var c;var i=v.getModel("Common_i18n");var B=i.getResourceBundle();var d="";var e=s.getBindingContext();var f=(e)?e.getObject():null;if(f){if(f.MaterialSafetyStockQty&&Number(f.MaterialSafetyStockQty)!==0.0){var g=sap.ca.ui.model.format.NumberFormat.getInstance({decimals:f.TargetQuantityUnitDcmls}).format(f.MaterialSafetyStockQty);d=B.getText("SAFETY_STOCK",[g,f.UnitOfMeasureTechnicalName])}else{d=B.getText("NO_SAFETY_STOCK")}}for(var h=0 in a){b=a[h];c=b.getBindingContext().getObject();if(c.MRPElementCategory===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_ELEMENT_CATEGORY_STOCK){var j=a[h].getCells();this._writeSafetyStock(j,d,"stockElement");break}}}};
