/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CalculationEngine");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.Helper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CollaborationHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.QuickViewHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.Wave3Helper");sap.ca.scfld.md.controller.BaseDetailController.extend("i2d.pp.mrpcockpit.reuse.view.S3parent",{constructor:function(){sap.ca.scfld.md.controller.BaseDetailController.apply(this,arguments);var o=this.onInit;this.onInit=function(){var b=new sap.ui.model.resource.ResourceModel({bundleName:"i2d.pp.mrpcockpit.reuse.i18n.i18n"});var v=this.oApplicationImplementation.getApplicationModel("ServiceVersions");this.getView().setModel(v,"ServiceVersions");this.getView().setModel(b,"Common_i18n");o.apply(this,arguments)}},onInit:function(){var s=this.getView().byId("SDItems");var t=s.getItems()[0];s.removeItem(t);s.bindAggregation("items",this.getDetailListNavProperty(),function(i,C){var o=t.clone(i);var v=parseFloat(C.getProperty("MRPAvailableQuantity"));var a=parseFloat(C.getProperty("MaterialShortageCriticalQty"));var b=parseFloat(C.getProperty("MaterialShortageThresholdQty"));var O=C.getObject();o.removeStyleClass("sapMRPShortage");o.removeStyleClass("sapMRPShortageSolved");o.removeStyleClass("sapMRPElementChanged");o.removeStyleClass("sapMRPShortageAccepted");o.removeStyleClass("sapMRPShortageSafetyStock");if(O.MRPAvailability===i2d.pp.mrpcockpit.reuse.util.CommonConstants.MRP_AVAILABILITY_ACCEPTED){o.addStyleClass("sapMRPShortageAccepted")}else{if(O.ChangedMrpElement&&O.ChangedMrpElement===true){o.addStyleClass("sapMRPElementChanged")}else if((v<b)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){o.addStyleClass("sapMRPShortage")}else if((v<a)&&(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.isStockItem(O.MRPElementCategory)||(Number(O.MRPElementOpenQuantity)<0))){o.addStyleClass("sapMRPShortageSafetyStock")}else if((v>=a)&&(O.InitialShortage&&O.InitialShortage===true)){o.addStyleClass("sapMRPShortageSolved")}}return o});var p=this.getView().getContent()[0];p.setShowNavButton(jQuery.device.is.phone);this.oRouter.attachRoutePatternMatched(this._onRoutePatternMatched,this);this.initChart();this.resizeHandlerParent=[];this.resizeHandlerPage=[];this.resizeTimer=[];this.isChartVisible=false;this.oApplicationFacade.registerOnMasterListRefresh(this.onMasterRefresh,this);if(!sap.ui.Device.system.desktop){var f=this.getView().byId("factSheetButton");if(f!==undefined){f.setVisible(false)}}var c=null;c=this.oApplicationFacade.getApplicationModel("changedItems");if(!c){c=new sap.ui.model.json.JSONModel();this.oApplicationFacade.setApplicationModel("changedItems",c)}},_subscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.subscribe(i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_OK,this._onDataChanged,this)},_unsubscribeEvents:function(){var b=sap.ui.getCore().getEventBus();b.unsubscribe(i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_CHANNELID_CARD_DIALOG_DATACHANGED,i2d.pp.mrpcockpit.reuse.util.CommonConstants.EVENT_EVENTID_OK,this._onDataChanged,this)},_onDataChanged:function(c,e,d){if(d&&d.model.cardModel){var m;if(d.model.cardModel.oData.msg){m=d.model.cardModel.oData.msg}else{m="Data has been saved."}sap.ca.ui.message.showMessageToast(m);this.refreshSDList()}},onMasterRefresh:function(e){if(e.getParameter("bManualRefresh")===true){if(e.getParameter("bAutoNavigation")===true){}else{this.refreshSDList();this._changeModel()}}else{}if(this.sdItemHighlightingNeeded){this._highlightSdItemTableRecord.call(this)}},_highlightSdItemTableRecord:function(){var s=this.getView().byId("SDItems");var b=s.getBindingContext();var o=b.getObject();if(o!==undefined){var I=s.getItems();var a=null;var i;for(i=0;i<I.length;i++){a=I[i].getBindingContext().getObject();if(this.compareKeys(a,o)){I[i].addStyleClass("sapMRPSDItemSelected")}else{I[i].removeStyleClass("sapMRPSDItemSelected")}}}},_onRoutePatternMatched:function(e){var v=this.getView();if(e.getParameter("name")===i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.DETAIL){v.getModel().detachRequestCompleted(this._onModelLoaded,this);v.getModel().attachRequestCompleted(this._onModelLoaded,this);this._unsubscribeEvents();this._subscribeEvents();var c=new sap.ui.model.Context(v.getModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c);var m=this.getView().byId("infoTabContainer");if(m!==undefined){m.bindElement('/'+e.getParameter("arguments").contextPath+'/'+this.getInfoTabNavProperty())}this.navParameter=e.getParameter("arguments");for(var i in this.navParameter){this.navParameter[i]=decodeURIComponent(this.navParameter[i])}this._changeModel()}else{this._unsubscribeEvents();v.getModel().detachRequestCompleted(this._onModelLoaded,this);i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.destroyQuickViews(this)}},navToSolutionView:function(d){var b=this.getView().getBindingContext().getObject();var n={};var m=this.oApplicationFacade.oApplicationImplementation.aMasterKeys;for(var i in m){if(b[m[i]]!==""){if(!(b[m[i]]instanceof Date)){n[m[i]]=b[m[i]]}else{n[m[i]]=b[m[i]].toISOString().slice(0,-5)}}else{n[m[i]]=" "}}var c=this.getView().byId("chart");n.ChartScrollPos=(c)?c.getShiftLeft():0;var C=this.getView().byId("chartContainer");n.DisplayInChart=(C.getVisible())?true:false;n.stateID=this.navParameter.stateID;n.DetailListNavProperty=this.getDetailListNavProperty();var r;var a=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(a===1){r=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.SUB_DETAIL_WAVE3;var s=i2d.pp.mrpcockpit.reuse.util.Wave3Helper.calcShortagePeriod.call(this,d);if(!s.firstDate||!s.lastDate||!s.shortageItem){return}n.MaterialShortageStartDate=s.firstDate.toISOString().slice(0,-5);n.MaterialShortageEndDate=s.lastDate.toISOString().slice(0,-5)}else{r=i2d.pp.mrpcockpit.reuse.util.CommonConstants.ROUTING.SUB_DETAIL;n.SelectedSupDemItemDate=d.toISOString().slice(0,-5)}for(var e in n){n[e]=encodeURIComponent(n[e])}var R=!jQuery.device.is.phone;this.oRouter.navTo(r,n,R)},selectShortage:function(e){var t=e.getSource();var c=t.getBindingContext();var s=c.getObject();var d=s.MRPElementAvailyOrRqmtDate;if(d){this.navToSolutionView(d)}},selectShortageInChart:function(e){var E=e.getParameter("date");if(E){this.navToSolutionView(E)}},_onModelLoaded:function(e){var u=e.getParameter("url");var i=u.indexOf("QuickViews");if(i>=0){var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var E=e.getParameter("errorobject");if(E){var b=this.getView().getModel("Common_i18n").getResourceBundle();var s=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,E.responseText);s=s.replace("@QuickView@","");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:s});return}else{var q=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewFragment(m.MRPElementCategory);var a=this._oQuickViewContainer[q];var c=a.getBindingContext().getObject();var d=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility(c.SolutionRequestStatus);var f=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.isEditAllowed(c.QuickviewCategory);var g=a.getBeginButton();if(g){if(d){if(this._isNavToCrAppAllowed()){g.setProperty("icon","sap-icon://request");g.setProperty("visible",f)}else{g.setProperty("visible",false)}}else{g.setProperty("icon","sap-icon://edit");g.setProperty("visible",f)}}else{if(f&&this.getView().sViewName!=="i2d.pp.changerequest.details.view.S4"){a.getFooter().getContent()[0].setVisible(true)}}a.openBy(this._oSelectedMRPElementItem);return}}var S=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(S===1){i2d.pp.mrpcockpit.reuse.util.Wave3Helper.determineAndWriteSafetyStock(this.getView())}this.writeDetailListTitle();var D=false;var h=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);var o=this.getView().byId("SDItems");if(o){var j=o.getItems();for(var k=0 in j){var l=j[k].getBindingContext().getObject();if(i2d.pp.mrpcockpit.reuse.util.CommonFormatter.allowSolutionNavigation(l.MRPAvailability,l.MRPElementCategory,l.DecisionSupport,h)===true){D=true;break}}}var C=this.getView().byId("chart");C.setProperty("allowNavigation",D,true);this.setChartData();if(this.sdItemHighlightingNeeded){this._highlightSdItemTableRecord.call(this)}},writeDetailListTitle:function(){var t;var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);if(b===1){if(this.getDetailListTitle){t=this.getDetailListTitle()}else{return}}else{var s=0;var l=0;var I=[];var o;var S=this.getView().byId("SDItems");if(S){I=S.getItems();if(I&&I.length){l=I.length}}var i;for(i=0;i<l;i++){o=I[i].getBindingContext().getObject();if(o.ShortageCount>s){s=o.ShortageCount}}var B=this.getView().getModel("Common_i18n").getResourceBundle();t=B.getText("DETAIL_LIST_TITLE",[s])}var T=this.getView().byId("panel").getHeaderToolbar();if(T){T.getContent()[0].setTitle(t)}},switchToChart:function(){this.isChartVisible=true;this.getView().byId("chartContainer").setVisible(true);this.getView().byId("SDItems").setVisible(false)},switchToTable:function(){this.isChartVisible=false;this.getView().byId("chartContainer").setVisible(false);this.getView().byId("SDItems").setVisible(true)},onToolbarIconSelect:function(e){var s=e.getSource();var b=s.getSelectedButton();if(b.match("btnChart")){this.switchToChart()}else{this.switchToTable()}},initChart:function(){var c=this.getView().byId("chart");c.attachSelected(this.selectShortageInChart,this);this.oChartModel=new sap.ui.model.json.JSONModel();this.oChartModel.setSizeLimit(10000);c.setModel(this.oChartModel);var C=new i2d.pp.mrpcockpit.reuse.controls.ChartValue({date:"{date}",demand:"{demand}",supply:"{supply}",shortageAccepted:"{shortageAccepted}"});c.setProperty("height","300px",true);c.setProperty("width","100%",true);var n=this.getView().getModel("Common_i18n").getResourceBundle().getText("NO_NAVIGATION_TO_SOLUTION");c.setProperty("noNavigationText",n,true);var b=this.getView().getModel("Common_i18n").getResourceBundle().getText("XTOL_BAL_DOT");c.setProperty("balanceDotTooltip",b);c.bindProperty("shiftLeft","/shiftLeft");c.bindProperty("unitDecimals","/decimals");c.bindProperty("startBalance","/startBalance");c.bindProperty("minStock","/minStock");c.bindProperty("safetyStock","/safetyStock");c.bindValues("/chartData",C)},setChartData:function(){var v=this.getView();var d=v.getModel().oData;var c=new i2d.pp.mrpcockpit.reuse.util.CalculationEngine(v.getModel("Common_i18n"));var r=[];var t=this.byId("SDItems");var I=(t)?t.getItems():[];var l=(I&&I.length)?I.length:0;for(var i=0;i<l;i++){var o=d[I[i].getBindingContext().getPath().slice(1)];r.push(o)}var m=c.initialChartData(r,this.dateStart,this.dateEnd,0);this.oChartModel.setData(m)},navToMM02:function(c){var m=this.getView().getBindingContext().getObject().MaterialID;var s="MRPMaterial";var a="changeMaterial";var p={"Material":m};i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToMD04:function(c){var m=this.getView().getBindingContext().getObject();var a=m.MaterialID;var b=m.MRPArea;var p=m.MRPPlant;var s="MRPMaterial";var d="showStockRequirementsList";var e={"Material":a,"MRPPlant":b,"MRPArea":p};i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,d,e)},navToTransaction:function(e){var d=e.getSource().getBindingContext().getObject();var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSemanticObject(d.QuickviewCategory);var a=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getTransactionAction(d.QuickviewCategory);var p=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getNavigationParameter(d.QuickviewCategory,d.MRPElement,' ',d.PlannedOrder);i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToFactsheet:function(e){var d=e.getSource().getBindingContext().getObject();var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSemanticObject(d.QuickviewCategory);var a=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getFactsheetAction(d.QuickviewCategory);var p=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getNavigationParameter(d.QuickviewCategory,d.MRPElement,d.MRPElementItem,d.PlannedOrder);i2d.pp.mrpcockpit.reuse.util.Helper.factsheetNavigate(s,a,p)},navToPODestination:function(e){var p=e.getSource().getBindingContext().getObject();var v=this.getView().getModel('ServiceVersions').getData().iServiceSchemaVersion;if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToPOApp(p)}else{this.navToTransaction(e)}},navToSODestination:function(e){var s=e.getSource().getBindingContext().getObject();var v=this.getView().getModel('ServiceVersions').getData().iServiceSchemaVersion;if(v===i2d.pp.mrpcockpit.reuse.util.CommonConstants.BACKEND_MODEL_S){i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToSOApp(s)}else{this.navToTransaction(e)}},openFactSheetActionSheet:function(e){if(!this._actionSheet){this._actionSheet=new sap.m.ActionSheet({title:"",showCancelButton:false,placement:sap.m.PlacementType.Top,buttons:[new sap.m.Button({icon:"sap-icon://popup-window",text:"{Common_i18n>MD04}",press:jQuery.proxy(this.navToMD04,this)}),new sap.m.Button({icon:"sap-icon://popup-window",text:"{Common_i18n>MM02}",press:jQuery.proxy(this.navToMM02,this)})]});this._actionSheet.setModel(this.getView().getModel("Common_i18n"),"Common_i18n")}this._actionSheet.openBy(e.getSource())},onExit:function(){if(this._actionSheet){this._actionSheet.destroy()}this._unsubscribeEvents();this.removeHandler();this.oApplicationFacade.deRegisterOnMasterListRefresh(this.onMasterRefresh,this);this.getView().getModel().detachRequestCompleted(this._onModelLoaded,this);this.oRouter.detachRoutePatternMatched(this._onRoutePatternMatched,this);i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.destroyQuickViews(this)},removeHandler:function(){if(this.resizeHandlerParent.length>=0){for(var i in this.resizeHandlerParent){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerParent[i])}this.resizeHandlerParent=[]}if(jQuery.device.is.desktop){if(this.resizeHandlerPage.length>=0){for(var j in this.resizeHandlerPage){sap.ui.core.ResizeHandler.deregister(this.resizeHandlerPage[j])}this.resizeHandlerPage=[]}}else{sap.ui.Device.orientation.detachHandler(this.onResize,this);sap.ui.Device.resize.detachHandler(this.onResize,this)}if(this.resizeTimer.length>=0){for(var k in this.resizeTimer){jQuery.sap.clearDelayedCall(this.resizeTimer[k])}this.resizeTimer=[]}},resize:function(r){i2d.pp.mrpcockpit.reuse.util.Helper.resizeUiControls(this,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_S3)},onResize:function(r){if(this.resizeTimer[r]){jQuery.sap.clearDelayedCall(this.resizeTimer[r])}this.resizeTimer[r]=jQuery.sap.delayedCall(200,this,jQuery.proxy(this.resize,this,r))},onBeforeRendering:function(){this.removeHandler()},onAfterRendering:function(){this._registerResizeHandler("mainPage-cont")},selectIconTabBarSelect:function(e){var r=e.getParameter("key");if("supDemItemsTab"==r){this.onResize()}},_registerResizeHandler:function(r){var p=null;var a=null;this.onResize();var n=jQuery("#"+this.getView().getId()+"--"+r);if(n&&n.length){if(r=='mainPage-cont'){p=n}else{p=n.parent()}a=p;while((a.length!=0)&&!(a.attr('id')==this.getView().getId()+"--"+"mainPage-cont")){a=a.parent()}if(p){this.resizeHandlerParent[r]=sap.ui.core.ResizeHandler.register(p[0],jQuery.proxy(this.onResize,this,r))}if(jQuery.device.is.desktop){if(a){this.resizeHandlerPage[r]=sap.ui.core.ResizeHandler.register(a[0],jQuery.proxy(this.onResize,this,r))}}else{sap.ui.Device.orientation.attachHandler(this.onResize,this,r);sap.ui.Device.resize.attachHandler(this.onResize,this,r)}}},onItemsUpdateStarted:function(e){var s=this.getView().byId("SDItems");var i=this.getView().getModel("Common_i18n");if(i&&s){s.setNoDataText(i.getResourceBundle().getText("tableUpdateStarted"))}},onItemsUpdateFinished:function(e){var s=e.getSource();var i=s.getItems();if(!i||i.length===0){var a=this.getView().byId("SDItems");var b=this.getView().getModel("Common_i18n");if(b&&a){a.setNoDataText(b.getResourceBundle().getText("tableUpdateFinished"))}}},onClickChangeRequest:function(e){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.onCRPressed(e);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}},handlePressDispoElementQuickView:function(e){i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.handlePressDispoElementQuickView(e,this)},handleCloseButton:function(e){var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var q=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getQuickViewFragment(m.MRPElementCategory);var a=this._oQuickViewContainer[q];a.close()},_isNavToCrAppAllowed:function(){return true},handleEditButton:function(e){var q=e.getSource().getBindingContext().getObject();var m=this._oSelectedMRPElementItem.getBindingContext().getObject();var c=i2d.pp.mrpcockpit.reuse.util.CommonFormatter.getChangeRequestVisibility(q.SolutionRequestStatus);if(this._isNavToCrAppAllowed()&&c){var E=i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.navToCRApp(q,m);if(E){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:E})}}else{var s=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getSolutionType(q.QuickviewCategory);var v=i2d.pp.mrpcockpit.reuse.util.QuickViewHelper.getEditFragment(q.QuickviewCategory);var Q=new sap.ui.model.json.JSONModel({ContactPersonName:q.ContactPersonName,ContactPersonEmailAddress:q.ContactPersonEmailAddress,ContactPersonPhoneNumber:q.ContactPersonPhoneNumber,IntContactPersonName:q.IntContactPersonName,IntContactPersonEmailAddress:q.IntContactPersonEmailAddress,IntContactPersonTelephone:q.IntContactPersonTelephone,MaterialShortageSolutionType:s,MRPElementAvailyOrRqmtDate:q.MRPElementPlndDeliveryDate,MRPElementChgAvailyOrRqmtDate:q.MRPElementPlndDeliveryDate,MRPElementOpenQuantity:m.MRPElementOpenQuantity,MRPElementChangeOpenQuantity:m.MRPElementOpenQuantity,MaterialGoodsReceiptDuration:q.MaterialGoodsReceiptDuration,AvailabilityDate:q.MRPElementPlndDeliveryDate,ChangedAvailabilityDate:q.MRPElementPlndDeliveryDate,OrderFinishDate:q.OrderFinishDate,ChangedOrderFinishDate:q.OrderFinishDate,MRPElementOriginalTotalQty:q.TotalQuantity,MRPElementChangedTotalQuantity:q.TotalQuantity,OrderedQuantity:q.OrderedQuantity,OrderedChangedQuantity:q.OrderedQuantity,SupplyingPlant:q.BusinessPartnerPlant,Vendor:q.Vendor,VendorName:q.VendorName,TargetQuantityUnitDcmls:q.TargetQuantityUnitDcmls,OrderUnitOfMeasureTechnicalName:q.UnitOfMeasureTechnicalName,MaterialID:m.MaterialID,MRPPlant:q.MRPPlant,MRPArea:m.MRPArea,MRPPlanningSegmentType:m.MRPPlanningSegmentType,MRPPlanningSegmentNumber:m.MRPPlanningSegmentNumber,MRPElement:q.MRPElement,MRPElementCategory:q.MRPElementCategory,MRPElementExternalID:q.MRPElementExternalID,MRPElementItem:q.MRPElementItem,MRPElementItemExternalID:q.MRPElementItemExternalID,MRPElementScheduleLine:q.MRPElementScheduleLine,MRPController:q.MRPController,MRPControllerName:q.MRPControllerName,SolutionRequestNote:q.SolutionRequestNote,SolutionRequestStatus:q.SolutionRequestStatus,VendorResponse:"",MaterialShortageProfile:m.MaterialShortageDefinitionID.substring(0,12),MaterialShortageProfileCount:m.MaterialShortageDefinitionID.substring(12,15),MaterialShortageDefinitionID:m.MaterialShortageDefinitionID,ChangeStateID:q.ChangeStateID,QuickviewCategory:q.QuickviewCategory,PlannedOrder:q.PlannedOrder,ProductionSupervisor:q.ProductionSupervisor,ProductionSupervisorDesc:q.ProductionSupervisorDesc,BusinessPartnerPlant:q.BusinessPartnerPlant,BusinessPartnerPlantName:q.BusinessPartnerPlantName,VendorIsFixed:q.VendorIsFixed});var b=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getServiceSchemaVersion(this.oApplicationFacade);i2d.pp.mrpcockpit.reuse.util.CollaborationHelper.setODataModel(this.getView().getModel(),b);i2d.pp.mrpcockpit.reuse.util.Wave3CollaborationHelper.setODataModel(this.getView().getModel(),b);var a=sap.ui.controller(v);var d=sap.ui.xmlfragment(v,a);d.setModel(this.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");d.setModel(this.getView().getModel("Common_i18n"),"Common_i18n");var o=new sap.ui.model.json.JSONModel(i2d.pp.mrpcockpit.reuse.util.CommonConstants.QUICKVIEW_CAT);d.setModel(o,"QuickEditConstantsModel");d.setModel(Q);d.open()}},refreshSDList:function(){var c=this.getView().getBindingContext();this.getView().setBindingContext(null);this.getView().setBindingContext(c)},_changeModel:function(){var v=this.getView();var c=this.oApplicationFacade.getApplicationModel("changedItems");if(!c){return}var u=new Array();u=this._changeModelAppSpecific();for(var i=0;i<u.length;i++){var U=v.byId(u[i]);if(!U){continue}var C=null;if(v&&v.getBindingContext()){C=v.getBindingContext().getPath()}if(c.getProperty(C)){U.setModel(c);U.bindElement(C)}else{U.setModel();U.unbindElement()}}},_changeModelAppSpecific:function(){return["objectHeader"]},runMRP:function(){var d=this.getView().getModel();d.setUseBatch(true);d.clearBatch();var m=this.getView().getModel("Common_i18n");var b=m.getResourceBundle();var o=this.getView().byId("objectHeader");var B=o.getBindingContext();var o=B.getObject();var u="/RunMRP?MaterialID='";u+=o.MaterialID;u+="'&MRPPlant='";u+=o.MRPPlant;u+="'";d.addBatchChangeOperations([d.createBatchOperation(u,"POST")]);d.submitBatch(function(r,R,e){if(e.length>0){var E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromBatchResponse(b,e);sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("MRP_RUN_ERRORS"),details:E})}else{d.refresh();sap.m.MessageToast.show(b.getText("MRP_RUN_COMPLETED"))}},function(e){var E="";if(e&&e.response&&e.response.body){E=i2d.pp.mrpcockpit.reuse.util.Helper.extractErrorMsgFromStream(b,e.response.body)}else{E=""}sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:b.getText("MRP_RUN_ERRORS"),details:E})},false)}});
