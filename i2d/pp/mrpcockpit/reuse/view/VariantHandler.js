/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.VariantHandler");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.VariantDeleteDialog");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog");i2d.pp.mrpcockpit.reuse.view.VariantHandler={i18NCommonReuseModel:new sap.ui.model.resource.ResourceModel({bundleUrl:jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties"}),openVariantDialog:function(c,C,v,V,s,a,n,l,L,o,b,d,e,f){this.sContainerPrefix=C;this.oVariantData=v;this.sServiceUrl=s;this.sAppURL=a;this.fCallbackFunction=c;this.aVariantNames=V;this.sNumberUnit=n;this.sLPIconMonitor=l;this.sLPIconManage=L;this.sOldVariantName=o;this.b2MonitorTile=b;this.b2ManageTile=d;this.bChangeVariant=e;var D=f.getView().getModel("Common_i18n").getResourceBundle().getText("DefaultLayout");var g=f.getObjectHeaderTitle();if(this.b2MonitorTile===undefined){this.b2MonitorTile=false}if(this.b2ManageTile===undefined){this.b2ManageTile=false}if(this.bChangeVariant===undefined){this.bChangeVariant=false}var h=function(r){};var i=function(p,A,q){this.onVariantSave(this.fCallbackFunction,this.sContainerPrefix,p,this.oVariantData,A,q,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,this.sOldVariantName,e,f)}.bind(this);var j=function(p,A,q){this.openVariantChangeConfirmationDialog(this.fCallbackFunction,this.sContainerPrefix,p,this.oVariantData,A,q,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,f)}.bind(this);this.oMRPDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantSaveDialog",type:sap.ui.core.mvc.ViewType.XML});var k=this.oMRPDialogView.byId("DLG_VARIANT_SAVE");var t=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("CreateVariant");if(e){t=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("ChangeVariant")}var m={title:t,closeFunction:h,saveFunction:i,variantList:this.aVariantNames,changeVariantFunction:j,oldVariantName:this.sOldVariantName,b2MonitorTile:b,b2ManageTile:d,sDefaultLayoutName:D,sListName:g,forcasteDemandApp:f.ForecastDemandManageApp};var M=new sap.ui.model.json.JSONModel(m);k.setModel(M);f.getView().addDependent(k);k.open()},openVariantSaveDialog:function(c,C,v,V,s,a,n,l,L,o,b,d,e,f){var b=false;var d=false;this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var g="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(g);p.fail(function(){if(c){c(false)}});p.done(function(h){this.oPersonalizationContainer=h;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var i={};this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(o);var S=sap.ushell.Container.getService("Bookmark");if(f.sOrderCategory===undefined){var j=a+"-monitor"+"?VariantID="+this.sVariantKey}else{var j=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+f.sOrderCategory}S.countBookmarks(j).fail(function(){this.openVariantDialog(c,C,v,V,s,a,n,l,L,o,b,d,false,f)}.bind(this)).done(function(k){if(k>0){b=true}if(f.sOrderCategory===undefined){var m=a+"-manage"+"?VariantID="+this.sVariantKey}else{var m=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+f.sOrderCategory}S.countBookmarks(m).fail().done(function(k){if(k>0){d=true}this.openVariantDialog(c,C,v,V,s,a,n,l,L,o,b,d,false,f)}.bind(this))}.bind(this))}.bind(this))},openVariantChangeConfirmationDialog:function(c,C,v,V,a,A,s,S,n,l,L,o){this.sContainerPrefix=C;this.oVariantData=V;this.sServiceUrl=S;this.sAppURL=s;this.fCallbackFunction=c;this.sNumberUnit=n;this.sLPIconMonitor=l;this.sLPIconManage=L;this.sVariantName=v;this.bAddBookmarkMonitor=a;this.bAddBookmarkManage=A;var f=function(r){};var b=function(){this.onVariantSave(this.fCallbackFunction,this.sContainerPrefix,this.sVariantName,this.oVariantData,this.bAddBookmarkMonitor,this.bAddBookmarkManage,this.sAppURL,this.sServiceUrl,this.sNumberUnit,this.sLPIconMonitor,this.sLPIconManage,this.sVariantName,true,o)}.bind(this);this.oMRPChangeVariantDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantChangeConfirmationDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPChangeVariantDialogView.byId("DLG_CHANGE_VARIANT_CONFIRMATION");var D={title:"{i18n>DIALOG_CHANGE_VARIANT_TITLE}",closeFunction:f,saveFunction:b,text:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("ChangeVariantConfirmationText",this.sVariantName),};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);o.getView().addDependent(d);d.open()},openVariantDeleteDialog:function(c,C,v,a,o){this.sContainerPrefix=C;this.sVariantName=v;this.fCallbackFunction=c;var f=function(r){};var b=function(r){this.onVariantDelete(this.fCallbackFunction,this.sContainerPrefix,this.sVariantName,a,i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText(("DeleteVariantConfirmation",v)),o)}.bind(this);this.oMRPDELDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.VariantDeleteDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPDELDialogView.byId("DLG_VARIANT_DELETE");d.getBeginButton().setType(sap.m.ButtonType.Reject);var D={title:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariantTitle"),text:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariant",v),closeFunction:f,confirmFunction:b};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);o.getView().addDependent(d);d.open()},openVariantPropertiesDialog:function(c,C,s,a,n,l,L,o,b){var d=false;var e=false;this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var f="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(f);p.fail(function(){if(c){c(false)}});p.done(function(g){this.oPersonalizationContainer=g;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var v={};this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(o);var S=sap.ushell.Container.getService("Bookmark");if(b.sOrderCategory===undefined){var h=a+"-monitor"+"?VariantID="+this.sVariantKey}else{var h=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+b.sOrderCategory}S.countBookmarks(h).fail(function(){}.bind(this)).done(function(i){if(i>0){d=true}if(b.sOrderCategory===undefined){var j=a+"-manage"+"?VariantID="+this.sVariantKey}else{var j=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+b.sOrderCategory}S.countBookmarks(j).fail().done(function(i){if(i>0){e=true}this.openVariantDialog(c,C,null,null,s,a,n,l,L,o,d,e,true,b)}.bind(this))}.bind(this))}.bind(this))},onVariantSave:function(c,C,v,V,a,A,s,S,n,l,L,o,b,d){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var e="MRPCockpit."+C;var N=JSON.parse(JSON.stringify(V));this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(e);p.fail(function(){if(c){c(false)}});p.done(function(f){this.oPersonalizationContainer=f;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var g={};var h=this.oPersonalizationVariantSet.getVariantKeyByName(o);if(((o!==v&&o!=="")&&b)){if(h){N=JSON.parse(JSON.stringify(this.oPersonalizationVariantSet.getVariant(h).getItemValue("Filter")));this.oPersonalizationVariantSet.delVariant(h)}}this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(this.sVariantKey){g=this.oPersonalizationVariantSet.getVariant(this.sVariantKey)}else{g=this.oPersonalizationVariantSet.addVariant(v)}if(N){g.setItemValue("Filter",N);if(N.ViewChanged){N.ViewChanged=false}}this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(b){var B=sap.ushell.Container.getService("Bookmark");if(h){if(B){if(d.sOrderCategory===undefined){this.sTargetUrlMonitor=s+"-monitor"+"?VariantID="+h}else{this.sTargetUrlMonitor=s+"-monitor"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlMonitor).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlMonitor).fail().done(function(){if(d.sOrderCategory===undefined){this.sTargetUrlManage=s+"-manage"+"?VariantID="+h}else{this.sTargetUrlManage=s+"-manage"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}.bind(this))}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}.bind(this))}else{if(d.sOrderCategory===undefined){this.sTargetUrlManage=s+"-manage"+"?VariantID="+h}else{this.sTargetUrlManage=s+"-manage"+"?VariantID="+h+"&OrderCategory="+d.sOrderCategory}B.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}.bind(this))}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}}.bind(this))}}}else{this.createBookmarks(v,this.sVariantKey,s,a,A,l,L,n,S,c,d)}}.bind(this))}.bind(this))},createBookmarks:function(v,V,a,A,b,l,L,n,s,c,C){this.sVariantKey=V;var B=false;this.sVariantKey=this.oPersonalizationVariantSet.getVariantKeyByName(v);var S=sap.ushell.Container.getService("Bookmark");if(C.sOrderCategory===undefined){this.sComplteAppUrlMonitor=a+"-monitor"+"?VariantID="+this.sVariantKey}else{this.sComplteAppUrlMonitor=a+"-monitor"+"?VariantID="+this.sVariantKey+"&OrderCategory="+C.sOrderCategory}S.countBookmarks(this.sComplteAppUrlMonitor).fail().done(function(i){if(A){if(i===0){B=true;S.addBookmark({title:v,subtitle:i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("MONITOR"),url:this.sComplteAppUrlMonitor,icon:l,numberUnit:n,serviceRefreshInterval:10,serviceUrl:s}).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessageBookmark",v))})}}else{if(i>0){S.deleteBookmarks(this.sComplteAppUrlMonitor).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText(("DeleteVariantConfirmation",v)))})}}}.bind(this));if(C.sOrderCategory===undefined){this.sComplteAppUrlManage=a+"-manage"+"?VariantID="+this.sVariantKey}else{this.sComplteAppUrlManage=a+"-manage"+"?VariantID="+this.sVariantKey+"&OrderCategory="+C.sOrderCategory}S.countBookmarks(this.sComplteAppUrlManage).fail().done(function(i){if(b){if(i===0){B=true;var d=i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("MANAGE");if(C.ForecastDemandManageApp){d=C.ForecastDemandManageAppSubtitle}S.addBookmark({title:v,subtitle:d,url:this.sComplteAppUrlManage,icon:L,numberUnit:n,serviceRefreshInterval:10,serviceUrl:s}).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessageBookmark",v))})}}else{if(i>0){S.deleteBookmarks(this.sComplteAppUrlManage).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",v))})}}}.bind(this));if(!B){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("VariantMessage",v))}if(c){c(true,v)}},getVariantByName:function(c,C,v){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var V="DefaultVariant";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var a={};var b=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(b){a=this.oPersonalizationVariantSet.getVariant(b);if(c&&a){if(a.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(a.getItemValue("Filter"))),a.getVariantName(),v)}else{c(false)}}}else{if(this.oPersonalizationContainer.containsVariantSet(V)){var P=this.oPersonalizationContainer.getVariantSet(V);b=P.getVariantKeyByName(v);a=P.getVariant(b);if(c&&a){if(a.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(a.getItemValue("Filter"))),a.getVariantName(),v)}else{c(false)}}else{if(c){c(false)}}}}}.bind(this))},getVariantByID:function(c,C,v){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V={};var a=v.toString();if(a){V=this.oPersonalizationVariantSet.getVariant(a);if(c&&V){if(V.getItemValue("Filter")){c(true,JSON.parse(JSON.stringify(V.getItemValue("Filter"))),V.getVariantName())}else{c(false)}}else{c(false)}}else{if(c){c(false)}}}.bind(this))},getAllVariants:function(c,C){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var v="DefaultVariant";var s="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V=this.oPersonalizationVariantSet.getVariantNamesAndKeys();if(V){var d=[];for(var k in V){if(V.hasOwnProperty(k)){d.push(k)}}if(c){var P=this.oPersonalizationContainer.getVariantSet(v);var D=P.getVariantNamesAndKeys();if(D){var S=d.sort(function(a,b){a=a.toLowerCase();b=b.toLowerCase();if(a==b)return 0;if(a>b)return 1;return-1});for(var k in D){if(D.hasOwnProperty(k)){S.push(k)}}c(true,S)}}}else{if(c){c(false)}}}.bind(this))},onVariantDelete:function(c,C,v,a,s,o){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};this.oPersonalizationVariantSet={};this.sVARIANTSET="Variants";var b="MRPCockpit."+C;this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(b);p.fail(function(){if(c){c(false)}});p.done(function(d){this.oPersonalizationContainer=d;if(!(this.oPersonalizationContainer.containsVariantSet(this.sVARIANTSET))){this.oPersonalizationContainer.addVariantSet(this.sVARIANTSET)};this.oPersonalizationVariantSet=this.oPersonalizationContainer.getVariantSet(this.sVARIANTSET);var V=this.oPersonalizationVariantSet.getVariantKeyByName(v);if(V){this.oPersonalizationVariantSet.delVariant(V);this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){var B=false;jQuery.sap.require("sap.m.MessageToast");var e=sap.ushell.Container.getService("Bookmark");if(e){if(o.sOrderCategory===undefined){this.sTargetUrlMonitor=a+"-monitor"+"?VariantID="+V}else{this.sTargetUrlMonitor=a+"-monitor"+"?VariantID="+V+"&OrderCategory="+o.sOrderCategory}e.countBookmarks(this.sTargetUrlMonitor).fail().done(function(i){if(i>0){B=true;e.deleteBookmarks(this.sTargetUrlMonitor).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",s))})}}.bind(this));if(o.sOrderCategory===undefined){this.sTargetUrlManage=a+"-manage"+"?VariantID="+V}else{this.sTargetUrlManage=a+"-manage"+"?VariantID="+V+"&OrderCategory="+o.sOrderCategory}e.countBookmarks(this.sTargetUrlManage).fail().done(function(i){if(i>0){B=true;e.deleteBookmarks(this.sTargetUrlManage).fail().done(function(){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteTeilConfirmation",s))})}}.bind(this))}if(!B){sap.m.MessageToast.show(i2d.pp.mrpcockpit.reuse.view.VariantHandler.i18NCommonReuseModel.getResourceBundle().getText("DeleteVariantConfirmation",s))}if(c){c(true)}}.bind(this))}else{if(c){c(false)}}}.bind(this))},saveDefaultVariant:function(c,C,v,V){this.oPersonalizationService={};var p={};this.oPersonalizationContainer={};var P={};var d="DefaultVariant";var s="MRPCockpit."+C;var n=JSON.parse(JSON.stringify(V));this.oPersonalizationService=sap.ushell.Container.getService("Personalization");p=this.oPersonalizationService.getPersonalizationContainer(s);p.fail(function(){if(c){c(false)}});p.done(function(o){this.oPersonalizationContainer=o;if(this.oPersonalizationContainer.containsVariantSet(d)){this.oPersonalizationContainer.delVariantSet(d)};this.oPersonalizationContainer.addVariantSet(d);P=this.oPersonalizationContainer.getVariantSet(d);var a={};var D=P.getVariantKeyByName(v);if(D){a=P.getVariant(D)}else{a=P.addVariant(v)}if(n){a.setItemValue("Filter",n)}this.oPersonalizationContainer.save().fail(function(){if(c){c(false)}}).done(function(){if(c){c(true,v)}}.bind(this))}.bind(this))},};
