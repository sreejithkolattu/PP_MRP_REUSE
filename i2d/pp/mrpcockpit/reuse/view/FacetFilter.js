/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.FacetFilter");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.Helper");i2d.pp.mrpcockpit.reuse.view.FacetFilter={_toObject:function(a){var r={};for(var i=0;i<a.length;++i){r[a[i][0]]=a[i][1]}return r},_setFacetFilterState:function(c,f){this.oController=c;if(f.length==0){this._resetFacetFilter(c)}else{var l=this.oController.oFacetFilter.getLists();for(var F=0;F<f.length;F++){var o=f[F];for(var L=0;L<l.length;L++){var a=l[L];if(a.getKey()!==o.listKey){continue}else{a.setActive(o.active);var s=this._toObject(o.selectedItemKeys);a.setSelectedKeys(s)}}}}this.oController.oFacetFilter.setVisible(false);this.oController.oFacetFilter.setVisible(true)},_recreateFacetFilterFiltersFromVariant:function(c,f){this.oController=c;this.oController.aFacetFilterFilters.length=0;for(var F=0;F<f.length;F++){var o=f[F];for(var i=0;i<o.selectedItemKeys.length;i++){var n=new sap.ui.model.Filter(o.listKey,sap.ui.model.FilterOperator.EQ,o.selectedItemKeys[i][0]);this.oController.aFacetFilterFilters.push(n)}}},_handleFacetFilterReset:function(c,f){this.oController=c;if(f.length==0){this._resetFacetFilter(c)}else{this.oController.aFacetFilterFilters.length=0;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];for(var F=0;F<f.length;F++){var a=f[F];if(o.getKey()!==a.listKey){o.setActive(false);var s=this._toObject([]);o.setSelectedKeys(s)}else{o.setActive(true);var s=this._toObject([]);o.setSelectedKeys(s);break}}}}this._recreateFacetFilterFilters(c);this.oController.registerViewChanged();this.oController.runStateMachine(this.oController,this.oController.oEvent.filterChanged);this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_recreateFacetFilter:function(c,f){this.oController=c;this.oController.oFacetFilter.destroyLists();for(var i=0;i<f.length;i++){var I=[];for(var j=0;j<f[i].To_FacetFilterValues.results.length;j++){var n=f[i].To_FacetFilterValues.results[j];if(n.FacetFilterValueID!=""){I.push(n)}}var m="MultiSelect";if(c.getSingleSelectFacetFilter){for(var k=0;k<c.getSingleSelectFacetFilter().length;k++){var s=c.getSingleSelectFacetFilter();if(f[i].FacetFilterField==s[k]){m="SingleSelectMaster";break}}}var o=new sap.ui.model.json.JSONModel({values:I});o.setSizeLimit(I.length);var F="{i18n>FF"+f[i].FacetFilterField+"}";if(this.oController.aDiffFieldText){F="{i18n>"+i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForField("FF"+f[i].FacetFilterField,c)+"}"}var N=new sap.m.FacetFilterList({key:f[i].FacetFilterField,title:F,mode:m,active:false,selectedKeys:undefined,rememberSelections:false,items:{path:"/values",template:new sap.m.FacetFilterItem({text:"{FacetFilterValueText}",key:"{FacetFilterValueID}"})}});N.addStyleClass("sapMRPFFList");N.setModel(o);this.oController.oFacetFilter.addList(N);N.attachListClose(function(){this._handleFacetFilterListClose(this.oController)}.bind(this))}this.oController.oFacetFilter.setShowPersonalization(true);this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_getFacetFilterState:function(c){this.oController=c;var f=[];var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];var n={listKey:o.getKey(),active:o.getActive(),selectedItemKeys:[]};var s=o.getSelectedKeys();for(var S in s){n.selectedItemKeys.push([S,s[S]])}f.push(n)}return f},_handleFacetFilterListClose:function(c){this.oController=c;this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c);this.oController.aStoredFacetFilterState=this.oController.oViewState.FacetFilterState;var f=false;var F=[];for(var i=0;i<this.oController.aFacetFilterFilters.length;i++){F.push(this.oController.aFacetFilterFilters[i])}this._recreateFacetFilterFilters(c);if(this.oController.aFacetFilterFilters.length!=F.length){f=true}else{for(var i=0;i<this.oController.aFacetFilterFilters.length;i++){var o=F[i];var a=this.oController.aFacetFilterFilters[i];if((a.oValue1!=o.oValue1)||(a.sOperator!=o.sOperator)||(a.sPath!=o.sPath)){f=true}}}if(f==true){this.oController.registerViewChanged();this.oController.runStateMachine(this.oController,this.oController.oEvent.filterChanged)}},_resetFacetFilter:function(c){this.oController=c;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];o.setActive(false);var i=o.getItems();for(var I=0;I<i.length;I++){i[I].setSelected(false)}o.removeSelections(true)}this.oController.oViewState.FacetFilterState=this._getFacetFilterState(c)},_recreateFacetFilterFilters:function(c){this.oController=c;this.oController.aFacetFilterFilters.length=0;var l=this.oController.oFacetFilter.getLists();for(var L=0;L<l.length;L++){var o=l[L];if(o.getActive()==true){var k=o.getKey();var s=o.getSelectedKeys();for(var S in s){var n=new sap.ui.model.Filter(k,sap.ui.model.FilterOperator.EQ,S);this.oController.aFacetFilterFilters.push(n)}}}}};
