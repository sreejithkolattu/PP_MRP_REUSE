/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.TableSorting");i2d.pp.mrpcockpit.reuse.view.TableSorting={_getVSDialogNEW:function(c){this.oController=c;if(this.oController.newVSDialog){this.oController.oVSDialog=new sap.m.ViewSettingsDialog({sortItems:this._getSortFields(),groupItems:[],filterItems:[],confirm:function(e){var p=e.getParameters();var s=[];if(p.groupItem){var P=p.groupItem.getKey();var d=p.groupDescending;var g=this.oController.oController.mGroupFunctions[P];s.push(new sap.ui.model.Sorter(P,d,g))}var P=p.sortItem.getKey();var d=p.sortDescending;if(!this.oController.bSortDescending){this.oController.bsortDescending=d}else{d=this.oController.bsortDescending};this.oController.bSortPath=P;s.push(new sap.ui.model.Sorter(P,d));this.oController.oSorter=s;this.oController.runStateMachine(this.oController,this.oController.oEvent.tableChanged);this.oController.oViewState.SortKey=P;this.oController.oViewState.SortDescending=d;this.oController.registerViewChanged()}.bind(this)});this.oController.newVSDialog=false}return this.oController.oVSDialog},_getSortFields:function(){var s=function(p,d){var i,e=-1;for(i=0;i<p.length;i++){if(p[i][0]===d){e=i;break}}return e};var S=false;var a=[];var b="";var c=this._getCellsInOrder();if(c.length!==0){for(var i=0;i<c.length;i++){var m=s(this.oController.aDefaultSorting,c[i]);if(m>=0){if(this.oController.aDiffFieldText){b=this.oController.oResourceBundle.getText(i2d.pp.mrpcockpit.reuse.util.Helper.getSpecialTextForField(c[i],this.oController))}else{b=this.oController.oResourceBundle.getText(c[i])}S=((this.oController.bSortPath&&(this.oController.bSortPath===c[i]))||(!this.oController.bSortPath&&(this.oController.aDefaultSorting[m][1]===1)));var v=new sap.m.ViewSettingsItem({text:b,key:c[i],selected:S});a.push(v)}}}return a},_getCellsInOrder:function(p){var t=[];var a=[];this.oController.oTable.getColumns().forEach(function(c){if((c.getVisible()&&p)||!p){a[this.oController.oTable.getColumns(true).indexOf(c)]=c.data("mrpcoDataField")}}.bind(this));a.forEach(function(c){var C=[];C=c.split(",");C.forEach(function(b){t.push(b)})});return t}};
