/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.declare("i2d.pp.mrpcockpit.reuse.view.AoRHandler");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.AoRAddDialog");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.AoRMainDialog");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog");i2d.pp.mrpcockpit.reuse.view.AoRHandler={i18NCommonReuseModel:new sap.ui.model.resource.ResourceModel({bundleUrl:jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties"}),openOnboardingDialog:function(e,s,c,C){this.openAoRMainDialog(e,true,s,c,null,false,C)},openFirstOnboardingDialog:function(s,c,C){this.openAoRWelcomeDialog(null,s,c,C)},openAoRAddDialog:function(e,s,c,a,C,o){var b=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var B=new sap.ui.model.resource.ResourceModel({bundleUrl:b});var S=function(E){var v=E.getParameter("value");var F=new sap.ui.model.Filter("MRPControllerName",sap.ui.model.FilterOperator.Contains,v);var h=E.getSource().getBinding("items");h.filter([F])};var t=this;var f=function(E){if(E){this.openAoRMainDialog(E,false,s,c,a,C,o)}}.bind(this);var d=function(E){if(E){if(C){var h=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNav=h&&h("CrossApplicationNavigation");var j=(this.oCrossAppNav&&this.oCrossAppNav.toExternal({target:{shellHash:"#"}}))||""}else{if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED)}}}}.bind(this);this.oMRPSDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRAddDialog",type:sap.ui.core.mvc.ViewType.XML});var D=this.oMRPSDialogView.byId("DLG_SELECT");var g={closeFunction:d,confirmFunction:f};D._list.setShowNoData(false);D._list.removeSelections(true);o.getView().addDependent(D);D.open();var m=new sap.ui.model.json.JSONModel(g);D.setModel(m);D.setModel(B,"commondialogs_i18n");D.setTitle(D.getModel('commondialogs_i18n').getResourceBundle().getText("DIALOG_SELECT"));D.setModel(s,"items");var i=D.getBinding("items");if(i.aFilters.length!=0){D.getBinding("items").filter([])}},openAoRMainDialog:function(e,r,s,c,a,C,o){var b=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var B=new sap.ui.model.resource.ResourceModel({bundleUrl:b});var t=this;if(!a){a=[]}this.oSelModel=s;this.oSelectedItemsJSON=new sap.ui.model.json.JSONModel();jQuery.sap.require("sap.m.MessageToast");if(r){s.read("/MRPControllers",null,{"$filter":"(AreaOfResponsibility eq true)"},true,function(p,R){t.oSelectedItemsJSON.setData({data:p.results});a=p.results})}else{this.oSelectedItems=[];this.oSelectedItems=e.getParameter("selectedContexts");if(this.oSelectedItems){for(var i=0;i<this.oSelectedItems.length;i++){var f=false;for(var j=0;j<a.length;j++){var T=this.oSelectedItems[i].getObject();if(a[j].MRPControllerID===T.MRPControllerID&&a[j].MRPPlant===T.MRPPlant){f=true;break}}if(!f){a.push(this.oSelectedItems[i].getObject())}}this.oSelectedItemsJSON.setData({data:a})}}var d=function(R){if(C){var p=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;this.oCrossAppNav=p&&p("CrossApplicationNavigation");var q=(this.oCrossAppNav&&this.oCrossAppNav.toExternal({target:{shellHash:"#"}}))||""}else{if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED)}}n()}.bind(this);var O=function(e){if(e){t.openAoRAddDialog(e,t.oSelModel,c,a,C,o)}};var g=function(e){if(e){t.sendAoRtoBackend(e,t.oSelectedItemsJSON,c,t.sSuccessMessage,s);n()}};this.oMRPAORDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRMainDialog",type:sap.ui.core.mvc.ViewType.XML});var D={closeFunction:d,addFunction:O,confirmFunction:g};var h=new sap.m.Button({press:g,text:""});var k=new sap.m.Button({press:d,text:""});var l=sap.ui.getCore().byId("DLG_AOR_ID");if(l!==undefined){l.removeAllContent();l.destroy()}l=new sap.m.Dialog("DLG_AOR_ID",{content:[this.oMRPAORDialogView],title:"",beginButton:h,endButton:k});var m=new sap.ui.model.json.JSONModel(D);l.setModel(m);l.setModel(this.oSelectedItemsJSON,"items");l.setModel(B,"commondialogs_i18n");l.getBeginButton().setText(l.getModel('commondialogs_i18n').getResourceBundle().getText("BUTTON_OK"));l.getEndButton().setText(l.getModel('commondialogs_i18n').getResourceBundle().getText("BUTTON_CANCEL"));l.setTitle(l.getModel('commondialogs_i18n').getResourceBundle().getText("DIALOG_AOR"));var n=function(e){l.close()};this.sSuccessMessage=l.getModel('commondialogs_i18n').getResourceBundle().getText("SEND_AOR_SUCCESS_MSG");o.getView().addDependent(l);l.open()},openAoRWelcomeDialog:function(e,s,c,C){var a=jQuery.sap.getModulePath("i2d.pp.mrpcockpit.reuse")+"/"+"i18n/i18n.properties";var b=new sap.ui.model.resource.ResourceModel({bundleUrl:a});var f=function(r){};var t=this;var o=function(E){if(E){t.openAoRAddDialog(E,s,c,null,true,C)}};this.oMRPWLCDialogView=new sap.ui.view({viewName:"i2d.pp.mrpcockpit.reuse.view.AoRWelcomeDialog",type:sap.ui.core.mvc.ViewType.XML});var d=this.oMRPWLCDialogView.byId("DLG_WLC");var D={title:b.getResourceBundle().getText("DIALOG_WELCOME"),text:b.getResourceBundle().getText("DIALOG_WELCOME_TEXT"),closeFunction:f,fnOpenAoRAddDialog:o};var m=new sap.ui.model.json.JSONModel(D);d.setModel(m);d.setModel(b,"commondialogs_i18n");C.getView().addDependent(d);d.open()},sendAoRtoBackend:function(e,s,c,a,m){var M=[];if(s){for(var i=0;i<s.oData.data.length;i++){var o={};o.MRPPlant=s.oData.data[i].MRPPlant;o.MRPControllerID=s.oData.data[i].MRPControllerID;M.push(o)}}var A={};A.AreaOfResponsibility_To_MRPControllers=M;m.create('/AreasOfResponsibility',A,null,function(){jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(a);if(c){c()}},function(){if(c){c(i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_FAILED)}})}};
