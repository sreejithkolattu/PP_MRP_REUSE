/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.m.TablePersoController");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.AoRHandler");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.VariantHandler");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.StateMachine");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.ViewStateHandler");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.DisplayVariant");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.FacetFilter");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.view.TableSorting");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper");jQuery.sap.require("i2d.pp.mrpcockpit.reuse.util.CommonConstants");sap.ca.scfld.md.controller.BaseFullscreenController.extend("i2d.pp.mrpcockpit.reuse.view.S1parent",{constructor:function(){sap.ca.scfld.md.controller.BaseFullscreenController.apply(this,arguments);var o=this.onInit;this.onInit=function(){i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.initialize(this.getView().getModel(),this.getMasterServiceEntity(),this.oApplicationImplementation);var v=this.oApplicationImplementation.getApplicationModel("ServiceVersions");this.getView().setModel(v,"ServiceVersions");this.aDiffFieldText=[];if(i2d.pp.mrpcockpit.reuse.util.CommonConstants.ONE_CODELINE_TEXT){switch(v){case 1:break;default:this.aDiffFieldText=[["xtolTimeHorizonSelect",["xtolTimeHorizonSelectSoH","xtolTimeHorizonSelectModS"]],["xtolShortageDefinitionSelect",["xtolShortageDefinitionSelectSoH","xtolShortageDefinitionSelectModS"]]];break}}var b=new sap.ui.model.resource.ResourceModel({bundleName:"i2d.pp.mrpcockpit.reuse.i18n.i18n"});this.getView().setModel(b,"Common_i18n");o.apply(this,arguments)}},oPersoService:{init:function(p){this._sPersistenceId=p;this._oBundle={}},getPersData:function(){var d=new jQuery.Deferred();var b=this._oBundle;d.resolve(b);return d.promise()},setPersData:function(b){var d=new jQuery.Deferred();this._oBundle=b;d.resolve();return d.promise()},resetPersData:function(c){var d=new jQuery.Deferred();var i={_persoSchemaVersion:"1.0",aColumns:c};this._oBundle=i;d.resolve();return d.promise()}},onInit:function(){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this.oHeaderFooterOptions={oEditBtn:{sId:"manageButton",sI18nBtnTxt:"btnManageShortages",bDisabled:false,onBtnPressed:jQuery.proxy(this.onNavigationButtonPressed,this)},bSuppressBookmarkButton:true,aAdditionalSettingButtons:[{sI18nBtnTxt:"AreaOfResponsibility",onBtnPressed:function(e){this.aStoredFacetFilterState=this.oViewState.FacetFilterState;this.runStateMachine(this,this.oEvent.aORButtonPressed)}.bind(this)}]};this.setHeaderFooterOptions(this.oHeaderFooterOptions);this.oRouter.attachRoutePatternMatched(this.onRouteMatched,this);this.logger=jQuery.sap.log.getLogger(this.getVariantContainerPrefix());this.logger.setLevel(jQuery.sap.log.Level.INFO);this.oResourceBundle=this.oApplicationFacade.getResourceBundle();this.oObjectHeader=this.getView().byId("ObjectHeader");this.oShortageSelect=this.oView.byId("ShortageSelect");var s=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,s);this.oTimeHorizonSelect=this.getView().byId("TimeHorizonSelect");this.oFacetFilter=this.getView().byId("FacetFilter");this.aShortageDefinitionKeys=[];this.aFacetFilterFilters=[];this.oTable=this.getView().byId(this.getTableId());this.oView=this.getView();this.oTable.setEnableBusyIndicator(false);this.oTable.setGrowingThreshold(100);this.oTable.setGrowing(true);this.oTableItemTemplate=this.oTable.getItems()[0].clone();this.oTable.removeAllItems();this.oDataModel=this.oApplicationFacade.getODataModel();this.oDataModel.setSizeLimit(999);if(this.getMasterServiceEntity){this._iServiceSchemaVersion=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceSchemaVersion(this.oDataModel,this.getMasterServiceEntity());this._iServiceVersion=i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper._getServiceVersion(this.oDataModel,this.getMasterServiceEntity());i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.removeNeedlessColumnsFromTable(this.oDataModel,this.getMasterServiceEntity(),this.oTable,"mrpcoDataField")};this.oDataModel.attachRequestCompleted(this._onRequestComplete,this);this.oDataModel.attachRequestFailed(this.oDataModel,this._handleRequestFailed,this);this.oPersoService.init(this.getViewNumber()+"PersoService");this._initShortageSelect();if(this.oTimeHorizonSelect){this._initTimeHorizonSelect()}var c=sap.ui.core.Component.getOwnerIdFor(this.getView());this.myComponent=sap.ui.component(c);var C=this.myComponent.getComponentData();this.sVariantID="";this.sStateID=this.myComponent.sStateID;if(C&&C.startupParameters&&C.startupParameters.VariantID){if(C.startupParameters.VariantID[0]!==undefined){this.sVariantID=C.startupParameters.VariantID[0]}}if(C&&C.startupParameters&&C.startupParameters.OrderCategory){if(C.startupParameters.OrderCategory[0]!==undefined){this.sOrderCategory=C.startupParameters.OrderCategory[0];if(this._changeAppName){this._changeAppName(this.sOrderCategory)}}}if(this.getDemandType){this.demandType=this.getDemandType();this.oViewState={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DemandType:this.demandType,DefaultVariant:false,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}}else{this.oViewState={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DefaultVariant:false,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}};this.oVSDialog={};this.bNewVSDialogRequiredAfterTablePers=true;this.newVSDialog=true;this.oSorter=[];this.bSortPath=null;this.bsortDescending=null;this.aTableStateColumnsInitial=this._getInitialTableColumnsState();this.oTPC=new sap.m.TablePersoController({table:this.oTable,persoService:this.oPersoService,componentName:this.getComponentName()}).activate();this.oTPC.attachPersonalizationsDone(function(D){this._personalizationsDone(D)}.bind(this));this.oView.byId(this.getViewNumber()+"TablePersoButton").attachPress(function(){this.oTPC.openDialog()}.bind(this));this._initResultTable();this.sDefaultVariantName="";if(!this.oDefaultVariantData){this.oDefaultVariantData={MaterialShortageDefinitionID:"",TimeHorizon:"7",FacetFilterState:[],TableState:{},SortKey:"",SortDescending:false,DefaultVariant:true,VariantName:"",ViewChanged:false,OrderCategory:this.sOrderCategory}}var d=this.getView().getModel("Common_i18n").getResourceBundle().getText("DefaultLayout");i2d.pp.mrpcockpit.reuse.view.VariantHandler.saveDefaultVariant(null,this.getVariantContainerPrefix(),d,this.oDefaultVariantData);this.oFacetFilter.attachReset(function(){i2d.pp.mrpcockpit.reuse.view.FacetFilter._handleFacetFilterReset(this,this.oDefaultVariantData.FacetFilterState)}.bind(this));this.oVariantData=this.oDefaultVariantData;this.oVariantData.DefaultVariant=false;this.sCurrentVariantName="";this.sVariantContainerPrefix=this.getVariantContainerPrefix();this.bViewHasBeenChanged=false;this.oDisplayVariantPopover=i2d.pp.mrpcockpit.reuse.view.DisplayVariant.getDisplayVariantPopover(this);this.oObjectHeaderIconDomRef={};this.oState=i2d.pp.mrpcockpit.reuse.util.StateMachine.oState;this.oEvent=i2d.pp.mrpcockpit.reuse.util.StateMachine.oEvent;this.oAction=i2d.pp.mrpcockpit.reuse.util.StateMachine.oAction;this.runStateMachine=i2d.pp.mrpcockpit.reuse.util.StateMachine.runStateMachine;this.sState=this.oState.initial;this.runStateMachine(this,this.oEvent.start)},onRouteMatched:function(e){var r=e.getParameter("name");if(r==="state"){var a=e.getParameter("arguments");if((a.stateID!="undefined")&&(a.stateID!=this.sStateID)){var m=/id-.*-.*/;var s=m.exec(a.stateID);if(s){this.sStateID=s[0]}}}else{return}},registerViewChanged:function(){if(this.bViewHasBeenChanged==false){this.bViewHasBeenChanged=true;if(this.sCurrentVariantName){this.oObjectHeader.setTitle(this.sCurrentVariantName+" *");this.oViewState.VariantName=this.sCurrentVariantName}else{this.oObjectHeader.setTitle(this.getObjectHeaderTitle()+" *")}this.oViewState.ViewChanged=true}i2d.pp.mrpcockpit.reuse.view.ViewStateHandler.saveViewStateInContainer(null,this.oViewState,this.sStateID,i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME)},_onRequestComplete:function(d){var u=d.getParameter("url");var s=this.oDataModel.getServiceMetadata().dataServices.schema[0].namespace+this.getMasterEntity();if(d.getSource().bUseBatch){}else if(u.match(this.getShortageEntitySetName())){this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,this.oVariantData.MaterialShortageDefinitionID);var I=this.oShortageSelect.getItems();for(var i=0;i<I.length;i++){var o=I[i];this.aShortageDefinitionKeys.push(o.getKey())};if(this.oVariantData.MaterialShortageDefinitionID!=""){if(this.aShortageDefinitionKeys.length>0){var S=false;for(var i=0;i<this.aShortageDefinitionKeys.length;i++){if(this.aShortageDefinitionKeys[i]==this.oVariantData.MaterialShortageDefinitionID){S=true;this.oShortageSelect.setSelectedKey(this.oVariantData.MaterialShortageDefinitionID);break}}if(S==false){this.oShortageSelect.setSelectedItem(I[0]);var a=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,a);this.oViewState.MaterialShortageDefinitionID=a;sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("SHORTDEF_MISSING_MSG"))}}else{sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("SHORTDEF_MISSING_MSG"))}}else{if(this.aShortageDefinitionKeys.length>0){this.oShortageSelect.setSelectedItem(I[0]);var a=this.oShortageSelect.getSelectedKey();this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,a);this.oViewState.MaterialShortageDefinitionID=a}}}else if(u.match(s)){var b=d.getParameters("errorobject");var c=b&&b.errorobject&&b.errorobject.responseText;if(c){if(!c.match('@AOR@')){this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"));this.runStateMachine(this,this.oEvent.tableDataReceived)}}else{this.runStateMachine(this,this.oEvent.tableDataReceived)}}},_handleRequestFailed:function(e){var s=e.getParameter("responseText");if(s){if(s.match('@AOR@')){this.runStateMachine(this,this.oEvent.aORUndefined)}else if(s.match('@SHORTDEF@')){sap.m.MessageBox.alert(this.getView().getModel("Common_i18n").getResourceBundle().getText("NO_SHORTDEF_MSG"))}else{this.oApplicationFacade.oApplicationImplementation.oConnectionManager.handleRequestFailed(e)}}else{this.oApplicationFacade.oApplicationImplementation.oConnectionManager.handleRequestFailed(e)}},getServiceVersion:function(){return this._iServiceVersion},getServiceSchemaVersion:function(){return this._iServiceSchemaVersion},_rebindRefreshTable:function(){var f=[];if(this._iServiceSchemaVersion>1){f.push(i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFilterFrontendVersion())}if(this.sOrderCategory!==undefined){var o=new sap.ui.model.Filter("MRPElementCategory",sap.ui.model.FilterOperator.EQ,this.sOrderCategory);f.push(o)}if(this.filterMaterialShortage.oValue1!=""){f.push(this.filterMaterialShortage)}if(this.oTimeHorizonSelect){f.push(this.filterTimeHorizon)}if(this.getSpecificAppFilter()){f.push(this.getSpecificAppFilter())}for(var F=0;F<this.aFacetFilterFilters.length;F++){f.push(this.aFacetFilterFilters[F])}if(this.sDataFieldSelect){this._setupMasterEntityCall(this.getMasterEntity(),this.oTableItemTemplate,this.oSorter,this.sDataFieldSelect,f)}else{this._setupMasterEntityCall(this.getMasterEntity(),this.oTableItemTemplate,this.oSorter,this.getInitialSelectFields(),f)}this.newVSDialog=true},_handleShortageChange:function(){var s=this.oShortageSelect.getSelectedKey();this.oViewState.MaterialShortageDefinitionID=s;this.filterMaterialShortage=new sap.ui.model.Filter("MaterialShortageDefinitionID",sap.ui.model.FilterOperator.EQ,s);this.registerViewChanged();this.runStateMachine(this,this.oEvent.filterChanged)},_handleTimeHorizonChange:function(){var s=this.oTimeHorizonSelect.getSelectedKey();this.oViewState.TimeHorizon=s;this.filterTimeHorizon=new sap.ui.model.Filter("DynamicHorizonCode",sap.ui.model.FilterOperator.EQ,s);this.registerViewChanged();this.runStateMachine(this,this.oEvent.filterChanged)},_setFacetFilterState:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._setFacetFilterState(this,f)},_recreateFacetFilterFiltersFromVariant:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._recreateFacetFilterFiltersFromVariant(this,f)},_recreateFacetFilter:function(f){i2d.pp.mrpcockpit.reuse.view.FacetFilter._recreateFacetFilter(this,f)},_initShortageSelect:function(){var s=new sap.ui.core.Item({text:"{MaterialShortageDefinitionName}",key:"{MaterialShortageDefinitionID}"});var S=[new sap.ui.model.Filter("MaterialShortageDefinitionType",sap.ui.model.FilterOperator.EQ,this.getShortageDefintionType())];this.oShortageSelect.bindItems({path:"/MaterialShortageDefinitions",template:s,filters:S});this.oShortageSelect.attachChange(function(){this._handleShortageChange()}.bind(this))},_initTimeHorizonSelect:function(){this.oTimeHorizonSelect.setSelectedKey("7");var s=this.oTimeHorizonSelect.getSelectedKey();this.filterTimeHorizon=new sap.ui.model.Filter("DynamicHorizonCode",sap.ui.model.FilterOperator.EQ,s);this.oTimeHorizonSelect.attachChange(function(){this._handleTimeHorizonChange()}.bind(this))},_initResultTable:function(){this.oTable.attachUpdateFinished(function(e){if(this.bNewVSDialogRequiredAfterTablePers==true){this.bNewVSDialogRequiredAfterTablePers=false;this.newVSDialog=true;this.oVSDialog=i2d.pp.mrpcockpit.reuse.view.TableSorting._getVSDialogNEW(this);var s=this.oVSDialog.getSortItems();for(var i=0;i<s.length;i++){var S=s[i];if(S.getKey()==this.oViewState.SortKey){this.oVSDialog.setSelectedSortItem(S)}}this.oVSDialog.setSortDescending(this.oViewState.SortDescending)}this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"));var n=e.getParameter("total");jQuery.sap.delayedCall(0,this,function(){this.oObjectHeader.setNumber(n)})}.bind(this));this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateStarted"))},_setupMasterEntityCall:function(m,t,s,i,f){this.oTable.bindItems({path:m,template:t,sorter:s,parameters:{select:i},filters:f})},_setupFacetFilterCall:function(){var f=this.getFacetFilterDefaults();if(this.getDemandType){var F="$filter=((FacetFilterType eq '"+this.getFacetFilterType()+"')) and ((DemandType eq '"+this.getDemandType()+"')) and (((FacetFilterField eq '"+f[0]+"'))"}else{var F="$filter=((FacetFilterType eq '"+this.getFacetFilterType()+"')) and (((FacetFilterField eq '"+f[0]+"'))"}for(var i=1;i<f.length;i++){F=F+" or ((FacetFilterField eq '"+f[i]+"'))"}F=F+")";if(this._iServiceSchemaVersion>1){F=F+" and ((Version eq '"+i2d.pp.mrpcockpit.reuse.util.InteroperabilityHelper.getFrontendVersion()+"'))"}if(this.sOrderCategory!==undefined){F=F+" and ((MRPElementCategory eq '"+this.sOrderCategory+"'))"}var e="$expand=To_FacetFilterValues";var j="$format=json";var u=[F,e,j];this.oDataModel.read('/FacetFilters',null,u,true,function(d,r){this._recreateFacetFilter(d.results);this.runStateMachine(this,this.oEvent.facetDataReceived)}.bind(this),function(E){this.oFacetFilter.setShowPersonalization(false);var b=E&&E.response&&E.response.body;if(b){if(b.match('@AOR@')){this.runStateMachine(this,this.oEvent.aORUndefined)}else{this.runStateMachine(this,this.oEvent.noFacetDataReceived)}}else{this.runStateMachine(this,this.oEvent.noFacetDataReceived)}}.bind(this))},_firstAORDialogFinished:function(){this.runStateMachine(this,this.oEvent.firstAORDialogFinished)},_aORDialogFinished:function(r){if(r==i2d.pp.mrpcockpit.reuse.util.CommonConstants.AOR_DEFINITION_CANCELED){this.runStateMachine(this,this.oEvent.aORDialogCancelled)}else{this.runStateMachine(this,this.oEvent.aORDialogFinished)}},onItemsUpdateStarted:function(e){this.setBtnEnabled("manageButton",false);this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateStarted"))},onItemsUpdateFinished:function(){if(this.oTable.getSelectedItems().length>0){this.setBtnEnabled("manageButton",true)}this.oTable.setNoDataText(this.getView().getModel("Common_i18n").getResourceBundle().getText("itemUpdateFinished"))},_getInitialTableColumnsState:function(){var c=[];var C=this.oTable.getColumns();for(var i=0;i<C.length;i++){var o=C[i];var I=o.getId();var O=i;var t=o.getHeader().getText();var v=o.getVisible();c.push({id:I,order:O,text:t,visible:v})}return c},_personalizationsDone:function(d){this.bNewVSDialogRequiredAfterTablePers=true;var m=this.oPersoService.getPersData();m.done(this._refilloDataSelectFields.bind(this));m.done(this._storeTableState.bind(this));m.done(this._triggerStateMachineEventTableChanged.bind(this));this.registerViewChanged()},_triggerStateMachineEventTableChanged:function(){this.runStateMachine(this,this.oEvent.tableChanged)},_refilloDataSelectFields:function(){var u=this._determineFieldsForVisibleColumns();this.sDataFieldSelect="";this.sDataFieldSelect+=this.getBaseSelectFields();for(var i=0;i<u.length;i++){this.sDataFieldSelect+=","+u[i]}},_determineFieldsForVisibleColumns:function(){var c=[];var C={};var t="";var a="";var A=[];var u=[];c=this.oTable.getColumns();for(var i=0;i<c.length;i++){C=c[i];if(C.getVisible()==true){t=C.data("mrpcoDataField");if(t){if(a==""){a=t}else{a=a+","+t}}}};if(a!=""){A=a.split(",");u=jQuery.sap.unique(A)}return u},_storeTableState:function(t){this.oViewState.TableState=t},_applyTableStateToTable:function(t){this.oPersoService.setPersData(t);this.oTPC.applyPersonalizations()},_resetTableStateToTable:function(t){this.oPersoService.resetPersData(this.aTableStateColumnsInitial);if(this.oTPC.refresh){this.oTPC.refresh()}},onViewSettingsDialogButtonPressed:function(e){this.oVSDialog.open()},onVariantSelectorPress:function(e){this.oObjectHeaderIconDomRef=e.getParameters().domRef;i2d.pp.mrpcockpit.reuse.view.DisplayVariant.readVariantList(this)},_keyGen:function(){return jQuery.sap.uid()},onNavigationButtonPressed:function(e){var l=this.getView().byId(this.getTableId());this.setBtnEnabled("manageButton",false);sap.ca.ui.utils.busydialog.requireBusyDialog();var s=l.getSelectedItems();if(s.length>0){var f=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var c=f&&f("CrossApplicationNavigation");if(c){var h="MRPCockpitNavigation."+this.sViewNumber;var p=sap.ushell.Container.getService("Personalization");var C=h;if(p.getContainer){p.getContainer(C,{validity:i2d.pp.mrpcockpit.reuse.util.CommonConstants.VIEW_STATE_VALIDITY_TIME}).fail(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();jQuery.sap.log.error("Loading personalization data failed.")}).done(function(o){o.setItemValue("Navigation",this.getNavigationParams());o.save().done(function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();var P={"navigationID":h};if(this.sOrderCategory!=undefined){P.OrderCategory=this.sOrderCategory}c.toExternal({target:this.getNavigationTarget(),params:P})}.bind(this))}.bind(this))}}else{var m=this.oResourceBundle.getText("messNoLaunchpad");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m})}}else{var m=this.oResourceBundle.getText("messNoItems");sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m})}},onItemSelection:function(e){var l=this.oView.byId(this.getTableId());var s=[];s=l.getSelectedItems();if(s.length===0){this.setBtnEnabled("manageButton",false)}else{this.setBtnEnabled("manageButton",true)}},onItemsLoaded:function(e){this.setBtnEnabled("manageButton",false)},handlePressMaterialShortageQuickView:function(e){if(!this._oShortageQuickView){this._oShortageQuickView=sap.ui.xmlfragment("i2d.pp.mrpcockpit.reuse.fragments.MaterialShortageQuickView",this);this._oShortageQuickView.setModel(this.oApplicationImplementation.getApplicationModel("ServiceVersions"),"ServiceVersions");this._oShortageQuickView.setModel(this.getView().getModel("Common_i18n"),"Common_i18n");this._oShortageQuickView.setModel(this.getView().getModel())}var s=e.getSource();var d=s.getBindingContext().getObject();var q="/Materials(";q+="MaterialID='"+encodeURIComponent(d.MaterialID)+"',";q+="MaterialShortageDefinitionID='"+encodeURIComponent(d.MaterialShortageDefinitionID)+"',";q+="MRPArea='"+encodeURIComponent(d.MRPArea)+"',";q+="MRPPlanningSegmentNumber='"+encodeURIComponent(d.MRPPlanningSegmentNumber)+"',";q+="MRPPlanningSegmentType='"+encodeURIComponent(d.MRPPlanningSegmentType)+"',";q+="MRPPlant='"+encodeURIComponent(d.MRPPlant)+"'";q+=")";q+="?$select=";q+="MaterialExternalID,MaterialName,AvailabilityChart,MaterialShortageStartDate,MaterialShortageEndDate,DaysOfSupplyDuration,"+"MaterialShortageQuantity,MaterialABCClassification,MRPAvailableStockQuantity,MaterialSafetyStockQty,TargetQuantityUnitDcmls,"+"ManualPlanningHorizonEndDate,TotalReplenishmentLeadDuration,VendorName,MaterialProcurementCategory,UnitOfMeasureTechnicalName,MRPPlant,MRPArea";this._oShortageQuickView.bindElement(q);this._oShortageQuickView.getElementBinding().attachDataReceived(function(){this._oShortageQuickView.openBy(s)},this)},handleQuickViewCloseButton:function(e){this._oShortageQuickView.close()},onExit:function(){sap.ca.ui.utils.busydialog.releaseBusyDialog();this.oDataModel.detachRequestCompleted(this._onRequestComplete,this);this.oDataModel.detachRequestFailed(this.oDataModel,this._handleRequestFailed,this);this.oTPC.detachPersonalizationsDone();this.oRouter.detachRoutePatternMatched(this.onRouteMatched,this);this.oView.byId(this.getViewNumber()+"TablePersoButton").detachPress();this.oFacetFilter.detachReset()}});
